var s_=Object.defineProperty;var Wg=n=>{throw TypeError(n)};var i_=(n,t,e)=>t in n?s_(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var T=(n,t,e)=>i_(n,typeof t!="symbol"?t+"":t,e),jd=(n,t,e)=>t.has(n)||Wg("Cannot "+e);var d=(n,t,e)=>(jd(n,t,"read from private field"),e?e.call(n):t.get(n)),x=(n,t,e)=>t.has(n)?Wg("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(n):t.set(n,e),_=(n,t,e,s)=>(jd(n,t,"write to private field"),s?s.call(n,e):t.set(n,e),e),v=(n,t,e)=>(jd(n,t,"access private method"),e);var xe=(n,t,e,s)=>({set _(i){_(n,t,i,e)},get _(){return d(n,t,s)}});(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();const n_="modulepreload",r_=function(n){return"/blood-analyzer/"+n},jg={},jc=function(t,e,s){let i=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(e.map(l=>{if(l=r_(l),l in jg)return;jg[l]=!0;const c=l.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const u=document.createElement("link");if(u.rel=c?"stylesheet":n_,c||(u.as="script"),u.crossOrigin="",u.href=l,a&&u.setAttribute("nonce",a),document.head.appendChild(u),c)return new Promise((f,g)=>{u.addEventListener("load",f),u.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function r(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&r(a.reason);return t().catch(r)})};var el={};el.d=(n,t)=>{for(var e in t)el.o(t,e)&&!el.o(n,e)&&Object.defineProperty(n,e,{enumerable:!0,get:t[e]})};el.o=(n,t)=>Object.prototype.hasOwnProperty.call(n,t);var J=globalThis.pdfjsLib={};el.d(J,{AbortException:()=>ro,AnnotationEditorLayer:()=>Tf,AnnotationEditorParamsType:()=>K,AnnotationEditorType:()=>ot,AnnotationEditorUIManager:()=>Zr,AnnotationLayer:()=>iA,AnnotationMode:()=>Wi,CMapCompressionType:()=>bu,ColorPicker:()=>Kh,DOMSVGFactory:()=>lg,DrawLayer:()=>Df,FeatureTest:()=>Te,GlobalWorkerOptions:()=>ki,ImageKind:()=>hh,InvalidPDFException:()=>Um,MissingPDFException:()=>no,OPS:()=>ss,PDFDataRangeTransport:()=>jb,PDFDateString:()=>eb,PDFWorker:()=>wo,PasswordResponses:()=>c_,PermissionFlag:()=>l_,PixelsPerInch:()=>xn,RenderingCancelledException:()=>cg,TextLayer:()=>cl,UnexpectedResponseException:()=>Td,Util:()=>V,VerbosityLevel:()=>Cd,XfaLayer:()=>Ub,build:()=>Nv,createValidAbsoluteUrl:()=>f_,fetchData:()=>Pd,getDocument:()=>Mv,getFilenameFromUrl:()=>S_,getPdfFilenameFromUrl:()=>E_,getXfaPageViewport:()=>C_,isDataScheme:()=>Rd,isPdfFile:()=>hg,noContextMenu:()=>ts,normalizeUnicode:()=>__,setLayerDimensions:()=>Kr,shadow:()=>at,version:()=>Fv});const ue=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Vm=[1,0,0,1,0,0],mu=[.001,0,0,.001,0,0],o_=1e7,Vd=1.35,ze={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Wi={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},a_="pdfjs_internal_editor_",ot={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},K={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35},l_={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},oe={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},hh={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Wt={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,WIDGET:20},Ea={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Cd={ERRORS:0,WARNINGS:1,INFOS:5},bu={NONE:0,BINARY:1},ss={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},c_={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let kd=Cd.WARNINGS;function h_(n){Number.isInteger(n)&&(kd=n)}function d_(){return kd}function Md(n){kd>=Cd.INFOS&&console.log(`Info: ${n}`)}function et(n){kd>=Cd.WARNINGS&&console.log(`Warning: ${n}`)}function $t(n){throw new Error(n)}function Xt(n,t){n||$t(t)}function u_(n){switch(n==null?void 0:n.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function f_(n,t=null,e=null){if(!n)return null;try{if(e&&typeof n=="string"){if(e.addDefaultProtocol&&n.startsWith("www.")){const i=n.match(/\./g);(i==null?void 0:i.length)>=2&&(n=`http://${n}`)}if(e.tryConvertEncoding)try{n=y_(n)}catch{}}const s=t?new URL(n,t):new URL(n);if(u_(s))return s}catch{}return null}function at(n,t,e,s=!1){return Object.defineProperty(n,t,{value:e,enumerable:!s,configurable:!0,writable:!1}),e}const Mn=function(){function t(e,s){this.message=e,this.name=s}return t.prototype=new Error,t.constructor=t,t}();class yu extends Mn{constructor(t,e){super(t,"PasswordException"),this.code=e}}class _u extends Mn{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class Um extends Mn{constructor(t){super(t,"InvalidPDFException")}}class no extends Mn{constructor(t){super(t,"MissingPDFException")}}class Td extends Mn{constructor(t,e){super(t,"UnexpectedResponseException"),this.status=e}}class g_ extends Mn{constructor(t){super(t,"FormatError")}}class ro extends Mn{constructor(t){super(t,"AbortException")}}function Gm(n){(typeof n!="object"||(n==null?void 0:n.length)===void 0)&&$t("Invalid argument for bytesToString");const t=n.length,e=8192;if(t<e)return String.fromCharCode.apply(null,n);const s=[];for(let i=0;i<t;i+=e){const r=Math.min(i+e,t),o=n.subarray(i,r);s.push(String.fromCharCode.apply(null,o))}return s.join("")}function Ld(n){typeof n!="string"&&$t("Invalid argument for stringToBytes");const t=n.length,e=new Uint8Array(t);for(let s=0;s<t;++s)e[s]=n.charCodeAt(s)&255;return e}function p_(n){return String.fromCharCode(n>>24&255,n>>16&255,n>>8&255,n&255)}function ag(n){const t=Object.create(null);for(const[e,s]of n)t[e]=s;return t}function m_(){const n=new Uint8Array(4);return n[0]=1,new Uint32Array(n.buffer,0,1)[0]===1}function b_(){try{return new Function(""),!0}catch{return!1}}class Te{static get isLittleEndian(){return at(this,"isLittleEndian",m_())}static get isEvalSupported(){return at(this,"isEvalSupported",b_())}static get isOffscreenCanvasSupported(){return at(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.platform)=="string"?at(this,"platform",{isMac:navigator.platform.includes("Mac")}):at(this,"platform",{isMac:!1})}static get isCSSRoundSupported(){var t,e;return at(this,"isCSSRoundSupported",(e=(t=globalThis.CSS)==null?void 0:t.supports)==null?void 0:e.call(t,"width: round(1.5px, 1px)"))}}const Ud=Array.from(Array(256).keys(),n=>n.toString(16).padStart(2,"0"));var Ii,dh,vu;class V{static makeHexColor(t,e,s){return`#${Ud[t]}${Ud[e]}${Ud[s]}`}static scaleMinMax(t,e){let s;t[0]?(t[0]<0&&(s=e[0],e[0]=e[2],e[2]=s),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(s=e[1],e[1]=e[3],e[3]=s),e[1]*=t[3],e[3]*=t[3]):(s=e[0],e[0]=e[1],e[1]=s,s=e[2],e[2]=e[3],e[3]=s,t[1]<0&&(s=e[1],e[1]=e[3],e[3]=s),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(s=e[0],e[0]=e[2],e[2]=s),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static applyTransform(t,e){const s=t[0]*e[0]+t[1]*e[2]+e[4],i=t[0]*e[1]+t[1]*e[3]+e[5];return[s,i]}static applyInverseTransform(t,e){const s=e[0]*e[3]-e[1]*e[2],i=(t[0]*e[3]-t[1]*e[2]+e[2]*e[5]-e[4]*e[3])/s,r=(-t[0]*e[1]+t[1]*e[0]+e[4]*e[1]-e[5]*e[0])/s;return[i,r]}static getAxialAlignedBoundingBox(t,e){const s=this.applyTransform(t,e),i=this.applyTransform(t.slice(2,4),e),r=this.applyTransform([t[0],t[3]],e),o=this.applyTransform([t[2],t[1]],e);return[Math.min(s[0],i[0],r[0],o[0]),Math.min(s[1],i[1],r[1],o[1]),Math.max(s[0],i[0],r[0],o[0]),Math.max(s[1],i[1],r[1],o[1])]}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t){const e=[t[0],t[2],t[1],t[3]],s=t[0]*e[0]+t[1]*e[2],i=t[0]*e[1]+t[1]*e[3],r=t[2]*e[0]+t[3]*e[2],o=t[2]*e[1]+t[3]*e[3],a=(s+o)/2,l=Math.sqrt((s+o)**2-4*(s*o-r*i))/2,c=a+l||1,h=a-l||1;return[Math.sqrt(c),Math.sqrt(h)]}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const s=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),i=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(s>i)return null;const r=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),o=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return r>o?null:[s,r,i,o]}static bezierBoundingBox(t,e,s,i,r,o,a,l,c){return c?(c[0]=Math.min(c[0],t,a),c[1]=Math.min(c[1],e,l),c[2]=Math.max(c[2],t,a),c[3]=Math.max(c[3],e,l)):c=[Math.min(t,a),Math.min(e,l),Math.max(t,a),Math.max(e,l)],v(this,Ii,vu).call(this,t,s,r,a,e,i,o,l,3*(-t+3*(s-r)+a),6*(t-2*s+r),3*(s-t),c),v(this,Ii,vu).call(this,t,s,r,a,e,i,o,l,3*(-e+3*(i-o)+l),6*(e-2*i+o),3*(i-e),c),c}}Ii=new WeakSet,dh=function(t,e,s,i,r,o,a,l,c,h){if(c<=0||c>=1)return;const u=1-c,f=c*c,g=f*c,p=u*(u*(u*t+3*c*e)+3*f*s)+g*i,m=u*(u*(u*r+3*c*o)+3*f*a)+g*l;h[0]=Math.min(h[0],p),h[1]=Math.min(h[1],m),h[2]=Math.max(h[2],p),h[3]=Math.max(h[3],m)},vu=function(t,e,s,i,r,o,a,l,c,h,u,f){if(Math.abs(c)<1e-12){Math.abs(h)>=1e-12&&v(this,Ii,dh).call(this,t,e,s,i,r,o,a,l,-u/h,f);return}const g=h**2-4*u*c;if(g<0)return;const p=Math.sqrt(g),m=2*c;v(this,Ii,dh).call(this,t,e,s,i,r,o,a,l,(-h+p)/m,f),v(this,Ii,dh).call(this,t,e,s,i,r,o,a,l,(-h-p)/m,f)},x(V,Ii);function y_(n){return decodeURIComponent(escape(n))}let Gd=null,Vg=null;function __(n){return Gd||(Gd=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Vg=new Map([["ﬅ","ſt"]])),n.replaceAll(Gd,(t,e,s)=>e?e.normalize("NFKC"):Vg.get(s))}function v_(){if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.randomUUID)=="function")return crypto.randomUUID();const n=new Uint8Array(32);if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.getRandomValues)=="function")crypto.getRandomValues(n);else for(let t=0;t<32;t++)n[t]=Math.floor(Math.random()*255);return Gm(n)}const Xm="pdfjs_internal_id_",qs={BEZIER_CURVE_TO:0,MOVE_TO:1,LINE_TO:2,QUADRATIC_CURVE_TO:3,RESTORE:4,SAVE:5,SCALE:6,TRANSFORM:7,TRANSLATE:8};class Ym{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,s,i,r){return"none"}destroy(t=!1){}}var Al;class qm{constructor({enableHWA:t=!1}={}){x(this,Al,!1);_(this,Al,t)}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(t,e);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!d(this,Al)})}}reset(t,e,s){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||s<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=s}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){$t("Abstract method `_createCanvas` called.")}}Al=new WeakMap;class Km{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":""),s=this.isCompressed?bu.BINARY:bu.NONE;return this._fetchData(e,s).catch(i=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}_fetchData(t,e){$t("Abstract method `_fetchData` called.")}}class Zm{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetchData(e).catch(s=>{throw new Error(`Unable to load font data at: ${e}`)})}_fetchData(t){$t("Abstract method `_fetchData` called.")}}class A_{create(t,e,s=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),s||(i.setAttribute("width",`${t}px`),i.setAttribute("height",`${e}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${t} ${e}`),i}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){$t("Abstract method `_createSVG` called.")}}const Js="http://www.w3.org/2000/svg",jn=class jn{};T(jn,"CSS",96),T(jn,"PDF",72),T(jn,"PDF_TO_CSS_UNITS",jn.CSS/jn.PDF);let xn=jn;var Xn,Yn,Ss,oi,ce,ld,qn,W,ae,fo,go,uh,po,Jm,Au,mo,Ia,Oa,xu,Fa;class x_ extends Ym{constructor({docId:e,ownerDocument:s=globalThis.document}={}){super();x(this,W);x(this,Xn);x(this,Yn);x(this,Ss);x(this,oi);x(this,ce);x(this,ld);x(this,qn,0);_(this,oi,e),_(this,ce,s)}addFilter(e){if(!e)return"none";let s=d(this,W,ae).get(e);if(s)return s;const[i,r,o]=v(this,W,uh).call(this,e),a=e.length===1?i:`${i}${r}${o}`;if(s=d(this,W,ae).get(a),s)return d(this,W,ae).set(e,s),s;const l=`g_${d(this,oi)}_transfer_map_${xe(this,qn)._++}`,c=v(this,W,po).call(this,l);d(this,W,ae).set(e,c),d(this,W,ae).set(a,c);const h=v(this,W,mo).call(this,l);return v(this,W,Oa).call(this,i,r,o,h),c}addHCMFilter(e,s){var p;const i=`${e}-${s}`,r="base";let o=d(this,W,fo).get(r);if((o==null?void 0:o.key)===i||(o?((p=o.filter)==null||p.remove(),o.key=i,o.url="none",o.filter=null):(o={key:i,url:"none",filter:null},d(this,W,fo).set(r,o)),!e||!s))return o.url;const a=v(this,W,Fa).call(this,e);e=V.makeHexColor(...a);const l=v(this,W,Fa).call(this,s);if(s=V.makeHexColor(...l),d(this,W,go).style.color="",e==="#000000"&&s==="#ffffff"||e===s)return o.url;const c=new Array(256);for(let m=0;m<=255;m++){const b=m/255;c[m]=b<=.03928?b/12.92:((b+.055)/1.055)**2.4}const h=c.join(","),u=`g_${d(this,oi)}_hcm_filter`,f=o.filter=v(this,W,mo).call(this,u);v(this,W,Oa).call(this,h,h,h,f),v(this,W,Au).call(this,f);const g=(m,b)=>{const y=a[m]/255,A=l[m]/255,w=new Array(b+1);for(let S=0;S<=b;S++)w[S]=y+S/b*(A-y);return w.join(",")};return v(this,W,Oa).call(this,g(0,5),g(1,5),g(2,5),f),o.url=v(this,W,po).call(this,u),o.url}addAlphaFilter(e){let s=d(this,W,ae).get(e);if(s)return s;const[i]=v(this,W,uh).call(this,[e]),r=`alpha_${i}`;if(s=d(this,W,ae).get(r),s)return d(this,W,ae).set(e,s),s;const o=`g_${d(this,oi)}_alpha_map_${xe(this,qn)._++}`,a=v(this,W,po).call(this,o);d(this,W,ae).set(e,a),d(this,W,ae).set(r,a);const l=v(this,W,mo).call(this,o);return v(this,W,xu).call(this,i,l),a}addLuminosityFilter(e){let s=d(this,W,ae).get(e||"luminosity");if(s)return s;let i,r;if(e?([i]=v(this,W,uh).call(this,[e]),r=`luminosity_${i}`):r="luminosity",s=d(this,W,ae).get(r),s)return d(this,W,ae).set(e,s),s;const o=`g_${d(this,oi)}_luminosity_map_${xe(this,qn)._++}`,a=v(this,W,po).call(this,o);d(this,W,ae).set(e,a),d(this,W,ae).set(r,a);const l=v(this,W,mo).call(this,o);return v(this,W,Jm).call(this,l),e&&v(this,W,xu).call(this,i,l),a}addHighlightHCMFilter(e,s,i,r,o){var A;const a=`${s}-${i}-${r}-${o}`;let l=d(this,W,fo).get(e);if((l==null?void 0:l.key)===a||(l?((A=l.filter)==null||A.remove(),l.key=a,l.url="none",l.filter=null):(l={key:a,url:"none",filter:null},d(this,W,fo).set(e,l)),!s||!i))return l.url;const[c,h]=[s,i].map(v(this,W,Fa).bind(this));let u=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),f=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),[g,p]=[r,o].map(v(this,W,Fa).bind(this));f<u&&([u,f,g,p]=[f,u,p,g]),d(this,W,go).style.color="";const m=(w,S,E)=>{const C=new Array(256),k=(f-u)/E,M=w/255,R=(S-w)/(255*E);let N=0;for(let O=0;O<=E;O++){const j=Math.round(u+O*k),X=M+O*R;for(let Q=N;Q<=j;Q++)C[Q]=X;N=j+1}for(let O=N;O<256;O++)C[O]=C[N-1];return C.join(",")},b=`g_${d(this,oi)}_hcm_${e}_filter`,y=l.filter=v(this,W,mo).call(this,b);return v(this,W,Au).call(this,y),v(this,W,Oa).call(this,m(g[0],p[0],5),m(g[1],p[1],5),m(g[2],p[2],5),y),l.url=v(this,W,po).call(this,b),l.url}destroy(e=!1){e&&d(this,W,fo).size!==0||(d(this,Ss)&&(d(this,Ss).parentNode.parentNode.remove(),_(this,Ss,null)),d(this,Yn)&&(d(this,Yn).clear(),_(this,Yn,null)),_(this,qn,0))}}Xn=new WeakMap,Yn=new WeakMap,Ss=new WeakMap,oi=new WeakMap,ce=new WeakMap,ld=new WeakMap,qn=new WeakMap,W=new WeakSet,ae=function(){return d(this,Yn)||_(this,Yn,new Map)},fo=function(){return d(this,ld)||_(this,ld,new Map)},go=function(){if(!d(this,Ss)){const e=d(this,ce).createElement("div"),{style:s}=e;s.visibility="hidden",s.contain="strict",s.width=s.height=0,s.position="absolute",s.top=s.left=0,s.zIndex=-1;const i=d(this,ce).createElementNS(Js,"svg");i.setAttribute("width",0),i.setAttribute("height",0),_(this,Ss,d(this,ce).createElementNS(Js,"defs")),e.append(i),i.append(d(this,Ss)),d(this,ce).body.append(e)}return d(this,Ss)},uh=function(e){if(e.length===1){const c=e[0],h=new Array(256);for(let f=0;f<256;f++)h[f]=c[f]/255;const u=h.join(",");return[u,u,u]}const[s,i,r]=e,o=new Array(256),a=new Array(256),l=new Array(256);for(let c=0;c<256;c++)o[c]=s[c]/255,a[c]=i[c]/255,l[c]=r[c]/255;return[o.join(","),a.join(","),l.join(",")]},po=function(e){if(d(this,Xn)===void 0){_(this,Xn,"");const s=d(this,ce).URL;s!==d(this,ce).baseURI&&(Rd(s)?et('#createUrl: ignore "data:"-URL for performance reasons.'):_(this,Xn,s.split("#",1)[0]))}return`url(${d(this,Xn)}#${e})`},Jm=function(e){const s=d(this,ce).createElementNS(Js,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(s)},Au=function(e){const s=d(this,ce).createElementNS(Js,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(s)},mo=function(e){const s=d(this,ce).createElementNS(Js,"filter");return s.setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("id",e),d(this,W,go).append(s),s},Ia=function(e,s,i){const r=d(this,ce).createElementNS(Js,s);r.setAttribute("type","discrete"),r.setAttribute("tableValues",i),e.append(r)},Oa=function(e,s,i,r){const o=d(this,ce).createElementNS(Js,"feComponentTransfer");r.append(o),v(this,W,Ia).call(this,o,"feFuncR",e),v(this,W,Ia).call(this,o,"feFuncG",s),v(this,W,Ia).call(this,o,"feFuncB",i)},xu=function(e,s){const i=d(this,ce).createElementNS(Js,"feComponentTransfer");s.append(i),v(this,W,Ia).call(this,i,"feFuncA",e)},Fa=function(e){return d(this,W,go).style.color=e,dg(getComputedStyle(d(this,W,go)).getPropertyValue("color"))};class w_ extends qm{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}={}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const s=this._document.createElement("canvas");return s.width=t,s.height=e,s}}async function Pd(n,t="text"){if(Na(n,document.baseURI)){const e=await fetch(n);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,s)=>{const i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType=t,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(i.response);return}e(i.responseText);return}s(new Error(i.statusText))}},i.send(null)})}class Qm extends Km{_fetchData(t,e){return Pd(t,this.isCompressed?"arraybuffer":"text").then(s=>({cMapData:s instanceof ArrayBuffer?new Uint8Array(s):Ld(s),compressionType:e}))}}class tb extends Zm{_fetchData(t){return Pd(t,"arraybuffer").then(e=>new Uint8Array(e))}}class lg extends A_{_createSVG(t){return document.createElementNS(Js,t)}}class Nc{constructor({viewBox:t,scale:e,rotation:s,offsetX:i=0,offsetY:r=0,dontFlip:o=!1}){this.viewBox=t,this.scale=e,this.rotation=s,this.offsetX=i,this.offsetY=r;const a=(t[2]+t[0])/2,l=(t[3]+t[1])/2;let c,h,u,f;switch(s%=360,s<0&&(s+=360),s){case 180:c=-1,h=0,u=0,f=1;break;case 90:c=0,h=1,u=1,f=0;break;case 270:c=0,h=-1,u=-1,f=0;break;case 0:c=1,h=0,u=0,f=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(u=-u,f=-f);let g,p,m,b;c===0?(g=Math.abs(l-t[1])*e+i,p=Math.abs(a-t[0])*e+r,m=(t[3]-t[1])*e,b=(t[2]-t[0])*e):(g=Math.abs(a-t[0])*e+i,p=Math.abs(l-t[1])*e+r,m=(t[2]-t[0])*e,b=(t[3]-t[1])*e),this.transform=[c*e,h*e,u*e,f*e,g-c*e*a-u*e*l,p-h*e*a-f*e*l],this.width=m,this.height=b}get rawDims(){const{viewBox:t}=this;return at(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:s=this.offsetX,offsetY:i=this.offsetY,dontFlip:r=!1}={}){return new Nc({viewBox:this.viewBox.slice(),scale:t,rotation:e,offsetX:s,offsetY:i,dontFlip:r})}convertToViewportPoint(t,e){return V.applyTransform([t,e],this.transform)}convertToViewportRectangle(t){const e=V.applyTransform([t[0],t[1]],this.transform),s=V.applyTransform([t[2],t[3]],this.transform);return[e[0],e[1],s[0],s[1]]}convertToPdfPoint(t,e){return V.applyInverseTransform([t,e],this.transform)}}class cg extends Mn{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function Rd(n){const t=n.length;let e=0;for(;e<t&&n[e].trim()==="";)e++;return n.substring(e,e+5).toLowerCase()==="data:"}function hg(n){return typeof n=="string"&&/\.pdf$/i.test(n)}function S_(n){return[n]=n.split(/[#?]/,1),n.substring(n.lastIndexOf("/")+1)}function E_(n,t="document.pdf"){if(typeof n!="string")return t;if(Rd(n))return et('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const e=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,s=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,i=e.exec(n);let r=s.exec(i[1])||s.exec(i[2])||s.exec(i[3]);if(r&&(r=r[0],r.includes("%")))try{r=s.exec(decodeURIComponent(r))[0]}catch{}return r||t}class Ug{constructor(){T(this,"started",Object.create(null));T(this,"times",[])}time(t){t in this.started&&et(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||et(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:s}of this.times)e=Math.max(s.length,e);for(const{name:s,start:i,end:r}of this.times)t.push(`${s.padEnd(e)} ${r-i}ms
`);return t.join("")}}function Na(n,t){try{const{protocol:e}=t?new URL(n,t):new URL(n);return e==="http:"||e==="https:"}catch{return!1}}function ts(n){n.preventDefault()}let Gg;class eb{static toDateObject(t){if(!t||typeof t!="string")return null;Gg||(Gg=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const e=Gg.exec(t);if(!e)return null;const s=parseInt(e[1],10);let i=parseInt(e[2],10);i=i>=1&&i<=12?i-1:0;let r=parseInt(e[3],10);r=r>=1&&r<=31?r:1;let o=parseInt(e[4],10);o=o>=0&&o<=23?o:0;let a=parseInt(e[5],10);a=a>=0&&a<=59?a:0;let l=parseInt(e[6],10);l=l>=0&&l<=59?l:0;const c=e[7]||"Z";let h=parseInt(e[8],10);h=h>=0&&h<=23?h:0;let u=parseInt(e[9],10)||0;return u=u>=0&&u<=59?u:0,c==="-"?(o+=h,a+=u):c==="+"&&(o-=h,a-=u),new Date(Date.UTC(s,i,r,o,a,l))}}function C_(n,{scale:t=1,rotation:e=0}){const{width:s,height:i}=n.attributes.style,r=[0,0,parseInt(s),parseInt(i)];return new Nc({viewBox:r,scale:t,rotation:e})}function dg(n){if(n.startsWith("#")){const t=parseInt(n.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return n.startsWith("rgb(")?n.slice(4,-1).split(",").map(t=>parseInt(t)):n.startsWith("rgba(")?n.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(et(`Not a valid color format: "${n}"`),[0,0,0])}function k_(n){const t=document.createElement("span");t.style.visibility="hidden",document.body.append(t);for(const e of n.keys()){t.style.color=e;const s=window.getComputedStyle(t).color;n.set(e,dg(s))}t.remove()}function Pt(n){const{a:t,b:e,c:s,d:i,e:r,f:o}=n.getTransform();return[t,e,s,i,r,o]}function Ks(n){const{a:t,b:e,c:s,d:i,e:r,f:o}=n.getTransform().invertSelf();return[t,e,s,i,r,o]}function Kr(n,t,e=!1,s=!0){if(t instanceof Nc){const{pageWidth:i,pageHeight:r}=t.rawDims,{style:o}=n,a=Te.isCSSRoundSupported,l=`var(--scale-factor) * ${i}px`,c=`var(--scale-factor) * ${r}px`,h=a?`round(${l}, 1px)`:`calc(${l})`,u=a?`round(${c}, 1px)`:`calc(${c})`;!e||t.rotation%180===0?(o.width=h,o.height=u):(o.width=u,o.height=h)}s&&n.setAttribute("data-main-rotation",t.rotation)}var Kn,Zn,is,Jn,xl,wl,cd,sb,ve,ib,nb,fh,rb,Su;const ei=class ei{constructor(t){x(this,ve);x(this,Kn,null);x(this,Zn,null);x(this,is);x(this,Jn,null);x(this,xl,null);_(this,is,t),d(ei,wl)||_(ei,wl,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"}))}render(){const t=_(this,Kn,document.createElement("div"));t.className="editToolbar",t.setAttribute("role","toolbar");const e=d(this,is)._uiManager._signal;t.addEventListener("contextmenu",ts,{signal:e}),t.addEventListener("pointerdown",v(ei,cd,sb),{signal:e});const s=_(this,Jn,document.createElement("div"));s.className="buttons",t.append(s);const i=d(this,is).toolbarPosition;if(i){const{style:r}=t,o=d(this,is)._uiManager.direction==="ltr"?1-i[0]:i[0];r.insetInlineEnd=`${100*o}%`,r.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return v(this,ve,rb).call(this),t}hide(){var t;d(this,Kn).classList.add("hidden"),(t=d(this,Zn))==null||t.hideDropdown()}show(){var t;d(this,Kn).classList.remove("hidden"),(t=d(this,xl))==null||t.shown()}async addAltText(t){const e=await t.render();v(this,ve,fh).call(this,e),d(this,Jn).prepend(e,d(this,ve,Su)),_(this,xl,t)}addColorPicker(t){_(this,Zn,t);const e=t.renderButton();v(this,ve,fh).call(this,e),d(this,Jn).prepend(e,d(this,ve,Su))}remove(){var t;d(this,Kn).remove(),(t=d(this,Zn))==null||t.destroy(),_(this,Zn,null)}};Kn=new WeakMap,Zn=new WeakMap,is=new WeakMap,Jn=new WeakMap,xl=new WeakMap,wl=new WeakMap,cd=new WeakSet,sb=function(t){t.stopPropagation()},ve=new WeakSet,ib=function(t){d(this,is)._focusEventsAllowed=!1,t.preventDefault(),t.stopPropagation()},nb=function(t){d(this,is)._focusEventsAllowed=!0,t.preventDefault(),t.stopPropagation()},fh=function(t){const e=d(this,is)._uiManager._signal;t.addEventListener("focusin",v(this,ve,ib).bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",v(this,ve,nb).bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",ts,{signal:e})},rb=function(){const{editorType:t,_uiManager:e}=d(this,is),s=document.createElement("button");s.className="delete",s.tabIndex=0,s.setAttribute("data-l10n-id",d(ei,wl)[t]),v(this,ve,fh).call(this,s),s.addEventListener("click",i=>{e.delete()},{signal:e._signal}),d(this,Jn).append(s)},Su=function(){const t=document.createElement("div");return t.className="divider",t},x(ei,cd),x(ei,wl,null);let wu=ei;var Sl,Qn,tr,Cn,ob,ab,lb;class M_{constructor(t){x(this,Cn);x(this,Sl,null);x(this,Qn,null);x(this,tr);_(this,tr,t)}show(t,e,s){const[i,r]=v(this,Cn,ab).call(this,e,s),{style:o}=d(this,Qn)||_(this,Qn,v(this,Cn,ob).call(this));t.append(d(this,Qn)),o.insetInlineEnd=`${100*i}%`,o.top=`calc(${100*r}% + var(--editor-toolbar-vert-offset))`}hide(){d(this,Qn).remove()}}Sl=new WeakMap,Qn=new WeakMap,tr=new WeakMap,Cn=new WeakSet,ob=function(){const t=_(this,Qn,document.createElement("div"));t.className="editToolbar",t.setAttribute("role","toolbar"),t.addEventListener("contextmenu",ts,{signal:d(this,tr)._signal});const e=_(this,Sl,document.createElement("div"));return e.className="buttons",t.append(e),v(this,Cn,lb).call(this),t},ab=function(t,e){let s=0,i=0;for(const r of t){const o=r.y+r.height;if(o<s)continue;const a=r.x+(e?r.width:0);if(o>s){i=a,s=o;continue}e?a>i&&(i=a):a<i&&(i=a)}return[e?1-i:i,s]},lb=function(){const t=document.createElement("button");t.className="highlightButton",t.tabIndex=0,t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const e=document.createElement("span");t.append(e),e.className="visuallyHidden",e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const s=d(this,tr)._signal;t.addEventListener("contextmenu",ts,{signal:s}),t.addEventListener("click",()=>{d(this,tr).highlightSelection("floating_button")},{signal:s}),d(this,Sl).append(t)};function Xh(n,t,e){for(const s of e)t.addEventListener(s,n[s].bind(n))}function T_(n){return Math.round(Math.min(255,Math.max(1,255*n))).toString(16).padStart(2,"0")}var hd;class L_{constructor(){x(this,hd,0)}get id(){return`${a_}${xe(this,hd)._++}`}}hd=new WeakMap;var El,dd,Xe,Cl,Cu;const Bg=class Bg{constructor(){x(this,Cl);x(this,El,v_());x(this,dd,0);x(this,Xe,null)}static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=t;const r=i.decode().then(()=>(s.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return at(this,"_isSVGFittingCanvas",r)}async getFromFile(t){const{lastModified:e,name:s,size:i,type:r}=t;return v(this,Cl,Cu).call(this,`${e}_${s}_${i}_${r}`,t)}async getFromUrl(t){return v(this,Cl,Cu).call(this,t,t)}async getFromId(t){d(this,Xe)||_(this,Xe,new Map);const e=d(this,Xe).get(t);return e?e.bitmap?(e.refCounter+=1,e):e.file?this.getFromFile(e.file):this.getFromUrl(e.url):null}getSvgUrl(t){const e=d(this,Xe).get(t);return e!=null&&e.isSvg?e.svgUrl:null}deleteId(t){d(this,Xe)||_(this,Xe,new Map);const e=d(this,Xe).get(t);e&&(e.refCounter-=1,e.refCounter===0&&(e.bitmap=null))}isValidId(t){return t.startsWith(`image_${d(this,El)}_`)}};El=new WeakMap,dd=new WeakMap,Xe=new WeakMap,Cl=new WeakSet,Cu=async function(t,e){d(this,Xe)||_(this,Xe,new Map);let s=d(this,Xe).get(t);if(s===null)return null;if(s!=null&&s.bitmap)return s.refCounter+=1,s;try{s||(s={bitmap:null,id:`image_${d(this,El)}_${xe(this,dd)._++}`,refCounter:0,isSvg:!1});let i;if(typeof e=="string"?(s.url=e,i=await Pd(e,"blob")):i=s.file=e,i.type==="image/svg+xml"){const r=Bg._isSVGFittingCanvas,o=new FileReader,a=new Image,l=new Promise((c,h)=>{a.onload=()=>{s.bitmap=a,s.isSvg=!0,c()},o.onload=async()=>{const u=s.svgUrl=o.result;a.src=await r?`${u}#svgView(preserveAspectRatio(none))`:u},a.onerror=o.onerror=h});o.readAsDataURL(i),await l}else s.bitmap=await createImageBitmap(i);s.refCounter=1}catch(i){console.error(i),s=null}return d(this,Xe).set(t,s),s&&d(this,Xe).set(s.id,s),s};let Eu=Bg;var qt,ji,kl,Kt;class P_{constructor(t=128){x(this,qt,[]);x(this,ji,!1);x(this,kl);x(this,Kt,-1);_(this,kl,t)}add({cmd:t,undo:e,post:s,mustExec:i,type:r=NaN,overwriteIfSameType:o=!1,keepUndo:a=!1}){if(i&&t(),d(this,ji))return;const l={cmd:t,undo:e,post:s,type:r};if(d(this,Kt)===-1){d(this,qt).length>0&&(d(this,qt).length=0),_(this,Kt,0),d(this,qt).push(l);return}if(o&&d(this,qt)[d(this,Kt)].type===r){a&&(l.undo=d(this,qt)[d(this,Kt)].undo),d(this,qt)[d(this,Kt)]=l;return}const c=d(this,Kt)+1;c===d(this,kl)?d(this,qt).splice(0,1):(_(this,Kt,c),c<d(this,qt).length&&d(this,qt).splice(c)),d(this,qt).push(l)}undo(){if(d(this,Kt)===-1)return;_(this,ji,!0);const{undo:t,post:e}=d(this,qt)[d(this,Kt)];t(),e==null||e(),_(this,ji,!1),_(this,Kt,d(this,Kt)-1)}redo(){if(d(this,Kt)<d(this,qt).length-1){_(this,Kt,d(this,Kt)+1),_(this,ji,!0);const{cmd:t,post:e}=d(this,qt)[d(this,Kt)];t(),e==null||e(),_(this,ji,!1)}}hasSomethingToUndo(){return d(this,Kt)!==-1}hasSomethingToRedo(){return d(this,Kt)<d(this,qt).length-1}destroy(){_(this,qt,null)}}qt=new WeakMap,ji=new WeakMap,kl=new WeakMap,Kt=new WeakMap;var ud,cb;class Hc{constructor(t){x(this,ud);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=Te.platform;for(const[s,i,r={}]of t)for(const o of s){const a=o.startsWith("mac+");e&&a?(this.callbacks.set(o.slice(4),{callback:i,options:r}),this.allKeys.add(o.split("+").at(-1))):!e&&!a&&(this.callbacks.set(o,{callback:i,options:r}),this.allKeys.add(o.split("+").at(-1)))}}exec(t,e){if(!this.allKeys.has(e.key))return;const s=this.callbacks.get(v(this,ud,cb).call(this,e));if(!s)return;const{callback:i,options:{bubbles:r=!1,args:o=[],checker:a=null}}=s;a&&!a(t,e)||(i.bind(t,...o,e)(),r||(e.stopPropagation(),e.preventDefault()))}}ud=new WeakSet,cb=function(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e};const fd=class fd{get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return k_(t),at(this,"_colors",t)}convert(t){const e=dg(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[s,i]of this._colors)if(i.every((r,o)=>r===e[o]))return fd._colorsMapping.get(s);return e}getHexCode(t){const e=this._colors.get(t);return e?V.makeHexColor(...e):t}};T(fd,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let ku=fd;var Co,De,jt,se,ko,ai,Mo,ns,Vi,To,er,Es,rs,sr,Ml,Tl,Lo,Ll,Cs,Ui,Po,Gi,ks,gd,Xi,Pl,Yi,ir,Rl,Dl,Zt,mt,li,nr,Il,Ol,qi,Ms,ci,Fl,B,gh,Mu,hb,db,ph,ub,fb,gb,Tu,pb,Lu,Pu,mb,pe,Hi,bb,yb,Ru,_b,Ha,Du;const Ao=class Ao{constructor(t,e,s,i,r,o,a,l,c,h,u){x(this,B);x(this,Co,new AbortController);x(this,De,null);x(this,jt,new Map);x(this,se,new Map);x(this,ko,null);x(this,ai,null);x(this,Mo,null);x(this,ns,new P_);x(this,Vi,null);x(this,To,0);x(this,er,new Set);x(this,Es,null);x(this,rs,null);x(this,sr,new Set);x(this,Ml,!1);x(this,Tl,!1);x(this,Lo,!1);x(this,Ll,null);x(this,Cs,null);x(this,Ui,null);x(this,Po,null);x(this,Gi,!1);x(this,ks,null);x(this,gd,new L_);x(this,Xi,!1);x(this,Pl,!1);x(this,Yi,null);x(this,ir,null);x(this,Rl,null);x(this,Dl,null);x(this,Zt,ot.NONE);x(this,mt,new Set);x(this,li,null);x(this,nr,null);x(this,Il,null);x(this,Ol,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});x(this,qi,[0,0]);x(this,Ms,null);x(this,ci,null);x(this,Fl,null);const f=this._signal=d(this,Co).signal;_(this,ci,t),_(this,Fl,e),_(this,ko,s),this._eventBus=i,i._on("editingaction",this.onEditingAction.bind(this),{signal:f}),i._on("pagechanging",this.onPageChanging.bind(this),{signal:f}),i._on("scalechanging",this.onScaleChanging.bind(this),{signal:f}),i._on("rotationchanging",this.onRotationChanging.bind(this),{signal:f}),i._on("setpreference",this.onSetPreference.bind(this),{signal:f}),i._on("switchannotationeditorparams",g=>this.updateParams(g.type,g.value),{signal:f}),v(this,B,ub).call(this),v(this,B,mb).call(this),v(this,B,Tu).call(this),_(this,ai,r.annotationStorage),_(this,Ll,r.filterFactory),_(this,nr,o),_(this,Po,a||null),_(this,Ml,l),_(this,Tl,c),_(this,Lo,h),_(this,Dl,u||null),this.viewParameters={realScale:xn.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1}static get _keyboardManager(){const t=Ao.prototype,e=o=>d(o,ci).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),s=(o,{target:a})=>{if(a instanceof HTMLInputElement){const{type:l}=a;return l!=="text"&&l!=="number"}return!0},i=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return at(this,"_keyboardManager",new Hc([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],t.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:s}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&d(o,ci).contains(a)&&!o.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&d(o,ci).contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-i,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-r,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[i,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[r,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-i],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-r],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,i],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,r],checker:e}]]))}destroy(){var t,e,s;(t=d(this,Co))==null||t.abort(),_(this,Co,null),this._signal=null;for(const i of d(this,se).values())i.destroy();d(this,se).clear(),d(this,jt).clear(),d(this,sr).clear(),_(this,De,null),d(this,mt).clear(),d(this,ns).destroy(),(e=d(this,ko))==null||e.destroy(),(s=d(this,ks))==null||s.hide(),_(this,ks,null),d(this,Cs)&&(clearTimeout(d(this,Cs)),_(this,Cs,null)),d(this,Ms)&&(clearTimeout(d(this,Ms)),_(this,Ms,null))}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return d(this,Dl)}get useNewAltTextFlow(){return d(this,Tl)}get useNewAltTextWhenAddingImage(){return d(this,Lo)}get hcmFilter(){return at(this,"hcmFilter",d(this,nr)?d(this,Ll).addHCMFilter(d(this,nr).foreground,d(this,nr).background):"none")}get direction(){return at(this,"direction",getComputedStyle(d(this,ci)).direction)}get highlightColors(){return at(this,"highlightColors",d(this,Po)?new Map(d(this,Po).split(",").map(t=>t.split("=").map(e=>e.trim()))):null)}get highlightColorNames(){return at(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}setMainHighlightColorPicker(t){_(this,Rl,t)}editAltText(t,e=!1){var s;(s=d(this,ko))==null||s.editAltText(this,t,e)}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){switch(t){case"enableNewAltTextWhenAddingImage":_(this,Lo,e);break}}onPageChanging({pageNumber:t}){_(this,To,t-1)}focusMainContainer(){d(this,ci).focus()}findParent(t,e){for(const s of d(this,se).values()){const{x:i,y:r,width:o,height:a}=s.div.getBoundingClientRect();if(t>=i&&t<=i+o&&e>=r&&e<=r+a)return s}return null}disableUserSelect(t=!1){d(this,Fl).classList.toggle("noUserSelect",t)}addShouldRescale(t){d(this,sr).add(t)}removeShouldRescale(t){d(this,sr).delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*xn.PDF_TO_CSS_UNITS;for(const e of d(this,sr))e.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}highlightSelection(t=""){const e=document.getSelection();if(!e||e.isCollapsed)return;const{anchorNode:s,anchorOffset:i,focusNode:r,focusOffset:o}=e,a=e.toString(),c=v(this,B,gh).call(this,e).closest(".textLayer"),h=this.getSelectionBoxes(c);if(!h)return;e.empty();const u=v(this,B,Mu).call(this,c),f=d(this,Zt)===ot.NONE,g=()=>{u==null||u.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:h,anchorNode:s,anchorOffset:i,focusNode:r,focusOffset:o,text:a}),f&&this.showAllEditors("highlight",!0,!0)};if(f){this.switchToMode(ot.HIGHLIGHT,g);return}g()}addToAnnotationStorage(t){!t.isEmpty()&&d(this,ai)&&!d(this,ai).has(t.id)&&d(this,ai).setValue(t.id,t)}blur(){if(this.isShiftKeyDown=!1,d(this,Gi)&&(_(this,Gi,!1),v(this,B,ph).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of d(this,mt))if(e.div.contains(t)){_(this,ir,[e,t]),e._focusEventsAllowed=!1;break}}focus(){if(!d(this,ir))return;const[t,e]=d(this,ir);_(this,ir,null),e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}addEditListeners(){v(this,B,Tu).call(this),v(this,B,Lu).call(this)}removeEditListeners(){v(this,B,pb).call(this),v(this,B,Pu).call(this)}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const s of d(this,rs))if(s.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const s of d(this,rs))if(s.isHandlingMimeForPasting(e.type)){s.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){var s;if(t.preventDefault(),(s=d(this,De))==null||s.commitOrRemove(),!this.hasSelection)return;const e=[];for(const i of d(this,mt)){const r=i.serialize(!0);r&&e.push(r)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}paste(t){t.preventDefault();const{clipboardData:e}=t;for(const r of e.items)for(const o of d(this,rs))if(o.isHandlingMimeForPasting(r.type)){o.paste(r,this.currentLayer);return}let s=e.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(r){et(`paste: "${r.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const i=this.currentLayer;try{const r=[];for(const l of s){const c=i.deserialize(l);if(!c)return;r.push(c)}const o=()=>{for(const l of r)v(this,B,Ru).call(this,l);v(this,B,Du).call(this,r)},a=()=>{for(const l of r)l.remove()};this.addCommands({cmd:o,undo:a,mustExec:!0})}catch(r){et(`paste: "${r.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),d(this,Zt)!==ot.NONE&&!this.isEditorHandlingKeyboard&&Ao._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,d(this,Gi)&&(_(this,Gi,!1),v(this,B,ph).call(this,"main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(t){t?(v(this,B,fb).call(this),v(this,B,Lu).call(this),v(this,B,pe).call(this,{isEditing:d(this,Zt)!==ot.NONE,isEmpty:v(this,B,Ha).call(this),hasSomethingToUndo:d(this,ns).hasSomethingToUndo(),hasSomethingToRedo:d(this,ns).hasSomethingToRedo(),hasSelectedEditor:!1})):(v(this,B,gb).call(this),v(this,B,Pu).call(this),v(this,B,pe).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!d(this,rs)){_(this,rs,t);for(const e of d(this,rs))v(this,B,Hi).call(this,e.defaultPropertiesToUpdate)}}getId(){return d(this,gd).id}get currentLayer(){return d(this,se).get(d(this,To))}getLayer(t){return d(this,se).get(t)}get currentPageIndex(){return d(this,To)}addLayer(t){d(this,se).set(t.pageIndex,t),d(this,Xi)?t.enable():t.disable()}removeLayer(t){d(this,se).delete(t.pageIndex)}updateMode(t,e=null,s=!1){if(d(this,Zt)!==t){if(_(this,Zt,t),t===ot.NONE){this.setEditingState(!1),v(this,B,yb).call(this);return}this.setEditingState(!0),v(this,B,bb).call(this),this.unselectAll();for(const i of d(this,se).values())i.updateMode(t);if(!e&&s){this.addNewEditorFromKeyboard();return}if(e){for(const i of d(this,jt).values())if(i.annotationElementId===e){this.setSelected(i),i.enterInEditMode();break}}}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t!==d(this,Zt)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:t})}updateParams(t,e){var s;if(d(this,rs)){switch(t){case K.CREATE:this.currentLayer.addNewEditor();return;case K.HIGHLIGHT_DEFAULT_COLOR:(s=d(this,Rl))==null||s.updateColor(e);break;case K.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(d(this,Il)||_(this,Il,new Map)).set(t,e),this.showAllEditors("highlight",e);break}for(const i of d(this,mt))i.updateParams(t,e);for(const i of d(this,rs))i.updateDefaultParams(t,e)}}showAllEditors(t,e,s=!1){var r;for(const o of d(this,jt).values())o.editorType===t&&o.show(e);(((r=d(this,Il))==null?void 0:r.get(K.HIGHLIGHT_SHOW_ALL))??!0)!==e&&v(this,B,Hi).call(this,[[K.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(d(this,Pl)!==t){_(this,Pl,t);for(const e of d(this,se).values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}getEditors(t){const e=[];for(const s of d(this,jt).values())s.pageIndex===t&&e.push(s);return e}getEditor(t){return d(this,jt).get(t)}addEditor(t){d(this,jt).set(t.id,t)}removeEditor(t){var e;t.div.contains(document.activeElement)&&(d(this,Cs)&&clearTimeout(d(this,Cs)),_(this,Cs,setTimeout(()=>{this.focusMainContainer(),_(this,Cs,null)},0))),d(this,jt).delete(t.id),this.unselect(t),(!t.annotationElementId||!d(this,er).has(t.annotationElementId))&&((e=d(this,ai))==null||e.remove(t.id))}addDeletedAnnotationElement(t){d(this,er).add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return d(this,er).has(t)}removeDeletedAnnotationElement(t){d(this,er).delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}setActiveEditor(t){d(this,De)!==t&&(_(this,De,t),t&&v(this,B,Hi).call(this,t.propertiesToUpdate))}updateUI(t){d(this,B,_b)===t&&v(this,B,Hi).call(this,t.propertiesToUpdate)}toggleSelected(t){if(d(this,mt).has(t)){d(this,mt).delete(t),t.unselect(),v(this,B,pe).call(this,{hasSelectedEditor:this.hasSelection});return}d(this,mt).add(t),t.select(),v(this,B,Hi).call(this,t.propertiesToUpdate),v(this,B,pe).call(this,{hasSelectedEditor:!0})}setSelected(t){for(const e of d(this,mt))e!==t&&e.unselect();d(this,mt).clear(),d(this,mt).add(t),t.select(),v(this,B,Hi).call(this,t.propertiesToUpdate),v(this,B,pe).call(this,{hasSelectedEditor:!0})}isSelected(t){return d(this,mt).has(t)}get firstSelectedEditor(){return d(this,mt).values().next().value}unselect(t){t.unselect(),d(this,mt).delete(t),v(this,B,pe).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return d(this,mt).size!==0}get isEnterHandled(){return d(this,mt).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){d(this,ns).undo(),v(this,B,pe).call(this,{hasSomethingToUndo:d(this,ns).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:v(this,B,Ha).call(this)})}redo(){d(this,ns).redo(),v(this,B,pe).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:d(this,ns).hasSomethingToRedo(),isEmpty:v(this,B,Ha).call(this)})}addCommands(t){d(this,ns).add(t),v(this,B,pe).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:v(this,B,Ha).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const t=[...d(this,mt)],e=()=>{for(const i of t)i.remove()},s=()=>{for(const i of t)v(this,B,Ru).call(this,i)};this.addCommands({cmd:e,undo:s,mustExec:!0})}commitOrRemove(){var t;(t=d(this,De))==null||t.commitOrRemove()}hasSomethingToControl(){return d(this,De)||this.hasSelection}selectAll(){for(const t of d(this,mt))t.commit();v(this,B,Du).call(this,d(this,jt).values())}unselectAll(){if(!(d(this,De)&&(d(this,De).commitOrRemove(),d(this,Zt)!==ot.NONE))&&this.hasSelection){for(const t of d(this,mt))t.unselect();d(this,mt).clear(),v(this,B,pe).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(t,e,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;d(this,qi)[0]+=t,d(this,qi)[1]+=e;const[i,r]=d(this,qi),o=[...d(this,mt)],a=1e3;d(this,Ms)&&clearTimeout(d(this,Ms)),_(this,Ms,setTimeout(()=>{_(this,Ms,null),d(this,qi)[0]=d(this,qi)[1]=0,this.addCommands({cmd:()=>{for(const l of o)d(this,jt).has(l.id)&&l.translateInPage(i,r)},undo:()=>{for(const l of o)d(this,jt).has(l.id)&&l.translateInPage(-i,-r)},mustExec:!1})},a));for(const l of o)l.translateInPage(t,e)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),_(this,Es,new Map);for(const t of d(this,mt))d(this,Es).set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!d(this,Es))return!1;this.disableUserSelect(!1);const t=d(this,Es);_(this,Es,null);let e=!1;for(const[{x:i,y:r,pageIndex:o},a]of t)a.newX=i,a.newY=r,a.newPageIndex=o,e||(e=i!==a.savedX||r!==a.savedY||o!==a.savedPageIndex);if(!e)return!1;const s=(i,r,o,a)=>{if(d(this,jt).has(i.id)){const l=d(this,se).get(a);l?i._setParentAndPosition(l,r,o):(i.pageIndex=a,i.x=r,i.y=o)}};return this.addCommands({cmd:()=>{for(const[i,{newX:r,newY:o,newPageIndex:a}]of t)s(i,r,o,a)},undo:()=>{for(const[i,{savedX:r,savedY:o,savedPageIndex:a}]of t)s(i,r,o,a)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(d(this,Es))for(const s of d(this,Es).keys())s.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){var t;return((t=this.getActive())==null?void 0:t.shouldGetKeyboardEvents())||d(this,mt).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return d(this,De)===t}getActive(){return d(this,De)}getMode(){return d(this,Zt)}get imageManager(){return at(this,"imageManager",new Eu)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let c=0,h=e.rangeCount;c<h;c++)if(!t.contains(e.getRangeAt(c).commonAncestorContainer))return null;const{x:s,y:i,width:r,height:o}=t.getBoundingClientRect();let a;switch(t.getAttribute("data-main-rotation")){case"90":a=(c,h,u,f)=>({x:(h-i)/o,y:1-(c+u-s)/r,width:f/o,height:u/r});break;case"180":a=(c,h,u,f)=>({x:1-(c+u-s)/r,y:1-(h+f-i)/o,width:u/r,height:f/o});break;case"270":a=(c,h,u,f)=>({x:1-(h+f-i)/o,y:(c-s)/r,width:f/o,height:u/r});break;default:a=(c,h,u,f)=>({x:(c-s)/r,y:(h-i)/o,width:u/r,height:f/o});break}const l=[];for(let c=0,h=e.rangeCount;c<h;c++){const u=e.getRangeAt(c);if(!u.collapsed)for(const{x:f,y:g,width:p,height:m}of u.getClientRects())p===0||m===0||l.push(a(f,g,p,m))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:t,id:e}){(d(this,Mo)||_(this,Mo,new Map)).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){var e;(e=d(this,Mo))==null||e.delete(t)}renderAnnotationElement(t){var i;const e=(i=d(this,Mo))==null?void 0:i.get(t.data.id);if(!e)return;const s=d(this,ai).getRawValue(e);s&&(d(this,Zt)===ot.NONE&&!s.hasBeenModified||s.renderAnnotationElement(t))}};Co=new WeakMap,De=new WeakMap,jt=new WeakMap,se=new WeakMap,ko=new WeakMap,ai=new WeakMap,Mo=new WeakMap,ns=new WeakMap,Vi=new WeakMap,To=new WeakMap,er=new WeakMap,Es=new WeakMap,rs=new WeakMap,sr=new WeakMap,Ml=new WeakMap,Tl=new WeakMap,Lo=new WeakMap,Ll=new WeakMap,Cs=new WeakMap,Ui=new WeakMap,Po=new WeakMap,Gi=new WeakMap,ks=new WeakMap,gd=new WeakMap,Xi=new WeakMap,Pl=new WeakMap,Yi=new WeakMap,ir=new WeakMap,Rl=new WeakMap,Dl=new WeakMap,Zt=new WeakMap,mt=new WeakMap,li=new WeakMap,nr=new WeakMap,Il=new WeakMap,Ol=new WeakMap,qi=new WeakMap,Ms=new WeakMap,ci=new WeakMap,Fl=new WeakMap,B=new WeakSet,gh=function({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t},Mu=function(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const s of d(this,se).values())if(s.hasTextLayer(t))return s;return null},hb=function(){const t=document.getSelection();if(!t||t.isCollapsed)return;const s=v(this,B,gh).call(this,t).closest(".textLayer"),i=this.getSelectionBoxes(s);i&&(d(this,ks)||_(this,ks,new M_(this)),d(this,ks).show(s,i,this.direction==="ltr"))},db=function(){var r,o,a;const t=document.getSelection();if(!t||t.isCollapsed){d(this,li)&&((r=d(this,ks))==null||r.hide(),_(this,li,null),v(this,B,pe).call(this,{hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===d(this,li))return;const i=v(this,B,gh).call(this,t).closest(".textLayer");if(!i){d(this,li)&&((o=d(this,ks))==null||o.hide(),_(this,li,null),v(this,B,pe).call(this,{hasSelectedText:!1}));return}if((a=d(this,ks))==null||a.hide(),_(this,li,e),v(this,B,pe).call(this,{hasSelectedText:!0}),!(d(this,Zt)!==ot.HIGHLIGHT&&d(this,Zt)!==ot.NONE)&&(d(this,Zt)===ot.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),_(this,Gi,this.isShiftKeyDown),!this.isShiftKeyDown)){const l=d(this,Zt)===ot.HIGHLIGHT?v(this,B,Mu).call(this,i):null;l==null||l.toggleDrawing();const c=new AbortController,h=this.combinedSignal(c),u=f=>{f.type==="pointerup"&&f.button!==0||(c.abort(),l==null||l.toggleDrawing(!0),f.type==="pointerup"&&v(this,B,ph).call(this,"main_toolbar"))};window.addEventListener("pointerup",u,{signal:h}),window.addEventListener("blur",u,{signal:h})}},ph=function(t=""){d(this,Zt)===ot.HIGHLIGHT?this.highlightSelection(t):d(this,Ml)&&v(this,B,hb).call(this)},ub=function(){document.addEventListener("selectionchange",v(this,B,db).bind(this),{signal:this._signal})},fb=function(){if(d(this,Ui))return;_(this,Ui,new AbortController);const t=this.combinedSignal(d(this,Ui));window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})},gb=function(){var t;(t=d(this,Ui))==null||t.abort(),_(this,Ui,null)},Tu=function(){if(d(this,Yi))return;_(this,Yi,new AbortController);const t=this.combinedSignal(d(this,Yi));window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})},pb=function(){var t;(t=d(this,Yi))==null||t.abort(),_(this,Yi,null)},Lu=function(){if(d(this,Vi))return;_(this,Vi,new AbortController);const t=this.combinedSignal(d(this,Vi));document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})},Pu=function(){var t;(t=d(this,Vi))==null||t.abort(),_(this,Vi,null)},mb=function(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})},pe=function(t){Object.entries(t).some(([s,i])=>d(this,Ol)[s]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(d(this,Ol),t)}),d(this,Zt)===ot.HIGHLIGHT&&t.hasSelectedEditor===!1&&v(this,B,Hi).call(this,[[K.HIGHLIGHT_FREE,!0]]))},Hi=function(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})},bb=function(){if(!d(this,Xi)){_(this,Xi,!0);for(const t of d(this,se).values())t.enable();for(const t of d(this,jt).values())t.enable()}},yb=function(){if(this.unselectAll(),d(this,Xi)){_(this,Xi,!1);for(const t of d(this,se).values())t.disable();for(const t of d(this,jt).values())t.disable()}},Ru=function(t){const e=d(this,se).get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))},_b=function(){let t=null;for(t of d(this,mt));return t},Ha=function(){if(d(this,jt).size===0)return!0;if(d(this,jt).size===1)for(const t of d(this,jt).values())return t.isEmpty();return!1},Du=function(t){for(const e of d(this,mt))e.unselect();d(this,mt).clear();for(const e of t)e.isEmpty()||(d(this,mt).add(e),e.select());v(this,B,pe).call(this,{hasSelectedEditor:this.hasSelection})},T(Ao,"TRANSLATE_SMALL",1),T(Ao,"TRANSLATE_BIG",10);let Zr=Ao;var Jt,Ts,os,Ls,Ie,Ro,Ps,Ee,hi,rr,Rs,Gs,mh,bh;const Ge=class Ge{constructor(t){x(this,Gs);x(this,Jt,null);x(this,Ts,!1);x(this,os,null);x(this,Ls,null);x(this,Ie,null);x(this,Ro,!1);x(this,Ps,null);x(this,Ee,null);x(this,hi,null);x(this,rr,null);x(this,Rs,!1);_(this,Ee,t),_(this,Rs,t._uiManager.useNewAltTextFlow)}static initialize(t){Ge._l10nPromise||(Ge._l10nPromise=t)}async render(){const t=_(this,os,document.createElement("button"));t.className="altText";let e;d(this,Rs)?(t.classList.add("new"),e=await Ge._l10nPromise.get("pdfjs-editor-new-alt-text-missing-button-label")):e=await Ge._l10nPromise.get("pdfjs-editor-alt-text-button-label"),t.textContent=e,t.setAttribute("aria-label",e),t.tabIndex="0";const s=d(this,Ee)._uiManager._signal;t.addEventListener("contextmenu",ts,{signal:s}),t.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:s});const i=r=>{r.preventDefault(),d(this,Ee)._uiManager.editAltText(d(this,Ee)),d(this,Rs)&&d(this,Ee)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:d(this,Gs,mh)}})};return t.addEventListener("click",i,{capture:!0,signal:s}),t.addEventListener("keydown",r=>{r.target===t&&r.key==="Enter"&&(_(this,Ro,!0),i(r))},{signal:s}),await v(this,Gs,bh).call(this),t}finish(){d(this,os)&&(d(this,os).focus({focusVisible:d(this,Ro)}),_(this,Ro,!1))}isEmpty(){return d(this,Rs)?d(this,Jt)===null:!d(this,Jt)&&!d(this,Ts)}hasData(){return d(this,Rs)?d(this,Jt)!==null||!!d(this,hi):this.isEmpty()}get guessedText(){return d(this,hi)}async setGuessedText(t){d(this,Jt)===null&&(_(this,hi,t),_(this,rr,await Ge._l10nPromise.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer")({generatedAltText:t})),v(this,Gs,bh).call(this))}toggleAltTextBadge(t=!1){var e;if(!d(this,Rs)||d(this,Jt)){(e=d(this,Ps))==null||e.remove(),_(this,Ps,null);return}if(!d(this,Ps)){const s=_(this,Ps,document.createElement("div"));s.className="noAltTextBadge",d(this,Ee).div.append(s)}d(this,Ps).classList.toggle("hidden",!t)}serialize(t){let e=d(this,Jt);return!t&&d(this,hi)===e&&(e=d(this,rr)),{altText:e,decorative:d(this,Ts),guessedText:d(this,hi),textWithDisclaimer:d(this,rr)}}get data(){return{altText:d(this,Jt),decorative:d(this,Ts)}}set data({altText:t,decorative:e,guessedText:s,textWithDisclaimer:i,cancel:r=!1}){s&&(_(this,hi,s),_(this,rr,i)),!(d(this,Jt)===t&&d(this,Ts)===e)&&(r||(_(this,Jt,t),_(this,Ts,e)),v(this,Gs,bh).call(this))}toggle(t=!1){d(this,os)&&(!t&&d(this,Ie)&&(clearTimeout(d(this,Ie)),_(this,Ie,null)),d(this,os).disabled=!t)}shown(){d(this,Ee)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:d(this,Gs,mh)}})}destroy(){var t,e;(t=d(this,os))==null||t.remove(),_(this,os,null),_(this,Ls,null),(e=d(this,Ps))==null||e.remove(),_(this,Ps,null)}};Jt=new WeakMap,Ts=new WeakMap,os=new WeakMap,Ls=new WeakMap,Ie=new WeakMap,Ro=new WeakMap,Ps=new WeakMap,Ee=new WeakMap,hi=new WeakMap,rr=new WeakMap,Rs=new WeakMap,Gs=new WeakSet,mh=function(){return d(this,Jt)&&"added"||d(this,Jt)===null&&this.guessedText&&"review"||"missing"},bh=async function(){var i,r;const t=d(this,os);if(!t)return;if(d(this,Rs)){const o=d(this,Gs,mh),a=o==="review"?"to-review":o;if(t.classList.toggle("done",!!d(this,Jt)),Ge._l10nPromise.get(`pdfjs-editor-new-alt-text-${a}-button-label`).then(l=>{t.setAttribute("aria-label",l);for(const c of t.childNodes)if(c.nodeType===Node.TEXT_NODE){c.textContent=l;break}}),!d(this,Jt)){(i=d(this,Ls))==null||i.remove();return}}else{if(!d(this,Jt)&&!d(this,Ts)){t.classList.remove("done"),(r=d(this,Ls))==null||r.remove();return}t.classList.add("done"),Ge._l10nPromise.get("pdfjs-editor-alt-text-edit-button-label").then(o=>{t.setAttribute("aria-label",o)})}let e=d(this,Ls);if(!e){_(this,Ls,e=document.createElement("span")),e.className="tooltip",e.setAttribute("role","tooltip");const o=e.id=`alt-text-tooltip-${d(this,Ee).id}`;t.setAttribute("aria-describedby",o);const a=100,l=d(this,Ee)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(d(this,Ie)),_(this,Ie,null)},{once:!0}),t.addEventListener("mouseenter",()=>{_(this,Ie,setTimeout(()=>{_(this,Ie,null),d(this,Ls).classList.add("show"),d(this,Ee)._reportTelemetry({action:"alt_text_tooltip"})},a))},{signal:l}),t.addEventListener("mouseleave",()=>{var c;d(this,Ie)&&(clearTimeout(d(this,Ie)),_(this,Ie,null)),(c=d(this,Ls))==null||c.classList.remove("show")},{signal:l})}e.innerText=d(this,Ts)?await Ge._l10nPromise.get("pdfjs-editor-alt-text-decorative-tooltip"):d(this,Jt),e.parentNode||t.append(e);const s=d(this,Ee).getImageForAltText();s==null||s.setAttribute("aria-describedby",e.id)},T(Ge,"_l10nPromise",null);let Yh=Ge;var or,as,Lt,Do,ar,ie,lr,Ki,Nl,cr,Zi,Hl,hr,di,Ds,Io,Oo,Ye,Bl,pd,tt,Iu,zl,Ou,Fu,vb,Ab,Nu,Hu,Bu,xb,zu,wb,Sb,Eb,$u,Ba;const ut=class ut{constructor(t){x(this,tt);x(this,or,null);x(this,as,null);x(this,Lt,null);x(this,Do,!1);x(this,ar,!1);x(this,ie,null);x(this,lr,null);x(this,Ki,null);x(this,Nl,"");x(this,cr,!1);x(this,Zi,null);x(this,Hl,!1);x(this,hr,!1);x(this,di,!1);x(this,Ds,null);x(this,Io,0);x(this,Oo,0);x(this,Ye,null);T(this,"_editToolbar",null);T(this,"_initialOptions",Object.create(null));T(this,"_isVisible",!0);T(this,"_uiManager",null);T(this,"_focusEventsAllowed",!0);x(this,Bl,!1);x(this,pd,ut._zIndex++);this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null;const{rotation:e,rawDims:{pageWidth:s,pageHeight:i,pageX:r,pageY:o}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,i],this.pageTranslation=[r,o];const[a,l]=this.parentDimensions;this.x=t.x/a,this.y=t.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const t=ut.prototype._resizeWithKeyboard,e=Zr.TRANSLATE_SMALL,s=Zr.TRANSLATE_BIG;return at(this,"_resizerKeyboardManager",new Hc([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,s]}],[["Escape","mac+Escape"],ut.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return at(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new R_({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e,s){if(ut._l10nResizer||(ut._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),ut._l10nPromise||(ut._l10nPromise=new Map([...["pdfjs-editor-alt-text-button-label","pdfjs-editor-alt-text-edit-button-label","pdfjs-editor-alt-text-decorative-tooltip","pdfjs-editor-new-alt-text-added-button-label","pdfjs-editor-new-alt-text-missing-button-label","pdfjs-editor-new-alt-text-to-review-button-label"].map(r=>[r,t.get(r)]),...["pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer"].map(r=>[r,t.get.bind(t,r)])])),s!=null&&s.strings)for(const r of s.strings)ut._l10nPromise.set(r,t.get(r));if(ut._borderLineWidth!==-1)return;const i=getComputedStyle(document.documentElement);ut._borderLineWidth=parseFloat(i.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){$t("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return d(this,Bl)}set _isDraggable(t){var e;_(this,Bl,t),(e=this.div)==null||e.classList.toggle("draggable",t)}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=d(this,pd)}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):v(this,tt,Ba).call(this),this.parent=t}focusin(t){this._focusEventsAllowed&&(d(this,cr)?_(this,cr,!1):this.parent.setSelected(this))}focusout(t){var s;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const e=t.relatedTarget;e!=null&&e.closest(`#${this.id}`)||(t.preventDefault(),(s=this.parent)!=null&&s.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,s,i){const[r,o]=this.parentDimensions;[s,i]=this.screenToPageTranslation(s,i),this.x=(t+s)/r,this.y=(e+i)/o,this.fixAndSetPosition()}translate(t,e){v(this,tt,Iu).call(this,this.parentDimensions,t,e)}translateInPage(t,e){d(this,Zi)||_(this,Zi,[this.x,this.y]),v(this,tt,Iu).call(this,this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}drag(t,e){d(this,Zi)||_(this,Zi,[this.x,this.y]);const[s,i]=this.parentDimensions;if(this.x+=t/s,this.y+=e/i,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:c,y:h}=this.div.getBoundingClientRect();this.parent.findNewParent(this,c,h)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:r,y:o}=this;const[a,l]=this.getBaseTranslation();r+=a,o+=l,this.div.style.left=`${(100*r).toFixed(2)}%`,this.div.style.top=`${(100*o).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}get _hasBeenMoved(){return!!d(this,Zi)&&(d(this,Zi)[0]!==this.x||d(this,Zi)[1]!==this.y)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:s}=ut,i=s/t,r=s/e;switch(this.rotation){case 90:return[-i,r];case 180:return[i,r];case 270:return[i,-r];default:return[-i,-r]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const[e,s]=this.pageDimensions;let{x:i,y:r,width:o,height:a}=this;if(o*=e,a*=s,i*=e,r*=s,this._mustFixPosition)switch(t){case 0:i=Math.max(0,Math.min(e-o,i)),r=Math.max(0,Math.min(s-a,r));break;case 90:i=Math.max(0,Math.min(e-a,i)),r=Math.min(s,Math.max(o,r));break;case 180:i=Math.min(e,Math.max(o,i)),r=Math.min(s,Math.max(a,r));break;case 270:i=Math.min(e,Math.max(a,i)),r=Math.max(0,Math.min(s-o,r));break}this.x=i/=e,this.y=r/=s;const[l,c]=this.getBaseTranslation();i+=l,r+=c;const{style:h}=this.div;h.left=`${(100*i).toFixed(2)}%`,h.top=`${(100*r).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(t,e){var s;return v(s=ut,zl,Ou).call(s,t,e,this.parentRotation)}pageTranslationToScreen(t,e){var s;return v(s=ut,zl,Ou).call(s,t,e,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,s]}=this,i=e*t,r=s*t;return Te.isCSSRoundSupported?[Math.round(i),Math.round(r)]:[i,r]}setDims(t,e){const[s,i]=this.parentDimensions;this.div.style.width=`${(100*t/s).toFixed(2)}%`,d(this,ar)||(this.div.style.height=`${(100*e/i).toFixed(2)}%`)}fixDims(){const{style:t}=this.div,{height:e,width:s}=t,i=s.endsWith("%"),r=!d(this,ar)&&e.endsWith("%");if(i&&r)return;const[o,a]=this.parentDimensions;i||(t.width=`${(100*parseFloat(s)/o).toFixed(2)}%`),!d(this,ar)&&!r&&(t.height=`${(100*parseFloat(e)/a).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}altTextFinish(){var t;(t=d(this,Lt))==null||t.finish()}async addEditToolbar(){return this._editToolbar||d(this,hr)?this._editToolbar:(this._editToolbar=new wu(this),this.div.append(this._editToolbar.render()),d(this,Lt)&&await this._editToolbar.addAltText(d(this,Lt)),this._editToolbar)}removeEditToolbar(){var t;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(t=d(this,Lt))==null||t.destroy())}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){d(this,Lt)||(Yh.initialize(ut._l10nPromise),_(this,Lt,new Yh(this)),d(this,or)&&(d(this,Lt).data=d(this,or),_(this,or,null)),await this.addEditToolbar())}get altTextData(){var t;return(t=d(this,Lt))==null?void 0:t.data}set altTextData(t){d(this,Lt)&&(d(this,Lt).data=t)}get guessedAltText(){var t;return(t=d(this,Lt))==null?void 0:t.guessedText}async setGuessedAltText(t){var e;await((e=d(this,Lt))==null?void 0:e.setGuessedText(t))}serializeAltText(t){var e;return(e=d(this,Lt))==null?void 0:e.serialize(t)}hasAltText(){return!!d(this,Lt)&&!d(this,Lt).isEmpty()}hasAltTextData(){var t;return((t=d(this,Lt))==null?void 0:t.hasData())??!1}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=d(this,Do)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),v(this,tt,zu).call(this);const[t,e]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*e/t).toFixed(2)}%`,this.div.style.maxHeight=`${(100*t/e).toFixed(2)}%`);const[s,i]=this.getInitialTranslation();return this.translate(s,i),Xh(this,this.div,["pointerdown"]),this.div}pointerdown(t){const{isMac:e}=Te.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(_(this,cr,!0),this._isDraggable){v(this,tt,xb).call(this,t);return}v(this,tt,Bu).call(this,t)}moveInDOM(){d(this,Ds)&&clearTimeout(d(this,Ds)),_(this,Ds,setTimeout(()=>{var t;_(this,Ds,null),(t=this.parent)==null||t.moveEditorInDOM(this)},0))}_setParentAndPosition(t,e,s){t.changeParent(this),this.x=e,this.y=s,this.fixAndSetPosition()}getRect(t,e,s=this.rotation){const i=this.parentScale,[r,o]=this.pageDimensions,[a,l]=this.pageTranslation,c=t/i,h=e/i,u=this.x*r,f=this.y*o,g=this.width*r,p=this.height*o;switch(s){case 0:return[u+c+a,o-f-h-p+l,u+c+g+a,o-f-h+l];case 90:return[u+h+a,o-f+c+l,u+h+p+a,o-f+c+g+l];case 180:return[u-c-g+a,o-f+h+l,u-c+a,o-f+h+p+l];case 270:return[u-h-p+a,o-f-c-g+l,u-h+a,o-f-c+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[s,i,r,o]=t,a=r-s,l=o-i;switch(this.rotation){case 0:return[s,e-o,a,l];case 90:return[s,e-i,l,a];case 180:return[r,e-i,a,l];case 270:return[r,e-o,l,a];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){_(this,hr,!0)}disableEditMode(){_(this,hr,!1)}isInEditMode(){return d(this,hr)}shouldGetKeyboardEvents(){return d(this,di)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){v(this,tt,zu).call(this)}rotate(t){}serialize(t=!1,e=null){$t("An editor must be serializable")}static deserialize(t,e,s){const i=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:s});i.rotation=t.rotation,_(i,or,t.accessibilityData);const[r,o]=i.pageDimensions,[a,l,c,h]=i.getRectInCurrentCoords(t.rect,o);return i.x=a/r,i.y=l/o,i.width=c/r,i.height=h/o,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var t;if((t=d(this,Ki))==null||t.abort(),_(this,Ki,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),d(this,Ds)&&(clearTimeout(d(this,Ds)),_(this,Ds,null)),v(this,tt,Ba).call(this),this.removeEditToolbar(),d(this,Ye)){for(const e of d(this,Ye).values())clearTimeout(e);_(this,Ye,null)}this.parent=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(v(this,tt,vb).call(this),d(this,ie).classList.remove("hidden"),Xh(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),_(this,lr,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const e=d(this,ie).children;if(!d(this,as)){_(this,as,Array.from(e));const o=v(this,tt,wb).bind(this),a=v(this,tt,Sb).bind(this),l=this._uiManager._signal;for(const c of d(this,as)){const h=c.getAttribute("data-resizer-name");c.setAttribute("role","spinbutton"),c.addEventListener("keydown",o,{signal:l}),c.addEventListener("blur",a,{signal:l}),c.addEventListener("focus",v(this,tt,Eb).bind(this,h),{signal:l}),c.setAttribute("data-l10n-id",ut._l10nResizer[h])}}const s=d(this,as)[0];let i=0;for(const o of e){if(o===s)break;i++}const r=(360-this.rotation+this.parentRotation)%360/90*(d(this,as).length/4);if(r!==i){if(r<i)for(let a=0;a<i-r;a++)d(this,ie).append(d(this,ie).firstChild);else if(r>i)for(let a=0;a<r-i;a++)d(this,ie).firstChild.before(d(this,ie).lastChild);let o=0;for(const a of e){const c=d(this,as)[o++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",ut._l10nResizer[c])}}v(this,tt,$u).call(this,0),_(this,di,!0),d(this,ie).firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}_resizeWithKeyboard(t,e){d(this,di)&&v(this,tt,Hu).call(this,d(this,Nl),{movementX:t,movementY:e})}_stopResizingWithKeyboard(){v(this,tt,Ba).call(this),this.div.focus()}select(){var t,e,s;if(this.makeResizable(),(t=this.div)==null||t.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var i,r;(i=this.div)!=null&&i.classList.contains("selectedEditor")&&((r=this._editToolbar)==null||r.show())});return}(e=this._editToolbar)==null||e.show(),(s=d(this,Lt))==null||s.toggleAltTextBadge(!1)}unselect(){var t,e,s,i,r;(t=d(this,ie))==null||t.classList.add("hidden"),(e=this.div)==null||e.classList.remove("selectedEditor"),(s=this.div)!=null&&s.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(i=this._editToolbar)==null||i.hide(),(r=d(this,Lt))==null||r.toggleAltTextBadge(!0)}updateParams(t,e){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return d(this,Hl)}set isEditing(t){_(this,Hl,t),this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(t,e){_(this,ar,!0);const s=t/e,{style:i}=this.div;i.aspectRatio=s,i.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){d(this,Ye)||_(this,Ye,new Map);const{action:s}=t;let i=d(this,Ye).get(s);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(t),d(this,Ye).delete(s),d(this,Ye).size===0&&_(this,Ye,null)},ut._telemetryTimeout),d(this,Ye).set(s,i);return}t.type||(t.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),_(this,Do,!1)}disable(){this.div&&(this.div.tabIndex=-1),_(this,Do,!0)}renderAnnotationElement(t){let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const s=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),s.before(e)}return e}resetAnnotationElement(t){const{firstChild:e}=t.container;e.nodeName==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}};or=new WeakMap,as=new WeakMap,Lt=new WeakMap,Do=new WeakMap,ar=new WeakMap,ie=new WeakMap,lr=new WeakMap,Ki=new WeakMap,Nl=new WeakMap,cr=new WeakMap,Zi=new WeakMap,Hl=new WeakMap,hr=new WeakMap,di=new WeakMap,Ds=new WeakMap,Io=new WeakMap,Oo=new WeakMap,Ye=new WeakMap,Bl=new WeakMap,pd=new WeakMap,tt=new WeakSet,Iu=function([t,e],s,i){[s,i]=this.screenToPageTranslation(s,i),this.x+=s/t,this.y+=i/e,this.fixAndSetPosition()},zl=new WeakSet,Ou=function(t,e,s){switch(s){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}},Fu=function(t){switch(t){case 90:{const[e,s]=this.pageDimensions;return[0,-e/s,s/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,s]=this.pageDimensions;return[0,e/s,-s/e,0]}default:return[1,0,0,1]}},vb=function(){if(d(this,ie))return;_(this,ie,document.createElement("div")),d(this,ie).classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const s of t){const i=document.createElement("div");d(this,ie).append(i),i.classList.add("resizer",s),i.setAttribute("data-resizer-name",s),i.addEventListener("pointerdown",v(this,tt,Ab).bind(this,s),{signal:e}),i.addEventListener("contextmenu",ts,{signal:e}),i.tabIndex=-1}this.div.prepend(d(this,ie))},Ab=function(t,e){var p;e.preventDefault();const{isMac:s}=Te.platform;if(e.button!==0||e.ctrlKey&&s)return;(p=d(this,Lt))==null||p.toggle(!1);const i=this._isDraggable;this._isDraggable=!1;const r=new AbortController,o=this._uiManager.combinedSignal(r);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",v(this,tt,Hu).bind(this,t),{passive:!0,capture:!0,signal:o}),window.addEventListener("contextmenu",ts,{signal:o});const a=this.x,l=this.y,c=this.width,h=this.height,u=this.parent.div.style.cursor,f=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const g=()=>{var m;r.abort(),this.parent.togglePointerEvents(!0),(m=d(this,Lt))==null||m.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=u,this.div.style.cursor=f,v(this,tt,Nu).call(this,a,l,c,h)};window.addEventListener("pointerup",g,{signal:o}),window.addEventListener("blur",g,{signal:o})},Nu=function(t,e,s,i){const r=this.x,o=this.y,a=this.width,l=this.height;r===t&&o===e&&a===s&&l===i||this.addCommands({cmd:()=>{this.width=a,this.height=l,this.x=r,this.y=o;const[c,h]=this.parentDimensions;this.setDims(c*a,h*l),this.fixAndSetPosition()},undo:()=>{this.width=s,this.height=i,this.x=t,this.y=e;const[c,h]=this.parentDimensions;this.setDims(c*s,h*i),this.fixAndSetPosition()},mustExec:!0})},Hu=function(t,e){const[s,i]=this.parentDimensions,r=this.x,o=this.y,a=this.width,l=this.height,c=ut.MIN_SIZE/s,h=ut.MIN_SIZE/i,u=D=>Math.round(D*1e4)/1e4,f=v(this,tt,Fu).call(this,this.rotation),g=(D,F)=>[f[0]*D+f[2]*F,f[1]*D+f[3]*F],p=v(this,tt,Fu).call(this,360-this.rotation),m=(D,F)=>[p[0]*D+p[2]*F,p[1]*D+p[3]*F];let b,y,A=!1,w=!1;switch(t){case"topLeft":A=!0,b=(D,F)=>[0,0],y=(D,F)=>[D,F];break;case"topMiddle":b=(D,F)=>[D/2,0],y=(D,F)=>[D/2,F];break;case"topRight":A=!0,b=(D,F)=>[D,0],y=(D,F)=>[0,F];break;case"middleRight":w=!0,b=(D,F)=>[D,F/2],y=(D,F)=>[0,F/2];break;case"bottomRight":A=!0,b=(D,F)=>[D,F],y=(D,F)=>[0,0];break;case"bottomMiddle":b=(D,F)=>[D/2,F],y=(D,F)=>[D/2,0];break;case"bottomLeft":A=!0,b=(D,F)=>[0,F],y=(D,F)=>[D,0];break;case"middleLeft":w=!0,b=(D,F)=>[0,F/2],y=(D,F)=>[D,F/2];break}const S=b(a,l),E=y(a,l);let C=g(...E);const k=u(r+C[0]),M=u(o+C[1]);let R=1,N=1,[O,j]=this.screenToPageTranslation(e.movementX,e.movementY);if([O,j]=m(O/s,j/i),A){const D=Math.hypot(a,l);R=N=Math.max(Math.min(Math.hypot(E[0]-S[0]-O,E[1]-S[1]-j)/D,1/a,1/l),c/a,h/l)}else w?R=Math.max(c,Math.min(1,Math.abs(E[0]-S[0]-O)))/a:N=Math.max(h,Math.min(1,Math.abs(E[1]-S[1]-j)))/l;const X=u(a*R),Q=u(l*N);C=g(...y(X,Q));const U=k-C[0],Y=M-C[1];this.width=X,this.height=Q,this.x=U,this.y=Y,this.setDims(s*X,i*Q),this.fixAndSetPosition()},Bu=function(t){const{isMac:e}=Te.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)},xb=function(t){const e=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();const s=new AbortController,i=this._uiManager.combinedSignal(s);if(e){this.div.classList.add("moving"),_(this,Io,t.clientX),_(this,Oo,t.clientY);const o=a=>{const{clientX:l,clientY:c}=a,[h,u]=this.screenToPageTranslation(l-d(this,Io),c-d(this,Oo));_(this,Io,l),_(this,Oo,c),this._uiManager.dragSelectedEditors(h,u)};window.addEventListener("pointermove",o,{passive:!0,capture:!0,signal:i})}const r=()=>{s.abort(),e&&this.div.classList.remove("moving"),_(this,cr,!1),this._uiManager.endDragSession()||v(this,tt,Bu).call(this,t)};window.addEventListener("pointerup",r,{signal:i}),window.addEventListener("blur",r,{signal:i})},zu=function(){if(d(this,Ki)||!this.div)return;_(this,Ki,new AbortController);const t=this._uiManager.combinedSignal(d(this,Ki));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})},wb=function(t){ut._resizerKeyboardManager.exec(this,t)},Sb=function(t){var e;d(this,di)&&((e=t.relatedTarget)==null?void 0:e.parentNode)!==d(this,ie)&&v(this,tt,Ba).call(this)},Eb=function(t){_(this,Nl,d(this,di)?t:"")},$u=function(t){if(d(this,as))for(const e of d(this,as))e.tabIndex=t},Ba=function(){if(_(this,di,!1),v(this,tt,$u).call(this,-1),d(this,lr)){const{savedX:t,savedY:e,savedWidth:s,savedHeight:i}=d(this,lr);v(this,tt,Nu).call(this,t,e,s,i),_(this,lr,null)}},x(ut,zl),T(ut,"_l10nPromise",null),T(ut,"_l10nResizer",null),T(ut,"_borderLineWidth",-1),T(ut,"_colorManager",new ku),T(ut,"_zIndex",1),T(ut,"_telemetryTimeout",1e3);let pt=ut;class R_ extends pt{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}const Xg=3285377520,Ve=4294901760,ys=65535;class Cb{constructor(t){this.h1=t?t&4294967295:Xg,this.h2=t?t&4294967295:Xg}update(t){let e,s;if(typeof t=="string"){e=new Uint8Array(t.length*2),s=0;for(let m=0,b=t.length;m<b;m++){const y=t.charCodeAt(m);y<=255?e[s++]=y:(e[s++]=y>>>8,e[s++]=y&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),s=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const i=s>>2,r=s-i*4,o=new Uint32Array(e.buffer,0,i);let a=0,l=0,c=this.h1,h=this.h2;const u=3432918353,f=461845907,g=u&ys,p=f&ys;for(let m=0;m<i;m++)m&1?(a=o[m],a=a*u&Ve|a*g&ys,a=a<<15|a>>>17,a=a*f&Ve|a*p&ys,c^=a,c=c<<13|c>>>19,c=c*5+3864292196):(l=o[m],l=l*u&Ve|l*g&ys,l=l<<15|l>>>17,l=l*f&Ve|l*p&ys,h^=l,h=h<<13|h>>>19,h=h*5+3864292196);switch(a=0,r){case 3:a^=e[i*4+2]<<16;case 2:a^=e[i*4+1]<<8;case 1:a^=e[i*4],a=a*u&Ve|a*g&ys,a=a<<15|a>>>17,a=a*f&Ve|a*p&ys,i&1?c^=a:h^=a}this.h1=c,this.h2=h}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&Ve|t*36045&ys,e=e*4283543511&Ve|((e<<16|t>>>16)*2950163797&Ve)>>>16,t^=e>>>1,t=t*444984403&Ve|t*60499&ys,e=e*3301882366&Ve|((e<<16|t>>>16)*3120437893&Ve)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const Wu=Object.freeze({map:null,hash:"",transfer:void 0});var dr,ur,Qt,md,kb;class ug{constructor(){x(this,md);x(this,dr,!1);x(this,ur,null);x(this,Qt,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const s=d(this,Qt).get(t);return s===void 0?e:Object.assign(e,s)}getRawValue(t){return d(this,Qt).get(t)}remove(t){if(d(this,Qt).delete(t),d(this,Qt).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const e of d(this,Qt).values())if(e instanceof pt)return;this.onAnnotationEditor(null)}}setValue(t,e){const s=d(this,Qt).get(t);let i=!1;if(s!==void 0)for(const[r,o]of Object.entries(e))s[r]!==o&&(i=!0,s[r]=o);else i=!0,d(this,Qt).set(t,e);i&&v(this,md,kb).call(this),e instanceof pt&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type)}has(t){return d(this,Qt).has(t)}getAll(){return d(this,Qt).size>0?ag(d(this,Qt)):null}setAll(t){for(const[e,s]of Object.entries(t))this.setValue(e,s)}get size(){return d(this,Qt).size}resetModified(){d(this,dr)&&(_(this,dr,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new Mb(this)}get serializable(){if(d(this,Qt).size===0)return Wu;const t=new Map,e=new Cb,s=[],i=Object.create(null);let r=!1;for(const[o,a]of d(this,Qt)){const l=a instanceof pt?a.serialize(!1,i):a;l&&(t.set(o,l),e.update(`${o}:${JSON.stringify(l)}`),r||(r=!!l.bitmap))}if(r)for(const o of t.values())o.bitmap&&s.push(o.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:s}:Wu}get editorStats(){let t=null;const e=new Map;for(const s of d(this,Qt).values()){if(!(s instanceof pt))continue;const i=s.telemetryFinalData;if(!i)continue;const{type:r}=i;e.has(r)||e.set(r,Object.getPrototypeOf(s).constructor),t||(t=Object.create(null));const o=t[r]||(t[r]=new Map);for(const[a,l]of Object.entries(i)){if(a==="type")continue;let c=o.get(a);c||(c=new Map,o.set(a,c));const h=c.get(l)??0;c.set(l,h+1)}}for(const[s,i]of e)t[s]=i.computeTelemetryFinalData(t[s]);return t}resetModifiedIds(){_(this,ur,null)}get modifiedIds(){if(d(this,ur))return d(this,ur);const t=[];for(const e of d(this,Qt).values())!(e instanceof pt)||!e.annotationElementId||!e.serialize()||t.push(e.annotationElementId);return _(this,ur,{ids:new Set(t),hash:t.join(",")})}}dr=new WeakMap,ur=new WeakMap,Qt=new WeakMap,md=new WeakSet,kb=function(){d(this,dr)||(_(this,dr,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var $l;class Mb extends ug{constructor(e){super();x(this,$l);const{map:s,hash:i,transfer:r}=e.serializable,o=structuredClone(s,r?{transfer:r}:null);_(this,$l,{map:o,hash:i,transfer:r})}get print(){$t("Should not call PrintAnnotationStorage.print")}get serializable(){return d(this,$l)}get modifiedIds(){return at(this,"modifiedIds",{ids:new Set,hash:""})}}$l=new WeakMap;var Fo;class D_{constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){x(this,Fo,new Set);this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),d(this,Fo).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,_inspectFont:e}){if(!(!t||d(this,Fo).has(t.loadedName))){if(Xt(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:s,src:i,style:r}=t,o=new FontFace(s,i,r);this.addNativeFontFace(o);try{await o.load(),d(this,Fo).add(s),e==null||e(t)}catch{et(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}$t("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const s=t.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(i){throw et(`Failed to load font '${s.family}': '${i}'.`),t.disableFontFace=!0,i}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const i=this._queueLoadingCallback(s);this._prepareFontLoadEvent(t,i)})}}get isFontLoadingAPISupported(){var e;const t=!!((e=this._document)!=null&&e.fonts);return at(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){let t=!1;return(ue||typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.userAgent)=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(t=!0),at(this,"isSyncFontLoadingSupported",t)}_queueLoadingCallback(t){function e(){for(Xt(!i.done,"completeRequest() cannot be called twice."),i.done=!0;s.length>0&&s[0].done;){const r=s.shift();setTimeout(r.callback,0)}}const{loadingRequests:s}=this,i={done:!1,complete:e,callback:t};return s.push(i),i}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return at(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function s(S,E){return S.charCodeAt(E)<<24|S.charCodeAt(E+1)<<16|S.charCodeAt(E+2)<<8|S.charCodeAt(E+3)&255}function i(S,E,C,k){const M=S.substring(0,E),R=S.substring(E+C);return M+k+R}let r,o;const a=this._document.createElement("canvas");a.width=1,a.height=1;const l=a.getContext("2d");let c=0;function h(S,E){if(++c>30){et("Load test font never loaded."),E();return}if(l.font="30px "+S,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){E();return}setTimeout(h.bind(null,S,E))}const u=`lt${Date.now()}${this.loadTestFontId++}`;let f=this._loadTestFont;f=i(f,976,u.length,u);const p=16,m=1482184792;let b=s(f,p);for(r=0,o=u.length-3;r<o;r+=4)b=b-m+s(u,r)|0;r<u.length&&(b=b-m+s(u+"XXX",r)|0),f=i(f,p,4,p_(b));const y=`url(data:font/opentype;base64,${btoa(f)});`,A=`@font-face {font-family:"${u}";src:${y}}`;this.insertRule(A);const w=this._document.createElement("div");w.style.visibility="hidden",w.style.width=w.style.height="10px",w.style.position="absolute",w.style.top=w.style.left="0px";for(const S of[t.loadedName,u]){const E=this._document.createElement("span");E.textContent="Hi",E.style.fontFamily=S,w.append(E)}this._document.body.append(w),h(u,()=>{w.remove(),e.complete()})}}Fo=new WeakMap;class I_{constructor(t,{disableFontFace:e=!1,inspectFont:s=null}){this.compiledGlyphs=Object.create(null);for(const i in t)this[i]=t[i];this.disableFontFace=e===!0,this._inspectFont=s}createNativeFontFace(){var e;if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const s={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(s.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,s)}return(e=this._inspectFont)==null||e.call(this,this),t}createFontFaceRule(){var i;if(!this.data||this.disableFontFace)return null;const t=Gm(this.data),e=`url(data:${this.mimetype};base64,${btoa(t)});`;let s;if(!this.cssFontInfo)s=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let r=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(r+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),s=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${r}src:${e}}`}return(i=this._inspectFont)==null||i.call(this,this,e),s}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];let s;try{s=t.get(this.loadedName+"_path_"+e)}catch(r){et(`getPathGenerator - ignoring character: "${r}".`)}if(!Array.isArray(s)||s.length===0)return this.compiledGlyphs[e]=function(r,o){};const i=[];for(let r=0,o=s.length;r<o;)switch(s[r++]){case qs.BEZIER_CURVE_TO:{const[a,l,c,h,u,f]=s.slice(r,r+6);i.push(g=>g.bezierCurveTo(a,l,c,h,u,f)),r+=6}break;case qs.MOVE_TO:{const[a,l]=s.slice(r,r+2);i.push(c=>c.moveTo(a,l)),r+=2}break;case qs.LINE_TO:{const[a,l]=s.slice(r,r+2);i.push(c=>c.lineTo(a,l)),r+=2}break;case qs.QUADRATIC_CURVE_TO:{const[a,l,c,h]=s.slice(r,r+4);i.push(u=>u.quadraticCurveTo(a,l,c,h)),r+=4}break;case qs.RESTORE:i.push(a=>a.restore());break;case qs.SAVE:i.push(a=>a.save());break;case qs.SCALE:Xt(i.length===2,"Scale command is only valid at the third position.");break;case qs.TRANSFORM:{const[a,l,c,h,u,f]=s.slice(r,r+6);i.push(g=>g.transform(a,l,c,h,u,f)),r+=6}break;case qs.TRANSLATE:{const[a,l]=s.slice(r,r+2);i.push(c=>c.translate(a,l)),r+=2}break}return this.compiledGlyphs[e]=function(o,a){i[0](o),i[1](o),o.scale(a,-a);for(let l=2,c=i.length;l<c;l++)i[l](o)}}}if(ue){var ju=Promise.withResolvers(),sl=null;(async()=>{const t=await jc(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]),e=await jc(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]),s=await jc(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]),i=await jc(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]);let r,o;return new Map(Object.entries({fs:t,http:e,https:s,url:i,canvas:r,path2d:o}))})().then(t=>{sl=t,ju.resolve()},t=>{et(`loadPackages: ${t}`),sl=new Map,ju.resolve()})}class wn{static get promise(){return ju.promise}static get(t){return sl==null?void 0:sl.get(t)}}const Tb=function(n){return wn.get("fs").promises.readFile(n).then(e=>new Uint8Array(e))};class O_ extends Ym{}class F_ extends qm{_createCanvas(t,e){return wn.get("canvas").createCanvas(t,e)}}class N_ extends Km{_fetchData(t,e){return Tb(t).then(s=>({cMapData:s,compressionType:e}))}}class H_ extends Zm{_fetchData(t){return Tb(t)}}const ye={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Vu(n,t){if(!t)return;const e=t[2]-t[0],s=t[3]-t[1],i=new Path2D;i.rect(t[0],t[1],e,s),n.clip(i)}class fg{getPattern(){$t("Abstract method `getPattern` called.")}}class B_ extends fg{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const s of this._colorStops)e.addColorStop(s[0],s[1]);return e}getPattern(t,e,s,i){let r;if(i===ye.STROKE||i===ye.FILL){const o=e.current.getClippedPathBoundingBox(i,Pt(t))||[0,0,0,0],a=Math.ceil(o[2]-o[0])||1,l=Math.ceil(o[3]-o[1])||1,c=e.cachedCanvases.getCanvas("pattern",a,l,!0),h=c.context;h.clearRect(0,0,h.canvas.width,h.canvas.height),h.beginPath(),h.rect(0,0,h.canvas.width,h.canvas.height),h.translate(-o[0],-o[1]),s=V.transform(s,[1,0,0,1,o[0],o[1]]),h.transform(...e.baseTransform),this.matrix&&h.transform(...this.matrix),Vu(h,this._bbox),h.fillStyle=this._createGradient(h),h.fill(),r=t.createPattern(c.canvas,"no-repeat");const u=new DOMMatrix(s);r.setTransform(u)}else Vu(t,this._bbox),r=this._createGradient(t);return r}}function Xd(n,t,e,s,i,r,o,a){const l=t.coords,c=t.colors,h=n.data,u=n.width*4;let f;l[e+1]>l[s+1]&&(f=e,e=s,s=f,f=r,r=o,o=f),l[s+1]>l[i+1]&&(f=s,s=i,i=f,f=o,o=a,a=f),l[e+1]>l[s+1]&&(f=e,e=s,s=f,f=r,r=o,o=f);const g=(l[e]+t.offsetX)*t.scaleX,p=(l[e+1]+t.offsetY)*t.scaleY,m=(l[s]+t.offsetX)*t.scaleX,b=(l[s+1]+t.offsetY)*t.scaleY,y=(l[i]+t.offsetX)*t.scaleX,A=(l[i+1]+t.offsetY)*t.scaleY;if(p>=A)return;const w=c[r],S=c[r+1],E=c[r+2],C=c[o],k=c[o+1],M=c[o+2],R=c[a],N=c[a+1],O=c[a+2],j=Math.round(p),X=Math.round(A);let Q,U,Y,D,F,L,P,I;for(let $=j;$<=X;$++){if($<b){const ct=$<p?0:(p-$)/(p-b);Q=g-(g-m)*ct,U=w-(w-C)*ct,Y=S-(S-k)*ct,D=E-(E-M)*ct}else{let ct;$>A?ct=1:b===A?ct=0:ct=(b-$)/(b-A),Q=m-(m-y)*ct,U=C-(C-R)*ct,Y=k-(k-N)*ct,D=M-(M-O)*ct}let z;$<p?z=0:$>A?z=1:z=(p-$)/(p-A),F=g-(g-y)*z,L=w-(w-R)*z,P=S-(S-N)*z,I=E-(E-O)*z;const q=Math.round(Math.min(Q,F)),gt=Math.round(Math.max(Q,F));let dt=u*$+q*4;for(let ct=q;ct<=gt;ct++)z=(Q-ct)/(Q-F),z<0?z=0:z>1&&(z=1),h[dt++]=U-(U-L)*z|0,h[dt++]=Y-(Y-P)*z|0,h[dt++]=D-(D-I)*z|0,h[dt++]=255}}function z_(n,t,e){const s=t.coords,i=t.colors;let r,o;switch(t.type){case"lattice":const a=t.verticesPerRow,l=Math.floor(s.length/a)-1,c=a-1;for(r=0;r<l;r++){let h=r*a;for(let u=0;u<c;u++,h++)Xd(n,e,s[h],s[h+1],s[h+a],i[h],i[h+1],i[h+a]),Xd(n,e,s[h+a+1],s[h+1],s[h+a],i[h+a+1],i[h+1],i[h+a])}break;case"triangles":for(r=0,o=s.length;r<o;r+=3)Xd(n,e,s[r],s[r+1],s[r+2],i[r],i[r+1],i[r+2]);break;default:throw new Error("illegal figure")}}class $_ extends fg{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[7],this._background=t[8],this.matrix=null}_createMeshCanvas(t,e,s){const a=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),c=Math.ceil(this._bounds[2])-a,h=Math.ceil(this._bounds[3])-l,u=Math.min(Math.ceil(Math.abs(c*t[0]*1.1)),3e3),f=Math.min(Math.ceil(Math.abs(h*t[1]*1.1)),3e3),g=c/u,p=h/f,m={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-l,scaleX:1/g,scaleY:1/p},b=u+2*2,y=f+2*2,A=s.getCanvas("mesh",b,y,!1),w=A.context,S=w.createImageData(u,f);if(e){const C=S.data;for(let k=0,M=C.length;k<M;k+=4)C[k]=e[0],C[k+1]=e[1],C[k+2]=e[2],C[k+3]=255}for(const C of this._figures)z_(S,C,m);return w.putImageData(S,2,2),{canvas:A.canvas,offsetX:a-2*g,offsetY:l-2*p,scaleX:g,scaleY:p}}getPattern(t,e,s,i){Vu(t,this._bbox);let r;if(i===ye.SHADING)r=V.singularValueDecompose2dScale(Pt(t));else if(r=V.singularValueDecompose2dScale(e.baseTransform),this.matrix){const a=V.singularValueDecompose2dScale(this.matrix);r=[r[0]*a[0],r[1]*a[1]]}const o=this._createMeshCanvas(r,i===ye.SHADING?null:this._background,e.cachedCanvases);return i!==ye.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(o.offsetX,o.offsetY),t.scale(o.scaleX,o.scaleY),t.createPattern(o.canvas,"no-repeat")}}class W_ extends fg{getPattern(){return"hotpink"}}function j_(n){switch(n[0]){case"RadialAxial":return new B_(n);case"Mesh":return new $_(n);case"Dummy":return new W_}throw new Error(`Unknown IR type: ${n[0]}`)}const Yg={COLORED:1,UNCOLORED:2},bd=class bd{constructor(t,e,s,i,r){this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.color=e,this.ctx=s,this.canvasGraphicsFactory=i,this.baseTransform=r}createPatternCanvas(t){const e=this.operatorList,s=this.bbox,i=this.xstep,r=this.ystep,o=this.paintType,a=this.tilingType,l=this.color,c=this.canvasGraphicsFactory;Md("TilingType: "+a);const h=s[0],u=s[1],f=s[2],g=s[3],p=V.singularValueDecompose2dScale(this.matrix),m=V.singularValueDecompose2dScale(this.baseTransform),b=[p[0]*m[0],p[1]*m[1]],y=this.getSizeAndScale(i,this.ctx.canvas.width,b[0]),A=this.getSizeAndScale(r,this.ctx.canvas.height,b[1]),w=t.cachedCanvases.getCanvas("pattern",y.size,A.size,!0),S=w.context,E=c.createCanvasGraphics(S);E.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(E,o,l);let C=h,k=u,M=f,R=g;return h<0&&(C=0,M+=Math.abs(h)),u<0&&(k=0,R+=Math.abs(u)),S.translate(-(y.scale*C),-(A.scale*k)),E.transform(y.scale,0,0,A.scale,0,0),S.save(),this.clipBbox(E,C,k,M,R),E.baseTransform=Pt(E.ctx),E.executeOperatorList(e),E.endDrawing(),{canvas:w.canvas,scaleX:y.scale,scaleY:A.scale,offsetX:C,offsetY:k}}getSizeAndScale(t,e,s){t=Math.abs(t);const i=Math.max(bd.MAX_PATTERN_SIZE,e);let r=Math.ceil(t*s);return r>=i?r=i:s=r/t,{scale:s,size:r}}clipBbox(t,e,s,i,r){const o=i-e,a=r-s;t.ctx.rect(e,s,o,a),t.current.updateRectMinMax(Pt(t.ctx),[e,s,i,r]),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,s){const i=t.ctx,r=t.current;switch(e){case Yg.COLORED:const o=this.ctx;i.fillStyle=o.fillStyle,i.strokeStyle=o.strokeStyle,r.fillColor=o.fillStyle,r.strokeColor=o.strokeStyle;break;case Yg.UNCOLORED:const a=V.makeHexColor(s[0],s[1],s[2]);i.fillStyle=a,i.strokeStyle=a,r.fillColor=a,r.strokeColor=a;break;default:throw new g_(`Unsupported paint type: ${e}`)}}getPattern(t,e,s,i){let r=s;i!==ye.SHADING&&(r=V.transform(r,e.baseTransform),this.matrix&&(r=V.transform(r,this.matrix)));const o=this.createPatternCanvas(e);let a=new DOMMatrix(r);a=a.translate(o.offsetX,o.offsetY),a=a.scale(1/o.scaleX,1/o.scaleY);const l=t.createPattern(o.canvas,"repeat");return l.setTransform(a),l}};T(bd,"MAX_PATTERN_SIZE",3e3);let Uu=bd;function V_({src:n,srcPos:t=0,dest:e,width:s,height:i,nonBlackColor:r=4294967295,inverseDecode:o=!1}){const a=Te.isLittleEndian?4278190080:255,[l,c]=o?[r,a]:[a,r],h=s>>3,u=s&7,f=n.length;e=new Uint32Array(e.buffer);let g=0;for(let p=0;p<i;p++){for(const b=t+h;t<b;t++){const y=t<f?n[t]:255;e[g++]=y&128?c:l,e[g++]=y&64?c:l,e[g++]=y&32?c:l,e[g++]=y&16?c:l,e[g++]=y&8?c:l,e[g++]=y&4?c:l,e[g++]=y&2?c:l,e[g++]=y&1?c:l}if(u===0)continue;const m=t<f?n[t++]:255;for(let b=0;b<u;b++)e[g++]=m&1<<7-b?c:l}return{srcPos:t,destPos:g}}const qg=16,Kg=100,U_=15,Zg=10,Jg=1e3,ke=16;function G_(n,t){if(n._removeMirroring)throw new Error("Context is already forwarding operations.");n.__originalSave=n.save,n.__originalRestore=n.restore,n.__originalRotate=n.rotate,n.__originalScale=n.scale,n.__originalTranslate=n.translate,n.__originalTransform=n.transform,n.__originalSetTransform=n.setTransform,n.__originalResetTransform=n.resetTransform,n.__originalClip=n.clip,n.__originalMoveTo=n.moveTo,n.__originalLineTo=n.lineTo,n.__originalBezierCurveTo=n.bezierCurveTo,n.__originalRect=n.rect,n.__originalClosePath=n.closePath,n.__originalBeginPath=n.beginPath,n._removeMirroring=()=>{n.save=n.__originalSave,n.restore=n.__originalRestore,n.rotate=n.__originalRotate,n.scale=n.__originalScale,n.translate=n.__originalTranslate,n.transform=n.__originalTransform,n.setTransform=n.__originalSetTransform,n.resetTransform=n.__originalResetTransform,n.clip=n.__originalClip,n.moveTo=n.__originalMoveTo,n.lineTo=n.__originalLineTo,n.bezierCurveTo=n.__originalBezierCurveTo,n.rect=n.__originalRect,n.closePath=n.__originalClosePath,n.beginPath=n.__originalBeginPath,delete n._removeMirroring},n.save=function(){t.save(),this.__originalSave()},n.restore=function(){t.restore(),this.__originalRestore()},n.translate=function(s,i){t.translate(s,i),this.__originalTranslate(s,i)},n.scale=function(s,i){t.scale(s,i),this.__originalScale(s,i)},n.transform=function(s,i,r,o,a,l){t.transform(s,i,r,o,a,l),this.__originalTransform(s,i,r,o,a,l)},n.setTransform=function(s,i,r,o,a,l){t.setTransform(s,i,r,o,a,l),this.__originalSetTransform(s,i,r,o,a,l)},n.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},n.rotate=function(s){t.rotate(s),this.__originalRotate(s)},n.clip=function(s){t.clip(s),this.__originalClip(s)},n.moveTo=function(e,s){t.moveTo(e,s),this.__originalMoveTo(e,s)},n.lineTo=function(e,s){t.lineTo(e,s),this.__originalLineTo(e,s)},n.bezierCurveTo=function(e,s,i,r,o,a){t.bezierCurveTo(e,s,i,r,o,a),this.__originalBezierCurveTo(e,s,i,r,o,a)},n.rect=function(e,s,i,r){t.rect(e,s,i,r),this.__originalRect(e,s,i,r)},n.closePath=function(){t.closePath(),this.__originalClosePath()},n.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class X_{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,s){let i;return this.cache[t]!==void 0?(i=this.cache[t],this.canvasFactory.reset(i,e,s)):(i=this.canvasFactory.create(e,s),this.cache[t]=i),i}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function Vc(n,t,e,s,i,r,o,a,l,c){const[h,u,f,g,p,m]=Pt(n);if(u===0&&f===0){const A=o*h+p,w=Math.round(A),S=a*g+m,E=Math.round(S),C=(o+l)*h+p,k=Math.abs(Math.round(C)-w)||1,M=(a+c)*g+m,R=Math.abs(Math.round(M)-E)||1;return n.setTransform(Math.sign(h),0,0,Math.sign(g),w,E),n.drawImage(t,e,s,i,r,0,0,k,R),n.setTransform(h,u,f,g,p,m),[k,R]}if(h===0&&g===0){const A=a*f+p,w=Math.round(A),S=o*u+m,E=Math.round(S),C=(a+c)*f+p,k=Math.abs(Math.round(C)-w)||1,M=(o+l)*u+m,R=Math.abs(Math.round(M)-E)||1;return n.setTransform(0,Math.sign(u),Math.sign(f),0,w,E),n.drawImage(t,e,s,i,r,0,0,R,k),n.setTransform(h,u,f,g,p,m),[R,k]}n.drawImage(t,e,s,i,r,o,a,l,c);const b=Math.hypot(h,u),y=Math.hypot(f,g);return[b*l,y*c]}function Y_(n){const{width:t,height:e}=n;if(t>Jg||e>Jg)return null;const s=1e3,i=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),r=t+1;let o=new Uint8Array(r*(e+1)),a,l,c;const h=t+7&-8;let u=new Uint8Array(h*e),f=0;for(const y of n.data){let A=128;for(;A>0;)u[f++]=y&A?0:255,A>>=1}let g=0;for(f=0,u[f]!==0&&(o[0]=1,++g),l=1;l<t;l++)u[f]!==u[f+1]&&(o[l]=u[f]?2:1,++g),f++;for(u[f]!==0&&(o[l]=2,++g),a=1;a<e;a++){f=a*h,c=a*r,u[f-h]!==u[f]&&(o[c]=u[f]?1:8,++g);let y=(u[f]?4:0)+(u[f-h]?8:0);for(l=1;l<t;l++)y=(y>>2)+(u[f+1]?4:0)+(u[f-h+1]?8:0),i[y]&&(o[c+l]=i[y],++g),f++;if(u[f-h]!==u[f]&&(o[c+l]=u[f]?2:4,++g),g>s)return null}for(f=h*(e-1),c=a*r,u[f]!==0&&(o[c]=8,++g),l=1;l<t;l++)u[f]!==u[f+1]&&(o[c+l]=u[f]?4:8,++g),f++;if(u[f]!==0&&(o[c+l]=4,++g),g>s)return null;const p=new Int32Array([0,r,-1,0,-r,0,0,0,1]),m=new Path2D;for(a=0;g&&a<=e;a++){let y=a*r;const A=y+t;for(;y<A&&!o[y];)y++;if(y===A)continue;m.moveTo(y%r,a);const w=y;let S=o[y];do{const E=p[S];do y+=E;while(!o[y]);const C=o[y];C!==5&&C!==10?(S=C,o[y]=0):(S=C&51*S>>4,o[y]&=S>>2|S<<2),m.lineTo(y%r,y/r|0),o[y]||--g}while(w!==y);--a}return u=null,o=null,function(y){y.save(),y.scale(1/t,-1/e),y.translate(0,-e),y.fill(m),y.beginPath(),y.restore()}}class Qg{constructor(t,e){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=Vm,this.textMatrixScale=1,this.fontMatrix=mu,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=oe.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,t,e])}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t}setCurrentPoint(t,e){this.x=t,this.y=e}updatePathMinMax(t,e,s){[e,s]=V.applyTransform([e,s],t),this.minX=Math.min(this.minX,e),this.minY=Math.min(this.minY,s),this.maxX=Math.max(this.maxX,e),this.maxY=Math.max(this.maxY,s)}updateRectMinMax(t,e){const s=V.applyTransform(e,t),i=V.applyTransform(e.slice(2),t),r=V.applyTransform([e[0],e[3]],t),o=V.applyTransform([e[2],e[1]],t);this.minX=Math.min(this.minX,s[0],i[0],r[0],o[0]),this.minY=Math.min(this.minY,s[1],i[1],r[1],o[1]),this.maxX=Math.max(this.maxX,s[0],i[0],r[0],o[0]),this.maxY=Math.max(this.maxY,s[1],i[1],r[1],o[1])}updateScalingPathMinMax(t,e){V.scaleMinMax(t,e),this.minX=Math.min(this.minX,e[0]),this.minY=Math.min(this.minY,e[1]),this.maxX=Math.max(this.maxX,e[2]),this.maxY=Math.max(this.maxY,e[3])}updateCurvePathMinMax(t,e,s,i,r,o,a,l,c,h){const u=V.bezierBoundingBox(e,s,i,r,o,a,l,c,h);h||this.updateRectMinMax(t,u)}getPathBoundingBox(t=ye.FILL,e=null){const s=[this.minX,this.minY,this.maxX,this.maxY];if(t===ye.STROKE){e||$t("Stroke bounding box must include transform.");const i=V.singularValueDecompose2dScale(e),r=i[0]*this.lineWidth/2,o=i[1]*this.lineWidth/2;s[0]-=r,s[1]-=o,s[2]+=r,s[3]+=o}return s}updateClipFromPath(){const t=V.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(t){this.clipBox=t,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(t=ye.FILL,e=null){return V.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function tp(n,t){if(typeof ImageData<"u"&&t instanceof ImageData){n.putImageData(t,0,0);return}const e=t.height,s=t.width,i=e%ke,r=(e-i)/ke,o=i===0?r:r+1,a=n.createImageData(s,ke);let l=0,c;const h=t.data,u=a.data;let f,g,p,m;if(t.kind===hh.GRAYSCALE_1BPP){const b=h.byteLength,y=new Uint32Array(u.buffer,0,u.byteLength>>2),A=y.length,w=s+7>>3,S=4294967295,E=Te.isLittleEndian?4278190080:255;for(f=0;f<o;f++){for(p=f<r?ke:i,c=0,g=0;g<p;g++){const C=b-l;let k=0;const M=C>w?s:C*8-7,R=M&-8;let N=0,O=0;for(;k<R;k+=8)O=h[l++],y[c++]=O&128?S:E,y[c++]=O&64?S:E,y[c++]=O&32?S:E,y[c++]=O&16?S:E,y[c++]=O&8?S:E,y[c++]=O&4?S:E,y[c++]=O&2?S:E,y[c++]=O&1?S:E;for(;k<M;k++)N===0&&(O=h[l++],N=128),y[c++]=O&N?S:E,N>>=1}for(;c<A;)y[c++]=0;n.putImageData(a,0,f*ke)}}else if(t.kind===hh.RGBA_32BPP){for(g=0,m=s*ke*4,f=0;f<r;f++)u.set(h.subarray(l,l+m)),l+=m,n.putImageData(a,0,g),g+=ke;f<o&&(m=s*i*4,u.set(h.subarray(l,l+m)),n.putImageData(a,0,g))}else if(t.kind===hh.RGB_24BPP)for(p=ke,m=s*p,f=0;f<o;f++){for(f>=r&&(p=i,m=s*p),c=0,g=m;g--;)u[c++]=h[l++],u[c++]=h[l++],u[c++]=h[l++],u[c++]=255;n.putImageData(a,0,f*ke)}else throw new Error(`bad image kind: ${t.kind}`)}function ep(n,t){if(t.bitmap){n.drawImage(t.bitmap,0,0);return}const e=t.height,s=t.width,i=e%ke,r=(e-i)/ke,o=i===0?r:r+1,a=n.createImageData(s,ke);let l=0;const c=t.data,h=a.data;for(let u=0;u<o;u++){const f=u<r?ke:i;({srcPos:l}=V_({src:c,srcPos:l,dest:h,width:s,height:f,nonBlackColor:0})),n.putImageData(a,0,u*ke)}}function Ca(n,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of e)n[s]!==void 0&&(t[s]=n[s]);n.setLineDash!==void 0&&(t.setLineDash(n.getLineDash()),t.lineDashOffset=n.lineDashOffset)}function Uc(n){if(n.strokeStyle=n.fillStyle="#000000",n.fillRule="nonzero",n.globalAlpha=1,n.lineWidth=1,n.lineCap="butt",n.lineJoin="miter",n.miterLimit=10,n.globalCompositeOperation="source-over",n.font="10px sans-serif",n.setLineDash!==void 0&&(n.setLineDash([]),n.lineDashOffset=0),!ue){const{filter:t}=n;t!=="none"&&t!==""&&(n.filter="none")}}function sp(n,t){if(t)return!0;const e=V.singularValueDecompose2dScale(n);e[0]=Math.fround(e[0]),e[1]=Math.fround(e[1]);const s=Math.fround((globalThis.devicePixelRatio||1)*xn.PDF_TO_CSS_UNITS);return e[0]<=s&&e[1]<=s}const q_=["butt","round","square"],K_=["miter","round","bevel"],Z_={},ip={};var kn,Gu,Xu;const zg=class zg{constructor(t,e,s,i,r,{optionalContentConfig:o,markedContentStack:a=null},l,c){x(this,kn);this.ctx=t,this.current=new Qg(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=s,this.canvasFactory=i,this.filterFactory=r,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=o,this.cachedCanvases=new X_(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(t,e=null){return typeof t=="string"?t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t):e}beginDrawing({transform:t,viewport:e,transparency:s=!1,background:i=null}){const r=this.ctx.canvas.width,o=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,r,o),this.ctx.fillStyle=a,s){const l=this.cachedCanvases.getCanvas("transparent",r,o);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...Pt(this.compositeCtx))}this.ctx.save(),Uc(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=Pt(this.ctx)}executeOperatorList(t,e,s,i){const r=t.argsArray,o=t.fnArray;let a=e||0;const l=r.length;if(l===a)return a;const c=l-a>Zg&&typeof s=="function",h=c?Date.now()+U_:0;let u=0;const f=this.commonObjs,g=this.objs;let p;for(;;){if(i!==void 0&&a===i.nextBreakPoint)return i.breakIt(a,s),a;if(p=o[a],p!==ss.dependency)this[p].apply(this,r[a]);else for(const m of r[a]){const b=m.startsWith("g_")?f:g;if(!b.has(m))return b.get(m,s),a}if(a++,a===l)return a;if(c&&++u>Zg){if(Date.now()>h)return s(),a;u=0}}}endDrawing(){v(this,kn,Gu).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),v(this,kn,Xu).call(this)}_scaleImage(t,e){const s=t.width,i=t.height;let r=Math.max(Math.hypot(e[0],e[1]),1),o=Math.max(Math.hypot(e[2],e[3]),1),a=s,l=i,c="prescale1",h,u;for(;r>2&&a>1||o>2&&l>1;){let f=a,g=l;r>2&&a>1&&(f=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),r/=a/f),o>2&&l>1&&(g=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,o/=l/g),h=this.cachedCanvases.getCanvas(c,f,g),u=h.context,u.clearRect(0,0,f,g),u.drawImage(t,0,0,a,l,0,0,f,g),t=h.canvas,a=f,l=g,c=c==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:a,paintHeight:l}}_createMaskCanvas(t){const e=this.ctx,{width:s,height:i}=t,r=this.current.fillColor,o=this.current.patternFill,a=Pt(e);let l,c,h,u;if((t.bitmap||t.data)&&t.count>1){const M=t.bitmap||t.data.buffer;c=JSON.stringify(o?a:[a.slice(0,4),r]),l=this._cachedBitmapsMap.get(M),l||(l=new Map,this._cachedBitmapsMap.set(M,l));const R=l.get(c);if(R&&!o){const N=Math.round(Math.min(a[0],a[2])+a[4]),O=Math.round(Math.min(a[1],a[3])+a[5]);return{canvas:R,offsetX:N,offsetY:O}}h=R}h||(u=this.cachedCanvases.getCanvas("maskCanvas",s,i),ep(u.context,t));let f=V.transform(a,[1/s,0,0,-1/i,0,0]);f=V.transform(f,[1,0,0,1,0,-i]);const[g,p,m,b]=V.getAxialAlignedBoundingBox([0,0,s,i],f),y=Math.round(m-g)||1,A=Math.round(b-p)||1,w=this.cachedCanvases.getCanvas("fillCanvas",y,A),S=w.context,E=g,C=p;S.translate(-E,-C),S.transform(...f),h||(h=this._scaleImage(u.canvas,Ks(S)),h=h.img,l&&o&&l.set(c,h)),S.imageSmoothingEnabled=sp(Pt(S),t.interpolate),Vc(S,h,0,0,h.width,h.height,0,0,s,i),S.globalCompositeOperation="source-in";const k=V.transform(Ks(S),[1,0,0,1,-E,-C]);return S.fillStyle=o?r.getPattern(e,this,k,ye.FILL):r,S.fillRect(0,0,s,i),l&&!o&&(this.cachedCanvases.delete("fillCanvas"),l.set(c,w.canvas)),{canvas:w.canvas,offsetX:Math.round(E),offsetY:Math.round(C)}}setLineWidth(t){t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(t){this.ctx.lineCap=q_[t]}setLineJoin(t){this.ctx.lineJoin=K_[t]}setMiterLimit(t){this.ctx.miterLimit=t}setDash(t,e){const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(t),s.lineDashOffset=e)}setRenderingIntent(t){}setFlatness(t){}setGState(t){for(const[e,s]of t)switch(e){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=s;break;case"ca":this.current.fillAlpha=s,this.ctx.globalAlpha=s;break;case"BM":this.ctx.globalCompositeOperation=s;break;case"SMask":this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,e=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(s,t,e);this.suspendedCtx=this.ctx,this.ctx=i.context;const r=this.ctx;r.setTransform(...Pt(this.suspendedCtx)),Ca(this.suspendedCtx,r),G_(r,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Ca(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,s,i){const r=i[0],o=i[1],a=i[2]-r,l=i[3]-o;a===0||l===0||(this.genericComposeSMask(e.context,s,a,l,e.subtype,e.backdrop,e.transferMap,r,o,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(s.canvas,0,0),t.restore())}genericComposeSMask(t,e,s,i,r,o,a,l,c,h,u){let f=t.canvas,g=l-h,p=c-u;if(o){if(g<0||p<0||g+s>f.width||p+i>f.height){const b=this.cachedCanvases.getCanvas("maskExtension",s,i),y=b.context;y.drawImage(f,-g,-p),o.some(A=>A!==0)&&(y.globalCompositeOperation="destination-atop",y.fillStyle=V.makeHexColor(...o),y.fillRect(0,0,s,i),y.globalCompositeOperation="source-over"),f=b.canvas,g=p=0}else if(o.some(b=>b!==0)){t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const b=new Path2D;b.rect(g,p,s,i),t.clip(b),t.globalCompositeOperation="destination-atop",t.fillStyle=V.makeHexColor(...o),t.fillRect(g,p,s,i),t.restore()}}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),r==="Alpha"&&a?e.filter=this.filterFactory.addAlphaFilter(a):r==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(a));const m=new Path2D;m.rect(l,c,s,i),e.clip(m),e.globalCompositeOperation="destination-in",e.drawImage(f,g,p,s,i,l,c,s,i),e.restore()}save(){this.inSMaskMode?(Ca(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),Ca(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(t,e,s,i,r,o){this.ctx.transform(t,e,s,i,r,o),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,s){const i=this.ctx,r=this.current;let o=r.x,a=r.y,l,c;const h=Pt(i),u=h[0]===0&&h[3]===0||h[1]===0&&h[2]===0,f=u?s.slice(0):null;for(let g=0,p=0,m=t.length;g<m;g++)switch(t[g]|0){case ss.rectangle:o=e[p++],a=e[p++];const b=e[p++],y=e[p++],A=o+b,w=a+y;i.moveTo(o,a),b===0||y===0?i.lineTo(A,w):(i.lineTo(A,a),i.lineTo(A,w),i.lineTo(o,w)),u||r.updateRectMinMax(h,[o,a,A,w]),i.closePath();break;case ss.moveTo:o=e[p++],a=e[p++],i.moveTo(o,a),u||r.updatePathMinMax(h,o,a);break;case ss.lineTo:o=e[p++],a=e[p++],i.lineTo(o,a),u||r.updatePathMinMax(h,o,a);break;case ss.curveTo:l=o,c=a,o=e[p+4],a=e[p+5],i.bezierCurveTo(e[p],e[p+1],e[p+2],e[p+3],o,a),r.updateCurvePathMinMax(h,l,c,e[p],e[p+1],e[p+2],e[p+3],o,a,f),p+=6;break;case ss.curveTo2:l=o,c=a,i.bezierCurveTo(o,a,e[p],e[p+1],e[p+2],e[p+3]),r.updateCurvePathMinMax(h,l,c,o,a,e[p],e[p+1],e[p+2],e[p+3],f),o=e[p+2],a=e[p+3],p+=4;break;case ss.curveTo3:l=o,c=a,o=e[p+2],a=e[p+3],i.bezierCurveTo(e[p],e[p+1],o,a,o,a),r.updateCurvePathMinMax(h,l,c,e[p],e[p+1],o,a,o,a,f),p+=4;break;case ss.closePath:i.closePath();break}u&&r.updateScalingPathMinMax(h,f),r.setCurrentPoint(o,a)}closePath(){this.ctx.closePath()}stroke(t=!0){const e=this.ctx,s=this.current.strokeColor;e.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof s=="object"&&(s!=null&&s.getPattern)?(e.save(),e.strokeStyle=s.getPattern(e,this,Ks(e),ye.STROKE),this.rescaleAndStroke(!1),e.restore()):this.rescaleAndStroke(!0)),t&&this.consumePath(this.current.getClippedPathBoundingBox()),e.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(t=!0){const e=this.ctx,s=this.current.fillColor,i=this.current.patternFill;let r=!1;i&&(e.save(),e.fillStyle=s.getPattern(e,this,Ks(e),ye.FILL),r=!0);const o=this.current.getClippedPathBoundingBox();this.contentVisible&&o!==null&&(this.pendingEOFill?(e.fill("evenodd"),this.pendingEOFill=!1):e.fill()),r&&e.restore(),t&&this.consumePath(o)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=Z_}eoClip(){this.pendingClip=ip}beginText(){this.current.textMatrix=Vm,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const t=this.pendingTextPaths,e=this.ctx;if(t===void 0){e.beginPath();return}e.save(),e.beginPath();for(const s of t)e.setTransform(...s.transform),e.translate(s.x,s.y),s.addToPath(e,s.fontSize);e.restore(),e.clip(),e.beginPath(),delete this.pendingTextPaths}setCharSpacing(t){this.current.charSpacing=t}setWordSpacing(t){this.current.wordSpacing=t}setHScale(t){this.current.textHScale=t/100}setLeading(t){this.current.leading=-t}setFont(t,e){var h;const s=this.commonObjs.get(t),i=this.current;if(!s)throw new Error(`Can't find font for ${t}`);if(i.fontMatrix=s.fontMatrix||mu,(i.fontMatrix[0]===0||i.fontMatrix[3]===0)&&et("Invalid font matrix for font "+t),e<0?(e=-e,i.fontDirection=-1):i.fontDirection=1,this.current.font=s,this.current.fontSize=e,s.isType3Font)return;const r=s.loadedName||"sans-serif",o=((h=s.systemFontInfo)==null?void 0:h.css)||`"${r}", ${s.fallbackName}`;let a="normal";s.black?a="900":s.bold&&(a="bold");const l=s.italic?"italic":"normal";let c=e;e<qg?c=qg:e>Kg&&(c=Kg),this.current.fontSizeScale=e/c,this.ctx.font=`${l} ${a} ${c}px ${o}`}setTextRenderingMode(t){this.current.textRenderingMode=t}setTextRise(t){this.current.textRise=t}moveText(t,e){this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=e}setLeadingMoveText(t,e){this.setLeading(-e),this.moveText(t,e)}setTextMatrix(t,e,s,i,r,o){this.current.textMatrix=[t,e,s,i,r,o],this.current.textMatrixScale=Math.hypot(t,e),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(t,e,s,i){const r=this.ctx,o=this.current,a=o.font,l=o.textRenderingMode,c=o.fontSize/o.fontSizeScale,h=l&oe.FILL_STROKE_MASK,u=!!(l&oe.ADD_TO_PATH_FLAG),f=o.patternFill&&!a.missingFile;let g;(a.disableFontFace||u||f)&&(g=a.getPathGenerator(this.commonObjs,t)),a.disableFontFace||f?(r.save(),r.translate(e,s),r.beginPath(),g(r,c),i&&r.setTransform(...i),(h===oe.FILL||h===oe.FILL_STROKE)&&r.fill(),(h===oe.STROKE||h===oe.FILL_STROKE)&&r.stroke(),r.restore()):((h===oe.FILL||h===oe.FILL_STROKE)&&r.fillText(t,e,s),(h===oe.STROKE||h===oe.FILL_STROKE)&&r.strokeText(t,e,s)),u&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:Pt(r),x:e,y:s,fontSize:c,addToPath:g})}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let s=!1;for(let i=3;i<e.length;i+=4)if(e[i]>0&&e[i]<255){s=!0;break}return at(this,"isFontSubpixelAAEnabled",s)}showText(t){const e=this.current,s=e.font;if(s.isType3Font)return this.showType3Text(t);const i=e.fontSize;if(i===0)return;const r=this.ctx,o=e.fontSizeScale,a=e.charSpacing,l=e.wordSpacing,c=e.fontDirection,h=e.textHScale*c,u=t.length,f=s.vertical,g=f?1:-1,p=s.defaultVMetrics,m=i*e.fontMatrix[0],b=e.textRenderingMode===oe.FILL&&!s.disableFontFace&&!e.patternFill;r.save(),r.transform(...e.textMatrix),r.translate(e.x,e.y+e.textRise),c>0?r.scale(h,-1):r.scale(h,1);let y;if(e.patternFill){r.save();const C=e.fillColor.getPattern(r,this,Ks(r),ye.FILL);y=Pt(r),r.restore(),r.fillStyle=C}let A=e.lineWidth;const w=e.textMatrixScale;if(w===0||A===0){const C=e.textRenderingMode&oe.FILL_STROKE_MASK;(C===oe.STROKE||C===oe.FILL_STROKE)&&(A=this.getSinglePixelWidth())}else A/=w;if(o!==1&&(r.scale(o,o),A/=o),r.lineWidth=A,s.isInvalidPDFjsFont){const C=[];let k=0;for(const M of t)C.push(M.unicode),k+=M.width;r.fillText(C.join(""),0,0),e.x+=k*m*h,r.restore(),this.compose();return}let S=0,E;for(E=0;E<u;++E){const C=t[E];if(typeof C=="number"){S+=g*C*i/1e3;continue}let k=!1;const M=(C.isSpace?l:0)+a,R=C.fontChar,N=C.accent;let O,j,X=C.width;if(f){const U=C.vmetric||p,Y=-(C.vmetric?U[1]:X*.5)*m,D=U[2]*m;X=U?-U[0]:X,O=Y/o,j=(S+D)/o}else O=S/o,j=0;if(s.remeasure&&X>0){const U=r.measureText(R).width*1e3/i*o;if(X<U&&this.isFontSubpixelAAEnabled){const Y=X/U;k=!0,r.save(),r.scale(Y,1),O/=Y}else X!==U&&(O+=(X-U)/2e3*i/o)}if(this.contentVisible&&(C.isInFont||s.missingFile)){if(b&&!N)r.fillText(R,O,j);else if(this.paintChar(R,O,j,y),N){const U=O+i*N.offset.x/o,Y=j-i*N.offset.y/o;this.paintChar(N.fontChar,U,Y,y)}}const Q=f?X*m-M*c:X*m+M*c;S+=Q,k&&r.restore()}f?e.y-=S:e.x+=S*h,r.restore(),this.compose()}showType3Text(t){const e=this.ctx,s=this.current,i=s.font,r=s.fontSize,o=s.fontDirection,a=i.vertical?1:-1,l=s.charSpacing,c=s.wordSpacing,h=s.textHScale*o,u=s.fontMatrix||mu,f=t.length,g=s.textRenderingMode===oe.INVISIBLE;let p,m,b,y;if(!(g||r===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,e.save(),e.transform(...s.textMatrix),e.translate(s.x,s.y),e.scale(h,o),p=0;p<f;++p){if(m=t[p],typeof m=="number"){y=a*m*r/1e3,this.ctx.translate(y,0),s.x+=y*h;continue}const A=(m.isSpace?c:0)+l,w=i.charProcOperatorList[m.operatorListId];if(!w){et(`Type3 character "${m.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=m,this.save(),e.scale(r,r),e.transform(...u),this.executeOperatorList(w),this.restore()),b=V.applyTransform([m.width,0],u)[0]*r+A,e.translate(b,0),s.x+=b*h}e.restore(),this.processingType3=null}}setCharWidth(t,e){}setCharWidthAndBounds(t,e,s,i,r,o){this.ctx.rect(s,i,r-s,o-i),this.ctx.clip(),this.endPath()}getColorN_Pattern(t){let e;if(t[0]==="TilingPattern"){const s=t[1],i=this.baseTransform||Pt(this.ctx),r={createCanvasGraphics:o=>new zg(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};e=new Uu(t,s,this.ctx,r,i)}else e=this._getPattern(t[1],t[2]);return e}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(t,e,s){this.ctx.strokeStyle=this.current.strokeColor=V.makeHexColor(t,e,s)}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent"}setFillRGBColor(t,e,s){this.ctx.fillStyle=this.current.fillColor=V.makeHexColor(t,e,s),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e=null){let s;return this.cachedPatterns.has(t)?s=this.cachedPatterns.get(t):(s=j_(this.getObject(t)),this.cachedPatterns.set(t,s)),e&&(s.matrix=e),s}shadingFill(t){if(!this.contentVisible)return;const e=this.ctx;this.save();const s=this._getPattern(t);e.fillStyle=s.getPattern(e,this,Ks(e),ye.SHADING);const i=Ks(e);if(i){const{width:r,height:o}=e.canvas,[a,l,c,h]=V.getAxialAlignedBoundingBox([0,0,r,o],i);this.ctx.fillRect(a,l,c-a,h-l)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){$t("Should not call beginInlineImage")}beginImageData(){$t("Should not call beginImageData")}paintFormXObjectBegin(t,e){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),t&&this.transform(...t),this.baseTransform=Pt(this.ctx),e)){const s=e[2]-e[0],i=e[3]-e[1];this.ctx.rect(e[0],e[1],s,i),this.current.updateRectMinMax(Pt(this.ctx),e),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const e=this.ctx;t.isolated||Md("TODO: Support non-isolated groups."),t.knockout&&et("Knockout groups not supported.");const s=Pt(e);if(t.matrix&&e.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let i=V.getAxialAlignedBoundingBox(t.bbox,Pt(e));const r=[0,0,e.canvas.width,e.canvas.height];i=V.intersect(i,r)||[0,0,0,0];const o=Math.floor(i[0]),a=Math.floor(i[1]),l=Math.max(Math.ceil(i[2])-o,1),c=Math.max(Math.ceil(i[3])-a,1);this.current.startNewPathAndClipBox([0,0,l,c]);let h="groupAt"+this.groupLevel;t.smask&&(h+="_smask_"+this.smaskCounter++%2);const u=this.cachedCanvases.getCanvas(h,l,c),f=u.context;f.translate(-o,-a),f.transform(...s),t.smask?this.smaskStack.push({canvas:u.canvas,context:f,offsetX:o,offsetY:a,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}):(e.setTransform(1,0,0,1,0,0),e.translate(o,a),e.save()),Ca(e,f),this.ctx=f,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(e),this.groupLevel++}endGroup(t){if(!this.contentVisible)return;this.groupLevel--;const e=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,t.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const i=Pt(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...i);const r=V.getAxialAlignedBoundingBox([0,0,e.canvas.width,e.canvas.height],i);this.ctx.drawImage(e.canvas,0,0),this.ctx.restore(),this.compose(r)}}beginAnnotation(t,e,s,i,r){if(v(this,kn,Gu).call(this),Uc(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),e){const o=e[2]-e[0],a=e[3]-e[1];if(r&&this.annotationCanvasMap){s=s.slice(),s[4]-=e[0],s[5]-=e[1],e=e.slice(),e[0]=e[1]=0,e[2]=o,e[3]=a;const[l,c]=V.singularValueDecompose2dScale(Pt(this.ctx)),{viewportScale:h}=this,u=Math.ceil(o*this.outputScaleX*h),f=Math.ceil(a*this.outputScaleY*h);this.annotationCanvas=this.canvasFactory.create(u,f);const{canvas:g,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(t,g),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.save(),this.ctx.setTransform(l,0,0,-c,0,a*c),Uc(this.ctx)}else Uc(this.ctx),this.ctx.rect(e[0],e[1],o,a),this.ctx.clip(),this.endPath()}this.current=new Qg(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...s),this.transform(...i)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),v(this,kn,Xu).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t){if(!this.contentVisible)return;const e=t.count;t=this.getObject(t.data,t),t.count=e;const s=this.ctx,i=this.processingType3;if(i&&(i.compiled===void 0&&(i.compiled=Y_(t)),i.compiled)){i.compiled(s);return}const r=this._createMaskCanvas(t),o=r.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(o,r.offsetX,r.offsetY),s.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,s=0,i=0,r,o){if(!this.contentVisible)return;t=this.getObject(t.data,t);const a=this.ctx;a.save();const l=Pt(a);a.transform(e,s,i,r,0,0);const c=this._createMaskCanvas(t);a.setTransform(1,0,0,1,c.offsetX-l[4],c.offsetY-l[5]);for(let h=0,u=o.length;h<u;h+=2){const f=V.transform(l,[e,s,i,r,o[h],o[h+1]]),[g,p]=V.applyTransform([0,0],f);a.drawImage(c.canvas,g,p)}a.restore(),this.compose()}paintImageMaskXObjectGroup(t){if(!this.contentVisible)return;const e=this.ctx,s=this.current.fillColor,i=this.current.patternFill;for(const r of t){const{data:o,width:a,height:l,transform:c}=r,h=this.cachedCanvases.getCanvas("maskCanvas",a,l),u=h.context;u.save();const f=this.getObject(o,r);ep(u,f),u.globalCompositeOperation="source-in",u.fillStyle=i?s.getPattern(u,this,Ks(e),ye.FILL):s,u.fillRect(0,0,a,l),u.restore(),e.save(),e.transform(...c),e.scale(1,-1),Vc(e,h.canvas,0,0,a,l,0,-1,1,1),e.restore()}this.compose()}paintImageXObject(t){if(!this.contentVisible)return;const e=this.getObject(t);if(!e){et("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e)}paintImageXObjectRepeat(t,e,s,i){if(!this.contentVisible)return;const r=this.getObject(t);if(!r){et("Dependent image isn't ready yet");return}const o=r.width,a=r.height,l=[];for(let c=0,h=i.length;c<h;c+=2)l.push({transform:[e,0,0,s,i[c],i[c+1]],x:0,y:0,w:o,h:a});this.paintInlineImageXObjectGroup(r,l)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:s,height:i}=t,r=this.cachedCanvases.getCanvas("inlineImage",s,i),o=r.context;return o.filter=this.current.transferMaps,o.drawImage(e,0,0),o.filter="none",r.canvas}paintInlineImageXObject(t){if(!this.contentVisible)return;const e=t.width,s=t.height,i=this.ctx;if(this.save(),!ue){const{filter:a}=i;a!=="none"&&a!==""&&(i.filter="none")}i.scale(1/e,-1/s);let r;if(t.bitmap)r=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)r=t;else{const l=this.cachedCanvases.getCanvas("inlineImage",e,s).context;tp(l,t),r=this.applyTransferMapsToCanvas(l)}const o=this._scaleImage(r,Ks(i));i.imageSmoothingEnabled=sp(Pt(i),t.interpolate),Vc(i,o.img,0,0,o.paintWidth,o.paintHeight,0,-s,e,s),this.compose(),this.restore()}paintInlineImageXObjectGroup(t,e){if(!this.contentVisible)return;const s=this.ctx;let i;if(t.bitmap)i=t.bitmap;else{const r=t.width,o=t.height,l=this.cachedCanvases.getCanvas("inlineImage",r,o).context;tp(l,t),i=this.applyTransferMapsToCanvas(l)}for(const r of e)s.save(),s.transform(...r.transform),s.scale(1,-1),Vc(s,i,r.x,r.y,r.w,r.h,0,-1,1,1),s.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t){}markPointProps(t,e){}beginMarkedContent(t){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e){t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(e)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(t){const e=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(t);const s=this.ctx;this.pendingClip&&(e||(this.pendingClip===ip?s.clip("evenodd"):s.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),s.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=Pt(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),s=Math.hypot(t[0],t[2]),i=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(s,i)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:s,c:i,d:r}=this.ctx.getTransform();let o,a;if(s===0&&i===0){const l=Math.abs(e),c=Math.abs(r);if(l===c)if(t===0)o=a=1/l;else{const h=l*t;o=a=h<1?1/h:1}else if(t===0)o=1/l,a=1/c;else{const h=l*t,u=c*t;o=h<1?1/h:1,a=u<1?1/u:1}}else{const l=Math.abs(e*r-s*i),c=Math.hypot(e,s),h=Math.hypot(i,r);if(t===0)o=h/l,a=c/l;else{const u=t*l;o=h>u?h/u:1,a=c>u?c/u:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(t){const{ctx:e}=this,{lineWidth:s}=this.current,[i,r]=this.getScaleForStroking();if(e.lineWidth=s||1,i===1&&r===1){e.stroke();return}const o=e.getLineDash();if(t&&e.save(),e.scale(i,r),o.length>0){const a=Math.max(i,r);e.setLineDash(o.map(l=>l/a)),e.lineDashOffset/=a}e.stroke(),t&&e.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}};kn=new WeakSet,Gu=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Xu=function(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}};let xo=zg;for(const n in ss)xo.prototype[n]!==void 0&&(xo.prototype[ss[n]]=xo.prototype[n]);var Wl,jl;class ki{static get workerPort(){return d(this,Wl)}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");_(this,Wl,t)}static get workerSrc(){return d(this,jl)}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");_(this,jl,t)}}Wl=new WeakMap,jl=new WeakMap,x(ki,Wl,null),x(ki,jl,"");const Gc={DATA:1,ERROR:2},Bt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Pe(n){switch(n instanceof Error||typeof n=="object"&&n!==null||$t('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),n.name){case"AbortException":return new ro(n.message);case"MissingPDFException":return new no(n.message);case"PasswordException":return new yu(n.message,n.code);case"UnexpectedResponseException":return new Td(n.message,n.status);case"UnknownErrorException":return new _u(n.message,n.details);default:return new _u(n.message,n.toString())}}var Xs,Lb,Pb,yh;class za{constructor(t,e,s){x(this,Xs);this.sourceName=t,this.targetName=e,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=i=>{const r=i.data;if(r.targetName!==this.sourceName)return;if(r.stream){v(this,Xs,Pb).call(this,r);return}if(r.callback){const a=r.callbackId,l=this.callbackCapabilities[a];if(!l)throw new Error(`Cannot resolve callback ${a}`);if(delete this.callbackCapabilities[a],r.callback===Gc.DATA)l.resolve(r.data);else if(r.callback===Gc.ERROR)l.reject(Pe(r.reason));else throw new Error("Unexpected callback case");return}const o=this.actionHandler[r.action];if(!o)throw new Error(`Unknown action from worker: ${r.action}`);if(r.callbackId){const a=this.sourceName,l=r.sourceName;new Promise(function(c){c(o(r.data))}).then(function(c){s.postMessage({sourceName:a,targetName:l,callback:Gc.DATA,callbackId:r.callbackId,data:c})},function(c){s.postMessage({sourceName:a,targetName:l,callback:Gc.ERROR,callbackId:r.callbackId,reason:Pe(c)})});return}if(r.streamId){v(this,Xs,Lb).call(this,r);return}o(r.data)},s.addEventListener("message",this._onComObjOnMessage)}on(t,e){const s=this.actionHandler;if(s[t])throw new Error(`There is already an actionName called "${t}"`);s[t]=e}send(t,e,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},s)}sendWithPromise(t,e,s){const i=this.callbackId++,r=Promise.withResolvers();this.callbackCapabilities[i]=r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:i,data:e},s)}catch(o){r.reject(o)}return r.promise}sendWithStream(t,e,s,i){const r=this.streamId++,o=this.sourceName,a=this.targetName,l=this.comObj;return new ReadableStream({start:c=>{const h=Promise.withResolvers();return this.streamControllers[r]={controller:c,startCall:h,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:o,targetName:a,action:t,streamId:r,data:e,desiredSize:c.desiredSize},i),h.promise},pull:c=>{const h=Promise.withResolvers();return this.streamControllers[r].pullCall=h,l.postMessage({sourceName:o,targetName:a,stream:Bt.PULL,streamId:r,desiredSize:c.desiredSize}),h.promise},cancel:c=>{Xt(c instanceof Error,"cancel must have a valid reason");const h=Promise.withResolvers();return this.streamControllers[r].cancelCall=h,this.streamControllers[r].isClosed=!0,l.postMessage({sourceName:o,targetName:a,stream:Bt.CANCEL,streamId:r,reason:Pe(c)}),h.promise}},s)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}Xs=new WeakSet,Lb=function(t){const e=t.streamId,s=this.sourceName,i=t.sourceName,r=this.comObj,o=this,a=this.actionHandler[t.action],l={enqueue(c,h=1,u){if(this.isCancelled)return;const f=this.desiredSize;this.desiredSize-=h,f>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),r.postMessage({sourceName:s,targetName:i,stream:Bt.ENQUEUE,streamId:e,chunk:c},u)},close(){this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:i,stream:Bt.CLOSE,streamId:e}),delete o.streamSinks[e])},error(c){Xt(c instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:i,stream:Bt.ERROR,streamId:e,reason:Pe(c)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[e]=l,new Promise(function(c){c(a(t.data,l))}).then(function(){r.postMessage({sourceName:s,targetName:i,stream:Bt.START_COMPLETE,streamId:e,success:!0})},function(c){r.postMessage({sourceName:s,targetName:i,stream:Bt.START_COMPLETE,streamId:e,reason:Pe(c)})})},Pb=function(t){const e=t.streamId,s=this.sourceName,i=t.sourceName,r=this.comObj,o=this.streamControllers[e],a=this.streamSinks[e];switch(t.stream){case Bt.START_COMPLETE:t.success?o.startCall.resolve():o.startCall.reject(Pe(t.reason));break;case Bt.PULL_COMPLETE:t.success?o.pullCall.resolve():o.pullCall.reject(Pe(t.reason));break;case Bt.PULL:if(!a){r.postMessage({sourceName:s,targetName:i,stream:Bt.PULL_COMPLETE,streamId:e,success:!0});break}a.desiredSize<=0&&t.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=t.desiredSize,new Promise(function(l){var c;l((c=a.onPull)==null?void 0:c.call(a))}).then(function(){r.postMessage({sourceName:s,targetName:i,stream:Bt.PULL_COMPLETE,streamId:e,success:!0})},function(l){r.postMessage({sourceName:s,targetName:i,stream:Bt.PULL_COMPLETE,streamId:e,reason:Pe(l)})});break;case Bt.ENQUEUE:if(Xt(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(t.chunk);break;case Bt.CLOSE:if(Xt(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),v(this,Xs,yh).call(this,o,e);break;case Bt.ERROR:Xt(o,"error should have stream controller"),o.controller.error(Pe(t.reason)),v(this,Xs,yh).call(this,o,e);break;case Bt.CANCEL_COMPLETE:t.success?o.cancelCall.resolve():o.cancelCall.reject(Pe(t.reason)),v(this,Xs,yh).call(this,o,e);break;case Bt.CANCEL:if(!a)break;new Promise(function(l){var c;l((c=a.onCancel)==null?void 0:c.call(a,Pe(t.reason)))}).then(function(){r.postMessage({sourceName:s,targetName:i,stream:Bt.CANCEL_COMPLETE,streamId:e,success:!0})},function(l){r.postMessage({sourceName:s,targetName:i,stream:Bt.CANCEL_COMPLETE,streamId:e,reason:Pe(l)})}),a.sinkCapability.reject(Pe(t.reason)),a.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}},yh=async function(t,e){var s,i,r;await Promise.allSettled([(s=t.startCall)==null?void 0:s.promise,(i=t.pullCall)==null?void 0:i.promise,(r=t.cancelCall)==null?void 0:r.promise]),delete this.streamControllers[e]};var fr,Vl;class J_{constructor({parsedData:t,rawData:e}){x(this,fr);x(this,Vl);_(this,fr,t),_(this,Vl,e)}getRaw(){return d(this,Vl)}get(t){return d(this,fr).get(t)??null}getAll(){return ag(d(this,fr))}has(t){return d(this,fr).has(t)}}fr=new WeakMap,Vl=new WeakMap;const Bi=Symbol("INTERNAL");var Ul,Gl,Xl,No;class Q_{constructor(t,{name:e,intent:s,usage:i}){x(this,Ul,!1);x(this,Gl,!1);x(this,Xl,!1);x(this,No,!0);_(this,Ul,!!(t&ze.DISPLAY)),_(this,Gl,!!(t&ze.PRINT)),this.name=e,this.intent=s,this.usage=i}get visible(){if(d(this,Xl))return d(this,No);if(!d(this,No))return!1;const{print:t,view:e}=this.usage;return d(this,Ul)?(e==null?void 0:e.viewState)!=="OFF":d(this,Gl)?(t==null?void 0:t.printState)!=="OFF":!0}_setVisible(t,e,s=!1){t!==Bi&&$t("Internal method `_setVisible` called."),_(this,Xl,s),_(this,No,e)}}Ul=new WeakMap,Gl=new WeakMap,Xl=new WeakMap,No=new WeakMap;var Ji,yt,Ho,Bo,Yl,Yu;class tv{constructor(t,e=ze.DISPLAY){x(this,Yl);x(this,Ji,null);x(this,yt,new Map);x(this,Ho,null);x(this,Bo,null);if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,_(this,Bo,t.order);for(const s of t.groups)d(this,yt).set(s.id,new Q_(e,s));if(t.baseState==="OFF")for(const s of d(this,yt).values())s._setVisible(Bi,!1);for(const s of t.on)d(this,yt).get(s)._setVisible(Bi,!0);for(const s of t.off)d(this,yt).get(s)._setVisible(Bi,!1);_(this,Ho,this.getHash())}}isVisible(t){if(d(this,yt).size===0)return!0;if(!t)return Md("Optional content group not defined."),!0;if(t.type==="OCG")return d(this,yt).has(t.id)?d(this,yt).get(t.id).visible:(et(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return v(this,Yl,Yu).call(this,t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!d(this,yt).has(e))return et(`Optional content group not found: ${e}`),!0;if(d(this,yt).get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!d(this,yt).has(e))return et(`Optional content group not found: ${e}`),!0;if(!d(this,yt).get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!d(this,yt).has(e))return et(`Optional content group not found: ${e}`),!0;if(!d(this,yt).get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!d(this,yt).has(e))return et(`Optional content group not found: ${e}`),!0;if(d(this,yt).get(e).visible)return!1}return!0}return et(`Unknown optional content policy ${t.policy}.`),!0}return et(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0){const s=d(this,yt).get(t);if(!s){et(`Optional content group not found: ${t}`);return}s._setVisible(Bi,!!e,!0),_(this,Ji,null)}setOCGState({state:t,preserveRB:e}){let s;for(const i of t){switch(i){case"ON":case"OFF":case"Toggle":s=i;continue}const r=d(this,yt).get(i);if(r)switch(s){case"ON":r._setVisible(Bi,!0);break;case"OFF":r._setVisible(Bi,!1);break;case"Toggle":r._setVisible(Bi,!r.visible);break}}_(this,Ji,null)}get hasInitialVisibility(){return d(this,Ho)===null||this.getHash()===d(this,Ho)}getOrder(){return d(this,yt).size?d(this,Bo)?d(this,Bo).slice():[...d(this,yt).keys()]:null}getGroups(){return d(this,yt).size>0?ag(d(this,yt)):null}getGroup(t){return d(this,yt).get(t)||null}getHash(){if(d(this,Ji)!==null)return d(this,Ji);const t=new Cb;for(const[e,s]of d(this,yt))t.update(`${e}:${s.visible}`);return _(this,Ji,t.hexdigest())}}Ji=new WeakMap,yt=new WeakMap,Ho=new WeakMap,Bo=new WeakMap,Yl=new WeakSet,Yu=function(t){const e=t.length;if(e<2)return!0;const s=t[0];for(let i=1;i<e;i++){const r=t[i];let o;if(Array.isArray(r))o=v(this,Yl,Yu).call(this,r);else if(d(this,yt).has(r))o=d(this,yt).get(r).visible;else return et(`Optional content group not found: ${r}`),!0;switch(s){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return s==="And"};class ev{constructor(t,{disableRange:e=!1,disableStream:s=!1}){Xt(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:r,progressiveDone:o,contentDispositionFilename:a}=t;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=a,(r==null?void 0:r.length)>0){const l=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!s,this._isRangeSupported=!e,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((l,c)=>{this._onReceiveData({begin:l,chunk:c})}),t.addProgressListener((l,c)=>{this._onProgress({loaded:l,total:c})}),t.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const s=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const i=this._rangeReaders.some(function(r){return r._begin!==t?!1:(r._enqueue(s),!0)});Xt(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}_onProgress(t){var e,s,i,r;t.total===void 0?(s=(e=this._rangeReaders[0])==null?void 0:e.onProgress)==null||s.call(e,{loaded:t.loaded}):(r=(i=this._fullRequestReader)==null?void 0:i.onProgress)==null||r.call(i,{loaded:t.loaded,total:t.total})}_onProgressiveDone(){var t;(t=this._fullRequestReader)==null||t.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){Xt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new sv(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new iv(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(s),s}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const s of this._rangeReaders.slice(0))s.cancel(t);this._pdfDataRangeTransport.abort()}}class sv{constructor(t,e,s=!1,i=null){this._stream=t,this._done=s||!1,this._filename=hg(i)?i:null,this._queuedChunks=e||[],this._loaded=0;for(const r of this._queuedChunks)this._loaded+=r.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class iv{constructor(t,e,s){this._stream=t,this._begin=e,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function nv(n){let t=!0,e=s("filename\\*","i").exec(n);if(e){e=e[1];let h=a(e);return h=unescape(h),h=l(h),h=c(h),r(h)}if(e=o(n),e){const h=c(e);return r(h)}if(e=s("filename","i").exec(n),e){e=e[1];let h=a(e);return h=c(h),r(h)}function s(h,u){return new RegExp("(?:^|;)\\s*"+h+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',u)}function i(h,u){if(h){if(!/^[\x00-\xFF]+$/.test(u))return u;try{const f=new TextDecoder(h,{fatal:!0}),g=Ld(u);u=f.decode(g),t=!1}catch{}}return u}function r(h){return t&&/[\x80-\xff]/.test(h)&&(h=i("utf-8",h),t&&(h=i("iso-8859-1",h))),h}function o(h){const u=[];let f;const g=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(f=g.exec(h))!==null;){let[,m,b,y]=f;if(m=parseInt(m,10),m in u){if(m===0)break;continue}u[m]=[b,y]}const p=[];for(let m=0;m<u.length&&m in u;++m){let[b,y]=u[m];y=a(y),b&&(y=unescape(y),m===0&&(y=l(y))),p.push(y)}return p.join("")}function a(h){if(h.startsWith('"')){const u=h.slice(1).split('\\"');for(let f=0;f<u.length;++f){const g=u[f].indexOf('"');g!==-1&&(u[f]=u[f].slice(0,g),u.length=f+1),u[f]=u[f].replaceAll(/\\(.)/g,"$1")}h=u.join('"')}return h}function l(h){const u=h.indexOf("'");if(u===-1)return h;const f=h.slice(0,u),p=h.slice(u+1).replace(/^[^']*'/,"");return i(f,p)}function c(h){return!h.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(h)?h:h.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(u,f,g,p){if(g==="q"||g==="Q")return p=p.replaceAll("_"," "),p=p.replaceAll(/=([0-9a-fA-F]{2})/g,function(m,b){return String.fromCharCode(parseInt(b,16))}),i(f,p);try{p=atob(p)}catch{}return i(f,p)})}return""}function gg({getResponseHeader:n,isHttp:t,rangeChunkSize:e,disableRange:s}){const i={allowRangeRequests:!1,suggestedLength:void 0},r=parseInt(n("Content-Length"),10);return!Number.isInteger(r)||(i.suggestedLength=r,r<=2*e)||s||!t||n("Accept-Ranges")!=="bytes"||(n("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function pg(n){const t=n("Content-Disposition");if(t){let e=nv(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(hg(e))return e}return null}function Dd(n,t){return n===404||n===0&&t.startsWith("file:")?new no('Missing PDF "'+t+'".'):new Td(`Unexpected server response (${n}) while retrieving PDF "${t}".`,n)}function Rb(n){return n===200||n===206}function Db(n,t,e){return{method:"GET",headers:n,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function Ib(n){const t=new Headers;for(const e in n){const s=n[e];s!==void 0&&t.append(e,s)}return t}function Ob(n){return n instanceof Uint8Array?n.buffer:n instanceof ArrayBuffer?n:(et(`getArrayBuffer - unexpected data format: ${n}`),new Uint8Array(n).buffer)}class np{constructor(t){this.source=t,this.isHttp=/^https?:/i.test(t.url),this.httpHeaders=this.isHttp&&t.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}getFullReader(){return Xt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new rv(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new ov(this,t,e);return this._rangeRequestReaders.push(s),s}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const s of this._rangeRequestReaders.slice(0))s.cancel(t)}}class rv{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._headers=Ib(this._stream.httpHeaders);const s=e.url;fetch(s,Db(this._headers,this._withCredentials,this._abortController)).then(i=>{if(!Rb(i.status))throw Dd(i.status,s);this._reader=i.body.getReader(),this._headersCapability.resolve();const r=l=>i.headers.get(l),{allowRangeRequests:o,suggestedLength:a}=gg({getResponseHeader:r,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=a||this._contentLength,this._filename=pg(r),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new ro("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:Ob(t),done:!1})}cancel(t){var e;(e=this._reader)==null||e.cancel(t),this._abortController.abort()}}class ov{constructor(t,e,s){this._stream=t,this._reader=null,this._loaded=0;const i=t.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController,this._headers=Ib(this._stream.httpHeaders),this._headers.append("Range",`bytes=${e}-${s-1}`);const r=i.url;fetch(r,Db(this._headers,this._withCredentials,this._abortController)).then(o=>{if(!Rb(o.status))throw Dd(o.status,r);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:Ob(t),done:!1})}cancel(t){var e;(e=this._reader)==null||e.cancel(t),this._abortController.abort()}}const Yd=200,qd=206;function av(n){const t=n.response;return typeof t!="string"?t:Ld(t).buffer}class lv{constructor(t,e={}){this.url=t,this.isHttp=/^https?:/i.test(t),this.httpHeaders=this.isHttp&&e.httpHeaders||Object.create(null),this.withCredentials=e.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(t,e,s){const i={begin:t,end:e};for(const r in s)i[r]=s[r];return this.request(i)}requestFull(t){return this.request(t)}request(t){const e=new XMLHttpRequest,s=this.currXhrId++,i=this.pendingRequests[s]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const r in this.httpHeaders){const o=this.httpHeaders[r];o!==void 0&&e.setRequestHeader(r,o)}return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),i.expectedStatus=qd):i.expectedStatus=Yd,e.responseType="arraybuffer",t.onError&&(e.onerror=function(r){t.onError(e.status)}),e.onreadystatechange=this.onStateChange.bind(this,s),e.onprogress=this.onProgress.bind(this,s),i.onHeadersReceived=t.onHeadersReceived,i.onDone=t.onDone,i.onError=t.onError,i.onProgress=t.onProgress,e.send(null),s}onProgress(t,e){var i;const s=this.pendingRequests[t];s&&((i=s.onProgress)==null||i.call(s,e))}onStateChange(t,e){var l,c,h;const s=this.pendingRequests[t];if(!s)return;const i=s.xhr;if(i.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),i.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],i.status===0&&this.isHttp){(l=s.onError)==null||l.call(s,i.status);return}const r=i.status||Yd;if(!(r===Yd&&s.expectedStatus===qd)&&r!==s.expectedStatus){(c=s.onError)==null||c.call(s,i.status);return}const a=av(i);if(r===qd){const u=i.getResponseHeader("Content-Range"),f=/bytes (\d+)-(\d+)\/(\d+)/.exec(u);s.onDone({begin:parseInt(f[1],10),chunk:a})}else a?s.onDone({begin:0,chunk:a}):(h=s.onError)==null||h.call(s,i.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class cv{constructor(t){this._source=t,this._manager=new lv(t.url,{httpHeaders:t.httpHeaders,withCredentials:t.withCredentials}),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return Xt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new hv(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const s=new dv(this._manager,t,e);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const s of this._rangeRequestReaders.slice(0))s.cancel(t)}}class hv{constructor(t,e){this._manager=t;const s={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url,this._fullRequestId=t.requestFull(s),this._headersReceivedCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t),s=o=>e.getResponseHeader(o),{allowRangeRequests:i,suggestedLength:r}=gg({getResponseHeader:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});i&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=pg(s),this._isRangeSupported&&this._manager.abortRequest(t),this._headersReceivedCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=Dd(t,this._url),this._headersReceivedCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){var e;(e=this.onProgress)==null||e.call(this,{loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersReceivedCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class dv{constructor(t,e,s){this._manager=t;const i={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=t.url,this._requestId=t.requestRange(e,s,i),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var t;(t=this.onClosed)==null||t.call(this,this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError=Dd(t,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){var e;this.isStreamingSupported||(e=this.onProgress)==null||e.call(this,{loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const uv=/^[a-z][a-z0-9\-+.]+:/i;function fv(n){if(uv.test(n))return new URL(n);const t=wn.get("url");return new URL(t.pathToFileURL(n))}function Fb(n,t,e){return n.protocol==="http:"?wn.get("http").request(n,{headers:t},e):wn.get("https").request(n,{headers:t},e)}class gv{constructor(t){this.source=t,this.url=fv(t.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&t.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}getFullReader(){return Xt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new bv(this):new pv(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=this.isFsUrl?new yv(this,t,e):new mv(this,t,e);return this._rangeRequestReaders.push(s),s}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const s of this._rangeRequestReaders.slice(0))s.cancel(t)}}class Nb{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new ro("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class Hb{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const e=t.source;this._isStreamingSupported=!e.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}class pv extends Nb{constructor(t){super(t);const e=s=>{if(s.statusCode===404){const a=new no(`Missing PDF "${this._url}".`);this._storedError=a,this._headersCapability.reject(a);return}this._headersCapability.resolve(),this._setReadableStream(s);const i=a=>this._readableStream.headers[a.toLowerCase()],{allowRangeRequests:r,suggestedLength:o}=gg({getResponseHeader:i,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=r,this._contentLength=o||this._contentLength,this._filename=pg(i)};this._request=Fb(this._url,t.httpHeaders,e),this._request.on("error",s=>{this._storedError=s,this._headersCapability.reject(s)}),this._request.end()}}class mv extends Hb{constructor(t,e,s){super(t),this._httpHeaders={};for(const r in t.httpHeaders){const o=t.httpHeaders[r];o!==void 0&&(this._httpHeaders[r]=o)}this._httpHeaders.Range=`bytes=${e}-${s-1}`;const i=r=>{if(r.statusCode===404){const o=new no(`Missing PDF "${this._url}".`);this._storedError=o;return}this._setReadableStream(r)};this._request=Fb(this._url,this._httpHeaders,i),this._request.on("error",r=>{this._storedError=r}),this._request.end()}}class bv extends Nb{constructor(t){super(t);const e=wn.get("fs");e.promises.lstat(this._url).then(s=>{this._contentLength=s.size,this._setReadableStream(e.createReadStream(this._url)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=new no(`Missing PDF "${this._url}".`)),this._storedError=s,this._headersCapability.reject(s)})}}class yv extends Hb{constructor(t,e,s){super(t);const i=wn.get("fs");this._setReadableStream(i.createReadStream(this._url,{start:e,end:s-1}))}}const _v=1e5,we=30,vv=.8;var jm,Qi,Ce,ql,Kl,gr,ui,Zl,Jl,pr,zo,$o,tn,Wo,Ql,jo,mr,tc,ec,br,yr,en,Vo,Fi,Bb,zb,qu,Ys,_h,$b,Wb;const le=class le{constructor({textContentSource:t,container:e,viewport:s}){x(this,Fi);x(this,Qi,Promise.withResolvers());x(this,Ce,null);x(this,ql,!1);x(this,Kl,!!((jm=globalThis.FontInspector)!=null&&jm.enabled));x(this,gr,null);x(this,ui,null);x(this,Zl,0);x(this,Jl,0);x(this,pr,null);x(this,zo,null);x(this,$o,0);x(this,tn,0);x(this,Wo,Object.create(null));x(this,Ql,[]);x(this,jo,null);x(this,mr,[]);x(this,tc,new WeakMap);x(this,ec,null);var l;if(t instanceof ReadableStream)_(this,jo,t);else if(typeof t=="object")_(this,jo,new ReadableStream({start(c){c.enqueue(t),c.close()}}));else throw new Error('No "textContentSource" parameter specified.');_(this,Ce,_(this,zo,e)),_(this,tn,s.scale*(globalThis.devicePixelRatio||1)),_(this,$o,s.rotation),_(this,ui,{prevFontSize:null,prevFontFamily:null,div:null,properties:null,ctx:null});const{pageWidth:i,pageHeight:r,pageX:o,pageY:a}=s.rawDims;_(this,ec,[1,0,0,-1,-o,a+r]),_(this,Jl,i),_(this,Zl,r),v(l=le,Ys,$b).call(l),Kr(e,s),d(this,Qi).promise.catch(()=>{}).then(()=>{d(le,Vo).delete(this),_(this,ui,null),_(this,Wo,null)})}render(){const t=()=>{d(this,pr).read().then(({value:e,done:s})=>{if(s){d(this,Qi).resolve();return}d(this,gr)??_(this,gr,e.lang),Object.assign(d(this,Wo),e.styles),v(this,Fi,Bb).call(this,e.items),t()},d(this,Qi).reject)};return _(this,pr,d(this,jo).getReader()),d(le,Vo).add(this),t(),d(this,Qi).promise}update({viewport:t,onBefore:e=null}){var r;const s=t.scale*(globalThis.devicePixelRatio||1),i=t.rotation;if(i!==d(this,$o)&&(e==null||e(),_(this,$o,i),Kr(d(this,zo),{rotation:i})),s!==d(this,tn)){e==null||e(),_(this,tn,s);const o={prevFontSize:null,prevFontFamily:null,div:null,properties:null,ctx:v(r=le,Ys,_h).call(r,d(this,gr))};for(const a of d(this,mr))o.properties=d(this,tc).get(a),o.div=a,v(this,Fi,qu).call(this,o)}}cancel(){var e;const t=new ro("TextLayer task cancelled.");(e=d(this,pr))==null||e.cancel(t).catch(()=>{}),_(this,pr,null),d(this,Qi).reject(t)}get textDivs(){return d(this,mr)}get textContentItemsStr(){return d(this,Ql)}static cleanup(){if(!(d(this,Vo).size>0)){d(this,br).clear();for(const{canvas:t}of d(this,yr).values())t.remove();d(this,yr).clear()}}};Qi=new WeakMap,Ce=new WeakMap,ql=new WeakMap,Kl=new WeakMap,gr=new WeakMap,ui=new WeakMap,Zl=new WeakMap,Jl=new WeakMap,pr=new WeakMap,zo=new WeakMap,$o=new WeakMap,tn=new WeakMap,Wo=new WeakMap,Ql=new WeakMap,jo=new WeakMap,mr=new WeakMap,tc=new WeakMap,ec=new WeakMap,br=new WeakMap,yr=new WeakMap,en=new WeakMap,Vo=new WeakMap,Fi=new WeakSet,Bb=function(t){var i,r;if(d(this,ql))return;(r=d(this,ui)).ctx??(r.ctx=v(i=le,Ys,_h).call(i,d(this,gr)));const e=d(this,mr),s=d(this,Ql);for(const o of t){if(e.length>_v){et("Ignoring additional textDivs for performance reasons."),_(this,ql,!0);return}if(o.str===void 0){if(o.type==="beginMarkedContentProps"||o.type==="beginMarkedContent"){const a=d(this,Ce);_(this,Ce,document.createElement("span")),d(this,Ce).classList.add("markedContent"),o.id!==null&&d(this,Ce).setAttribute("id",`${o.id}`),a.append(d(this,Ce))}else o.type==="endMarkedContent"&&_(this,Ce,d(this,Ce).parentNode);continue}s.push(o.str),v(this,Fi,zb).call(this,o)}},zb=function(t){var m;const e=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};d(this,mr).push(e);const i=V.transform(d(this,ec),t.transform);let r=Math.atan2(i[1],i[0]);const o=d(this,Wo)[t.fontName];o.vertical&&(r+=Math.PI/2);const a=d(this,Kl)&&o.fontSubstitution||o.fontFamily,l=Math.hypot(i[2],i[3]),c=l*v(m=le,Ys,Wb).call(m,a,d(this,gr));let h,u;r===0?(h=i[4],u=i[5]-c):(h=i[4]+c*Math.sin(r),u=i[5]-c*Math.cos(r));const f="calc(var(--scale-factor)*",g=e.style;d(this,Ce)===d(this,zo)?(g.left=`${(100*h/d(this,Jl)).toFixed(2)}%`,g.top=`${(100*u/d(this,Zl)).toFixed(2)}%`):(g.left=`${f}${h.toFixed(2)}px)`,g.top=`${f}${u.toFixed(2)}px)`),g.fontSize=`${f}${(d(le,en)*l).toFixed(2)}px)`,g.fontFamily=a,s.fontSize=l,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,d(this,Kl)&&(e.dataset.fontName=o.fontSubstitutionLoadedName||t.fontName),r!==0&&(s.angle=r*(180/Math.PI));let p=!1;if(t.str.length>1)p=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const b=Math.abs(t.transform[0]),y=Math.abs(t.transform[3]);b!==y&&Math.max(b,y)/Math.min(b,y)>1.5&&(p=!0)}if(p&&(s.canvasWidth=o.vertical?t.height:t.width),d(this,tc).set(e,s),d(this,ui).div=e,d(this,ui).properties=s,v(this,Fi,qu).call(this,d(this,ui)),s.hasText&&d(this,Ce).append(e),s.hasEOL){const b=document.createElement("br");b.setAttribute("role","presentation"),d(this,Ce).append(b)}},qu=function(t){const{div:e,properties:s,ctx:i,prevFontSize:r,prevFontFamily:o}=t,{style:a}=e;let l="";if(d(le,en)>1&&(l=`scale(${1/d(le,en)})`),s.canvasWidth!==0&&s.hasText){const{fontFamily:c}=a,{canvasWidth:h,fontSize:u}=s;(r!==u||o!==c)&&(i.font=`${u*d(this,tn)}px ${c}`,t.prevFontSize=u,t.prevFontFamily=c);const{width:f}=i.measureText(e.textContent);f>0&&(l=`scaleX(${h*d(this,tn)/f}) ${l}`)}s.angle!==0&&(l=`rotate(${s.angle}deg) ${l}`),l.length>0&&(a.transform=l)},Ys=new WeakSet,_h=function(t=null){let e=d(this,yr).get(t||(t=""));if(!e){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=t,document.body.append(s),e=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),d(this,yr).set(t,e)}return e},$b=function(){if(d(this,en)!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),_(this,en,t.getBoundingClientRect().height),t.remove()},Wb=function(t,e){const s=d(this,br).get(t);if(s)return s;const i=v(this,Ys,_h).call(this,e),r=i.font;i.canvas.width=i.canvas.height=we,i.font=`${we}px ${t}`;const o=i.measureText("");let a=o.fontBoundingBoxAscent,l=Math.abs(o.fontBoundingBoxDescent);if(a){const u=a/(a+l);return d(this,br).set(t,u),i.canvas.width=i.canvas.height=0,i.font=r,u}i.strokeStyle="red",i.clearRect(0,0,we,we),i.strokeText("g",0,0);let c=i.getImageData(0,0,we,we).data;l=0;for(let u=c.length-1-3;u>=0;u-=4)if(c[u]>0){l=Math.ceil(u/4/we);break}i.clearRect(0,0,we,we),i.strokeText("A",0,we),c=i.getImageData(0,0,we,we).data,a=0;for(let u=0,f=c.length;u<f;u+=4)if(c[u]>0){a=we-Math.floor(u/4/we);break}i.canvas.width=i.canvas.height=0,i.font=r;const h=a?a/(a+l):vv;return d(this,br).set(t,h),h},x(le,Ys),x(le,br,new Map),x(le,yr,new Map),x(le,en,null),x(le,Vo,new Set);let cl=le;class hl{static textContent(t){const e=[],s={items:e,styles:Object.create(null)};function i(r){var l;if(!r)return;let o=null;const a=r.name;if(a==="#text")o=r.value;else if(hl.shouldBuildText(a))(l=r==null?void 0:r.attributes)!=null&&l.textContent?o=r.attributes.textContent:r.value&&(o=r.value);else return;if(o!==null&&e.push({str:o}),!!r.children)for(const c of r.children)i(c)}return i(t),s}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}const Av=65536,xv=100,wv=5e3,Sv=ue?F_:w_,Ev=ue?N_:Qm,Cv=ue?O_:x_,kv=ue?H_:tb;function Mv(n={}){typeof n=="string"||n instanceof URL?n={url:n}:(n instanceof ArrayBuffer||ArrayBuffer.isView(n))&&(n={data:n});const t=new Ku,{docId:e}=t,s=n.url?Tv(n.url):null,i=n.data?Lv(n.data):null,r=n.httpHeaders||null,o=n.withCredentials===!0,a=n.password??null,l=n.range instanceof jb?n.range:null,c=Number.isInteger(n.rangeChunkSize)&&n.rangeChunkSize>0?n.rangeChunkSize:Av;let h=n.worker instanceof wo?n.worker:null;const u=n.verbosity,f=typeof n.docBaseUrl=="string"&&!Rd(n.docBaseUrl)?n.docBaseUrl:null,g=typeof n.cMapUrl=="string"?n.cMapUrl:null,p=n.cMapPacked!==!1,m=n.CMapReaderFactory||Ev,b=typeof n.standardFontDataUrl=="string"?n.standardFontDataUrl:null,y=n.StandardFontDataFactory||kv,A=n.stopAtErrors!==!0,w=Number.isInteger(n.maxImageSize)&&n.maxImageSize>-1?n.maxImageSize:-1,S=n.isEvalSupported!==!1,E=typeof n.isOffscreenCanvasSupported=="boolean"?n.isOffscreenCanvasSupported:!ue,C=Number.isInteger(n.canvasMaxAreaInBytes)?n.canvasMaxAreaInBytes:-1,k=typeof n.disableFontFace=="boolean"?n.disableFontFace:ue,M=n.fontExtraProperties===!0,R=n.enableXfa===!0,N=n.ownerDocument||globalThis.document,O=n.disableRange===!0,j=n.disableStream===!0,X=n.disableAutoFetch===!0,Q=n.pdfBug===!0,U=n.enableHWA===!0,Y=l?l.length:n.length??NaN,D=typeof n.useSystemFonts=="boolean"?n.useSystemFonts:!ue&&!k,F=typeof n.useWorkerFetch=="boolean"?n.useWorkerFetch:m===Qm&&y===tb&&g&&b&&Na(g,document.baseURI)&&Na(b,document.baseURI),L=n.canvasFactory||new Sv({ownerDocument:N,enableHWA:U}),P=n.filterFactory||new Cv({docId:e,ownerDocument:N}),I=null;h_(u);const $={canvasFactory:L,filterFactory:P};if(F||($.cMapReaderFactory=new m({baseUrl:g,isCompressed:p}),$.standardFontDataFactory=new y({baseUrl:b})),!h){const gt={verbosity:u,port:ki.workerPort};h=gt.port?wo.fromPort(gt):new wo(gt),t._worker=h}const z={docId:e,apiVersion:"4.6.82",data:i,password:a,disableAutoFetch:X,rangeChunkSize:c,length:Y,docBaseUrl:f,enableXfa:R,evaluatorOptions:{maxImageSize:w,disableFontFace:k,ignoreErrors:A,isEvalSupported:S,isOffscreenCanvasSupported:E,canvasMaxAreaInBytes:C,fontExtraProperties:M,useSystemFonts:D,cMapUrl:F?g:null,standardFontDataUrl:F?b:null}},q={disableFontFace:k,fontExtraProperties:M,ownerDocument:N,pdfBug:Q,styleElement:I,loadingParams:{disableAutoFetch:X,enableXfa:R}};return h.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const gt=h.messageHandler.sendWithPromise("GetDocRequest",z,i?[i.buffer]:null);let dt;if(l)dt=new ev(l,{disableRange:O,disableStream:j});else if(!i){if(!s)throw new Error("getDocument - no `url` parameter provided.");dt=(Et=>ue?function(){return typeof fetch<"u"&&typeof Response<"u"&&"body"in Response.prototype}()&&Na(Et.url)?new np(Et):new gv(Et):Na(Et.url)?new np(Et):new cv(Et))({url:s,length:Y,httpHeaders:r,withCredentials:o,rangeChunkSize:c,disableRange:O,disableStream:j})}return gt.then(ct=>{if(t.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const Et=new za(e,ct,h.port),co=new Iv(Et,t,dt,q,$);t._transport=co,Et.send("Ready",null)})}).catch(t._capability.reject),t}function Tv(n){if(n instanceof URL)return n.href;try{return new URL(n,window.location).href}catch{if(ue&&typeof n=="string")return n}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function Lv(n){if(ue&&typeof Buffer<"u"&&n instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength)return n;if(typeof n=="string")return Ld(n);if(n instanceof ArrayBuffer||ArrayBuffer.isView(n)||typeof n=="object"&&!isNaN(n==null?void 0:n.length))return new Uint8Array(n);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function rp(n){return typeof n=="object"&&Number.isInteger(n==null?void 0:n.num)&&n.num>=0&&Number.isInteger(n==null?void 0:n.gen)&&n.gen>=0}var yd;const _d=class _d{constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${xe(_d,yd)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var t,e,s;this.destroyed=!0;try{(t=this._worker)!=null&&t.port&&(this._worker._pendingDestroy=!0),await((e=this._transport)==null?void 0:e.destroy())}catch(i){throw(s=this._worker)!=null&&s.port&&delete this._worker._pendingDestroy,i}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};yd=new WeakMap,x(_d,yd,0);let Ku=_d;class jb{constructor(t,e,s=!1,i=null){this.length=t,this.initialData=e,this.progressiveDone=s,this.contentDispositionFilename=i,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(t){this._rangeListeners.push(t)}addProgressListener(t){this._progressListeners.push(t)}addProgressiveReadListener(t){this._progressiveReadListeners.push(t)}addProgressiveDoneListener(t){this._progressiveDoneListeners.push(t)}onDataRange(t,e){for(const s of this._rangeListeners)s(t,e)}onDataProgress(t,e){this._readyCapability.promise.then(()=>{for(const s of this._progressListeners)s(t,e)})}onDataProgressiveRead(t){this._readyCapability.promise.then(()=>{for(const e of this._progressiveReadListeners)e(t)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const t of this._progressiveDoneListeners)t()})}transportReady(){this._readyCapability.resolve()}requestDataRange(t,e){$t("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class Pv{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return at(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var sn,fi,Je,bo,vh;class Rv{constructor(t,e,s,i=!1){x(this,Je);x(this,sn,null);x(this,fi,!1);this._pageIndex=t,this._pageInfo=e,this._transport=s,this._stats=i?new Ug:null,this._pdfBug=i,this.commonObjs=s.commonObjs,this.objs=new Vb,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:s=0,offsetY:i=0,dontFlip:r=!1}={}){return new Nc({viewBox:this.view,scale:t,rotation:e,offsetX:s,offsetY:i,dontFlip:r})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return at(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var t;return((t=this._transport._htmlForXfa)==null?void 0:t.children[this._pageIndex])||null}render({canvasContext:t,viewport:e,intent:s="display",annotationMode:i=Wi.ENABLE,transform:r=null,background:o=null,optionalContentConfigPromise:a=null,annotationCanvasMap:l=null,pageColors:c=null,printAnnotationStorage:h=null,isEditing:u=!1}){var S,E;(S=this._stats)==null||S.time("Overall");const f=this._transport.getRenderingIntent(s,i,h,u),{renderingIntent:g,cacheKey:p}=f;_(this,fi,!1),v(this,Je,vh).call(this),a||(a=this._transport.getOptionalContentConfig(g));let m=this._intentStates.get(p);m||(m=Object.create(null),this._intentStates.set(p,m)),m.streamReaderCancelTimeout&&(clearTimeout(m.streamReaderCancelTimeout),m.streamReaderCancelTimeout=null);const b=!!(g&ze.PRINT);m.displayReadyCapability||(m.displayReadyCapability=Promise.withResolvers(),m.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(E=this._stats)==null||E.time("Page Request"),this._pumpOperatorList(f));const y=C=>{var k;m.renderTasks.delete(A),(this._maybeCleanupAfterRender||b)&&_(this,fi,!0),v(this,Je,bo).call(this,!b),C?(A.capability.reject(C),this._abortOperatorList({intentState:m,reason:C instanceof Error?C:new Error(C)})):A.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(k=globalThis.Stats)!=null&&k.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},A=new Ju({callback:y,params:{canvasContext:t,viewport:e,transform:r,background:o},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:m.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!b,pdfBug:this._pdfBug,pageColors:c});(m.renderTasks||(m.renderTasks=new Set)).add(A);const w=A.task;return Promise.all([m.displayReadyCapability.promise,a]).then(([C,k])=>{var M;if(this.destroyed){y();return}if((M=this._stats)==null||M.time("Rendering"),!(k.renderingIntent&g))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");A.initializeGraphics({transparency:C,optionalContentConfig:k}),A.operatorListChanged()}).catch(y),w}getOperatorList({intent:t="display",annotationMode:e=Wi.ENABLE,printAnnotationStorage:s=null,isEditing:i=!1}={}){var c;function r(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(l))}const o=this._transport.getRenderingIntent(t,e,s,i,!0);let a=this._intentStates.get(o.cacheKey);a||(a=Object.create(null),this._intentStates.set(o.cacheKey,a));let l;return a.opListReadCapability||(l=Object.create(null),l.operatorListChanged=r,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||(a.renderTasks=new Set)).add(l),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(c=this._stats)==null||c.time("Page Request"),this._pumpOperatorList(o)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>hl.textContent(s));const e=this.streamTextContent(t);return new Promise(function(s,i){function r(){o.read().then(function({value:l,done:c}){if(c){s(a);return}a.lang??(a.lang=l.lang),Object.assign(a.styles,l.styles),a.items.push(...l.items),r()},i)}const o=e.getReader(),a={items:[],styles:Object.create(null),lang:null};r()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const s of e.renderTasks)t.push(s.completed),s.cancel();return this.objs.clear(),_(this,fi,!1),v(this,Je,vh).call(this),Promise.all(t)}cleanup(t=!1){_(this,fi,!0);const e=v(this,Je,bo).call(this,!1);return t&&e&&this._stats&&(this._stats=new Ug),e}_startRenderPage(t,e){var i,r;const s=this._intentStates.get(e);s&&((i=this._stats)==null||i.timeEnd("Page Request"),(r=s.displayReadyCapability)==null||r.resolve(t))}_renderPageChunk(t,e){for(let s=0,i=t.length;s<i;s++)e.operatorList.fnArray.push(t.fnArray[s]),e.operatorList.argsArray.push(t.argsArray[s]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const s of e.renderTasks)s.operatorListChanged();t.lastChunk&&v(this,Je,bo).call(this,!0)}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:s,modifiedIds:i}){const{map:r,transfer:o}=s,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:r,modifiedIds:i},o).getReader(),c=this._intentStates.get(e);c.streamReader=l;const h=()=>{l.read().then(({value:u,done:f})=>{if(f){c.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(u,c),h())},u=>{if(c.streamReader=null,!this._transport.destroyed){if(c.operatorList){c.operatorList.lastChunk=!0;for(const f of c.renderTasks)f.operatorListChanged();v(this,Je,bo).call(this,!0)}if(c.displayReadyCapability)c.displayReadyCapability.reject(u);else if(c.opListReadCapability)c.opListReadCapability.reject(u);else throw u}})};h()}_abortOperatorList({intentState:t,reason:e,force:s=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!s){if(t.renderTasks.size>0)return;if(e instanceof cg){let i=xv;e.extraDelay>0&&e.extraDelay<1e3&&(i+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},i);return}}if(t.streamReader.cancel(new ro(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[i,r]of this._intentStates)if(r===t){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}sn=new WeakMap,fi=new WeakMap,Je=new WeakSet,bo=function(t=!1){if(v(this,Je,vh).call(this),!d(this,fi)||this.destroyed)return!1;if(t)return _(this,sn,setTimeout(()=>{_(this,sn,null),v(this,Je,bo).call(this,!1)},wv)),!1;for(const{renderTasks:e,operatorList:s}of this._intentStates.values())if(e.size>0||!s.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),_(this,fi,!1),!0},vh=function(){d(this,sn)&&(clearTimeout(d(this,sn)),_(this,sn,null))};var _r,vd;class Dv{constructor(){x(this,_r,new Set);x(this,vd,Promise.resolve())}postMessage(t,e){const s={data:structuredClone(t,e?{transfer:e}:null)};d(this,vd).then(()=>{for(const i of d(this,_r))i.call(this,s)})}addEventListener(t,e){d(this,_r).add(e)}removeEventListener(t,e){d(this,_r).delete(e)}terminate(){d(this,_r).clear()}}_r=new WeakMap,vd=new WeakMap;var Ad,vr,Ar,Uo,Ah,Go,xh;const Ct=class Ct{constructor({name:t=null,port:e=null,verbosity:s=d_()}={}){x(this,Uo);var i;if(this.name=t,this.destroyed=!1,this.verbosity=s,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,e){if((i=d(Ct,Ar))!=null&&i.has(e))throw new Error("Cannot use more than one PDFWorker per port.");(d(Ct,Ar)||_(Ct,Ar,new WeakMap)).set(e,this),this._initializeFromPort(e);return}this._initialize()}get promise(){return ue?Promise.all([wn.promise,this._readyCapability.promise]):this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(t){this._port=t,this._messageHandler=new za("main","worker",t),this._messageHandler.on("ready",function(){}),v(this,Uo,Ah).call(this)}_initialize(){if(d(Ct,vr)||d(Ct,Go,xh)){this._setupFakeWorker();return}let{workerSrc:t}=Ct;try{Ct._isSameOrigin(window.location.href,t)||(t=Ct._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),s=new za("main","worker",e),i=()=>{r.abort(),s.destroy(),e.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},r=new AbortController;e.addEventListener("error",()=>{this._webWorker||i()},{signal:r.signal}),s.on("test",a=>{if(r.abort(),this.destroyed||!a){i();return}this._messageHandler=s,this._port=e,this._webWorker=e,v(this,Uo,Ah).call(this)}),s.on("ready",a=>{if(r.abort(),this.destroyed){i();return}try{o()}catch{this._setupFakeWorker()}});const o=()=>{const a=new Uint8Array;s.send("test",a,[a.buffer])};o();return}catch{Md("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){d(Ct,vr)||(et("Setting up fake worker."),_(Ct,vr,!0)),Ct._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const e=new Dv;this._port=e;const s=`fake${xe(Ct,Ad)._++}`,i=new za(s+"_worker",s,e);t.setup(i,e),this._messageHandler=new za(s,s+"_worker",e),v(this,Uo,Ah).call(this)}).catch(t=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${t.message}".`))})}destroy(){var t;this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),(t=d(Ct,Ar))==null||t.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(t){var s;if(!(t!=null&&t.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const e=(s=d(this,Ar))==null?void 0:s.get(t.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new Ct(t)}static get workerSrc(){if(ki.workerSrc)return ki.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return at(this,"_setupFakeWorkerGlobal",(async()=>d(this,Go,xh)?d(this,Go,xh):(await import(this.workerSrc)).WorkerMessageHandler)())}};Ad=new WeakMap,vr=new WeakMap,Ar=new WeakMap,Uo=new WeakSet,Ah=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},Go=new WeakSet,xh=function(){var t;try{return((t=globalThis.pdfjsWorker)==null?void 0:t.WorkerMessageHandler)||null}catch{return null}},x(Ct,Go),x(Ct,Ad,0),x(Ct,vr,!1),x(Ct,Ar),ue&&(_(Ct,vr,!0),ki.workerSrc||(ki.workerSrc="./pdf.worker.mjs")),Ct._isSameOrigin=(t,e)=>{let s;try{if(s=new URL(t),!s.origin||s.origin==="null")return!1}catch{return!1}const i=new URL(e,s);return s.origin===i.origin},Ct._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};let wo=Ct;var gi,Is,Xo,Yo,Os,xr,$a;class Iv{constructor(t,e,s,i,r){x(this,xr);x(this,gi,new Map);x(this,Is,new Map);x(this,Xo,new Map);x(this,Yo,new Map);x(this,Os,null);this.messageHandler=t,this.loadingTask=e,this.commonObjs=new Vb,this.fontLoader=new D_({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return at(this,"annotationStorage",new ug)}getRenderingIntent(t,e=Wi.ENABLE,s=null,i=!1,r=!1){let o=ze.DISPLAY,a=Wu;switch(t){case"any":o=ze.ANY;break;case"display":break;case"print":o=ze.PRINT;break;default:et(`getRenderingIntent - invalid intent: ${t}`)}const l=o&ze.PRINT&&s instanceof Mb?s:this.annotationStorage;switch(e){case Wi.DISABLE:o+=ze.ANNOTATIONS_DISABLE;break;case Wi.ENABLE:break;case Wi.ENABLE_FORMS:o+=ze.ANNOTATIONS_FORMS;break;case Wi.ENABLE_STORAGE:o+=ze.ANNOTATIONS_STORAGE,a=l.serializable;break;default:et(`getRenderingIntent - invalid annotationMode: ${e}`)}i&&(o+=ze.IS_EDITING),r&&(o+=ze.OPLIST);const{ids:c,hash:h}=l.modifiedIds,u=[o,a.hash,h];return{renderingIntent:o,cacheKey:u.join("_"),annotationStorageSerializable:a,modifiedIds:c}}destroy(){var s;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(s=d(this,Os))==null||s.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const i of d(this,Is).values())t.push(i._destroy());d(this,Is).clear(),d(this,Xo).clear(),d(this,Yo).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{var i;this.commonObjs.clear(),this.fontLoader.clear(),d(this,gi).clear(),this.filterFactory.destroy(),cl.cleanup(),(i=this._networkStream)==null||i.cancelAllRequests(new ro("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(s,i)=>{Xt(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=r=>{this._lastProgress={loaded:r.loaded,total:r.total}},i.onPull=()=>{this._fullReader.read().then(function({value:r,done:o}){if(o){i.close();return}Xt(r instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{i.error(r)})},i.onCancel=r=>{this._fullReader.cancel(r),i.ready.catch(o=>{if(!this.destroyed)throw o})}}),t.on("ReaderHeadersReady",s=>{const i=Promise.withResolvers(),r=this._fullReader;return r.headersReady.then(()=>{var o;(!r.isStreamingSupported||!r.isRangeSupported)&&(this._lastProgress&&((o=e.onProgress)==null||o.call(e,this._lastProgress)),r.onProgress=a=>{var l;(l=e.onProgress)==null||l.call(e,{loaded:a.loaded,total:a.total})}),i.resolve({isStreamingSupported:r.isStreamingSupported,isRangeSupported:r.isRangeSupported,contentLength:r.contentLength})},i.reject),i.promise}),t.on("GetRangeReader",(s,i)=>{Xt(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const r=this._networkStream.getRangeReader(s.begin,s.end);if(!r){i.close();return}i.onPull=()=>{r.read().then(function({value:o,done:a}){if(a){i.close();return}Xt(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{i.error(o)})},i.onCancel=o=>{r.cancel(o),i.ready.catch(a=>{if(!this.destroyed)throw a})}}),t.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,e._capability.resolve(new Pv(s,this))}),t.on("DocException",function(s){let i;switch(s.name){case"PasswordException":i=new yu(s.message,s.code);break;case"InvalidPDFException":i=new Um(s.message);break;case"MissingPDFException":i=new no(s.message);break;case"UnexpectedResponseException":i=new Td(s.message,s.status);break;case"UnknownErrorException":i=new _u(s.message,s.details);break;default:$t("DocException - expected a valid Error.")}e._capability.reject(i)}),t.on("PasswordRequest",s=>{if(_(this,Os,Promise.withResolvers()),e.onPassword){const i=r=>{r instanceof Error?d(this,Os).reject(r):d(this,Os).resolve({password:r})};try{e.onPassword(i,s.code)}catch(r){d(this,Os).reject(r)}}else d(this,Os).reject(new yu(s.message,s.code));return d(this,Os).promise}),t.on("DataLoaded",s=>{var i;(i=e.onProgress)==null||i.call(e,{loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),t.on("StartRenderPage",s=>{if(this.destroyed)return;d(this,Is).get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),t.on("commonobj",([s,i,r])=>{var o;if(this.destroyed||this.commonObjs.has(s))return null;switch(i){case"Font":const{disableFontFace:a,fontExtraProperties:l,pdfBug:c}=this._params;if("error"in r){const g=r.error;et(`Error during font loading: ${g}`),this.commonObjs.resolve(s,g);break}const h=c&&((o=globalThis.FontInspector)!=null&&o.enabled)?(g,p)=>globalThis.FontInspector.fontAdded(g,p):null,u=new I_(r,{disableFontFace:a,inspectFont:h});this.fontLoader.bind(u).catch(()=>t.sendWithPromise("FontFallback",{id:s})).finally(()=>{!l&&u.data&&(u.data=null),this.commonObjs.resolve(s,u)});break;case"CopyLocalImage":const{imageRef:f}=r;Xt(f,"The imageRef must be defined.");for(const g of d(this,Is).values())for(const[,p]of g.objs)if((p==null?void 0:p.ref)===f)return p.dataLen?(this.commonObjs.resolve(s,structuredClone(p)),p.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(s,r);break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),t.on("obj",([s,i,r,o])=>{var l;if(this.destroyed)return;const a=d(this,Is).get(i);if(!a.objs.has(s)){if(a._intentStates.size===0){(l=o==null?void 0:o.bitmap)==null||l.close();return}switch(r){case"Image":a.objs.resolve(s,o),(o==null?void 0:o.dataLen)>o_&&(a._maybeCleanupAfterRender=!0);break;case"Pattern":a.objs.resolve(s,o);break;default:throw new Error(`Got unknown object type ${r}`)}}}),t.on("DocProgress",s=>{var i;this.destroyed||(i=e.onProgress)==null||i.call(e,{loaded:s.loaded,total:s.total})}),t.on("FetchBuiltInCMap",s=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(s):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),t.on("FetchStandardFontData",s=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(s):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var s;this.annotationStorage.size<=0&&et("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:((s=this._fullReader)==null?void 0:s.filename)??null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,s=d(this,Xo).get(e);if(s)return s;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");r.refStr&&d(this,Yo).set(r.refStr,t);const o=new Rv(e,r,this,this._params.pdfBug);return d(this,Is).set(e,o),o});return d(this,Xo).set(e,i),i}getPageIndex(t){return rp(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return v(this,xr,$a).call(this,"GetFieldObjects")}hasJSActions(){return v(this,xr,$a).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return v(this,xr,$a).call(this,"GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return v(this,xr,$a).call(this,"GetOptionalContentConfig").then(e=>new tv(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=d(this,gi).get(t);if(e)return e;const s=this.messageHandler.sendWithPromise(t,null).then(i=>{var r,o;return{info:i[0],metadata:i[1]?new J_(i[1]):null,contentDispositionFilename:((r=this._fullReader)==null?void 0:r.filename)??null,contentLength:((o=this._fullReader)==null?void 0:o.contentLength)??null}});return d(this,gi).set(t,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of d(this,Is).values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),d(this,gi).clear(),this.filterFactory.destroy(!0),cl.cleanup()}}cachedPageNumber(t){if(!rp(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return d(this,Yo).get(e)??null}}gi=new WeakMap,Is=new WeakMap,Xo=new WeakMap,Yo=new WeakMap,Os=new WeakMap,xr=new WeakSet,$a=function(t,e=null){const s=d(this,gi).get(t);if(s)return s;const i=this.messageHandler.sendWithPromise(t,e);return d(this,gi).set(t,i),i};const Xc=Symbol("INITIAL_DATA");var ls,sc,Zu;class Vb{constructor(){x(this,sc);x(this,ls,Object.create(null))}get(t,e=null){if(e){const i=v(this,sc,Zu).call(this,t);return i.promise.then(()=>e(i.data)),null}const s=d(this,ls)[t];if(!s||s.data===Xc)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return s.data}has(t){const e=d(this,ls)[t];return!!e&&e.data!==Xc}resolve(t,e=null){const s=v(this,sc,Zu).call(this,t);s.data=e,s.resolve()}clear(){var t;for(const e in d(this,ls)){const{data:s}=d(this,ls)[e];(t=s==null?void 0:s.bitmap)==null||t.close()}_(this,ls,Object.create(null))}*[Symbol.iterator](){for(const t in d(this,ls)){const{data:e}=d(this,ls)[t];e!==Xc&&(yield[t,e])}}}ls=new WeakMap,sc=new WeakSet,Zu=function(t){var e;return(e=d(this,ls))[t]||(e[t]={...Promise.withResolvers(),data:Xc})};var nn;class Ov{constructor(t){x(this,nn,null);_(this,nn,t),this.onContinue=null}get promise(){return d(this,nn).capability.promise}cancel(t=0){d(this,nn).cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=d(this,nn).operatorList;if(!t)return!1;const{annotationCanvasMap:e}=d(this,nn);return t.form||t.canvas&&(e==null?void 0:e.size)>0}}nn=new WeakMap;var rn,wr;const Vn=class Vn{constructor({callback:t,params:e,objs:s,commonObjs:i,annotationCanvasMap:r,operatorList:o,pageIndex:a,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:h=!1,pdfBug:u=!1,pageColors:f=null}){x(this,rn,null);this.callback=t,this.params=e,this.objs=s,this.commonObjs=i,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=a,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=u,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=h===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Ov(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){var a,l;if(this.cancelled)return;if(this._canvas){if(d(Vn,wr).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");d(Vn,wr).add(this._canvas)}this._pdfBug&&((a=globalThis.StepperManager)!=null&&a.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:s,viewport:i,transform:r,background:o}=this.params;this.gfx=new xo(s,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:r,viewport:i,transparency:t,background:o}),this.operatorListIdx=0,this.graphicsReady=!0,(l=this.graphicsReadyCallback)==null||l.call(this)}cancel(t=null,e=0){var s;this.running=!1,this.cancelled=!0,(s=this.gfx)==null||s.endDrawing(),d(this,rn)&&(window.cancelAnimationFrame(d(this,rn)),_(this,rn,null)),d(Vn,wr).delete(this._canvas),this.callback(t||new cg(`Rendering cancelled, page ${this._pageIndex+1}`,e))}operatorListChanged(){var t;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(t=this.stepper)==null||t.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?_(this,rn,window.requestAnimationFrame(()=>{_(this,rn,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),d(Vn,wr).delete(this._canvas),this.callback())))}};rn=new WeakMap,wr=new WeakMap,x(Vn,wr,new WeakSet);let Ju=Vn;const Fv="4.6.82",Nv="9b541910f";function op(n){return Math.floor(Math.max(0,Math.min(1,n))*255).toString(16).padStart(2,"0")}function ka(n){return Math.max(0,Math.min(255,255*n))}class ap{static CMYK_G([t,e,s,i]){return["G",1-Math.min(1,.3*t+.59*s+.11*e+i)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=ka(t),[t,t,t]}static G_HTML([t]){const e=op(t);return`#${e}${e}${e}`}static RGB_G([t,e,s]){return["G",.3*t+.59*e+.11*s]}static RGB_rgb(t){return t.map(ka)}static RGB_HTML(t){return`#${t.map(op).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,s,i]){return["RGB",1-Math.min(1,t+i),1-Math.min(1,s+i),1-Math.min(1,e+i)]}static CMYK_rgb([t,e,s,i]){return[ka(1-Math.min(1,t+i)),ka(1-Math.min(1,s+i)),ka(1-Math.min(1,e+i))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,s]){const i=1-t,r=1-e,o=1-s,a=Math.min(i,r,o);return["CMYK",i,r,o,a]}}class Ub{static setupStorage(t,e,s,i,r){const o=i.getValue(e,{value:null});switch(s.name){case"textarea":if(o.value!==null&&(t.textContent=o.value),r==="print")break;t.addEventListener("input",a=>{i.setValue(e,{value:a.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(o.value===s.attributes.xfaOn?t.setAttribute("checked",!0):o.value===s.attributes.xfaOff&&t.removeAttribute("checked"),r==="print")break;t.addEventListener("change",a=>{i.setValue(e,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&t.setAttribute("value",o.value),r==="print")break;t.addEventListener("input",a=>{i.setValue(e,{value:a.target.value})})}break;case"select":if(o.value!==null){t.setAttribute("value",o.value);for(const a of s.children)a.attributes.value===o.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}t.addEventListener("input",a=>{const l=a.target.options,c=l.selectedIndex===-1?"":l[l.selectedIndex].value;i.setValue(e,{value:c})});break}}static setAttributes({html:t,element:e,storage:s=null,intent:i,linkService:r}){const{attributes:o}=e,a=t instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${i}`);for(const[l,c]of Object.entries(o))if(c!=null)switch(l){case"class":c.length&&t.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",c);break;case"style":Object.assign(t.style,c);break;case"textContent":t.textContent=c;break;default:(!a||l!=="href"&&l!=="newWindow")&&t.setAttribute(l,c)}a&&r.addLinkAttributes(t,o.href,o.newWindow),s&&o.dataId&&this.setupStorage(t,o.dataId,e,s)}static render(t){var u,f;const e=t.annotationStorage,s=t.linkService,i=t.xfaHtml,r=t.intent||"display",o=document.createElement(i.name);i.attributes&&this.setAttributes({html:o,element:i,intent:r,linkService:s});const a=r!=="richText",l=t.div;if(l.append(o),t.viewport){const g=`matrix(${t.viewport.transform.join(",")})`;l.style.transform=g}a&&l.setAttribute("class","xfaLayer xfaFont");const c=[];if(i.children.length===0){if(i.value){const g=document.createTextNode(i.value);o.append(g),a&&hl.shouldBuildText(i.name)&&c.push(g)}return{textDivs:c}}const h=[[i,-1,o]];for(;h.length>0;){const[g,p,m]=h.at(-1);if(p+1===g.children.length){h.pop();continue}const b=g.children[++h.at(-1)[1]];if(b===null)continue;const{name:y}=b;if(y==="#text"){const w=document.createTextNode(b.value);c.push(w),m.append(w);continue}const A=(u=b==null?void 0:b.attributes)!=null&&u.xmlns?document.createElementNS(b.attributes.xmlns,y):document.createElement(y);if(m.append(A),b.attributes&&this.setAttributes({html:A,element:b,storage:e,intent:r,linkService:s}),((f=b.children)==null?void 0:f.length)>0)h.push([b,-1,A]);else if(b.value){const w=document.createTextNode(b.value);a&&hl.shouldBuildText(y)&&c.push(w),A.append(w)}}for(const g of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))g.setAttribute("readOnly",!0);return{textDivs:c}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const Bc=1e3,Hv=9,Jr=new WeakSet;function Ri(n){return{width:n[2]-n[0],height:n[3]-n[1]}}class Bv{static create(t){switch(t.data.annotationType){case Wt.LINK:return new Gb(t);case Wt.TEXT:return new zv(t);case Wt.WIDGET:switch(t.data.fieldType){case"Tx":return new $v(t);case"Btn":return t.data.radioButton?new qb(t):t.data.checkBox?new jv(t):new Vv(t);case"Ch":return new Uv(t);case"Sig":return new Wv(t)}return new oo(t);case Wt.POPUP:return new tf(t);case Wt.FREETEXT:return new t0(t);case Wt.LINE:return new Xv(t);case Wt.SQUARE:return new Yv(t);case Wt.CIRCLE:return new qv(t);case Wt.POLYLINE:return new e0(t);case Wt.CARET:return new Zv(t);case Wt.INK:return new s0(t);case Wt.POLYGON:return new Kv(t);case Wt.HIGHLIGHT:return new Jv(t);case Wt.UNDERLINE:return new Qv(t);case Wt.SQUIGGLY:return new tA(t);case Wt.STRIKEOUT:return new eA(t);case Wt.STAMP:return new i0(t);case Wt.FILEATTACHMENT:return new sA(t);default:return new Ht(t)}}}var Sr,qo,Ko,ic,Qu;const $g=class $g{constructor(t,{isRenderable:e=!1,ignoreBorder:s=!1,createQuadrilaterals:i=!1}={}){x(this,ic);x(this,Sr,null);x(this,qo,!1);x(this,Ko,null);this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(s)),i&&this._createQuadrilaterals()}static _hasPopupData({titleObj:t,contentsObj:e,richText:s}){return!!(t!=null&&t.str||e!=null&&e.str||s!=null&&s.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return $g._hasPopupData(this.data)}updateEdited(t){var s;if(!this.container)return;d(this,Sr)||_(this,Sr,{rect:this.data.rect.slice(0)});const{rect:e}=t;e&&v(this,ic,Qu).call(this,e),(s=d(this,Ko))==null||s.popup.updateEdited(t)}resetEdited(){var t;d(this,Sr)&&(v(this,ic,Qu).call(this,d(this,Sr).rect),(t=d(this,Ko))==null||t.popup.resetEdited(),_(this,Sr,null))}_createContainer(t){const{data:e,parent:{page:s,viewport:i}}=this,r=document.createElement("section");r.setAttribute("data-annotation-id",e.id),this instanceof oo||(r.tabIndex=Bc);const{style:o}=r;if(o.zIndex=this.parent.zIndex++,e.popupRef&&r.setAttribute("aria-haspopup","dialog"),e.alternativeText&&(r.title=e.alternativeText),e.noRotate&&r.classList.add("norotate"),!e.rect||this instanceof tf){const{rotation:m}=e;return!e.hasOwnCanvas&&m!==0&&this.setRotation(m,r),r}const{width:a,height:l}=Ri(e.rect);if(!t&&e.borderStyle.width>0){o.borderWidth=`${e.borderStyle.width}px`;const m=e.borderStyle.horizontalCornerRadius,b=e.borderStyle.verticalCornerRadius;if(m>0||b>0){const A=`calc(${m}px * var(--scale-factor)) / calc(${b}px * var(--scale-factor))`;o.borderRadius=A}else if(this instanceof qb){const A=`calc(${a}px * var(--scale-factor)) / calc(${l}px * var(--scale-factor))`;o.borderRadius=A}switch(e.borderStyle.style){case Ea.SOLID:o.borderStyle="solid";break;case Ea.DASHED:o.borderStyle="dashed";break;case Ea.BEVELED:et("Unimplemented border style: beveled");break;case Ea.INSET:et("Unimplemented border style: inset");break;case Ea.UNDERLINE:o.borderBottomStyle="solid";break}const y=e.borderColor||null;y?(_(this,qo,!0),o.borderColor=V.makeHexColor(y[0]|0,y[1]|0,y[2]|0)):o.borderWidth=0}const c=V.normalizeRect([e.rect[0],s.view[3]-e.rect[1]+s.view[1],e.rect[2],s.view[3]-e.rect[3]+s.view[1]]),{pageWidth:h,pageHeight:u,pageX:f,pageY:g}=i.rawDims;o.left=`${100*(c[0]-f)/h}%`,o.top=`${100*(c[1]-g)/u}%`;const{rotation:p}=e;return e.hasOwnCanvas||p===0?(o.width=`${100*a/h}%`,o.height=`${100*l/u}%`):this.setRotation(p,r),r}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:i}=this.parent.viewport.rawDims,{width:r,height:o}=Ri(this.data.rect);let a,l;t%180===0?(a=100*r/s,l=100*o/i):(a=100*o/s,l=100*r/i),e.style.width=`${a}%`,e.style.height=`${l}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,s,i)=>{const r=i.detail[e],o=r[0],a=r.slice(1);i.target.style[s]=ap[`${o}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[s]:ap[`${o}_rgb`](a)})};return at(this,"_commonActions",{display:e=>{const{display:s}=e.detail,i=s%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:s===1||s===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:s}=e.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const s=e.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(t,e){const s=this._commonActions;for(const i of Object.keys(e.detail)){const r=t[i]||s[i];r==null||r(e)}}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const s=this._commonActions;for(const[i,r]of Object.entries(e)){const o=s[i];if(o){const a={detail:{[i]:r},target:t};o(a),delete e[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,s,i,r]=this.data.rect.map(m=>Math.fround(m));if(t.length===8){const[m,b,y,A]=t.subarray(2,6);if(i===m&&r===b&&e===y&&s===A)return}const{style:o}=this.container;let a;if(d(this,qo)){const{borderColor:m,borderWidth:b}=o;o.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${m}" stroke-width="${b}">`],this.container.classList.add("hasBorder")}const l=i-e,c=r-s,{svgFactory:h}=this,u=h.createElement("svg");u.classList.add("quadrilateralsContainer"),u.setAttribute("width",0),u.setAttribute("height",0);const f=h.createElement("defs");u.append(f);const g=h.createElement("clipPath"),p=`clippath_${this.data.id}`;g.setAttribute("id",p),g.setAttribute("clipPathUnits","objectBoundingBox"),f.append(g);for(let m=2,b=t.length;m<b;m+=8){const y=t[m],A=t[m+1],w=t[m+2],S=t[m+3],E=h.createElement("rect"),C=(w-e)/l,k=(r-A)/c,M=(y-w)/l,R=(A-S)/c;E.setAttribute("x",C),E.setAttribute("y",k),E.setAttribute("width",M),E.setAttribute("height",R),g.append(E),a==null||a.push(`<rect vector-effect="non-scaling-stroke" x="${C}" y="${k}" width="${M}" height="${R}"/>`)}d(this,qo)&&(a.push("</g></svg>')"),o.backgroundImage=a.join("")),this.container.append(u),this.container.style.clipPath=`url(#${p})`}_createPopup(){const{container:t,data:e}=this;t.setAttribute("aria-haspopup","dialog");const s=_(this,Ko,new tf({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(s.render())}render(){$t("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const s=[];if(this._fieldObjects){const i=this._fieldObjects[t];if(i)for(const{page:r,id:o,exportValues:a}of i){if(r===-1||o===e)continue;const l=typeof a=="string"?a:null,c=document.querySelector(`[data-element-id="${o}"]`);if(c&&!Jr.has(c)){et(`_getElementsByName - element not allowed: ${o}`);continue}s.push({id:o,exportValue:l,domElement:c})}return s}for(const i of document.getElementsByName(t)){const{exportValue:r}=i,o=i.getAttribute("data-element-id");o!==e&&Jr.has(i)&&s.push({id:o,exportValue:r,domElement:i})}return s}show(){var t;this.container&&(this.container.hidden=!1),(t=this.popup)==null||t.maybeShow()}hide(){var t;this.container&&(this.container.hidden=!0),(t=this.popup)==null||t.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{var s;(s=this.linkService.eventBus)==null||s.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e})})}};Sr=new WeakMap,qo=new WeakMap,Ko=new WeakMap,ic=new WeakSet,Qu=function(t){const{container:{style:e},data:{rect:s,rotation:i},parent:{viewport:{rawDims:{pageWidth:r,pageHeight:o,pageX:a,pageY:l}}}}=this;s==null||s.splice(0,4,...t);const{width:c,height:h}=Ri(t);e.left=`${100*(t[0]-a)/r}%`,e.top=`${100*(o-t[3]+l)/o}%`,i===0?(e.width=`${100*c/r}%`,e.height=`${100*h/o}%`):this.setRotation(i)};let Ht=$g;var je,Hn,Xb,Yb;class Gb extends Ht{constructor(e,s=null){super(e,{isRenderable:!0,ignoreBorder:!!(s!=null&&s.ignoreBorder),createQuadrilaterals:!0});x(this,je);this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:s}=this,i=document.createElement("a");i.setAttribute("data-element-id",e.id);let r=!1;return e.url?(s.addLinkAttributes(i,e.url,e.newWindow),r=!0):e.action?(this._bindNamedAction(i,e.action),r=!0):e.attachment?(v(this,je,Xb).call(this,i,e.attachment,e.attachmentDest),r=!0):e.setOCGState?(v(this,je,Yb).call(this,i,e.setOCGState),r=!0):e.dest?(this._bindLink(i,e.dest),r=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,e),r=!0),e.resetForm?(this._bindResetFormAction(i,e.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(i,""),r=!0)),this.container.classList.add("linkAnnotation"),r&&this.container.append(i),this.container}_bindLink(e,s){e.href=this.linkService.getDestinationHash(s),e.onclick=()=>(s&&this.linkService.goToDestination(s),!1),(s||s==="")&&v(this,je,Hn).call(this)}_bindNamedAction(e,s){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(s),!1),v(this,je,Hn).call(this)}_bindJSAction(e,s){e.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const r of Object.keys(s.actions)){const o=i.get(r);o&&(e[o]=()=>{var a;return(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:s.id,name:r}}),!1})}e.onclick||(e.onclick=()=>!1),v(this,je,Hn).call(this)}_bindResetFormAction(e,s){const i=e.onclick;if(i||(e.href=this.linkService.getAnchorUrl("")),v(this,je,Hn).call(this),!this._fieldObjects){et('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(e.onclick=()=>!1);return}e.onclick=()=>{var u;i==null||i();const{fields:r,refs:o,include:a}=s,l=[];if(r.length!==0||o.length!==0){const f=new Set(o);for(const g of r){const p=this._fieldObjects[g]||[];for(const{id:m}of p)f.add(m)}for(const g of Object.values(this._fieldObjects))for(const p of g)f.has(p.id)===a&&l.push(p)}else for(const f of Object.values(this._fieldObjects))l.push(...f);const c=this.annotationStorage,h=[];for(const f of l){const{id:g}=f;switch(h.push(g),f.type){case"text":{const m=f.defaultValue||"";c.setValue(g,{value:m});break}case"checkbox":case"radiobutton":{const m=f.defaultValue===f.exportValues;c.setValue(g,{value:m});break}case"combobox":case"listbox":{const m=f.defaultValue||"";c.setValue(g,{value:m});break}default:continue}const p=document.querySelector(`[data-element-id="${g}"]`);if(p){if(!Jr.has(p)){et(`_bindResetFormAction - element not allowed: ${g}`);continue}}else continue;p.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((u=this.linkService.eventBus)==null||u.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:h,name:"ResetForm"}})),!1}}}je=new WeakSet,Hn=function(){this.container.setAttribute("data-internal-link","")},Xb=function(e,s,i=null){e.href=this.linkService.getAnchorUrl(""),s.description&&(e.title=s.description),e.onclick=()=>{var r;return(r=this.downloadManager)==null||r.openOrDownloadData(s.content,s.filename,i),!1},v(this,je,Hn).call(this)},Yb=function(e,s){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(s),!1),v(this,je,Hn).call(this)};class zv extends Ht{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}class oo extends Ht{render(){return this.container}showElementAndHideCanvas(t){var e;this.data.hasOwnCanvas&&(((e=t.previousSibling)==null?void 0:e.nodeName)==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return Te.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,s,i,r){s.includes("mouse")?t.addEventListener(s,o=>{var a;(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):t.addEventListener(s,o=>{var a;if(s==="blur"){if(!e.focused||!o.relatedTarget)return;e.focused=!1}else if(s==="focus"){if(e.focused)return;e.focused=!0}r&&((a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(o)}}))})}_setEventListeners(t,e,s,i){var r,o,a;for(const[l,c]of s)(c==="Action"||(r=this.data.actions)!=null&&r[c])&&((c==="Focus"||c==="Blur")&&(e||(e={focused:!1})),this._setEventListener(t,e,l,c,i),c==="Focus"&&!((o=this.data.actions)!=null&&o.Blur)?this._setEventListener(t,e,"blur","Blur",null):c==="Blur"&&!((a=this.data.actions)!=null&&a.Focus)&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":V.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||Hv,r=t.style;let o;const a=2,l=c=>Math.round(10*c)/10;if(this.data.multiLine){const c=Math.abs(this.data.rect[3]-this.data.rect[1]-a),h=Math.round(c/(Vd*i))||1,u=c/h;o=Math.min(i,l(u/Vd))}else{const c=Math.abs(this.data.rect[3]-this.data.rect[1]-a);o=Math.min(i,l(c/Vd))}r.fontSize=`calc(${o}px * var(--scale-factor))`,r.color=V.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(r.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class $v extends oo{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,s,i){const r=this.annotationStorage;for(const o of this._getElementsByName(t.name,t.id))o.domElement&&(o.domElement[e]=s),r.setValue(o.id,{[i]:s})}render(){var i,r;const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const o=t.getValue(e,{value:this.data.fieldValue});let a=o.value||"";const l=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;l&&a.length>l&&(a=a.slice(0,l));let c=o.formattedValue||((i=this.data.textContent)==null?void 0:i.join(`
`))||null;c&&this.data.comb&&(c=c.replaceAll(/\s+/g,""));const h={userValue:a,formattedValue:c,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=c??a,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type="text",s.setAttribute("value",c??a),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),Jr.add(s),s.setAttribute("data-element-id",e),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=Bc,this._setRequired(s,this.data.required),l&&(s.maxLength=l),s.addEventListener("input",f=>{t.setValue(e,{value:f.target.value}),this.setPropertyOnSiblings(s,"value",f.target.value,"value"),h.formattedValue=null}),s.addEventListener("resetform",f=>{const g=this.data.defaultFieldValue??"";s.value=h.userValue=g,h.formattedValue=null});let u=f=>{const{formattedValue:g}=h;g!=null&&(f.target.value=g),f.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",g=>{var m;if(h.focused)return;const{target:p}=g;h.userValue&&(p.value=h.userValue),h.lastCommittedValue=p.value,h.commitKey=1,(m=this.data.actions)!=null&&m.Focus||(h.focused=!0)}),s.addEventListener("updatefromsandbox",g=>{this.showElementAndHideCanvas(g.target);const p={value(m){h.userValue=m.detail.value??"",t.setValue(e,{value:h.userValue.toString()}),m.target.value=h.userValue},formattedValue(m){const{formattedValue:b}=m.detail;h.formattedValue=b,b!=null&&m.target!==document.activeElement&&(m.target.value=b),t.setValue(e,{formattedValue:b})},selRange(m){m.target.setSelectionRange(...m.detail.selRange)},charLimit:m=>{var w;const{charLimit:b}=m.detail,{target:y}=m;if(b===0){y.removeAttribute("maxLength");return}y.setAttribute("maxLength",b);let A=h.userValue;!A||A.length<=b||(A=A.slice(0,b),y.value=h.userValue=A,t.setValue(e,{value:A}),(w=this.linkService.eventBus)==null||w.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:A,willCommit:!0,commitKey:1,selStart:y.selectionStart,selEnd:y.selectionEnd}}))}};this._dispatchEventFromSandbox(p,g)}),s.addEventListener("keydown",g=>{var b;h.commitKey=1;let p=-1;if(g.key==="Escape"?p=0:g.key==="Enter"&&!this.data.multiLine?p=2:g.key==="Tab"&&(h.commitKey=3),p===-1)return;const{value:m}=g.target;h.lastCommittedValue!==m&&(h.lastCommittedValue=m,h.userValue=m,(b=this.linkService.eventBus)==null||b.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:m,willCommit:!0,commitKey:p,selStart:g.target.selectionStart,selEnd:g.target.selectionEnd}}))});const f=u;u=null,s.addEventListener("blur",g=>{var m,b;if(!h.focused||!g.relatedTarget)return;(m=this.data.actions)!=null&&m.Blur||(h.focused=!1);const{value:p}=g.target;h.userValue=p,h.lastCommittedValue!==p&&((b=this.linkService.eventBus)==null||b.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:p,willCommit:!0,commitKey:h.commitKey,selStart:g.target.selectionStart,selEnd:g.target.selectionEnd}})),f(g)}),(r=this.data.actions)!=null&&r.Keystroke&&s.addEventListener("beforeinput",g=>{var E;h.lastCommittedValue=null;const{data:p,target:m}=g,{value:b,selectionStart:y,selectionEnd:A}=m;let w=y,S=A;switch(g.inputType){case"deleteWordBackward":{const C=b.substring(0,y).match(/\w*[^\w]*$/);C&&(w-=C[0].length);break}case"deleteWordForward":{const C=b.substring(y).match(/^[^\w]*\w*/);C&&(S+=C[0].length);break}case"deleteContentBackward":y===A&&(w-=1);break;case"deleteContentForward":y===A&&(S+=1);break}g.preventDefault(),(E=this.linkService.eventBus)==null||E.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:b,change:p||"",willCommit:!1,selStart:w,selEnd:S}})}),this._setEventListeners(s,h,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],g=>g.target.value)}if(u&&s.addEventListener("blur",u),this.data.comb){const g=(this.data.rect[2]-this.data.rect[0])/l;s.classList.add("comb"),s.style.letterSpacing=`calc(${g}px * var(--scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class Wv extends oo{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class jv extends oo{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,s=e.id;let i=t.getValue(s,{value:e.exportValue===e.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",t.setValue(s,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const r=document.createElement("input");return Jr.add(r),r.setAttribute("data-element-id",s),r.disabled=e.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=e.fieldName,i&&r.setAttribute("checked",!0),r.setAttribute("exportValue",e.exportValue),r.tabIndex=Bc,r.addEventListener("change",o=>{const{name:a,checked:l}=o.target;for(const c of this._getElementsByName(a,s)){const h=l&&c.exportValue===e.exportValue;c.domElement&&(c.domElement.checked=h),t.setValue(c.id,{value:h})}t.setValue(s,{value:l})}),r.addEventListener("resetform",o=>{const a=e.defaultFieldValue||"Off";o.target.checked=a===e.exportValue}),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",o=>{const a={value(l){l.target.checked=l.detail.value!=="Off",t.setValue(s,{value:l.target.checked})}};this._dispatchEventFromSandbox(a,o)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class qb extends oo{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,s=e.id;let i=t.getValue(s,{value:e.fieldValue===e.buttonValue}).value;if(typeof i=="string"&&(i=i!==e.buttonValue,t.setValue(s,{value:i})),i)for(const o of this._getElementsByName(e.fieldName,s))t.setValue(o.id,{value:!1});const r=document.createElement("input");if(Jr.add(r),r.setAttribute("data-element-id",s),r.disabled=e.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=e.fieldName,i&&r.setAttribute("checked",!0),r.tabIndex=Bc,r.addEventListener("change",o=>{const{name:a,checked:l}=o.target;for(const c of this._getElementsByName(a,s))t.setValue(c.id,{value:!1});t.setValue(s,{value:l})}),r.addEventListener("resetform",o=>{const a=e.defaultFieldValue;o.target.checked=a!=null&&a===e.buttonValue}),this.enableScripting&&this.hasJSActions){const o=e.buttonValue;r.addEventListener("updatefromsandbox",a=>{const l={value:c=>{const h=o===c.detail.value;for(const u of this._getElementsByName(c.target.name)){const f=h&&u.id===s;u.domElement&&(u.domElement.checked=f),t.setValue(u.id,{value:f})}}};this._dispatchEventFromSandbox(l,a)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class Vv extends Gb{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),t}}class Uv extends oo{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,s=t.getValue(e,{value:this.data.fieldValue}),i=document.createElement("select");Jr.add(i),i.setAttribute("data-element-id",e),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=Bc;let r=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",h=>{const u=this.data.defaultFieldValue;for(const f of i.options)f.selected=f.value===u});for(const h of this.data.options){const u=document.createElement("option");u.textContent=h.displayValue,u.value=h.exportValue,s.value.includes(h.exportValue)&&(u.setAttribute("selected",!0),r=!1),i.append(u)}let o=null;if(r){const h=document.createElement("option");h.value=" ",h.setAttribute("hidden",!0),h.setAttribute("selected",!0),i.prepend(h),o=()=>{h.remove(),i.removeEventListener("input",o),o=null},i.addEventListener("input",o)}const a=h=>{const u=h?"value":"textContent",{options:f,multiple:g}=i;return g?Array.prototype.filter.call(f,p=>p.selected).map(p=>p[u]):f.selectedIndex===-1?null:f[f.selectedIndex][u]};let l=a(!1);const c=h=>{const u=h.target.options;return Array.prototype.map.call(u,f=>({displayValue:f.textContent,exportValue:f.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",h=>{const u={value(f){o==null||o();const g=f.detail.value,p=new Set(Array.isArray(g)?g:[g]);for(const m of i.options)m.selected=p.has(m.value);t.setValue(e,{value:a(!0)}),l=a(!1)},multipleSelection(f){i.multiple=!0},remove(f){const g=i.options,p=f.detail.remove;g[p].selected=!1,i.remove(p),g.length>0&&Array.prototype.findIndex.call(g,b=>b.selected)===-1&&(g[0].selected=!0),t.setValue(e,{value:a(!0),items:c(f)}),l=a(!1)},clear(f){for(;i.length!==0;)i.remove(0);t.setValue(e,{value:null,items:[]}),l=a(!1)},insert(f){const{index:g,displayValue:p,exportValue:m}=f.detail.insert,b=i.children[g],y=document.createElement("option");y.textContent=p,y.value=m,b?b.before(y):i.append(y),t.setValue(e,{value:a(!0),items:c(f)}),l=a(!1)},items(f){const{items:g}=f.detail;for(;i.length!==0;)i.remove(0);for(const p of g){const{displayValue:m,exportValue:b}=p,y=document.createElement("option");y.textContent=m,y.value=b,i.append(y)}i.options.length>0&&(i.options[0].selected=!0),t.setValue(e,{value:a(!0),items:c(f)}),l=a(!1)},indices(f){const g=new Set(f.detail.indices);for(const p of f.target.options)p.selected=g.has(p.index);t.setValue(e,{value:a(!0)}),l=a(!1)},editable(f){f.target.disabled=!f.detail.editable}};this._dispatchEventFromSandbox(u,h)}),i.addEventListener("input",h=>{var g;const u=a(!0),f=a(!1);t.setValue(e,{value:u}),h.preventDefault(),(g=this.linkService.eventBus)==null||g.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:l,change:f,changeEx:u,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],h=>h.target.value)):i.addEventListener("input",function(h){t.setValue(e,{value:a(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class tf extends Ht{constructor(t){const{data:e,elements:s}=t;super(t,{isRenderable:Ht._hasPopupData(e)}),this.elements=s,this.popup=null}render(){this.container.classList.add("popupAnnotation");const t=this.popup=new Gv({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),e=[];for(const s of this.elements)s.popup=t,e.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",e.map(s=>`${Xm}${s}`).join(",")),this.container}}var Zo,xd,wd,Jo,Er,Rt,pi,Qo,nc,rc,ta,mi,cs,bi,oc,yi,ac,Cr,kr,_t,wh,ef,Kb,Zb,Jb,Qb,Sh,Eh,sf;class Gv{constructor({container:t,color:e,elements:s,titleObj:i,modificationDate:r,contentsObj:o,richText:a,parent:l,rect:c,parentRect:h,open:u}){x(this,_t);x(this,Zo,v(this,_t,Jb).bind(this));x(this,xd,v(this,_t,sf).bind(this));x(this,wd,v(this,_t,Eh).bind(this));x(this,Jo,v(this,_t,Sh).bind(this));x(this,Er,null);x(this,Rt,null);x(this,pi,null);x(this,Qo,null);x(this,nc,null);x(this,rc,null);x(this,ta,null);x(this,mi,!1);x(this,cs,null);x(this,bi,null);x(this,oc,null);x(this,yi,null);x(this,ac,null);x(this,Cr,null);x(this,kr,!1);var f;_(this,Rt,t),_(this,ac,i),_(this,pi,o),_(this,yi,a),_(this,rc,l),_(this,Er,e),_(this,oc,c),_(this,ta,h),_(this,nc,s),_(this,Qo,eb.toDateObject(r)),this.trigger=s.flatMap(g=>g.getElementsToTriggerPopup());for(const g of this.trigger)g.addEventListener("click",d(this,Jo)),g.addEventListener("mouseenter",d(this,wd)),g.addEventListener("mouseleave",d(this,xd)),g.classList.add("popupTriggerArea");for(const g of s)(f=g.container)==null||f.addEventListener("keydown",d(this,Zo));d(this,Rt).hidden=!0,u&&v(this,_t,Sh).call(this)}render(){if(d(this,cs))return;const t=_(this,cs,document.createElement("div"));if(t.className="popup",d(this,Er)){const r=t.style.outlineColor=V.makeHexColor(...d(this,Er));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?t.style.backgroundColor=`color-mix(in srgb, ${r} 30%, white)`:t.style.backgroundColor=V.makeHexColor(...d(this,Er).map(a=>Math.floor(.7*(255-a)+a)))}const e=document.createElement("span");e.className="header";const s=document.createElement("h1");if(e.append(s),{dir:s.dir,str:s.textContent}=d(this,ac),t.append(e),d(this,Qo)){const r=document.createElement("span");r.classList.add("popupDate"),r.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),r.setAttribute("data-l10n-args",JSON.stringify({dateObj:d(this,Qo).valueOf()})),e.append(r)}const i=d(this,_t,wh);if(i)Ub.render({xfaHtml:i,intent:"richText",div:t}),t.lastChild.classList.add("richText","popupContent");else{const r=this._formatContents(d(this,pi));t.append(r)}d(this,Rt).append(t)}_formatContents({str:t,dir:e}){const s=document.createElement("p");s.classList.add("popupContent"),s.dir=e;const i=t.split(/(?:\r\n?|\n)/);for(let r=0,o=i.length;r<o;++r){const a=i[r];s.append(document.createTextNode(a)),r<o-1&&s.append(document.createElement("br"))}return s}updateEdited({rect:t,popupContent:e}){var s;d(this,Cr)||_(this,Cr,{contentsObj:d(this,pi),richText:d(this,yi)}),t&&_(this,bi,null),e&&(_(this,yi,v(this,_t,Zb).call(this,e)),_(this,pi,null)),(s=d(this,cs))==null||s.remove(),_(this,cs,null)}resetEdited(){var t;d(this,Cr)&&({contentsObj:xe(this,pi)._,richText:xe(this,yi)._}=d(this,Cr),_(this,Cr,null),(t=d(this,cs))==null||t.remove(),_(this,cs,null),_(this,bi,null))}forceHide(){_(this,kr,this.isVisible),d(this,kr)&&(d(this,Rt).hidden=!0)}maybeShow(){d(this,kr)&&(d(this,cs)||v(this,_t,Eh).call(this),_(this,kr,!1),d(this,Rt).hidden=!1)}get isVisible(){return d(this,Rt).hidden===!1}}Zo=new WeakMap,xd=new WeakMap,wd=new WeakMap,Jo=new WeakMap,Er=new WeakMap,Rt=new WeakMap,pi=new WeakMap,Qo=new WeakMap,nc=new WeakMap,rc=new WeakMap,ta=new WeakMap,mi=new WeakMap,cs=new WeakMap,bi=new WeakMap,oc=new WeakMap,yi=new WeakMap,ac=new WeakMap,Cr=new WeakMap,kr=new WeakMap,_t=new WeakSet,wh=function(){const t=d(this,yi),e=d(this,pi);return t!=null&&t.str&&(!(e!=null&&e.str)||e.str===t.str)&&d(this,yi).html||null},ef=function(){var t,e,s;return((s=(e=(t=d(this,_t,wh))==null?void 0:t.attributes)==null?void 0:e.style)==null?void 0:s.fontSize)||0},Kb=function(){var t,e,s;return((s=(e=(t=d(this,_t,wh))==null?void 0:t.attributes)==null?void 0:e.style)==null?void 0:s.color)||null},Zb=function(t){const e=[],s={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},i={style:{color:d(this,_t,Kb),fontSize:d(this,_t,ef)?`calc(${d(this,_t,ef)}px * var(--scale-factor))`:""}};for(const r of t.split(`
`))e.push({name:"span",value:r,attributes:i});return s},Jb=function(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&d(this,mi))&&v(this,_t,Sh).call(this)},Qb=function(){if(d(this,bi)!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:s,pageX:i,pageY:r}}}=d(this,rc);let o=!!d(this,ta),a=o?d(this,ta):d(this,oc);for(const p of d(this,nc))if(!a||V.intersect(p.data.rect,a)!==null){a=p.data.rect,o=!0;break}const l=V.normalizeRect([a[0],t[3]-a[1]+t[1],a[2],t[3]-a[3]+t[1]]),h=o?a[2]-a[0]+5:0,u=l[0]+h,f=l[1];_(this,bi,[100*(u-i)/e,100*(f-r)/s]);const{style:g}=d(this,Rt);g.left=`${d(this,bi)[0]}%`,g.top=`${d(this,bi)[1]}%`},Sh=function(){_(this,mi,!d(this,mi)),d(this,mi)?(v(this,_t,Eh).call(this),d(this,Rt).addEventListener("click",d(this,Jo)),d(this,Rt).addEventListener("keydown",d(this,Zo))):(v(this,_t,sf).call(this),d(this,Rt).removeEventListener("click",d(this,Jo)),d(this,Rt).removeEventListener("keydown",d(this,Zo)))},Eh=function(){d(this,cs)||this.render(),this.isVisible?d(this,mi)&&d(this,Rt).classList.add("focused"):(v(this,_t,Qb).call(this),d(this,Rt).hidden=!1,d(this,Rt).style.zIndex=parseInt(d(this,Rt).style.zIndex)+1e3)},sf=function(){d(this,Rt).classList.remove("focused"),!(d(this,mi)||!this.isVisible)&&(d(this,Rt).hidden=!0,d(this,Rt).style.zIndex=parseInt(d(this,Rt).style.zIndex)-1e3)};class t0 extends Ht{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=ot.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const s=document.createElement("span");s.textContent=e,t.append(s)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var lc;class Xv extends Ht{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});x(this,lc,null)}render(){this.container.classList.add("lineAnnotation");const e=this.data,{width:s,height:i}=Ri(e.rect),r=this.svgFactory.create(s,i,!0),o=_(this,lc,this.svgFactory.createElement("svg:line"));return o.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),o.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),o.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),o.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),o.setAttribute("stroke-width",e.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return d(this,lc)}addHighlightArea(){this.container.classList.add("highlightArea")}}lc=new WeakMap;var cc;class Yv extends Ht{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});x(this,cc,null)}render(){this.container.classList.add("squareAnnotation");const e=this.data,{width:s,height:i}=Ri(e.rect),r=this.svgFactory.create(s,i,!0),o=e.borderStyle.width,a=_(this,cc,this.svgFactory.createElement("svg:rect"));return a.setAttribute("x",o/2),a.setAttribute("y",o/2),a.setAttribute("width",s-o),a.setAttribute("height",i-o),a.setAttribute("stroke-width",o||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),r.append(a),this.container.append(r),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return d(this,cc)}addHighlightArea(){this.container.classList.add("highlightArea")}}cc=new WeakMap;var hc;class qv extends Ht{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});x(this,hc,null)}render(){this.container.classList.add("circleAnnotation");const e=this.data,{width:s,height:i}=Ri(e.rect),r=this.svgFactory.create(s,i,!0),o=e.borderStyle.width,a=_(this,hc,this.svgFactory.createElement("svg:ellipse"));return a.setAttribute("cx",s/2),a.setAttribute("cy",i/2),a.setAttribute("rx",s/2-o/2),a.setAttribute("ry",i/2-o/2),a.setAttribute("stroke-width",o||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),r.append(a),this.container.append(r),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return d(this,hc)}addHighlightArea(){this.container.classList.add("highlightArea")}}hc=new WeakMap;var dc;class e0 extends Ht{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});x(this,dc,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,vertices:s,borderStyle:i,popupRef:r}}=this;if(!s)return this.container;const{width:o,height:a}=Ri(e),l=this.svgFactory.create(o,a,!0);let c=[];for(let u=0,f=s.length;u<f;u+=2){const g=s[u]-e[0],p=e[3]-s[u+1];c.push(`${g},${p}`)}c=c.join(" ");const h=_(this,dc,this.svgFactory.createElement(this.svgElementName));return h.setAttribute("points",c),h.setAttribute("stroke-width",i.width||1),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),l.append(h),this.container.append(l),!r&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return d(this,dc)}addHighlightArea(){this.container.classList.add("highlightArea")}}dc=new WeakMap;class Kv extends e0{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Zv extends Ht{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var uc;class s0 extends Ht{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});x(this,uc,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=ot.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,inkLists:s,borderStyle:i,popupRef:r}}=this,{width:o,height:a}=Ri(e),l=this.svgFactory.create(o,a,!0);for(const c of s){let h=[];for(let f=0,g=c.length;f<g;f+=2){const p=c[f]-e[0],m=e[3]-c[f+1];h.push(`${p},${m}`)}h=h.join(" ");const u=this.svgFactory.createElement(this.svgElementName);d(this,uc).push(u),u.setAttribute("points",h),u.setAttribute("stroke-width",i.width||1),u.setAttribute("stroke","transparent"),u.setAttribute("fill","transparent"),!r&&this.hasPopupData&&this._createPopup(),l.append(u)}return this.container.append(l),this.container}getElementsToTriggerPopup(){return d(this,uc)}addHighlightArea(){this.container.classList.add("highlightArea")}}uc=new WeakMap;class Jv extends Ht{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class Qv extends Ht{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class tA extends Ht{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class eA extends Ht{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class i0 extends Ht{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var fc,gc,nf;class sA extends Ht{constructor(e){var i;super(e,{isRenderable:!0});x(this,gc);x(this,fc,null);const{file:s}=this.data;this.filename=s.filename,this.content=s.content,(i=this.linkService.eventBus)==null||i.dispatch("fileattachmentannotation",{source:this,...s})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:s}=this;let i;s.hasAppearance||s.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(s.name)?"paperclip":"pushpin"}.svg`,s.fillAlpha&&s.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(s.fillAlpha*100)}%);`)),i.addEventListener("dblclick",v(this,gc,nf).bind(this)),_(this,fc,i);const{isMac:r}=Te.platform;return e.addEventListener("keydown",o=>{o.key==="Enter"&&(r?o.metaKey:o.ctrlKey)&&v(this,gc,nf).call(this)}),!s.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),e.append(i),e}getElementsToTriggerPopup(){return d(this,fc)}addHighlightArea(){this.container.classList.add("highlightArea")}}fc=new WeakMap,gc=new WeakSet,nf=function(){var e;(e=this.downloadManager)==null||e.openOrDownloadData(this.content,this.filename)};var pc,Mr,Tr,so,n0,rf;class iA{constructor({div:t,accessibilityManager:e,annotationCanvasMap:s,annotationEditorUIManager:i,page:r,viewport:o}){x(this,so);x(this,pc,null);x(this,Mr,null);x(this,Tr,new Map);this.div=t,_(this,pc,e),_(this,Mr,s),this.page=r,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=i}hasEditableAnnotations(){return d(this,Tr).size>0}async render(t){var o;const{annotations:e}=t,s=this.div;Kr(s,this.viewport);const i=new Map,r={data:null,layer:s,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new lg,annotationStorage:t.annotationStorage||new ug,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const a of e){if(a.noHTML)continue;const l=a.annotationType===Wt.POPUP;if(l){const u=i.get(a.id);if(!u)continue;r.elements=u}else{const{width:u,height:f}=Ri(a.rect);if(u<=0||f<=0)continue}r.data=a;const c=Bv.create(r);if(!c.isRenderable)continue;if(!l&&a.popupRef){const u=i.get(a.popupRef);u?u.push(c):i.set(a.popupRef,[c])}const h=c.render();a.hidden&&(h.style.visibility="hidden"),v(this,so,n0).call(this,h,a.id),c._isEditable&&(d(this,Tr).set(c.data.id,c),(o=this._annotationEditorUIManager)==null||o.renderAnnotationElement(c))}v(this,so,rf).call(this)}update({viewport:t}){const e=this.div;this.viewport=t,Kr(e,{rotation:t.rotation}),v(this,so,rf).call(this),e.hidden=!1}getEditableAnnotations(){return Array.from(d(this,Tr).values())}getEditableAnnotation(t){return d(this,Tr).get(t)}}pc=new WeakMap,Mr=new WeakMap,Tr=new WeakMap,so=new WeakSet,n0=function(t,e){var i;const s=t.firstChild||t;s.id=`${Xm}${e}`,this.div.append(t),(i=d(this,pc))==null||i.moveElementInDOM(this.div,t,s,!1)},rf=function(){if(!d(this,Mr))return;const t=this.div;for(const[e,s]of d(this,Mr)){const i=t.querySelector(`[data-annotation-id="${e}"]`);if(!i)continue;s.className="annotationContent";const{firstChild:r}=i;r?r.nodeName==="CANVAS"?r.replaceWith(s):r.classList.contains("annotationContent")?r.after(s):r.before(s):i.append(s)}d(this,Mr).clear()};const Yc=/\r\n?|\n/g;var hs,Oe,mc,Lr,Fe,ea,zt,r0,o0,a0,Ch,Oi,kh,Mh,l0,af,c0;const xt=class xt extends pt{constructor(e){super({...e,name:"freeTextEditor"});x(this,zt);x(this,hs);x(this,Oe,"");x(this,mc,`${this.id}-editor`);x(this,Lr,null);x(this,Fe);x(this,ea,null);_(this,hs,e.color||xt._defaultColor||pt._defaultLineColor),_(this,Fe,e.fontSize||xt._defaultFontSize)}static get _keyboardManager(){const e=xt.prototype,s=o=>o.isEmpty(),i=Zr.TRANSLATE_SMALL,r=Zr.TRANSLATE_BIG;return at(this,"_keyboardManager",new Hc([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-i,0],checker:s}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-r,0],checker:s}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[i,0],checker:s}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[r,0],checker:s}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-i],checker:s}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-r],checker:s}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,i],checker:s}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,r],checker:s}]]))}static initialize(e,s){pt.initialize(e,s,{strings:["pdfjs-free-text-default-content"]});const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,s){switch(e){case K.FREETEXT_SIZE:xt._defaultFontSize=s;break;case K.FREETEXT_COLOR:xt._defaultColor=s;break}}updateParams(e,s){switch(e){case K.FREETEXT_SIZE:v(this,zt,r0).call(this,s);break;case K.FREETEXT_COLOR:v(this,zt,o0).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[K.FREETEXT_SIZE,xt._defaultFontSize],[K.FREETEXT_COLOR,xt._defaultColor||pt._defaultLineColor]]}get propertiesToUpdate(){return[[K.FREETEXT_SIZE,d(this,Fe)],[K.FREETEXT_COLOR,d(this,hs)]]}_translateEmpty(e,s){this._uiManager.translateSelectedEditors(e,s,!0)}getInitialTranslation(){const e=this.parentScale;return[-xt._internalPadding*e,-(xt._internalPadding+d(this,Fe))*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(ot.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),_(this,Lr,new AbortController);const e=this._uiManager.combinedSignal(d(this,Lr));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e})}disableEditMode(){var e;this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",d(this,mc)),this._isDraggable=!0,(e=d(this,Lr))==null||e.abort(),_(this,Lr,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){var e;this.width||(this.enableEditMode(),this.editorDiv.focus(),(e=this._initialOptions)!=null&&e.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=d(this,Oe),s=_(this,Oe,v(this,zt,a0).call(this).trimEnd());if(e===s)return;const i=r=>{if(_(this,Oe,r),!r){this.remove();return}v(this,zt,Mh).call(this),this._uiManager.rebuild(this),v(this,zt,Ch).call(this)};this.addCommands({cmd:()=>{i(s)},undo:()=>{i(e)},mustExec:!1}),v(this,zt,Ch).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(e){this.enterInEditMode()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){xt._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let e,s;this.width&&(e=this.x,s=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",d(this,mc)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text"),this.enableEditing(),pt._l10nPromise.get("pdfjs-free-text-default-content").then(r=>{var o;return(o=this.editorDiv)==null?void 0:o.setAttribute("default-content",r)}),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${d(this,Fe)}px * var(--scale-factor))`,i.color=d(this,hs),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),Xh(this,this.div,["dblclick","keydown"]),this.width){const[r,o]=this.parentDimensions;if(this.annotationElementId){const{position:a}=d(this,ea);let[l,c]=this.getInitialTranslation();[l,c]=this.pageTranslationToScreen(l,c);const[h,u]=this.pageDimensions,[f,g]=this.pageTranslation;let p,m;switch(this.rotation){case 0:p=e+(a[0]-f)/h,m=s+this.height-(a[1]-g)/u;break;case 90:p=e+(a[0]-f)/h,m=s-(a[1]-g)/u,[l,c]=[c,-l];break;case 180:p=e-this.width+(a[0]-f)/h,m=s-(a[1]-g)/u,[l,c]=[-l,-c];break;case 270:p=e+(a[0]-f-this.height*u)/h,m=s+(a[1]-g-this.width*h)/u,[l,c]=[-c,l];break}this.setAt(p*r,m*o,l,c)}else this.setAt(e*r,s*o,this.width*r,this.height*o);v(this,zt,Mh).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(e){var p,m,b;const s=e.clipboardData||window.clipboardData,{types:i}=s;if(i.length===1&&i[0]==="text/plain")return;e.preventDefault();const r=v(p=xt,Oi,af).call(p,s.getData("text")||"").replaceAll(Yc,`
`);if(!r)return;const o=window.getSelection();if(!o.rangeCount)return;this.editorDiv.normalize(),o.deleteFromDocument();const a=o.getRangeAt(0);if(!r.includes(`
`)){a.insertNode(document.createTextNode(r)),this.editorDiv.normalize(),o.collapseToStart();return}const{startContainer:l,startOffset:c}=a,h=[],u=[];if(l.nodeType===Node.TEXT_NODE){const y=l.parentElement;if(u.push(l.nodeValue.slice(c).replaceAll(Yc,"")),y!==this.editorDiv){let A=h;for(const w of this.editorDiv.childNodes){if(w===y){A=u;continue}A.push(v(m=xt,Oi,kh).call(m,w))}}h.push(l.nodeValue.slice(0,c).replaceAll(Yc,""))}else if(l===this.editorDiv){let y=h,A=0;for(const w of this.editorDiv.childNodes)A++===c&&(y=u),y.push(v(b=xt,Oi,kh).call(b,w))}_(this,Oe,`${h.join(`
`)}${r}${u.join(`
`)}`),v(this,zt,Mh).call(this);const f=new Range;let g=h.reduce((y,A)=>y+A.length,0);for(const{firstChild:y}of this.editorDiv.childNodes)if(y.nodeType===Node.TEXT_NODE){const A=y.nodeValue.length;if(g<=A){f.setStart(y,g),f.setEnd(y,g);break}g-=A}o.removeAllRanges(),o.addRange(f)}get contentDiv(){return this.editorDiv}static deserialize(e,s,i){var a;let r=null;if(e instanceof t0){const{data:{defaultAppearanceData:{fontSize:l,fontColor:c},rect:h,rotation:u,id:f},textContent:g,textPosition:p,parent:{page:{pageNumber:m}}}=e;if(!g||g.length===0)return null;r=e={annotationType:ot.FREETEXT,color:Array.from(c),fontSize:l,value:g.join(`
`),position:p,pageIndex:m-1,rect:h.slice(0),rotation:u,id:f,deleted:!1}}const o=super.deserialize(e,s,i);return _(o,Fe,e.fontSize),_(o,hs,V.makeHexColor(...e.color)),_(o,Oe,v(a=xt,Oi,af).call(a,e.value)),o.annotationElementId=e.id||null,_(o,ea,r),o}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const s=xt._internalPadding*this.parentScale,i=this.getRect(s,s),r=pt._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:d(this,hs)),o={annotationType:ot.FREETEXT,color:r,fontSize:d(this,Fe),value:v(this,zt,l0).call(this),pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?o:this.annotationElementId&&!v(this,zt,c0).call(this,o)?null:(o.id=this.annotationElementId,o)}renderAnnotationElement(e){const s=super.renderAnnotationElement(e);if(this.deleted)return s;const{style:i}=s;i.fontSize=`calc(${d(this,Fe)}px * var(--scale-factor))`,i.color=d(this,hs),s.replaceChildren();for(const o of d(this,Oe).split(`
`)){const a=document.createElement("div");a.append(o?document.createTextNode(o):document.createElement("br")),s.append(a)}const r=xt._internalPadding*this.parentScale;return e.updateEdited({rect:this.getRect(r,r),popupContent:d(this,Oe)}),s}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}};hs=new WeakMap,Oe=new WeakMap,mc=new WeakMap,Lr=new WeakMap,Fe=new WeakMap,ea=new WeakMap,zt=new WeakSet,r0=function(e){const s=r=>{this.editorDiv.style.fontSize=`calc(${r}px * var(--scale-factor))`,this.translate(0,-(r-d(this,Fe))*this.parentScale),_(this,Fe,r),v(this,zt,Ch).call(this)},i=d(this,Fe);this.addCommands({cmd:s.bind(this,e),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:K.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},o0=function(e){const s=r=>{_(this,hs,this.editorDiv.style.color=r)},i=d(this,hs);this.addCommands({cmd:s.bind(this,e),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:K.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},a0=function(){var s;const e=[];this.editorDiv.normalize();for(const i of this.editorDiv.childNodes)e.push(v(s=xt,Oi,kh).call(s,i));return e.join(`
`)},Ch=function(){const[e,s]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:r,div:o}=this,a=o.style.display,l=o.classList.contains("hidden");o.classList.remove("hidden"),o.style.display="hidden",r.div.append(this.div),i=o.getBoundingClientRect(),o.remove(),o.style.display=a,o.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=i.width/e,this.height=i.height/s):(this.width=i.height/e,this.height=i.width/s),this.fixAndSetPosition()},Oi=new WeakSet,kh=function(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(Yc,"")},Mh=function(){if(this.editorDiv.replaceChildren(),!!d(this,Oe))for(const e of d(this,Oe).split(`
`)){const s=document.createElement("div");s.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(s)}},l0=function(){return d(this,Oe).replaceAll(" "," ")},af=function(e){return e.replaceAll(" "," ")},c0=function(e){const{value:s,fontSize:i,color:r,pageIndex:o}=d(this,ea);return this._hasBeenMoved||e.value!==s||e.fontSize!==i||e.color.some((a,l)=>a!==r[l])||e.pageIndex!==o},x(xt,Oi),T(xt,"_freeTextDefaultContent",""),T(xt,"_internalPadding",0),T(xt,"_defaultColor",null),T(xt,"_defaultFontSize",10),T(xt,"_type","freetext"),T(xt,"_editorType",ot.FREETEXT);let of=xt;var bc,on,ds,Ae,h0,Th,d0,u0,lf;class lp{constructor(t,e=0,s=0,i=!0){x(this,Ae);x(this,bc);x(this,on,[]);x(this,ds,[]);let r=1/0,o=-1/0,a=1/0,l=-1/0;const c=10**-4;for(const{x:b,y,width:A,height:w}of t){const S=Math.floor((b-e)/c)*c,E=Math.ceil((b+A+e)/c)*c,C=Math.floor((y-e)/c)*c,k=Math.ceil((y+w+e)/c)*c,M=[S,C,k,!0],R=[E,C,k,!1];d(this,on).push(M,R),r=Math.min(r,S),o=Math.max(o,E),a=Math.min(a,C),l=Math.max(l,k)}const h=o-r+2*s,u=l-a+2*s,f=r-s,g=a-s,p=d(this,on).at(i?-1:-2),m=[p[0],p[2]];for(const b of d(this,on)){const[y,A,w]=b;b[0]=(y-f)/h,b[1]=(A-g)/u,b[2]=(w-g)/u}_(this,bc,{x:f,y:g,width:h,height:u,lastPoint:m})}getOutlines(){d(this,on).sort((e,s)=>e[0]-s[0]||e[1]-s[1]||e[2]-s[2]);const t=[];for(const e of d(this,on))e[3]?(t.push(...v(this,Ae,lf).call(this,e)),v(this,Ae,d0).call(this,e)):(v(this,Ae,u0).call(this,e),t.push(...v(this,Ae,lf).call(this,e)));return v(this,Ae,h0).call(this,t)}}bc=new WeakMap,on=new WeakMap,ds=new WeakMap,Ae=new WeakSet,h0=function(t){const e=[],s=new Set;for(const o of t){const[a,l,c]=o;e.push([a,l,o],[a,c,o])}e.sort((o,a)=>o[1]-a[1]||o[0]-a[0]);for(let o=0,a=e.length;o<a;o+=2){const l=e[o][2],c=e[o+1][2];l.push(c),c.push(l),s.add(l),s.add(c)}const i=[];let r;for(;s.size>0;){const o=s.values().next().value;let[a,l,c,h,u]=o;s.delete(o);let f=a,g=l;for(r=[a,c],i.push(r);;){let p;if(s.has(h))p=h;else if(s.has(u))p=u;else break;s.delete(p),[a,l,c,h,u]=p,f!==a&&(r.push(f,g,a,g===l?l:c),f=a),g=g===l?c:l}r.push(f,g)}return new nA(i,d(this,bc))},Th=function(t){const e=d(this,ds);let s=0,i=e.length-1;for(;s<=i;){const r=s+i>>1,o=e[r][0];if(o===t)return r;o<t?s=r+1:i=r-1}return i+1},d0=function([,t,e]){const s=v(this,Ae,Th).call(this,t);d(this,ds).splice(s,0,[t,e])},u0=function([,t,e]){const s=v(this,Ae,Th).call(this,t);for(let i=s;i<d(this,ds).length;i++){const[r,o]=d(this,ds)[i];if(r!==t)break;if(r===t&&o===e){d(this,ds).splice(i,1);return}}for(let i=s-1;i>=0;i--){const[r,o]=d(this,ds)[i];if(r!==t)break;if(r===t&&o===e){d(this,ds).splice(i,1);return}}},lf=function(t){const[e,s,i]=t,r=[[e,s,i]],o=v(this,Ae,Th).call(this,i);for(let a=0;a<o;a++){const[l,c]=d(this,ds)[a];for(let h=0,u=r.length;h<u;h++){const[,f,g]=r[h];if(!(c<=f||g<=l)){if(f>=l){if(g>c)r[h][1]=c;else{if(u===1)return[];r.splice(h,1),h--,u--}continue}r[h][2]=l,g>c&&r.push([e,c,g])}}}return r};class f0{toSVGPath(){throw new Error("Abstract method `toSVGPath` must be implemented.")}get box(){throw new Error("Abstract getter `box` must be implemented.")}serialize(t,e){throw new Error("Abstract method `serialize` must be implemented.")}get free(){return this instanceof hf}}var yc,sa;class nA extends f0{constructor(e,s){super();x(this,yc);x(this,sa);_(this,sa,e),_(this,yc,s)}toSVGPath(){const e=[];for(const s of d(this,sa)){let[i,r]=s;e.push(`M${i} ${r}`);for(let o=2;o<s.length;o+=2){const a=s[o],l=s[o+1];a===i?(e.push(`V${l}`),r=l):l===r&&(e.push(`H${a}`),i=a)}e.push("Z")}return e.join(" ")}serialize([e,s,i,r],o){const a=[],l=i-e,c=r-s;for(const h of d(this,sa)){const u=new Array(h.length);for(let f=0;f<h.length;f+=2)u[f]=e+h[f]*l,u[f+1]=r-h[f+1]*c;a.push(u)}return a}get box(){return d(this,yc)}}yc=new WeakMap,sa=new WeakMap;var Fs,_i,ia,na,Ns,rt,Pr,Rr,_c,vc,ra,oa,an,Ac,Sd,Ed,xc,cf;const si=class si{constructor({x:t,y:e},s,i,r,o,a=0){x(this,xc);x(this,Fs);x(this,_i,[]);x(this,ia);x(this,na);x(this,Ns,[]);x(this,rt,new Float64Array(18));x(this,Pr);x(this,Rr);x(this,_c);x(this,vc);x(this,ra);x(this,oa);x(this,an,[]);_(this,Fs,s),_(this,oa,r*i),_(this,na,o),d(this,rt).set([NaN,NaN,NaN,NaN,t,e],6),_(this,ia,a),_(this,vc,d(si,Ac)*i),_(this,_c,d(si,Ed)*i),_(this,ra,i),d(this,an).push(t,e)}get free(){return!0}isEmpty(){return isNaN(d(this,rt)[8])}add({x:t,y:e}){var R;_(this,Pr,t),_(this,Rr,e);const[s,i,r,o]=d(this,Fs);let[a,l,c,h]=d(this,rt).subarray(8,12);const u=t-c,f=e-h,g=Math.hypot(u,f);if(g<d(this,_c))return!1;const p=g-d(this,vc),m=p/g,b=m*u,y=m*f;let A=a,w=l;a=c,l=h,c+=b,h+=y,(R=d(this,an))==null||R.push(t,e);const S=-y/p,E=b/p,C=S*d(this,oa),k=E*d(this,oa);return d(this,rt).set(d(this,rt).subarray(2,8),0),d(this,rt).set([c+C,h+k],4),d(this,rt).set(d(this,rt).subarray(14,18),12),d(this,rt).set([c-C,h-k],16),isNaN(d(this,rt)[6])?(d(this,Ns).length===0&&(d(this,rt).set([a+C,l+k],2),d(this,Ns).push(NaN,NaN,NaN,NaN,(a+C-s)/r,(l+k-i)/o),d(this,rt).set([a-C,l-k],14),d(this,_i).push(NaN,NaN,NaN,NaN,(a-C-s)/r,(l-k-i)/o)),d(this,rt).set([A,w,a,l,c,h],6),!this.isEmpty()):(d(this,rt).set([A,w,a,l,c,h],6),Math.abs(Math.atan2(w-l,A-a)-Math.atan2(y,b))<Math.PI/2?([a,l,c,h]=d(this,rt).subarray(2,6),d(this,Ns).push(NaN,NaN,NaN,NaN,((a+c)/2-s)/r,((l+h)/2-i)/o),[a,l,A,w]=d(this,rt).subarray(14,18),d(this,_i).push(NaN,NaN,NaN,NaN,((A+a)/2-s)/r,((w+l)/2-i)/o),!0):([A,w,a,l,c,h]=d(this,rt).subarray(0,6),d(this,Ns).push(((A+5*a)/6-s)/r,((w+5*l)/6-i)/o,((5*a+c)/6-s)/r,((5*l+h)/6-i)/o,((a+c)/2-s)/r,((l+h)/2-i)/o),[c,h,a,l,A,w]=d(this,rt).subarray(12,18),d(this,_i).push(((A+5*a)/6-s)/r,((w+5*l)/6-i)/o,((5*a+c)/6-s)/r,((5*l+h)/6-i)/o,((a+c)/2-s)/r,((l+h)/2-i)/o),!0))}toSVGPath(){if(this.isEmpty())return"";const t=d(this,Ns),e=d(this,_i),s=d(this,rt).subarray(4,6),i=d(this,rt).subarray(16,18),[r,o,a,l]=d(this,Fs),[c,h,u,f]=v(this,xc,cf).call(this);if(isNaN(d(this,rt)[6])&&!this.isEmpty())return`M${(d(this,rt)[2]-r)/a} ${(d(this,rt)[3]-o)/l} L${(d(this,rt)[4]-r)/a} ${(d(this,rt)[5]-o)/l} L${c} ${h} L${u} ${f} L${(d(this,rt)[16]-r)/a} ${(d(this,rt)[17]-o)/l} L${(d(this,rt)[14]-r)/a} ${(d(this,rt)[15]-o)/l} Z`;const g=[];g.push(`M${t[4]} ${t[5]}`);for(let p=6;p<t.length;p+=6)isNaN(t[p])?g.push(`L${t[p+4]} ${t[p+5]}`):g.push(`C${t[p]} ${t[p+1]} ${t[p+2]} ${t[p+3]} ${t[p+4]} ${t[p+5]}`);g.push(`L${(s[0]-r)/a} ${(s[1]-o)/l} L${c} ${h} L${u} ${f} L${(i[0]-r)/a} ${(i[1]-o)/l}`);for(let p=e.length-6;p>=6;p-=6)isNaN(e[p])?g.push(`L${e[p+4]} ${e[p+5]}`):g.push(`C${e[p]} ${e[p+1]} ${e[p+2]} ${e[p+3]} ${e[p+4]} ${e[p+5]}`);return g.push(`L${e[4]} ${e[5]} Z`),g.join(" ")}getOutlines(){var y;const t=d(this,Ns),e=d(this,_i),s=d(this,rt),i=s.subarray(4,6),r=s.subarray(16,18),[o,a,l,c]=d(this,Fs),h=new Float64Array((((y=d(this,an))==null?void 0:y.length)??0)+2);for(let A=0,w=h.length-2;A<w;A+=2)h[A]=(d(this,an)[A]-o)/l,h[A+1]=(d(this,an)[A+1]-a)/c;h[h.length-2]=(d(this,Pr)-o)/l,h[h.length-1]=(d(this,Rr)-a)/c;const[u,f,g,p]=v(this,xc,cf).call(this);if(isNaN(s[6])&&!this.isEmpty()){const A=new Float64Array(36);return A.set([NaN,NaN,NaN,NaN,(s[2]-o)/l,(s[3]-a)/c,NaN,NaN,NaN,NaN,(s[4]-o)/l,(s[5]-a)/c,NaN,NaN,NaN,NaN,u,f,NaN,NaN,NaN,NaN,g,p,NaN,NaN,NaN,NaN,(s[16]-o)/l,(s[17]-a)/c,NaN,NaN,NaN,NaN,(s[14]-o)/l,(s[15]-a)/c],0),new hf(A,h,d(this,Fs),d(this,ra),d(this,ia),d(this,na))}const m=new Float64Array(d(this,Ns).length+24+d(this,_i).length);let b=t.length;for(let A=0;A<b;A+=2){if(isNaN(t[A])){m[A]=m[A+1]=NaN;continue}m[A]=t[A],m[A+1]=t[A+1]}m.set([NaN,NaN,NaN,NaN,(i[0]-o)/l,(i[1]-a)/c,NaN,NaN,NaN,NaN,u,f,NaN,NaN,NaN,NaN,g,p,NaN,NaN,NaN,NaN,(r[0]-o)/l,(r[1]-a)/c],b),b+=24;for(let A=e.length-6;A>=6;A-=6)for(let w=0;w<6;w+=2){if(isNaN(e[A+w])){m[b]=m[b+1]=NaN,b+=2;continue}m[b]=e[A+w],m[b+1]=e[A+w+1],b+=2}return m.set([NaN,NaN,NaN,NaN,e[4],e[5]],b),new hf(m,h,d(this,Fs),d(this,ra),d(this,ia),d(this,na))}};Fs=new WeakMap,_i=new WeakMap,ia=new WeakMap,na=new WeakMap,Ns=new WeakMap,rt=new WeakMap,Pr=new WeakMap,Rr=new WeakMap,_c=new WeakMap,vc=new WeakMap,ra=new WeakMap,oa=new WeakMap,an=new WeakMap,Ac=new WeakMap,Sd=new WeakMap,Ed=new WeakMap,xc=new WeakSet,cf=function(){const t=d(this,rt).subarray(4,6),e=d(this,rt).subarray(16,18),[s,i,r,o]=d(this,Fs);return[(d(this,Pr)+(t[0]-e[0])/2-s)/r,(d(this,Rr)+(t[1]-e[1])/2-i)/o,(d(this,Pr)+(e[0]-t[0])/2-s)/r,(d(this,Rr)+(e[1]-t[1])/2-i)/o]},x(si,Ac,8),x(si,Sd,2),x(si,Ed,d(si,Ac)+d(si,Sd));let qh=si;var aa,Dr,vi,wc,Ne,Sc,It,Le,Wa,ja,g0;class hf extends f0{constructor(e,s,i,r,o,a){super();x(this,Le);x(this,aa);x(this,Dr,null);x(this,vi);x(this,wc);x(this,Ne);x(this,Sc);x(this,It);_(this,It,e),_(this,Ne,s),_(this,aa,i),_(this,Sc,r),_(this,vi,o),_(this,wc,a),v(this,Le,g0).call(this,a);const{x:l,y:c,width:h,height:u}=d(this,Dr);for(let f=0,g=e.length;f<g;f+=2)e[f]=(e[f]-l)/h,e[f+1]=(e[f+1]-c)/u;for(let f=0,g=s.length;f<g;f+=2)s[f]=(s[f]-l)/h,s[f+1]=(s[f+1]-c)/u}toSVGPath(){const e=[`M${d(this,It)[4]} ${d(this,It)[5]}`];for(let s=6,i=d(this,It).length;s<i;s+=6){if(isNaN(d(this,It)[s])){e.push(`L${d(this,It)[s+4]} ${d(this,It)[s+5]}`);continue}e.push(`C${d(this,It)[s]} ${d(this,It)[s+1]} ${d(this,It)[s+2]} ${d(this,It)[s+3]} ${d(this,It)[s+4]} ${d(this,It)[s+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,s,i,r],o){const a=i-e,l=r-s;let c,h;switch(o){case 0:c=v(this,Le,Wa).call(this,d(this,It),e,r,a,-l),h=v(this,Le,Wa).call(this,d(this,Ne),e,r,a,-l);break;case 90:c=v(this,Le,ja).call(this,d(this,It),e,s,a,l),h=v(this,Le,ja).call(this,d(this,Ne),e,s,a,l);break;case 180:c=v(this,Le,Wa).call(this,d(this,It),i,s,-a,l),h=v(this,Le,Wa).call(this,d(this,Ne),i,s,-a,l);break;case 270:c=v(this,Le,ja).call(this,d(this,It),i,r,-a,-l),h=v(this,Le,ja).call(this,d(this,Ne),i,r,-a,-l);break}return{outline:Array.from(c),points:[Array.from(h)]}}get box(){return d(this,Dr)}getNewOutline(e,s){const{x:i,y:r,width:o,height:a}=d(this,Dr),[l,c,h,u]=d(this,aa),f=o*h,g=a*u,p=i*h+l,m=r*u+c,b=new qh({x:d(this,Ne)[0]*f+p,y:d(this,Ne)[1]*g+m},d(this,aa),d(this,Sc),e,d(this,wc),s??d(this,vi));for(let y=2;y<d(this,Ne).length;y+=2)b.add({x:d(this,Ne)[y]*f+p,y:d(this,Ne)[y+1]*g+m});return b.getOutlines()}}aa=new WeakMap,Dr=new WeakMap,vi=new WeakMap,wc=new WeakMap,Ne=new WeakMap,Sc=new WeakMap,It=new WeakMap,Le=new WeakSet,Wa=function(e,s,i,r,o){const a=new Float64Array(e.length);for(let l=0,c=e.length;l<c;l+=2)a[l]=s+e[l]*r,a[l+1]=i+e[l+1]*o;return a},ja=function(e,s,i,r,o){const a=new Float64Array(e.length);for(let l=0,c=e.length;l<c;l+=2)a[l]=s+e[l+1]*r,a[l+1]=i+e[l]*o;return a},g0=function(e){const s=d(this,It);let i=s[4],r=s[5],o=i,a=r,l=i,c=r,h=i,u=r;const f=e?Math.max:Math.min;for(let y=6,A=s.length;y<A;y+=6){if(isNaN(s[y]))o=Math.min(o,s[y+4]),a=Math.min(a,s[y+5]),l=Math.max(l,s[y+4]),c=Math.max(c,s[y+5]),u<s[y+5]?(h=s[y+4],u=s[y+5]):u===s[y+5]&&(h=f(h,s[y+4]));else{const w=V.bezierBoundingBox(i,r,...s.slice(y,y+6));o=Math.min(o,w[0]),a=Math.min(a,w[1]),l=Math.max(l,w[2]),c=Math.max(c,w[3]),u<w[3]?(h=w[2],u=w[3]):u===w[3]&&(h=f(h,w[2]))}i=s[y+4],r=s[y+5]}const g=o-d(this,vi),p=a-d(this,vi),m=l-o+2*d(this,vi),b=c-a+2*d(this,vi);_(this,Dr,{x:g,y:p,width:m,height:b,lastPoint:[h,u]})};var Ec,Cc,us,Ir,la,Vt,kc,ca,Mc,Tc,fs,ha,At,df,uf,p0,Bn,m0,zi;const ii=class ii{constructor({editor:t=null,uiManager:e=null}){x(this,At);x(this,Ec,v(this,At,p0).bind(this));x(this,Cc,v(this,At,m0).bind(this));x(this,us,null);x(this,Ir,null);x(this,la);x(this,Vt,null);x(this,kc,!1);x(this,ca,!1);x(this,Mc,null);x(this,Tc);x(this,fs,null);x(this,ha);var s;t?(_(this,ca,!1),_(this,ha,K.HIGHLIGHT_COLOR),_(this,Mc,t)):(_(this,ca,!0),_(this,ha,K.HIGHLIGHT_DEFAULT_COLOR)),_(this,fs,(t==null?void 0:t._uiManager)||e),_(this,Tc,d(this,fs)._eventBus),_(this,la,(t==null?void 0:t.color)||((s=d(this,fs))==null?void 0:s.highlightColors.values().next().value)||"#FFFF98")}static get _keyboardManager(){return at(this,"_keyboardManager",new Hc([[["Escape","mac+Escape"],ii.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],ii.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],ii.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],ii.prototype._moveToPrevious],[["Home","mac+Home"],ii.prototype._moveToBeginning],[["End","mac+End"],ii.prototype._moveToEnd]]))}renderButton(){const t=_(this,us,document.createElement("button"));t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.setAttribute("aria-haspopup",!0);const e=d(this,fs)._signal;t.addEventListener("click",v(this,At,Bn).bind(this),{signal:e}),t.addEventListener("keydown",d(this,Ec),{signal:e});const s=_(this,Ir,document.createElement("span"));return s.className="swatch",s.setAttribute("aria-hidden",!0),s.style.backgroundColor=d(this,la),t.append(s),t}renderMainDropdown(){const t=_(this,Vt,v(this,At,df).call(this));return t.setAttribute("aria-orientation","horizontal"),t.setAttribute("aria-labelledby","highlightColorPickerLabel"),t}_colorSelectFromKeyboard(t){if(t.target===d(this,us)){v(this,At,Bn).call(this,t);return}const e=t.target.getAttribute("data-color");e&&v(this,At,uf).call(this,e,t)}_moveToNext(t){var e,s;if(!d(this,At,zi)){v(this,At,Bn).call(this,t);return}if(t.target===d(this,us)){(e=d(this,Vt).firstChild)==null||e.focus();return}(s=t.target.nextSibling)==null||s.focus()}_moveToPrevious(t){var e,s;if(t.target===((e=d(this,Vt))==null?void 0:e.firstChild)||t.target===d(this,us)){d(this,At,zi)&&this._hideDropdownFromKeyboard();return}d(this,At,zi)||v(this,At,Bn).call(this,t),(s=t.target.previousSibling)==null||s.focus()}_moveToBeginning(t){var e;if(!d(this,At,zi)){v(this,At,Bn).call(this,t);return}(e=d(this,Vt).firstChild)==null||e.focus()}_moveToEnd(t){var e;if(!d(this,At,zi)){v(this,At,Bn).call(this,t);return}(e=d(this,Vt).lastChild)==null||e.focus()}hideDropdown(){var t;(t=d(this,Vt))==null||t.classList.add("hidden"),window.removeEventListener("pointerdown",d(this,Cc))}_hideDropdownFromKeyboard(){var t;if(!d(this,ca)){if(!d(this,At,zi)){(t=d(this,Mc))==null||t.unselect();return}this.hideDropdown(),d(this,us).focus({preventScroll:!0,focusVisible:d(this,kc)})}}updateColor(t){if(d(this,Ir)&&(d(this,Ir).style.backgroundColor=t),!d(this,Vt))return;const e=d(this,fs).highlightColors.values();for(const s of d(this,Vt).children)s.setAttribute("aria-selected",e.next().value===t)}destroy(){var t,e;(t=d(this,us))==null||t.remove(),_(this,us,null),_(this,Ir,null),(e=d(this,Vt))==null||e.remove(),_(this,Vt,null)}};Ec=new WeakMap,Cc=new WeakMap,us=new WeakMap,Ir=new WeakMap,la=new WeakMap,Vt=new WeakMap,kc=new WeakMap,ca=new WeakMap,Mc=new WeakMap,Tc=new WeakMap,fs=new WeakMap,ha=new WeakMap,At=new WeakSet,df=function(){const t=document.createElement("div"),e=d(this,fs)._signal;t.addEventListener("contextmenu",ts,{signal:e}),t.className="dropdown",t.role="listbox",t.setAttribute("aria-multiselectable",!1),t.setAttribute("aria-orientation","vertical"),t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[s,i]of d(this,fs).highlightColors){const r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",i),r.title=s,r.setAttribute("data-l10n-id",`pdfjs-editor-colorpicker-${s}`);const o=document.createElement("span");r.append(o),o.className="swatch",o.style.backgroundColor=i,r.setAttribute("aria-selected",i===d(this,la)),r.addEventListener("click",v(this,At,uf).bind(this,i),{signal:e}),t.append(r)}return t.addEventListener("keydown",d(this,Ec),{signal:e}),t},uf=function(t,e){e.stopPropagation(),d(this,Tc).dispatch("switchannotationeditorparams",{source:this,type:d(this,ha),value:t})},p0=function(t){ii._keyboardManager.exec(this,t)},Bn=function(t){if(d(this,At,zi)){this.hideDropdown();return}if(_(this,kc,t.detail===0),window.addEventListener("pointerdown",d(this,Cc),{signal:d(this,fs)._signal}),d(this,Vt)){d(this,Vt).classList.remove("hidden");return}const e=_(this,Vt,v(this,At,df).call(this));d(this,us).append(e)},m0=function(t){var e;(e=d(this,Vt))!=null&&e.contains(t.target)||this.hideDropdown()},zi=function(){return d(this,Vt)&&!d(this,Vt).classList.contains("hidden")};let Kh=ii;var da,Lc,ln,Or,ua,qe,Pc,Rc,Fr,gs,me,He,fa,Nr,Ut,ga,Hs,Dc,it,ff,gf,b0,y0,_0,pf,Va,Qe,yo,v0,Lh,Ua,A0,x0,w0,S0;const ft=class ft extends pt{constructor(e){super({...e,name:"highlightEditor"});x(this,it);x(this,da,null);x(this,Lc,0);x(this,ln);x(this,Or,null);x(this,ua,null);x(this,qe,null);x(this,Pc,null);x(this,Rc,0);x(this,Fr,null);x(this,gs,null);x(this,me,null);x(this,He,!1);x(this,fa,null);x(this,Nr);x(this,Ut,null);x(this,ga,"");x(this,Hs);x(this,Dc,"");this.color=e.color||ft._defaultColor,_(this,Hs,e.thickness||ft._defaultThickness),_(this,Nr,e.opacity||ft._defaultOpacity),_(this,ln,e.boxes||null),_(this,Dc,e.methodOfCreation||""),_(this,ga,e.text||""),this._isDraggable=!1,e.highlightId>-1?(_(this,He,!0),v(this,it,gf).call(this,e),v(this,it,Va).call(this)):(_(this,da,e.anchorNode),_(this,Lc,e.anchorOffset),_(this,Pc,e.focusNode),_(this,Rc,e.focusOffset),v(this,it,ff).call(this),v(this,it,Va).call(this),this.rotate(this.rotation))}static get _keyboardManager(){const e=ft.prototype;return at(this,"_keyboardManager",new Hc([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:d(this,He)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:d(this,Hs),methodOfCreation:d(this,Dc)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}static initialize(e,s){var i;pt.initialize(e,s),ft._defaultColor||(ft._defaultColor=((i=s.highlightColors)==null?void 0:i.values().next().value)||"#fff066")}static updateDefaultParams(e,s){switch(e){case K.HIGHLIGHT_DEFAULT_COLOR:ft._defaultColor=s;break;case K.HIGHLIGHT_THICKNESS:ft._defaultThickness=s;break}}translateInPage(e,s){}get toolbarPosition(){return d(this,fa)}updateParams(e,s){switch(e){case K.HIGHLIGHT_COLOR:v(this,it,b0).call(this,s);break;case K.HIGHLIGHT_THICKNESS:v(this,it,y0).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[K.HIGHLIGHT_DEFAULT_COLOR,ft._defaultColor],[K.HIGHLIGHT_THICKNESS,ft._defaultThickness]]}get propertiesToUpdate(){return[[K.HIGHLIGHT_COLOR,this.color||ft._defaultColor],[K.HIGHLIGHT_THICKNESS,d(this,Hs)||ft._defaultThickness],[K.HIGHLIGHT_FREE,d(this,He)]]}async addEditToolbar(){const e=await super.addEditToolbar();return e?(this._uiManager.highlightColors&&(_(this,ua,new Kh({editor:this})),e.addColorPicker(d(this,ua))),e):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(v(this,it,Ua).call(this))}getBaseTranslation(){return[0,0]}getRect(e,s){return super.getRect(e,s,v(this,it,Ua).call(this))}onceAdded(){this.parent.addUndoableEditor(this),this.div.focus()}remove(){v(this,it,pf).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(v(this,it,Va).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){var i;let s=!1;this.parent&&!e?v(this,it,pf).call(this):e&&(v(this,it,Va).call(this,e),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(e),this.show(this._isVisible),s&&this.select()}rotate(e){var r,o,a;const{drawLayer:s}=this.parent;let i;d(this,He)?(e=(e-this.rotation+360)%360,i=v(r=ft,Qe,yo).call(r,d(this,gs).box,e)):i=v(o=ft,Qe,yo).call(o,this,e),s.rotate(d(this,me),e),s.rotate(d(this,Ut),e),s.updateBox(d(this,me),i),s.updateBox(d(this,Ut),v(a=ft,Qe,yo).call(a,d(this,qe).box,e))}render(){if(this.div)return this.div;const e=super.render();d(this,ga)&&(e.setAttribute("aria-label",d(this,ga)),e.setAttribute("role","mark")),d(this,He)?e.classList.add("free"):this.div.addEventListener("keydown",v(this,it,v0).bind(this),{signal:this._uiManager._signal});const s=_(this,Fr,document.createElement("div"));e.append(s),s.setAttribute("aria-hidden","true"),s.className="internal",s.style.clipPath=d(this,Or);const[i,r]=this.parentDimensions;return this.setDims(this.width*i,this.height*r),Xh(this,d(this,Fr),["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){this.parent.drawLayer.addClass(d(this,Ut),"hovered")}pointerleave(){this.parent.drawLayer.removeClass(d(this,Ut),"hovered")}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:v(this,it,Lh).call(this,!0);break;case 1:case 3:v(this,it,Lh).call(this,!1);break}}select(){var e,s;super.select(),d(this,Ut)&&((e=this.parent)==null||e.drawLayer.removeClass(d(this,Ut),"hovered"),(s=this.parent)==null||s.drawLayer.addClass(d(this,Ut),"selected"))}unselect(){var e;super.unselect(),d(this,Ut)&&((e=this.parent)==null||e.drawLayer.removeClass(d(this,Ut),"selected"),d(this,He)||v(this,it,Lh).call(this,!1))}get _mustFixPosition(){return!d(this,He)}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.show(d(this,me),e),this.parent.drawLayer.show(d(this,Ut),e))}static startHighlighting(e,s,{target:i,x:r,y:o}){const{x:a,y:l,width:c,height:h}=i.getBoundingClientRect(),u=new AbortController,f=e.combinedSignal(u),g=m=>{m.preventDefault(),m.stopPropagation()},p=m=>{u.abort(),v(this,Qe,S0).call(this,e,m)};window.addEventListener("blur",p,{signal:f}),window.addEventListener("pointerup",p,{signal:f}),window.addEventListener("pointerdown",g,{capture:!0,passive:!1,signal:f}),window.addEventListener("contextmenu",ts,{signal:f}),i.addEventListener("pointermove",v(this,Qe,w0).bind(this,e),{signal:f}),this._freeHighlight=new qh({x:r,y:o},[a,l,c,h],e.scale,this._defaultThickness/2,s,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.highlight(this._freeHighlight,this._defaultColor,this._defaultOpacity,!0)}static deserialize(e,s,i){var m;const r=super.deserialize(e,s,i),{rect:[o,a,l,c],color:h,quadPoints:u}=e;r.color=V.makeHexColor(...h),_(r,Nr,e.opacity);const[f,g]=r.pageDimensions;r.width=(l-o)/f,r.height=(c-a)/g;const p=_(r,ln,[]);for(let b=0;b<u.length;b+=8)p.push({x:(u[4]-l)/f,y:(c-(1-u[b+5]))/g,width:(u[b+2]-u[b])/f,height:(u[b+5]-u[b+1])/g});return v(m=r,it,ff).call(m),r}serialize(e=!1){if(this.isEmpty()||e)return null;const s=this.getRect(0,0),i=pt._colorManager.convert(this.color);return{annotationType:ot.HIGHLIGHT,color:i,opacity:d(this,Nr),thickness:d(this,Hs),quadPoints:v(this,it,A0).call(this),outlines:v(this,it,x0).call(this,s),pageIndex:this.pageIndex,rect:s,rotation:v(this,it,Ua).call(this),structTreeParentId:this._structTreeParentId}}static canCreateNewEmptyEditor(){return!1}};da=new WeakMap,Lc=new WeakMap,ln=new WeakMap,Or=new WeakMap,ua=new WeakMap,qe=new WeakMap,Pc=new WeakMap,Rc=new WeakMap,Fr=new WeakMap,gs=new WeakMap,me=new WeakMap,He=new WeakMap,fa=new WeakMap,Nr=new WeakMap,Ut=new WeakMap,ga=new WeakMap,Hs=new WeakMap,Dc=new WeakMap,it=new WeakSet,ff=function(){const e=new lp(d(this,ln),.001);_(this,gs,e.getOutlines()),{x:this.x,y:this.y,width:this.width,height:this.height}=d(this,gs).box;const s=new lp(d(this,ln),.0025,.001,this._uiManager.direction==="ltr");_(this,qe,s.getOutlines());const{lastPoint:i}=d(this,qe).box;_(this,fa,[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height])},gf=function({highlightOutlines:e,highlightId:s,clipPathId:i}){var u,f;if(_(this,gs,e),_(this,qe,e.getNewOutline(d(this,Hs)/2+1.5,.0025)),s>=0)_(this,me,s),_(this,Or,i),this.parent.drawLayer.finalizeLine(s,e),_(this,Ut,this.parent.drawLayer.highlightOutline(d(this,qe)));else if(this.parent){const g=this.parent.viewport.rotation;this.parent.drawLayer.updateLine(d(this,me),e),this.parent.drawLayer.updateBox(d(this,me),v(u=ft,Qe,yo).call(u,d(this,gs).box,(g-this.rotation+360)%360)),this.parent.drawLayer.updateLine(d(this,Ut),d(this,qe)),this.parent.drawLayer.updateBox(d(this,Ut),v(f=ft,Qe,yo).call(f,d(this,qe).box,g))}const{x:o,y:a,width:l,height:c}=e.box;switch(this.rotation){case 0:this.x=o,this.y=a,this.width=l,this.height=c;break;case 90:{const[g,p]=this.parentDimensions;this.x=a,this.y=1-o,this.width=l*p/g,this.height=c*g/p;break}case 180:this.x=1-o,this.y=1-a,this.width=l,this.height=c;break;case 270:{const[g,p]=this.parentDimensions;this.x=1-a,this.y=o,this.width=l*p/g,this.height=c*g/p;break}}const{lastPoint:h}=d(this,qe).box;_(this,fa,[(h[0]-o)/l,(h[1]-a)/c])},b0=function(e){const s=r=>{var o,a;this.color=r,(o=this.parent)==null||o.drawLayer.changeColor(d(this,me),r),(a=d(this,ua))==null||a.updateColor(r)},i=this.color;this.addCommands({cmd:s.bind(this,e),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:K.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(e)},!0)},y0=function(e){const s=d(this,Hs),i=r=>{_(this,Hs,r),v(this,it,_0).call(this,r)};this.addCommands({cmd:i.bind(this,e),undo:i.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:K.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)},_0=function(e){if(!d(this,He))return;v(this,it,gf).call(this,{highlightOutlines:d(this,gs).getNewOutline(e/2)}),this.fixAndSetPosition();const[s,i]=this.parentDimensions;this.setDims(this.width*s,this.height*i)},pf=function(){d(this,me)===null||!this.parent||(this.parent.drawLayer.remove(d(this,me)),_(this,me,null),this.parent.drawLayer.remove(d(this,Ut)),_(this,Ut,null))},Va=function(e=this.parent){d(this,me)===null&&({id:xe(this,me)._,clipPathId:xe(this,Or)._}=e.drawLayer.highlight(d(this,gs),this.color,d(this,Nr)),_(this,Ut,e.drawLayer.highlightOutline(d(this,qe))),d(this,Fr)&&(d(this,Fr).style.clipPath=d(this,Or)))},Qe=new WeakSet,yo=function({x:e,y:s,width:i,height:r},o){switch(o){case 90:return{x:1-s-r,y:e,width:r,height:i};case 180:return{x:1-e-i,y:1-s-r,width:i,height:r};case 270:return{x:s,y:1-e-i,width:r,height:i}}return{x:e,y:s,width:i,height:r}},v0=function(e){ft._keyboardManager.exec(this,e)},Lh=function(e){if(!d(this,da))return;const s=window.getSelection();e?s.setPosition(d(this,da),d(this,Lc)):s.setPosition(d(this,Pc),d(this,Rc))},Ua=function(){return d(this,He)?this.rotation:0},A0=function(){if(d(this,He))return null;const[e,s]=this.pageDimensions,[i,r]=this.pageTranslation,o=d(this,ln),a=new Float32Array(o.length*8);let l=0;for(const{x:c,y:h,width:u,height:f}of o){const g=c*e+i,p=(1-h-f)*s+r;a[l]=a[l+4]=g,a[l+1]=a[l+3]=p,a[l+2]=a[l+6]=g+u*e,a[l+5]=a[l+7]=p+f*s,l+=8}return a},x0=function(e){return d(this,gs).serialize(e,v(this,it,Ua).call(this))},w0=function(e,s){this._freeHighlight.add(s)&&e.drawLayer.updatePath(this._freeHighlightId,this._freeHighlight)},S0=function(e,s){this._freeHighlight.isEmpty()?e.drawLayer.removeFreeHighlight(this._freeHighlightId):e.createAndAddNewEditor(s,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},x(ft,Qe),T(ft,"_defaultColor",null),T(ft,"_defaultOpacity",1),T(ft,"_defaultThickness",12),T(ft,"_l10nPromise"),T(ft,"_type","highlight"),T(ft,"_editorType",ot.HIGHLIGHT),T(ft,"_freeHighlightId",-1),T(ft,"_freeHighlight",null),T(ft,"_freeHighlightClipId","");let Zh=ft;var Hr,Br,Bs,Ai,Ke,zr,$r,Wr,xi,pa,jr,Vr,cn,H,E0,C0,k0,M0,bf,T0,yf,L0,P0,R0,D0,I0,zn,_f,vf,Af,Ph,Rh,_o,xf,Dh,Ni,O0,wf,F0,N0,Sf,Ih,Ga;const Tt=class Tt extends pt{constructor(e){super({...e,name:"inkEditor"});x(this,H);x(this,Hr,0);x(this,Br,0);x(this,Bs,null);x(this,Ai,new Path2D);x(this,Ke,!1);x(this,zr,null);x(this,$r,!1);x(this,Wr,!1);x(this,xi,null);x(this,pa,null);x(this,jr,0);x(this,Vr,0);x(this,cn,null);this.color=e.color||null,this.thickness=e.thickness||null,this.opacity=e.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(e,s){pt.initialize(e,s)}static updateDefaultParams(e,s){switch(e){case K.INK_THICKNESS:Tt._defaultThickness=s;break;case K.INK_COLOR:Tt._defaultColor=s;break;case K.INK_OPACITY:Tt._defaultOpacity=s/100;break}}updateParams(e,s){switch(e){case K.INK_THICKNESS:v(this,H,E0).call(this,s);break;case K.INK_COLOR:v(this,H,C0).call(this,s);break;case K.INK_OPACITY:v(this,H,k0).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[K.INK_THICKNESS,Tt._defaultThickness],[K.INK_COLOR,Tt._defaultColor||pt._defaultLineColor],[K.INK_OPACITY,Math.round(Tt._defaultOpacity*100)]]}get propertiesToUpdate(){return[[K.INK_THICKNESS,this.thickness||Tt._defaultThickness],[K.INK_COLOR,this.color||Tt._defaultColor||pt._defaultLineColor],[K.INK_OPACITY,Math.round(100*(this.opacity??Tt._defaultOpacity))]]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(v(this,H,Ph).call(this),v(this,H,Rh).call(this)),this.isAttachedToDOM||(this.parent.add(this),v(this,H,_o).call(this)),v(this,H,Ga).call(this)))}remove(){var e;this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,d(this,Bs)&&(clearTimeout(d(this,Bs)),_(this,Bs,null)),(e=d(this,xi))==null||e.disconnect(),_(this,xi,null),super.remove())}setParent(e){!this.parent&&e?this._uiManager.removeShouldRescale(this):this.parent&&e===null&&this._uiManager.addShouldRescale(this),super.setParent(e)}onScaleChanging(){const[e,s]=this.parentDimensions,i=this.width*e,r=this.height*s;this.setDimensions(i,r)}enableEditMode(){d(this,Ke)||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,v(this,H,_f).call(this))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),v(this,H,vf).call(this))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){d(this,Ke)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),_(this,Ke,!0),this.div.classList.add("disabled"),v(this,H,Ga).call(this,!0),this.select(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(e){this._focusEventsAllowed&&(super.focusin(e),this.enableEditMode())}canvasPointerdown(e){e.button!==0||!this.isInEditMode()||d(this,Ke)||(this.setInForeground(),e.preventDefault(),this.div.contains(document.activeElement)||this.div.focus({preventScroll:!0}),v(this,H,T0).call(this,e.offsetX,e.offsetY))}canvasPointermove(e){e.preventDefault(),v(this,H,yf).call(this,e.offsetX,e.offsetY)}canvasPointerup(e){e.preventDefault(),v(this,H,Af).call(this,e)}canvasPointerleave(e){v(this,H,Af).call(this,e)}get isResizable(){return!this.isEmpty()&&d(this,Ke)}render(){if(this.div)return this.div;let e,s;this.width&&(e=this.x,s=this.y),super.render(),this.div.setAttribute("data-l10n-id","pdfjs-ink");const[i,r,o,a]=v(this,H,M0).call(this);if(this.setAt(i,r,0,0),this.setDims(o,a),v(this,H,Ph).call(this),this.width){const[l,c]=this.parentDimensions;this.setAspectRatio(this.width*l,this.height*c),this.setAt(e*l,s*c,this.width*l,this.height*c),_(this,Wr,!0),v(this,H,_o).call(this),this.setDims(this.width*l,this.height*c),v(this,H,zn).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return v(this,H,Rh).call(this),this.div}setDimensions(e,s){const i=Math.round(e),r=Math.round(s);if(d(this,jr)===i&&d(this,Vr)===r)return;_(this,jr,i),_(this,Vr,r),this.canvas.style.visibility="hidden";const[o,a]=this.parentDimensions;this.width=e/o,this.height=s/a,this.fixAndSetPosition(),d(this,Ke)&&v(this,H,xf).call(this,e,s),v(this,H,_o).call(this),v(this,H,zn).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(e,s,i){var b,y,A;if(e instanceof s0)return null;const r=super.deserialize(e,s,i);r.thickness=e.thickness,r.color=V.makeHexColor(...e.color),r.opacity=e.opacity;const[o,a]=r.pageDimensions,l=r.width*o,c=r.height*a,h=r.parentScale,u=e.thickness/2;_(r,Ke,!0),_(r,jr,Math.round(l)),_(r,Vr,Math.round(c));const{paths:f,rect:g,rotation:p}=e;for(let{bezier:w}of f){w=v(b=Tt,Ni,F0).call(b,w,g,p);const S=[];r.paths.push(S);let E=h*(w[0]-u),C=h*(w[1]-u);for(let M=2,R=w.length;M<R;M+=6){const N=h*(w[M]-u),O=h*(w[M+1]-u),j=h*(w[M+2]-u),X=h*(w[M+3]-u),Q=h*(w[M+4]-u),U=h*(w[M+5]-u);S.push([[E,C],[N,O],[j,X],[Q,U]]),E=Q,C=U}const k=v(this,Ni,O0).call(this,S);r.bezierPath2D.push(k)}const m=v(y=r,H,Sf).call(y);return _(r,Br,Math.max(pt.MIN_SIZE,m[2]-m[0])),_(r,Hr,Math.max(pt.MIN_SIZE,m[3]-m[1])),v(A=r,H,xf).call(A,l,c),r}serialize(){if(this.isEmpty())return null;const e=this.getRect(0,0),s=pt._colorManager.convert(this.ctx.strokeStyle);return{annotationType:ot.INK,color:s,thickness:this.thickness,opacity:this.opacity,paths:v(this,H,N0).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,e),pageIndex:this.pageIndex,rect:e,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}};Hr=new WeakMap,Br=new WeakMap,Bs=new WeakMap,Ai=new WeakMap,Ke=new WeakMap,zr=new WeakMap,$r=new WeakMap,Wr=new WeakMap,xi=new WeakMap,pa=new WeakMap,jr=new WeakMap,Vr=new WeakMap,cn=new WeakMap,H=new WeakSet,E0=function(e){const s=r=>{this.thickness=r,v(this,H,Ga).call(this)},i=this.thickness;this.addCommands({cmd:s.bind(this,e),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:K.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},C0=function(e){const s=r=>{this.color=r,v(this,H,zn).call(this)},i=this.color;this.addCommands({cmd:s.bind(this,e),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:K.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},k0=function(e){const s=r=>{this.opacity=r,v(this,H,zn).call(this)};e/=100;const i=this.opacity;this.addCommands({cmd:s.bind(this,e),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:K.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},M0=function(){const{parentRotation:e,parentDimensions:[s,i]}=this;switch(e){case 90:return[0,i,i,s];case 180:return[s,i,s,i];case 270:return[s,0,i,s];default:return[0,0,s,i]}},bf=function(){const{ctx:e,color:s,opacity:i,thickness:r,parentScale:o,scaleFactor:a}=this;e.lineWidth=r*o/a,e.lineCap="round",e.lineJoin="round",e.miterLimit=10,e.strokeStyle=`${s}${T_(i)}`},T0=function(e,s){this.canvas.addEventListener("contextmenu",ts,{signal:this._uiManager._signal}),v(this,H,vf).call(this),_(this,zr,new AbortController);const i=this._uiManager.combinedSignal(d(this,zr));this.canvas.addEventListener("pointerleave",this.canvasPointerleave.bind(this),{signal:i}),this.canvas.addEventListener("pointermove",this.canvasPointermove.bind(this),{signal:i}),this.canvas.addEventListener("pointerup",this.canvasPointerup.bind(this),{signal:i}),this.isEditing=!0,d(this,Wr)||(_(this,Wr,!0),v(this,H,_o).call(this),this.thickness||(this.thickness=Tt._defaultThickness),this.color||(this.color=Tt._defaultColor||pt._defaultLineColor),this.opacity??(this.opacity=Tt._defaultOpacity)),this.currentPath.push([e,s]),_(this,$r,!1),v(this,H,bf).call(this),_(this,cn,()=>{v(this,H,R0).call(this),d(this,cn)&&window.requestAnimationFrame(d(this,cn))}),window.requestAnimationFrame(d(this,cn))},yf=function(e,s){const[i,r]=this.currentPath.at(-1);if(this.currentPath.length>1&&e===i&&s===r)return;const o=this.currentPath;let a=d(this,Ai);if(o.push([e,s]),_(this,$r,!0),o.length<=2){a.moveTo(...o[0]),a.lineTo(e,s);return}o.length===3&&(_(this,Ai,a=new Path2D),a.moveTo(...o[0])),v(this,H,D0).call(this,a,...o.at(-3),...o.at(-2),e,s)},L0=function(){if(this.currentPath.length===0)return;const e=this.currentPath.at(-1);d(this,Ai).lineTo(...e)},P0=function(e,s){_(this,cn,null),e=Math.min(Math.max(e,0),this.canvas.width),s=Math.min(Math.max(s,0),this.canvas.height),v(this,H,yf).call(this,e,s),v(this,H,L0).call(this);let i;if(this.currentPath.length!==1)i=v(this,H,I0).call(this);else{const c=[e,s];i=[[c,c.slice(),c.slice(),c]]}const r=d(this,Ai),o=this.currentPath;this.currentPath=[],_(this,Ai,new Path2D);const a=()=>{this.allRawPaths.push(o),this.paths.push(i),this.bezierPath2D.push(r),this._uiManager.rebuild(this)},l=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(v(this,H,Ph).call(this),v(this,H,Rh).call(this)),v(this,H,Ga).call(this))};this.addCommands({cmd:a,undo:l,mustExec:!0})},R0=function(){if(!d(this,$r))return;_(this,$r,!1);const e=Math.ceil(this.thickness*this.parentScale),s=this.currentPath.slice(-3),i=s.map(a=>a[0]),r=s.map(a=>a[1]);Math.min(...i)-e,Math.max(...i)+e,Math.min(...r)-e,Math.max(...r)+e;const{ctx:o}=this;o.save(),o.clearRect(0,0,this.canvas.width,this.canvas.height);for(const a of this.bezierPath2D)o.stroke(a);o.stroke(d(this,Ai)),o.restore()},D0=function(e,s,i,r,o,a,l){const c=(s+r)/2,h=(i+o)/2,u=(r+a)/2,f=(o+l)/2;e.bezierCurveTo(c+2*(r-c)/3,h+2*(o-h)/3,u+2*(r-u)/3,f+2*(o-f)/3,u,f)},I0=function(){const e=this.currentPath;if(e.length<=2)return[[e[0],e[0],e.at(-1),e.at(-1)]];const s=[];let i,[r,o]=e[0];for(i=1;i<e.length-2;i++){const[g,p]=e[i],[m,b]=e[i+1],y=(g+m)/2,A=(p+b)/2,w=[r+2*(g-r)/3,o+2*(p-o)/3],S=[y+2*(g-y)/3,A+2*(p-A)/3];s.push([[r,o],w,S,[y,A]]),[r,o]=[y,A]}const[a,l]=e[i],[c,h]=e[i+1],u=[r+2*(a-r)/3,o+2*(l-o)/3],f=[c+2*(a-c)/3,h+2*(l-h)/3];return s.push([[r,o],u,f,[c,h]]),s},zn=function(){if(this.isEmpty()){v(this,H,Dh).call(this);return}v(this,H,bf).call(this);const{canvas:e,ctx:s}=this;s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,e.width,e.height),v(this,H,Dh).call(this);for(const i of this.bezierPath2D)s.stroke(i)},_f=function(){if(d(this,pa))return;_(this,pa,new AbortController);const e=this._uiManager.combinedSignal(d(this,pa));this.canvas.addEventListener("pointerdown",this.canvasPointerdown.bind(this),{signal:e})},vf=function(){var e;(e=this.pointerdownAC)==null||e.abort(),this.pointerdownAC=null},Af=function(e){var s;(s=d(this,zr))==null||s.abort(),_(this,zr,null),v(this,H,_f).call(this),d(this,Bs)&&clearTimeout(d(this,Bs)),_(this,Bs,setTimeout(()=>{_(this,Bs,null),this.canvas.removeEventListener("contextmenu",ts)},10)),v(this,H,P0).call(this,e.offsetX,e.offsetY),this.addToAnnotationStorage(),this.setInBackground()},Ph=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",this.canvas.setAttribute("data-l10n-id","pdfjs-ink-canvas"),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},Rh=function(){_(this,xi,new ResizeObserver(e=>{const s=e[0].contentRect;s.width&&s.height&&this.setDimensions(s.width,s.height)})),d(this,xi).observe(this.div),this._uiManager._signal.addEventListener("abort",()=>{var e;(e=d(this,xi))==null||e.disconnect(),_(this,xi,null)},{once:!0})},_o=function(){if(!d(this,Wr))return;const[e,s]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*e),this.canvas.height=Math.ceil(this.height*s),v(this,H,Dh).call(this)},xf=function(e,s){const i=v(this,H,Ih).call(this),r=(e-i)/d(this,Br),o=(s-i)/d(this,Hr);this.scaleFactor=Math.min(r,o)},Dh=function(){const e=v(this,H,Ih).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+e,this.translationY*this.scaleFactor+e)},Ni=new WeakSet,O0=function(e){const s=new Path2D;for(let i=0,r=e.length;i<r;i++){const[o,a,l,c]=e[i];i===0&&s.moveTo(...o),s.bezierCurveTo(a[0],a[1],l[0],l[1],c[0],c[1])}return s},wf=function(e,s,i){const[r,o,a,l]=s;switch(i){case 0:for(let c=0,h=e.length;c<h;c+=2)e[c]+=r,e[c+1]=l-e[c+1];break;case 90:for(let c=0,h=e.length;c<h;c+=2){const u=e[c];e[c]=e[c+1]+r,e[c+1]=u+o}break;case 180:for(let c=0,h=e.length;c<h;c+=2)e[c]=a-e[c],e[c+1]+=o;break;case 270:for(let c=0,h=e.length;c<h;c+=2){const u=e[c];e[c]=a-e[c+1],e[c+1]=l-u}break;default:throw new Error("Invalid rotation")}return e},F0=function(e,s,i){const[r,o,a,l]=s;switch(i){case 0:for(let c=0,h=e.length;c<h;c+=2)e[c]-=r,e[c+1]=l-e[c+1];break;case 90:for(let c=0,h=e.length;c<h;c+=2){const u=e[c];e[c]=e[c+1]-o,e[c+1]=u-r}break;case 180:for(let c=0,h=e.length;c<h;c+=2)e[c]=a-e[c],e[c+1]-=o;break;case 270:for(let c=0,h=e.length;c<h;c+=2){const u=e[c];e[c]=l-e[c+1],e[c+1]=a-u}break;default:throw new Error("Invalid rotation")}return e},N0=function(e,s,i,r){var h,u;const o=[],a=this.thickness/2,l=e*s+a,c=e*i+a;for(const f of this.paths){const g=[],p=[];for(let m=0,b=f.length;m<b;m++){const[y,A,w,S]=f[m];if(y[0]===S[0]&&y[1]===S[1]&&b===1){const X=e*y[0]+l,Q=e*y[1]+c;g.push(X,Q),p.push(X,Q);break}const E=e*y[0]+l,C=e*y[1]+c,k=e*A[0]+l,M=e*A[1]+c,R=e*w[0]+l,N=e*w[1]+c,O=e*S[0]+l,j=e*S[1]+c;m===0&&(g.push(E,C),p.push(E,C)),g.push(k,M,R,N,O,j),p.push(k,M),m===b-1&&p.push(O,j)}o.push({bezier:v(h=Tt,Ni,wf).call(h,g,r,this.rotation),points:v(u=Tt,Ni,wf).call(u,p,r,this.rotation)})}return o},Sf=function(){let e=1/0,s=-1/0,i=1/0,r=-1/0;for(const o of this.paths)for(const[a,l,c,h]of o){const u=V.bezierBoundingBox(...a,...l,...c,...h);e=Math.min(e,u[0]),i=Math.min(i,u[1]),s=Math.max(s,u[2]),r=Math.max(r,u[3])}return[e,i,s,r]},Ih=function(){return d(this,Ke)?Math.ceil(this.thickness*this.parentScale):0},Ga=function(e=!1){if(this.isEmpty())return;if(!d(this,Ke)){v(this,H,zn).call(this);return}const s=v(this,H,Sf).call(this),i=v(this,H,Ih).call(this);_(this,Br,Math.max(pt.MIN_SIZE,s[2]-s[0])),_(this,Hr,Math.max(pt.MIN_SIZE,s[3]-s[1]));const r=Math.ceil(i+d(this,Br)*this.scaleFactor),o=Math.ceil(i+d(this,Hr)*this.scaleFactor),[a,l]=this.parentDimensions;this.width=r/a,this.height=o/l,this.setAspectRatio(r,o);const c=this.translationX,h=this.translationY;this.translationX=-s[0],this.translationY=-s[1],v(this,H,_o).call(this),v(this,H,zn).call(this),_(this,jr,r),_(this,Vr,o),this.setDims(r,o);const u=e?i/this.scaleFactor/2:0;this.translate(c-this.translationX-u,h-this.translationY-u)},x(Tt,Ni),T(Tt,"_defaultColor",null),T(Tt,"_defaultOpacity",1),T(Tt,"_defaultThickness",1),T(Tt,"_type","ink"),T(Tt,"_editorType",ot.INK);let mf=Tt;var Ot,ne,hn,wi,dn,ma,zs,Si,$s,Ze,Ic,lt,Xa,Ya,Oh,Cf,H0,kf,Mf,Fh,B0;const ll=class ll extends pt{constructor(e){super({...e,name:"stampEditor"});x(this,lt);x(this,Ot,null);x(this,ne,null);x(this,hn,null);x(this,wi,null);x(this,dn,null);x(this,ma,"");x(this,zs,null);x(this,Si,null);x(this,$s,null);x(this,Ze,!1);x(this,Ic,!1);_(this,wi,e.bitmapUrl),_(this,dn,e.bitmapFile)}static initialize(e,s){pt.initialize(e,s)}static get supportedTypes(){return at(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(s=>`image/${s}`))}static get supportedTypesStr(){return at(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(e){return this.supportedTypes.includes(e)}static paste(e,s){s.pasteEditor(ot.STAMP,{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var e;return{type:"stamp",hasAltText:!!((e=this.altTextData)!=null&&e.altText)}}static computeTelemetryFinalData(e){const s=e.get("hasAltText");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}async mlGuessAltText(e=null,s=!0){if(this.hasAltTextData())return null;const{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:r,width:o,height:a}=e||this.copyCanvas(null,!0).imageData,l=await i.guess({name:"altText",request:{data:r,width:o,height:a,channels:r.length/(o*a)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");const c=l.output;return await this.setGuessedAltText(c),s&&!this.hasAltTextData()&&(this.altTextData={alt:c,decorative:!1}),c}remove(){var e,s;d(this,ne)&&(_(this,Ot,null),this._uiManager.imageManager.deleteId(d(this,ne)),(e=d(this,zs))==null||e.remove(),_(this,zs,null),(s=d(this,Si))==null||s.disconnect(),_(this,Si,null),d(this,$s)&&(clearTimeout(d(this,$s)),_(this,$s,null))),super.remove()}rebuild(){if(!this.parent){d(this,ne)&&v(this,lt,Oh).call(this);return}super.rebuild(),this.div!==null&&(d(this,ne)&&d(this,zs)===null&&v(this,lt,Oh).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(d(this,hn)||d(this,Ot)||d(this,wi)||d(this,dn)||d(this,ne))}get isResizable(){return!0}render(){if(this.div)return this.div;let e,s;if(this.width&&(e=this.x,s=this.y),super.render(),this.div.hidden=!0,this.addAltTextButton(),d(this,Ot)?v(this,lt,Cf).call(this):v(this,lt,Oh).call(this),this.width){const[i,r]=this.parentDimensions;this.setAt(e*i,s*r,this.width*i,this.height*r)}return this.div}copyCanvas(e,s=!1){var b;e||(e=224);const{width:i,height:r}=d(this,Ot),o=document.createElement("canvas");let a=d(this,Ot),l=i,c=r;if(i>e||r>e){const y=Math.min(e/i,e/r);l=Math.floor(i*y),c=Math.floor(r*y),d(this,Ze)||(a=v(this,lt,kf).call(this,l,c))}o.width=l,o.height=c;const h=o.getContext("2d");h.filter=this._uiManager.hcmFilter;let u="white",f="#cfcfd8";this._uiManager.hcmFilter!=="none"?f="black":(b=window.matchMedia)!=null&&b.call(window,"(prefers-color-scheme: dark)").matches&&(u="#8f8f9d",f="#42414d");const g=15,p=new OffscreenCanvas(g*2,g*2),m=p.getContext("2d");if(m.fillStyle=u,m.fillRect(0,0,g*2,g*2),m.fillStyle=f,m.fillRect(0,0,g,g),m.fillRect(g,g,g,g),h.fillStyle=h.createPattern(p,"repeat"),h.fillRect(0,0,l,c),s){const y=new OffscreenCanvas(l,c),A=y.getContext("2d",{willReadFrequently:!0});A.drawImage(a,0,0,a.width,a.height,0,0,l,c);const w=A.getImageData(0,0,l,c).data;return h.drawImage(y,0,0),{canvas:o,imageData:{width:l,height:c,data:w}}}return h.drawImage(a,0,0,a.width,a.height,0,0,l,c),{canvas:o,imageData:null}}getImageForAltText(){return d(this,zs)}static deserialize(e,s,i){if(e instanceof i0)return null;const r=super.deserialize(e,s,i),{rect:o,bitmapUrl:a,bitmapId:l,isSvg:c,accessibilityData:h}=e;l&&i.imageManager.isValidId(l)?_(r,ne,l):_(r,wi,a),_(r,Ze,c);const[u,f]=r.pageDimensions;return r.width=(o[2]-o[0])/u,r.height=(o[3]-o[1])/f,h&&(r.altTextData=h),r}serialize(e=!1,s=null){if(this.isEmpty())return null;const i={annotationType:ot.STAMP,bitmapId:d(this,ne),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:d(this,Ze),structTreeParentId:this._structTreeParentId};if(e)return i.bitmapUrl=v(this,lt,Fh).call(this,!0),i.accessibilityData=this.serializeAltText(!0),i;const{decorative:r,altText:o}=this.serializeAltText(!1);if(!r&&o&&(i.accessibilityData={type:"Figure",alt:o}),s===null)return i;s.stamps||(s.stamps=new Map);const a=d(this,Ze)?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!s.stamps.has(d(this,ne)))s.stamps.set(d(this,ne),{area:a,serialized:i}),i.bitmap=v(this,lt,Fh).call(this,!1);else if(d(this,Ze)){const l=s.stamps.get(d(this,ne));a>l.area&&(l.area=a,l.serialized.bitmap.close(),l.serialized.bitmap=v(this,lt,Fh).call(this,!1))}return i}};Ot=new WeakMap,ne=new WeakMap,hn=new WeakMap,wi=new WeakMap,dn=new WeakMap,ma=new WeakMap,zs=new WeakMap,Si=new WeakMap,$s=new WeakMap,Ze=new WeakMap,Ic=new WeakMap,lt=new WeakSet,Xa=function(e,s=!1){if(!e){this.remove();return}_(this,Ot,e.bitmap),s||(_(this,ne,e.id),_(this,Ze,e.isSvg)),e.file&&_(this,ma,e.file.name),v(this,lt,Cf).call(this)},Ya=function(){if(_(this,hn,null),this._uiManager.enableWaiting(!1),!!d(this,zs)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&d(this,Ot)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&d(this,Ot)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},Oh=function(){if(d(this,ne)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(d(this,ne)).then(i=>v(this,lt,Xa).call(this,i,!0)).finally(()=>v(this,lt,Ya).call(this));return}if(d(this,wi)){const i=d(this,wi);_(this,wi,null),this._uiManager.enableWaiting(!0),_(this,hn,this._uiManager.imageManager.getFromUrl(i).then(r=>v(this,lt,Xa).call(this,r)).finally(()=>v(this,lt,Ya).call(this)));return}if(d(this,dn)){const i=d(this,dn);_(this,dn,null),this._uiManager.enableWaiting(!0),_(this,hn,this._uiManager.imageManager.getFromFile(i).then(r=>v(this,lt,Xa).call(this,r)).finally(()=>v(this,lt,Ya).call(this)));return}const e=document.createElement("input");e.type="file",e.accept=ll.supportedTypesStr;const s=this._uiManager._signal;_(this,hn,new Promise(i=>{e.addEventListener("change",async()=>{if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const r=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),v(this,lt,Xa).call(this,r)}i()},{signal:s}),e.addEventListener("cancel",()=>{this.remove(),i()},{signal:s})}).finally(()=>v(this,lt,Ya).call(this))),e.click()},Cf=function(){const{div:e}=this;let{width:s,height:i}=d(this,Ot);const[r,o]=this.pageDimensions,a=.75;if(this.width)s=this.width*r,i=this.height*o;else if(s>a*r||i>a*o){const u=Math.min(a*r/s,a*o/i);s*=u,i*=u}const[l,c]=this.parentDimensions;this.setDims(s*l/r,i*c/o),this._uiManager.enableWaiting(!1);const h=_(this,zs,document.createElement("canvas"));e.append(h),(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow)&&(e.hidden=!1),v(this,lt,Mf).call(this,s,i),v(this,lt,B0).call(this),d(this,Ic)||(this.parent.addUndoableEditor(this),_(this,Ic,!0)),this._reportTelemetry({action:"inserted_image"}),d(this,ma)&&h.setAttribute("aria-label",d(this,ma))},H0=function(e,s){var a;const[i,r]=this.parentDimensions;this.width=e/i,this.height=s/r,this.setDims(e,s),(a=this._initialOptions)!=null&&a.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,d(this,$s)!==null&&clearTimeout(d(this,$s)),_(this,$s,setTimeout(()=>{_(this,$s,null),v(this,lt,Mf).call(this,e,s)},200))},kf=function(e,s){const{width:i,height:r}=d(this,Ot);let o=i,a=r,l=d(this,Ot);for(;o>2*e||a>2*s;){const c=o,h=a;o>2*e&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),a>2*s&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));const u=new OffscreenCanvas(o,a);u.getContext("2d").drawImage(l,0,0,c,h,0,0,o,a),l=u.transferToImageBitmap()}return l},Mf=function(e,s){e=Math.ceil(e),s=Math.ceil(s);const i=d(this,zs);if(!i||i.width===e&&i.height===s)return;i.width=e,i.height=s;const r=d(this,Ze)?d(this,Ot):v(this,lt,kf).call(this,e,s),o=i.getContext("2d");o.filter=this._uiManager.hcmFilter,o.drawImage(r,0,0,r.width,r.height,0,0,e,s)},Fh=function(e){if(e){if(d(this,Ze)){const r=this._uiManager.imageManager.getSvgUrl(d(this,ne));if(r)return r}const s=document.createElement("canvas");return{width:s.width,height:s.height}=d(this,Ot),s.getContext("2d").drawImage(d(this,Ot),0,0),s.toDataURL()}if(d(this,Ze)){const[s,i]=this.pageDimensions,r=Math.round(this.width*s*xn.PDF_TO_CSS_UNITS),o=Math.round(this.height*i*xn.PDF_TO_CSS_UNITS),a=new OffscreenCanvas(r,o);return a.getContext("2d").drawImage(d(this,Ot),0,0,d(this,Ot).width,d(this,Ot).height,0,0,r,o),a.transferToImageBitmap()}return structuredClone(d(this,Ot))},B0=function(){this._uiManager._signal&&(_(this,Si,new ResizeObserver(e=>{const s=e[0].contentRect;s.width&&s.height&&v(this,lt,H0).call(this,s.width,s.height)})),d(this,Si).observe(this.div),this._uiManager._signal.addEventListener("abort",()=>{var e;(e=d(this,Si))==null||e.disconnect(),_(this,Si,null)},{once:!0}))},T(ll,"_type","stamp"),T(ll,"_editorType",ot.STAMP);let Ef=ll;var Ur,ba,Ws,un,Ei,Be,fn,ya,_a,be,Ci,G,gn,re,z0,Lf,Pf,Rf,Nh;const es=class es{constructor({uiManager:t,pageIndex:e,div:s,accessibilityManager:i,annotationLayer:r,drawLayer:o,textLayer:a,viewport:l,l10n:c}){x(this,re);x(this,Ur);x(this,ba,!1);x(this,Ws,null);x(this,un,null);x(this,Ei,null);x(this,Be,new Map);x(this,fn,!1);x(this,ya,!1);x(this,_a,!1);x(this,be,null);x(this,Ci,null);x(this,G);const h=[...d(es,gn).values()];if(!es._initialized){es._initialized=!0;for(const u of h)u.initialize(c,t)}t.registerEditorTypes(h),_(this,G,t),this.pageIndex=e,this.div=s,_(this,Ur,i),_(this,Ws,r),this.viewport=l,_(this,be,a),this.drawLayer=o,d(this,G).addLayer(this)}get isEmpty(){return d(this,Be).size===0}get isInvisible(){return this.isEmpty&&d(this,G).getMode()===ot.NONE}updateToolbar(t){d(this,G).updateToolbar(t)}updateMode(t=d(this,G).getMode()){switch(v(this,re,Nh).call(this),t){case ot.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case ot.INK:this.addInkEditorIfNeeded(!1),this.disableTextSelection(),this.togglePointerEvents(!0),this.disableClick();break;case ot.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;for(const s of d(es,gn).values())e.toggle(`${s._type}Editing`,t===s._editorType);this.div.hidden=!1}hasTextLayer(t){var e;return t===((e=d(this,be))==null?void 0:e.div)}addInkEditorIfNeeded(t){if(d(this,G).getMode()!==ot.INK)return;if(!t){for(const s of d(this,Be).values())if(s.isEmpty()){s.setInBackground();return}}this.createAndAddNewEditor({offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(t){d(this,G).setEditingState(t)}addCommands(t){d(this,G).addCommands(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){var e;(e=d(this,Ws))==null||e.div.classList.toggle("disabled",!t)}enable(){this.div.tabIndex=0,this.togglePointerEvents(!0);const t=new Set;for(const s of d(this,Be).values())s.enableEditing(),s.show(!0),s.annotationElementId&&(d(this,G).removeChangedExistingAnnotation(s),t.add(s.annotationElementId));if(!d(this,Ws))return;const e=d(this,Ws).getEditableAnnotations();for(const s of e){if(s.hide(),d(this,G).isDeletedAnnotationElement(s.data.id)||t.has(s.data.id))continue;const i=this.deserialize(s);i&&(this.addOrRebuild(i),i.enableEditing())}}disable(){var i;_(this,_a,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);const t=new Map,e=new Map;for(const r of d(this,Be).values())if(r.disableEditing(),!!r.annotationElementId){if(r.serialize()!==null){t.set(r.annotationElementId,r);continue}else e.set(r.annotationElementId,r);(i=this.getEditableAnnotation(r.annotationElementId))==null||i.show(),r.remove()}if(d(this,Ws)){const r=d(this,Ws).getEditableAnnotations();for(const o of r){const{id:a}=o.data;if(d(this,G).isDeletedAnnotationElement(a))continue;let l=e.get(a);if(l){l.resetAnnotationElement(o),l.show(!1),o.show();continue}l=t.get(a),l&&(d(this,G).addChangedExistingAnnotation(l),l.renderAnnotationElement(o),l.show(!1)),o.show()}}v(this,re,Nh).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const r of d(es,gn).values())s.remove(`${r._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),_(this,_a,!1)}getEditableAnnotation(t){var e;return((e=d(this,Ws))==null?void 0:e.getEditableAnnotation(t))||null}setActiveEditor(t){d(this,G).getActive()!==t&&d(this,G).setActiveEditor(t)}enableTextSelection(){var t;if(this.div.tabIndex=-1,(t=d(this,be))!=null&&t.div&&!d(this,Ci)){_(this,Ci,new AbortController);const e=d(this,G).combinedSignal(d(this,Ci));d(this,be).div.addEventListener("pointerdown",v(this,re,z0).bind(this),{signal:e}),d(this,be).div.classList.add("highlighting")}}disableTextSelection(){var t;this.div.tabIndex=0,(t=d(this,be))!=null&&t.div&&d(this,Ci)&&(d(this,Ci).abort(),_(this,Ci,null),d(this,be).div.classList.remove("highlighting"))}enableClick(){if(d(this,un))return;_(this,un,new AbortController);const t=d(this,G).combinedSignal(d(this,un));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t}),this.div.addEventListener("pointerup",this.pointerup.bind(this),{signal:t})}disableClick(){var t;(t=d(this,un))==null||t.abort(),_(this,un,null)}attach(t){d(this,Be).set(t.id,t);const{annotationElementId:e}=t;e&&d(this,G).isDeletedAnnotationElement(e)&&d(this,G).removeDeletedAnnotationElement(t)}detach(t){var e;d(this,Be).delete(t.id),(e=d(this,Ur))==null||e.removePointerInTextLayer(t.contentDiv),!d(this,_a)&&t.annotationElementId&&d(this,G).addDeletedAnnotationElement(t)}remove(t){this.detach(t),d(this,G).removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1,d(this,ya)||this.addInkEditorIfNeeded(!1)}changeParent(t){var e;t.parent!==this&&(t.parent&&t.annotationElementId&&(d(this,G).addDeletedAnnotationElement(t.annotationElementId),pt.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),(e=t.parent)==null||e.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),d(this,G).addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(),d(this,G).addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){var s;if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!d(this,Ei)&&(t._focusEventsAllowed=!1,_(this,Ei,setTimeout(()=>{_(this,Ei,null),t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:d(this,G)._signal}),e.focus())},0))),t._structTreeParentId=(s=d(this,Ur))==null?void 0:s.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||(t.parent=this),t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),s=()=>{t.remove()};this.addCommands({cmd:e,undo:s,mustExec:!1})}getNextId(){return d(this,G).getId()}combinedSignal(t){return d(this,G).combinedSignal(t)}canCreateNewEmptyEditor(){var t;return(t=d(this,re,Lf))==null?void 0:t.canCreateNewEmptyEditor()}pasteEditor(t,e){d(this,G).updateToolbar(t),d(this,G).updateMode(t);const{offsetX:s,offsetY:i}=v(this,re,Rf).call(this),r=this.getNextId(),o=v(this,re,Pf).call(this,{parent:this,id:r,x:s,y:i,uiManager:d(this,G),isCentered:!0,...e});o&&this.add(o)}deserialize(t){var e;return((e=d(es,gn).get(t.annotationType??t.annotationEditorType))==null?void 0:e.deserialize(t,this,d(this,G)))||null}createAndAddNewEditor(t,e,s={}){const i=this.getNextId(),r=v(this,re,Pf).call(this,{parent:this,id:i,x:t.offsetX,y:t.offsetY,uiManager:d(this,G),isCentered:e,...s});return r&&this.add(r),r}addNewEditor(){this.createAndAddNewEditor(v(this,re,Rf).call(this),!0)}setSelected(t){d(this,G).setSelected(t)}toggleSelected(t){d(this,G).toggleSelected(t)}isSelected(t){return d(this,G).isSelected(t)}unselect(t){d(this,G).unselect(t)}pointerup(t){const{isMac:e}=Te.platform;if(!(t.button!==0||t.ctrlKey&&e)&&t.target===this.div&&d(this,fn)){if(_(this,fn,!1),!d(this,ba)){_(this,ba,!0);return}if(d(this,G).getMode()===ot.STAMP){d(this,G).unselectAll();return}this.createAndAddNewEditor(t,!1)}}pointerdown(t){if(d(this,G).getMode()===ot.HIGHLIGHT&&this.enableTextSelection(),d(this,fn)){_(this,fn,!1);return}const{isMac:e}=Te.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;_(this,fn,!0);const s=d(this,G).getActive();_(this,ba,!s||s.isEmpty())}findNewParent(t,e,s){const i=d(this,G).findParent(e,s);return i===null||i===this?!1:(i.changeParent(t),!0)}destroy(){var t,e;((t=d(this,G).getActive())==null?void 0:t.parent)===this&&(d(this,G).commitOrRemove(),d(this,G).setActiveEditor(null)),d(this,Ei)&&(clearTimeout(d(this,Ei)),_(this,Ei,null));for(const s of d(this,Be).values())(e=d(this,Ur))==null||e.removePointerInTextLayer(s.contentDiv),s.setParent(null),s.isAttachedToDOM=!1,s.div.remove();this.div=null,d(this,Be).clear(),d(this,G).removeLayer(this)}render({viewport:t}){this.viewport=t,Kr(this.div,t);for(const e of d(this,G).getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){d(this,G).commitOrRemove(),v(this,re,Nh).call(this);const e=this.viewport.rotation,s=t.rotation;if(this.viewport=t,Kr(this.div,{rotation:s}),e!==s)for(const i of d(this,Be).values())i.rotate(s);this.addInkEditorIfNeeded(!1)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return d(this,G).viewParameters.realScale}};Ur=new WeakMap,ba=new WeakMap,Ws=new WeakMap,un=new WeakMap,Ei=new WeakMap,Be=new WeakMap,fn=new WeakMap,ya=new WeakMap,_a=new WeakMap,be=new WeakMap,Ci=new WeakMap,G=new WeakMap,gn=new WeakMap,re=new WeakSet,z0=function(t){d(this,G).unselectAll();const{target:e}=t;if(e===d(this,be).div||e.classList.contains("endOfContent")&&d(this,be).div.contains(e)){const{isMac:s}=Te.platform;if(t.button!==0||t.ctrlKey&&s)return;d(this,G).showAllEditors("highlight",!0,!0),d(this,be).div.classList.add("free"),this.toggleDrawing(),Zh.startHighlighting(this,d(this,G).direction==="ltr",t),d(this,be).div.addEventListener("pointerup",()=>{d(this,be).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:d(this,G)._signal}),t.preventDefault()}},Lf=function(){return d(es,gn).get(d(this,G).getMode())},Pf=function(t){const e=d(this,re,Lf);return e?new e.prototype.constructor(t):null},Rf=function(){const{x:t,y:e,width:s,height:i}=this.div.getBoundingClientRect(),r=Math.max(0,t),o=Math.max(0,e),a=Math.min(window.innerWidth,t+s),l=Math.min(window.innerHeight,e+i),c=(r+a)/2-t,h=(o+l)/2-e,[u,f]=this.viewport.rotation%180===0?[c,h]:[h,c];return{offsetX:u,offsetY:f}},Nh=function(){_(this,ya,!0);for(const t of d(this,Be).values())t.isEmpty()&&t.remove();_(this,ya,!1)},T(es,"_initialized",!1),x(es,gn,new Map([of,mf,Ef,Zh].map(t=>[t._editorType,t])));let Tf=es;var js,Oc,Gt,pn,Fc,If,io,Of,$0;const ee=class ee{constructor({pageIndex:t}){x(this,io);x(this,js,null);x(this,Oc,0);x(this,Gt,new Map);x(this,pn,new Map);this.pageIndex=t}setParent(t){if(!d(this,js)){_(this,js,t);return}if(d(this,js)!==t){if(d(this,Gt).size>0)for(const e of d(this,Gt).values())e.remove(),t.append(e);_(this,js,t)}}static get _svgFactory(){return at(this,"_svgFactory",new lg)}highlight(t,e,s,i=!1){const r=xe(this,Oc)._++,o=v(this,io,Of).call(this,t.box);o.classList.add("highlight"),t.free&&o.classList.add("free");const a=ee._svgFactory.createElement("defs");o.append(a);const l=ee._svgFactory.createElement("path");a.append(l);const c=`path_p${this.pageIndex}_${r}`;l.setAttribute("id",c),l.setAttribute("d",t.toSVGPath()),i&&d(this,pn).set(r,l);const h=v(this,io,$0).call(this,a,c),u=ee._svgFactory.createElement("use");return o.append(u),o.setAttribute("fill",e),o.setAttribute("fill-opacity",s),u.setAttribute("href",`#${c}`),d(this,Gt).set(r,o),{id:r,clipPathId:`url(#${h})`}}highlightOutline(t){const e=xe(this,Oc)._++,s=v(this,io,Of).call(this,t.box);s.classList.add("highlightOutline");const i=ee._svgFactory.createElement("defs");s.append(i);const r=ee._svgFactory.createElement("path");i.append(r);const o=`path_p${this.pageIndex}_${e}`;r.setAttribute("id",o),r.setAttribute("d",t.toSVGPath()),r.setAttribute("vector-effect","non-scaling-stroke");let a;if(t.free){s.classList.add("free");const h=ee._svgFactory.createElement("mask");i.append(h),a=`mask_p${this.pageIndex}_${e}`,h.setAttribute("id",a),h.setAttribute("maskUnits","objectBoundingBox");const u=ee._svgFactory.createElement("rect");h.append(u),u.setAttribute("width","1"),u.setAttribute("height","1"),u.setAttribute("fill","white");const f=ee._svgFactory.createElement("use");h.append(f),f.setAttribute("href",`#${o}`),f.setAttribute("stroke","none"),f.setAttribute("fill","black"),f.setAttribute("fill-rule","nonzero"),f.classList.add("mask")}const l=ee._svgFactory.createElement("use");s.append(l),l.setAttribute("href",`#${o}`),a&&l.setAttribute("mask",`url(#${a})`);const c=l.cloneNode();return s.append(c),l.classList.add("mainOutline"),c.classList.add("secondaryOutline"),d(this,Gt).set(e,s),e}finalizeLine(t,e){const s=d(this,pn).get(t);d(this,pn).delete(t),this.updateBox(t,e.box),s.setAttribute("d",e.toSVGPath())}updateLine(t,e){d(this,Gt).get(t).firstChild.firstChild.setAttribute("d",e.toSVGPath())}removeFreeHighlight(t){this.remove(t),d(this,pn).delete(t)}updatePath(t,e){d(this,pn).get(t).setAttribute("d",e.toSVGPath())}updateBox(t,e){var s;v(s=ee,Fc,If).call(s,d(this,Gt).get(t),e)}show(t,e){d(this,Gt).get(t).classList.toggle("hidden",!e)}rotate(t,e){d(this,Gt).get(t).setAttribute("data-main-rotation",e)}changeColor(t,e){d(this,Gt).get(t).setAttribute("fill",e)}changeOpacity(t,e){d(this,Gt).get(t).setAttribute("fill-opacity",e)}addClass(t,e){d(this,Gt).get(t).classList.add(e)}removeClass(t,e){d(this,Gt).get(t).classList.remove(e)}remove(t){d(this,js)!==null&&(d(this,Gt).get(t).remove(),d(this,Gt).delete(t))}destroy(){_(this,js,null);for(const t of d(this,Gt).values())t.remove();d(this,Gt).clear()}};js=new WeakMap,Oc=new WeakMap,Gt=new WeakMap,pn=new WeakMap,Fc=new WeakSet,If=function(t,{x:e=0,y:s=0,width:i=1,height:r=1}={}){const{style:o}=t;o.top=`${100*s}%`,o.left=`${100*e}%`,o.width=`${100*i}%`,o.height=`${100*r}%`},io=new WeakSet,Of=function(t){var s;const e=ee._svgFactory.create(1,1,!0);return d(this,js).append(e),e.setAttribute("aria-hidden",!0),v(s=ee,Fc,If).call(s,e,t),e},$0=function(t,e){const s=ee._svgFactory.createElement("clipPath");t.append(s);const i=`clip_${e}`;s.setAttribute("id",i),s.setAttribute("clipPathUnits","objectBoundingBox");const r=ee._svgFactory.createElement("use");return s.append(r),r.setAttribute("href",`#${e}`),r.classList.add("clip"),i},x(ee,Fc);let Df=ee;J.AbortException;J.AnnotationEditorLayer;J.AnnotationEditorParamsType;J.AnnotationEditorType;J.AnnotationEditorUIManager;J.AnnotationLayer;J.AnnotationMode;J.CMapCompressionType;J.ColorPicker;J.DOMSVGFactory;J.DrawLayer;J.FeatureTest;var rA=J.GlobalWorkerOptions;J.ImageKind;J.InvalidPDFException;J.MissingPDFException;J.OPS;J.PDFDataRangeTransport;J.PDFDateString;J.PDFWorker;J.PasswordResponses;J.PermissionFlag;J.PixelsPerInch;J.RenderingCancelledException;J.TextLayer;J.UnexpectedResponseException;J.Util;J.VerbosityLevel;J.XfaLayer;J.build;J.createValidAbsoluteUrl;J.fetchData;var oA=J.getDocument;J.getFilenameFromUrl;J.getPdfFilenameFromUrl;J.getXfaPageViewport;J.isDataScheme;J.isPdfFile;J.noContextMenu;J.normalizeUnicode;J.setLayerDimensions;J.shadow;J.version;const aA="/blood-analyzer/assets/pdf.worker-eDZEDl3N.mjs";function Ft(n,t){const e=n.toLowerCase(),s=lA(t);if(e.includes("vitamin d")&&s.toLowerCase()==="ng/l"||e.includes("testosteron")&&s.toLowerCase()==="ng/l"||e.includes("feritin")&&s.toLowerCase()==="ng/l")return"µg/L";if((e.includes("kreatinin")||e.includes("železo"))&&s.toLowerCase()==="pmol/l")return"µmol/L";if(e.includes("ckd-epi")){const i=s.replace(/\s+/g,"").toLowerCase();if(i.startsWith("ml/min")||i.startsWith("mL/min".toLowerCase()))return"mL/min"}if(s.toLowerCase()==="10/l"){if(e.includes("eritrocit"))return"10^12/L";if(e.startsWith("k-"))return"10^9/L"}return s}function lA(n){let e=n.trim().replace(/\s+/g," ").replaceAll("μ","µ").replaceAll("°","^").replaceAll('"',"^").replaceAll("'","^").replace(/[|]/g,"/").replace(/[.:]+$/g,"").replace(/µ\s+([a-zA-Z])/g,"µ$1");e=e.replace(/\s*\/\s*/g,"/"),e=e.replace(/\s*\^\s*/g,"^"),e=e.replace(/\/+$/g,"");const s=e.replace(/\s+/g,"");if(/^(o|0)\/?l$/i.test(s)||/^ol$/i.test(s))return"g/L";if(/^(w|vv|v)\/?l$/i.test(s)||/^wl$/i.test(s)||/^10\^?$/i.test(s)||/^10\^?\d{1,2}$/i.test(s)||/^10\^?\d{1,2}\/?l$/i.test(s)||/^10\^?\d{1,2}\/?1$/i.test(s))return"10/L";const i=s.match(/^10(\d{1,2})\/L$/i);if(i)return`10^${i[1]}/L`;const r=e.match(/^10\s+(\d{1,2})\s*\/L$/i);return r?`10^${r[1]}/L`:/^ml\/min$/i.test(s)||/^ml\/min\/?1[.,]?73m2$/i.test(s)||/^ml\/min\/?1[.,]?73m\^?2$/i.test(s)||/^ml\/min\/?1[.,]?73m²$/i.test(s)?"mL/min":e}const cA=[["S-Lp(a)","S-Lipoprotein(a)"],["K-MCH","MCH"],["K-MCHC","MCHC"],["K-MCV","MCV"],["oGF (CKD-EPI)","OGF (CKD-EPI)","oGF(CKD-EPI)","OGF(CKD-EPI)"],["K-RDW","RDW"],["K-Bazofilci","Bazofilci"],["K-Eozinofilci","Eozinofilci"],["K-Neutrofili","Neutrofili"],["K-Limfociti","Limfociti"],["K-Monociti","Monociti"],["S-Kortizol","Kortizol"],["S-Testosteron","Testosteron"],["S-HDL-Holesterol","S-HDL holesterol","HDL-Holesterol"],["S-LDL-Holesterol","S-LDL holesterol"],["S-Vitamin D","Vitamin D"]];function Ff(n){return n.trim().replace(/\s+/g," ").toLowerCase()}const hA=(()=>{const n=new Map;for(const[t,...e]of cA){n.set(Ff(t),t);for(const s of e)n.set(Ff(s),t)}return n})();function Gr(n){const t=n.trim().replace(/\s+/g," ");return t&&(hA.get(Ff(t))??t)}const W0=["result","unit","ant. result","reference range","test:","test","meth.","method"],vo=new Set(["NEPH","CLIA","EIA","ELISA","HPLC","RIA","IA"]),dA=/^[a-zA-Z0-9^°"'µμ%/]+$/,cp=new Set(["do","pod","<","≤"]),hp=new Set(["nad",">","≥"]),uA=new Set(["fl","pg"]);function _e(n){const t=n.trim().replace(/\s+/g,"").replace(/[|.:]/g,"");if(!t||!dA.test(t))return!1;const e=t.toLowerCase();return uA.has(e)?!0:t.startsWith("/")&&!/[a-zA-Zµμ%]/.test(t)?!1:!!(t==="1"||/^(o|0)l$/i.test(t)||/^(w|vv|v)l$/i.test(t)||/^wl$/i.test(t)||t.includes("/")||t.includes("%")||t.includes("µ")||t.includes("μ")||t.includes("^")||t.includes("°")||t.includes('"')||t.includes("'"))}function vt(n){const t=n.replace(/\s/g,"").replace(",",".").replace(/^[<>]/,""),e=Number.parseFloat(t);return Number.isFinite(e)?e:null}function Pn(n,t){const e=t==null?void 0:t.low,s=t==null?void 0:t.high;if(s===void 0&&e===void 0)return n;const i=s===void 0||n<=s*20,r=e===void 0||n>=e/20;if(i&&r)return n;for(const o of[10,100,1e3]){const a=n/o,l=s===void 0||a<=s*1.25,c=e===void 0||a>=e*.8;if(l&&c)return a}return n}function Un(n){return/^\d+[\d.,]*\s*[\-–]\s*\d+[\d.,]*$/.test(n)}function Vs(n){return/^[<>]?\d+[\d.,]*$/.test(n)}function $i(n){const t=n.split(/\s+/).filter(Boolean);if(t.length===0)return null;let e,s;const i=[];for(const o of t)if(!o.includes(":")){if(o.length===1&&(o==="H"||o==="L")){s??(s=o);continue}if(!(o.startsWith("/")&&/[0-9,]/.test(o))&&!(/^m[2²]$/i.test(o)||/^m\^2$/i.test(o))&&!vo.has(o)){if(!e&&_e(o)){e=o;continue}i.push(o)}}const r=i.join(" ").trim();return r?{marker:r,unit:e?e.trim():void 0,flag:s}:null}function mg(n){return/^[A-Z]{1,3}\s*-/.test(n.trim())}function Ma(n){const t=n.trim();return mg(t)?!0:Gr(t)!==t}function Kd(n){return`${n.marker}__${n.unit??""}`}function fA(n){const t=n.trim().replace(/\s+/g," ");if(!t)return[];const e=/(?:^|\s)([A-Z]\s*-|oGF\b|OGF\b)/g,s=[];let i;for(;i=e.exec(t);){const l=i.index+i[0].length-i[1].length;s.push(l)}const r=Array.from(new Set(s)).sort((l,c)=>l-c);if(r.length===0)return[t];const o=[],a=r[0];if(a>0){const l=t.slice(0,a).trim();l&&o.push(l)}for(let l=0;l<r.length;l+=1){const c=r[l],h=l+1<r.length?r[l+1]:t.length,u=t.slice(c,h).trim();u&&o.push(u)}return o}function gA(n){const t=n.trim().replace(/[^\dA-Za-z]/g,"");if(!t)return null;const e=t.replace(/[Oo]/g,"0").replace(/[Il]/g,"1").replace(/[Ss]/g,"7");if(!/^\d{2,4}$/.test(e))return null;const s=e.length===2?[Number(e[0]),Number(e[1])]:e.length===3?[Number(e[0]),Number(e.slice(1))]:[Number(e.slice(0,2)),Number(e.slice(2))],[i,r]=s;return!Number.isFinite(i)||!Number.isFinite(r)||i>=r?null:{low:i,high:r}}function qc(n,t){return{low:n.low===void 0?void 0:n.low*t,high:n.high===void 0?void 0:n.high*t}}function Zd(n){if(!n.unit||n.value===void 0)return n;let t=n.value,e=n.range?{...n.range}:void 0,s=n.flag;if(e&&n.unit==="%"&&t>=100&&(e.high??0)>=100&&(t*=.1,e=qc(e,.1)),e&&n.unit==="mmol/L"&&t>=10&&e.high!==void 0&&e.high<=70&&(t*=.1,e=qc(e,.1)),(e==null?void 0:e.low)!==void 0&&e.low>0&&t<e.low/5)for(const i of[.1,.01]){const r=qc(e,i),o=r.low===void 0||t>=r.low*.8,a=r.high===void 0||t<=r.high*1.2;if(o&&a){e=r;break}}return e&&n.unit==="%"&&t<1&&e.high!==void 0&&e.high>=10&&(e=qc(e,.1)),!s&&e&&(e.high!==void 0&&t>e.high?s="H":e.low!==void 0&&t<e.low&&(s="L")),{...n,value:t,range:e,flag:s}}function pA(n,t){const e=t*2-n;return!Number.isFinite(e)||e<=0||e>=t?null:Math.round(e*100)/100}function As(n){const t=n.trim().replace(/^[-–—]+\s*/,"");if(/^(Stran|Page)\b/i.test(t)||/^Telefon:/i.test(t))return null;const e=(()=>{const f=t.replace(/\bza odrasle\b/gi,"").replace(/[|]+/g," ").replace(/\s+/g," ").trim();if(/\d\s*[\-–]\s*\d/.test(f))return f;const g=f.match(/^(.+?)\s+(\d+[\d.,]*)\s+(\d+[\d.,]*)\s+([a-zA-Z0-9^°"'µμ/%/]+)\s+([<>]?\d+[\d.,]*)(?:\s+([A-Z]{2,6}))?(?:\s+([HL]))?(?:\s+.*)?$/);if(!g)return f;const[,p,m,b,y,A,w,S]=g;return!Ma(p)||w&&!vo.has(w)||!_e(y)?f:`${p} ${m} - ${b} ${y} ${A}${S?` ${S}`:""}`})();if(e!==t){const f=As(e);if(f)return f}const s=t.match(/^(.+?)\s+(dopoldan|popoldan):(\d+[\d.,]*)-(\d+[\d.,]*)[|\s]+(.+?)\.?\s+([<>]?\d+[\d.,]*)(?:\s+([HL]))?$/i);if(s){const[,f,,g,p,m,b,y]=s,A=vt(b),w=vt(g),S=vt(p);if(A===null)return null;const E=$i(f),C=w!==null&&S!==null?{low:w,high:S}:void 0;return{marker:(E==null?void 0:E.marker)??f.trim(),value:Pn(A,C),unit:Ft(f,m),range:C,flag:(y==="H"||y==="L"?y:void 0)??(E==null?void 0:E.flag)}}const i=t.match(/^(.+?)\s+(do|pod|nad|<|>|≤|≥)\s*([<>]?\d+[\d.,]*)\s+(.+?)\s+([<>]?\d+[\d.,]*)(?:\s+([A-Z]{2,6}))?(?:\s+([HL]))?$/);if(i){const[,f,g,p,m,b,y,A]=i;if(y&&!vo.has(y))return null;const w=$i(f),S=(w==null?void 0:w.marker)??f.trim(),E=vt(b),C=vt(p);if(E===null||C===null)return null;const k=g.toLowerCase(),M=cp.has(k)||k==="<"?{high:C}:hp.has(k)||k===">"?{low:C}:void 0;return M?{marker:S,value:Pn(E,M),unit:Ft(S,m),range:M,flag:(A==="H"||A==="L"?A:void 0)??(w==null?void 0:w.flag)}:null}const r=t.match(/^(.+?)\s+([<>]?\d+[\d.,]*)\s+(.+?)\s+(do|pod|nad|<|>|≤|≥)\s*([<>]?\d+[\d.,]*)(?:\s+(.+?))?(?:\s+([A-Z]{2,6}))?(?:\s+([HL]))?$/);if(r){const[,f,g,p,m,b,,y,A]=r;if(y&&!vo.has(y))return null;const w=$i(f),S=(w==null?void 0:w.marker)??f.trim(),E=vt(g),C=vt(b);if(E===null||C===null)return null;const k=m.toLowerCase(),M=cp.has(k)||k==="<"?{high:C}:hp.has(k)||k===">"?{low:C}:void 0;return M?{marker:S,value:Pn(E,M),unit:Ft(S,p),range:M,flag:(A==="H"||A==="L"?A:void 0)??(w==null?void 0:w.flag)}:null}const o=t.match(/^(.+?)\s+(\d+[\d.,]*)\s*[\-–]\s*(\d+[\d.,]*)\s+(.+?)\s+([<>]?\d+[\d.,]*)(?:\s+([A-Z]{2,6}))?(?:\s+([HL]))?$/);if(o){const[,f,g,p,m,b,y,A]=o;if(!Ma(f)||y&&!vo.has(y))return null;const w=vt(b),S=vt(g),E=vt(p);if(w===null)return null;const C={low:S??void 0,high:E??void 0};return{marker:f.trim(),value:Pn(w,C),unit:Ft(f,m),range:C,flag:A==="H"||A==="L"?A:void 0}}const a=t.match(/^(.+?)\s+([<>]?\d+[\d.,]*)\s*([a-zA-Z0-9^°"'µμ/%/]+(?:\s+[a-zA-Z0-9^°"'µμ/%/]+)?)?\s+(\d+[\d.,]*)\s*[\-–]\s*(\d+[\d.,]*)(?:\s+([A-Z]{2,6}))?(?:\s+([HL]))?$/);if(a){const[,f,g,p,m,b,y,A]=a;if(y&&!vo.has(y))return null;const w=$i(f),S=(w==null?void 0:w.marker)??f.trim(),E=vt(g),C=vt(m),k=vt(b);if(E===null)return null;const M={low:C??void 0,high:k??void 0};return{marker:S,value:Pn(E,M),unit:p?Ft(S,p):void 0,range:M,flag:(A==="H"||A==="L"?A:void 0)??(w==null?void 0:w.flag)}}const l=t.match(/^(.+?)\s+([a-zA-Z0-9]+)\s+([a-zA-Z0-9^°"'µμ/%/]+)\s+([<>]?\d+[\d.,]*)(?:\s+([HL]))?$/);if(l){const[,f,g,p,m,b]=l;if(Ma(f)&&/[a-zA-Z]/.test(g)&&!_e(g)&&_e(p)){const y=gA(g),A=vt(m);if(y&&A!==null)return{marker:f.trim(),value:Pn(A,y),unit:Ft(f,p),range:y,flag:b==="H"||b==="L"?b:void 0}}}const c=t.match(/^(.+?)\s+([<>]?\d+[\d.,]*)\s+([a-zA-Z0-9^°"'µμ/%/]+)\s+([<>]?\d+[\d.,]*)(?:\s+([HL]))?$/);if(c){const[,f,g,p,m,b]=c;if(!Ma(f)||!_e(p))return null;const y=vt(g),A=vt(m);if(y===null||A===null)return null;const w=y<=A?{low:y}:{high:y},S=$i(f),E=(S==null?void 0:S.marker)??f.trim();return{marker:E,value:Pn(A,w),unit:Ft(E,p),range:w,flag:(b==="H"||b==="L"?b:void 0)??(S==null?void 0:S.flag)}}const h=t.match(/^(.+?)\s+([a-zA-Z0-9^°"'µμ/%/]+)\s+([<>]?\d+[\d.,]*)(?:\s+([HL]))?$/);if(h){const[,f,g,p,m]=h;if(!Ma(f)||!_e(g)||/\s\d+[\d.,]*$/.test(f))return null;const b=vt(p);if(b===null)return null;const y=$i(f),A=(y==null?void 0:y.marker)??f.trim();return{marker:A,value:b,unit:Ft(A,g),flag:(m==="H"||m==="L"?m:void 0)??(y==null?void 0:y.flag)}}const u=t.match(/^(.+?)\s+([<>]?\d+[\d.,]*)\s*([a-zA-Z0-9^°"'µμ/%/]+(?:\s+[a-zA-Z0-9^°"'µμ/%/]+)?)?$/);if(u){const[,f,g,p]=u,m=mg(f);if(!p&&!m||p&&!_e(p)&&!m)return null;const b=vt(g);if(b===null)return null;const y=$i(f);return{marker:(y==null?void 0:y.marker)??f.trim(),value:b,unit:p?Ft(f,p):void 0,flag:y==null?void 0:y.flag}}return null}function mA(n){const t=[],e=[];let s=0;for(;s<n.length&&!Vs(n[s]);){const r=n[s];r&&!Un(r)&&!_e(r)&&t.push(r),s+=1}let i=0;for(;s+2<n.length&&i<t.length;){const r=n[s],o=n[s+1],a=n[s+2];if(!Vs(r)||!_e(o)||!Un(a))break;const l=vt(r),c=a.match(/^(\d+[\d.,]*)\s*[\-–]\s*(\d+[\d.,]*)$/);l!==null&&c&&e.push({marker:t[i].trim(),value:l,unit:Ft(t[i],o),range:{low:vt(c[1])??void 0,high:vt(c[2])??void 0}}),i+=1,s+=3}return e}function bA(n){const t=[];for(let e=0;e<n.length-1;e+=1){const s=n[e];if(!s||s.includes(":")||W0.includes(s.toLowerCase())||Vs(s)||Un(s))continue;const i=$i(s);if(!i||!i.unit)continue;const r=n.findIndex((c,h)=>h>e&&Vs(c));if(r===-1||r-e>2)continue;const o=vt(n[r]);if(o===null)continue;const a=n[r+1],l=a==null?void 0:a.match(/^(\d+[\d.,]*)\s*[\-–]\s*(\d+[\d.,]*)$/);t.push({marker:i.marker,value:o,unit:i.unit?Ft(i.marker,i.unit):void 0,range:l?{low:vt(l[1])??void 0,high:vt(l[2])??void 0}:void 0})}return t}function yA(n){const t=n.filter(s=>{const i=s.toLowerCase();return!(!s||W0.includes(i))}),e=mA(t);return e.length?e:bA(t)}function _A(n){const t=n.findIndex(o=>o.toLowerCase().trim()==="test:"||o.toLowerCase().trim()==="test"),e=n.findIndex(o=>o.toLowerCase().includes("reference range")),s=t!==-1?t:e;if(s===-1)return[];let i=n.length;const r=["meth.","method","final report","page:","exit date"];for(let o=s+1;o<n.length;o+=1){const a=n[o].toLowerCase();if(r.some(l=>a.includes(l))){i=o;break}}return n.slice(s+1,Math.min(i,s+80))}function xs(n){return n.replace(/[|]+/g," ").replace(/\s+/g," ").trim()}function vA(n){const t=xs(n).match(/^(do|pod|nad|<|>|≤|≥)\s*([<>]?\d+[\d.,]*)$/i);if(!t)return null;const e=vt(t[2]);return e===null?null:{keyword:t[1].toLowerCase(),limit:e}}function Rn(n){const t=xs(n);return!t||t.includes(":")||/[0-9]/.test(t)||_e(t)||/^(Stran|Page)\b/i.test(t)||/^Telefon\b/i.test(t)?!1:mg(t)||/^oGF\b/i.test(t)||/^OGF\b/i.test(t)}function AA(n){var s;const t=[],e=new Set;for(let i=0;i<n.length;i+=1){if(e.has(i))continue;const r=xs(n[i]),o=i+1<n.length?xs(n[i+1]):"",a=i+2<n.length?xs(n[i+2]):"",l=i+3<n.length?xs(n[i+3]):"";i+4<n.length&&xs(n[i+4]);const c=r.replace(/[.,]+$/g,"");if(Un(c)&&o){const f=c.match(/^(\d+[\d.,]*)\s*[\-–]\s*(\d+[\d.,]*)$/),g=f?vt(f[1]):null,p=f?vt(f[2]):null;if(g!==null&&p!==null){const m=As(o);if(m&&!m.range){t.push({...m,range:{low:g,high:p}}),e.add(i),e.add(i+1);continue}}}if(o.match(/^(\d+)\s*[\-–]$/)){const f=As(r),g=((s=f==null?void 0:f.range)==null?void 0:s.high)!==void 0?pA(f.range.high,f.value):null;if(f&&f.range&&f.range.low===void 0&&g!==null){t.push({...f,range:{...f.range,low:g}}),e.add(i),e.add(i+1);continue}}if(Rn(r)&&Un(o)&&_e(a)&&Vs(l)){const f=Ft(r,a),g=`${r} ${l} ${f} ${o}`,p=As(g);if(p){t.push(p),e.add(i),e.add(i+1),e.add(i+2),e.add(i+3);continue}}if(Un(r)&&_e(o)){const f=Rn(a)?i+2:Rn(l)?i+3:-1,g=f!==-1&&f+1<n.length&&Vs(xs(n[f+1]))?f+1:-1;if(f!==-1&&g!==-1){const p=xs(n[f]),m=xs(n[g]),b=Ft(p,o),y=`${p} ${m} ${b} ${r}`,A=As(y);if(A){t.push(A);for(let w=i;w<=g;w+=1)e.add(w);continue}}}const u=vA(o);if(Rn(r)&&u&&_e(a)&&Vs(l)){const f=Ft(r,a),g=`${r} ${l} ${f} ${u.keyword} ${u.limit}`,p=As(g);if(p){t.push(p),e.add(i),e.add(i+1),e.add(i+2),e.add(i+3);continue}}if(Rn(r)&&_e(o)&&Vs(a)){const f=Ft(r,o),g=`${r} ${a} ${f}`,p=As(g);if(p){t.push(p),e.add(i),e.add(i+1),e.add(i+2);continue}}if(Rn(r)&&/^(dopoldan|popoldan):/i.test(o)&&Vs(a)){const f=`${r} ${o} ${a}`,g=As(f);g&&(t.push(g),e.add(i),e.add(i+1),e.add(i+2))}if(Rn(r)&&Un(o)&&Vs(a)&&_e(l)){const f=Ft(r,l),g=`${r} ${a} ${f} ${o}`,p=As(g);p&&(t.push(p),e.add(i),e.add(i+1),e.add(i+2),e.add(i+3))}}return{markers:t,consumed:e}}function Nf(n){const t=[],e=new Set,s=_A(n);if(s.length)for(const r of yA(s)){const o=Gr(r.marker),a=r.unit?Ft(o,r.unit):void 0,l=Zd({...r,marker:o,unit:a}),c=Kd(l);e.has(c)||(t.push(l),e.add(c))}const i=AA(n);for(const r of i.markers){const o=Gr(r.marker),a=r.unit?Ft(o,r.unit):void 0,l=Zd({...r,marker:o,unit:a}),c=Kd(l);e.has(c)||(t.push(l),e.add(c))}for(let r=0;r<n.length;r+=1){if(i.consumed.has(r))continue;const o=n[r],a=fA(o);for(const l of a){const c=As(l);if(!c)continue;const h=Gr(c.marker),u=c.unit?Ft(h,c.unit):void 0,f=Zd({...c,marker:h,unit:u}),g=Kd(f);e.has(g)||(t.push(f),e.add(g))}}return t}const xA=2.4;function wA(n){const t=[];for(const e of n){const s=e.transform[4],i=e.transform[5],r=t.find(o=>Math.abs(o.y-i)<xA);r?(r.items.push({x:s,str:e.str}),r.y=(r.y+i)/2):t.push({y:i,items:[{x:s,str:e.str}]})}return t.sort((e,s)=>s.y-e.y).map(e=>e.items.sort((s,i)=>s.x-i.x).map(s=>s.str).join(" ").replace(/\s+/g," ").trim()).filter(Boolean)}const j0="blood-results-pdf-passwords";function SA(n){if(!n)return[];try{const t=JSON.parse(n);return Array.isArray(t)?t.filter(e=>typeof e=="string").map(e=>e.trim()).filter(Boolean):[]}catch{return[]}}function EA(n){return JSON.stringify(n)}function CA(n,t){const e=t.trim();return e?[e,...n.filter(i=>i!==e)].slice(0,20):n}function V0(){return SA(localStorage.getItem(j0))}function kA(n){const t=V0(),e=CA(t,n);localStorage.setItem(j0,EA(e))}function MA(){const n=new Date,t=n.getFullYear(),e=String(n.getMonth()+1).padStart(2,"0"),s=String(n.getDate()).padStart(2,"0");return`${t}-${e}-${s}`}function Jh(n,t,e){if(!Number.isInteger(n)||!Number.isInteger(t)||!Number.isInteger(e)||n<1900||n>2100||t<1||t>12||e<1||e>31)return!1;const s=new Date(Date.UTC(n,t-1,e));return s.getUTCFullYear()===n&&s.getUTCMonth()===t-1&&s.getUTCDate()===e}function Qh(n,t,e){return`${n}-${String(t).padStart(2,"0")}-${String(e).padStart(2,"0")}`}function TA(n){const t=n.match(new RegExp("(?<!\\d)(20\\d{2})(\\d{2})(\\d{2})(?!\\d)"));if(t){const s=Number(t[1]),i=Number(t[2]),r=Number(t[3]);if(Jh(s,i,r))return Qh(s,i,r)}const e=n.match(new RegExp("(?<!\\d)(20\\d{2})[._-](\\d{2})[._-](\\d{2})(?!\\d)"));if(e){const s=Number(e[1]),i=Number(e[2]),r=Number(e[3]);if(Jh(s,i,r))return Qh(s,i,r)}return null}function LA(n){const t=[],e=n.match(/\b(\d{1,2})[./-](\d{1,2})[./-](\d{4})\b/g)??[];for(const i of e){const r=i.match(/\b(\d{1,2})[./-](\d{1,2})[./-](\d{4})\b/);if(!r)continue;const o=Number(r[1]),a=Number(r[2]),l=Number(r[3]);Jh(l,a,o)&&t.push(Qh(l,a,o))}const s=n.match(/\b(\d{4})[./-](\d{1,2})[./-](\d{1,2})\b/g)??[];for(const i of s){const r=i.match(/\b(\d{4})[./-](\d{1,2})[./-](\d{1,2})\b/);if(!r)continue;const o=Number(r[1]),a=Number(r[2]),l=Number(r[3]);Jh(o,a,l)&&t.push(Qh(o,a,l))}return t}function PA(n){const t=n.toLowerCase().replace(/\s+/g,"");return t.includes("datumroj")||t.includes("datumroj.")||t.includes("roj.")||t.includes("roj:")?-100:t.includes("odvzema")||t.includes("odvzem")?100:t.includes("sprejema")||t.includes("sprejem")?80:t.includes("zaklj")||t.includes("izpisa")||t.includes("izpis")?30:10}function RA(n){const t=[];for(const e of n){const s=LA(e);if(s.length===0)continue;const i=PA(e);if(!(i<0))for(const r of s)t.push({date:r,score:i})}return t.length===0?null:(t.sort((e,s)=>s.score-e.score),t[0].date)}function U0(n,t){const e=RA(t),s=TA(n);return e??s??MA()}rA.workerSrc=aA;async function DA(n){const t=await n.arrayBuffer(),e=V0(),s=e[0],i=new Set;let r=0,o=null;s&&(i.add(s),o=s,r=1);const a=oA({data:t,password:s});a.onPassword=(f,g)=>{for(;r<e.length;){const b=e[r];if(r+=1,!(!b||i.has(b))){i.add(b),o=b,f(b);return}}const p=g===1?"This PDF is password-protected.":"Incorrect password, try again.",m=window.prompt(`${p}
Enter password:`,o??"");m?(i.add(m),o=m,f(m)):a.destroy()};const l=await a.promise;o&&kA(o);const c=[];for(let f=1;f<=l.numPages;f+=1){const m=(await(await l.getPage(f)).getTextContent()).items.filter(b=>"str"in b);c.push(...wA(m))}const h=U0(n.name,c),u=Nf(c).map(f=>({...f,date:h,sourceFile:n.name}));return{id:`${n.name}-${Date.now()}`,date:h,sourceFile:n.name,markers:u}}function IA(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var OA={exports:{}};(function(n){var t=function(e){var s=Object.prototype,i=s.hasOwnProperty,r=Object.defineProperty||function(L,P,I){L[P]=I.value},o,a=typeof Symbol=="function"?Symbol:{},l=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",h=a.toStringTag||"@@toStringTag";function u(L,P,I){return Object.defineProperty(L,P,{value:I,enumerable:!0,configurable:!0,writable:!0}),L[P]}try{u({},"")}catch{u=function(P,I,$){return P[I]=$}}function f(L,P,I,$){var z=P&&P.prototype instanceof w?P:w,q=Object.create(z.prototype),gt=new Y($||[]);return r(q,"_invoke",{value:j(L,I,gt)}),q}e.wrap=f;function g(L,P,I){try{return{type:"normal",arg:L.call(P,I)}}catch($){return{type:"throw",arg:$}}}var p="suspendedStart",m="suspendedYield",b="executing",y="completed",A={};function w(){}function S(){}function E(){}var C={};u(C,l,function(){return this});var k=Object.getPrototypeOf,M=k&&k(k(D([])));M&&M!==s&&i.call(M,l)&&(C=M);var R=E.prototype=w.prototype=Object.create(C);S.prototype=E,r(R,"constructor",{value:E,configurable:!0}),r(E,"constructor",{value:S,configurable:!0}),S.displayName=u(E,h,"GeneratorFunction");function N(L){["next","throw","return"].forEach(function(P){u(L,P,function(I){return this._invoke(P,I)})})}e.isGeneratorFunction=function(L){var P=typeof L=="function"&&L.constructor;return P?P===S||(P.displayName||P.name)==="GeneratorFunction":!1},e.mark=function(L){return Object.setPrototypeOf?Object.setPrototypeOf(L,E):(L.__proto__=E,u(L,h,"GeneratorFunction")),L.prototype=Object.create(R),L},e.awrap=function(L){return{__await:L}};function O(L,P){function I(q,gt,dt,ct){var Et=g(L[q],L,gt);if(Et.type==="throw")ct(Et.arg);else{var co=Et.arg,Sa=co.value;return Sa&&typeof Sa=="object"&&i.call(Sa,"__await")?P.resolve(Sa.__await).then(function(Ln){I("next",Ln,dt,ct)},function(Ln){I("throw",Ln,dt,ct)}):P.resolve(Sa).then(function(Ln){co.value=Ln,dt(co)},function(Ln){return I("throw",Ln,dt,ct)})}}var $;function z(q,gt){function dt(){return new P(function(ct,Et){I(q,gt,ct,Et)})}return $=$?$.then(dt,dt):dt()}r(this,"_invoke",{value:z})}N(O.prototype),u(O.prototype,c,function(){return this}),e.AsyncIterator=O,e.async=function(L,P,I,$,z){z===void 0&&(z=Promise);var q=new O(f(L,P,I,$),z);return e.isGeneratorFunction(P)?q:q.next().then(function(gt){return gt.done?gt.value:q.next()})};function j(L,P,I){var $=p;return function(q,gt){if($===b)throw new Error("Generator is already running");if($===y){if(q==="throw")throw gt;return F()}for(I.method=q,I.arg=gt;;){var dt=I.delegate;if(dt){var ct=X(dt,I);if(ct){if(ct===A)continue;return ct}}if(I.method==="next")I.sent=I._sent=I.arg;else if(I.method==="throw"){if($===p)throw $=y,I.arg;I.dispatchException(I.arg)}else I.method==="return"&&I.abrupt("return",I.arg);$=b;var Et=g(L,P,I);if(Et.type==="normal"){if($=I.done?y:m,Et.arg===A)continue;return{value:Et.arg,done:I.done}}else Et.type==="throw"&&($=y,I.method="throw",I.arg=Et.arg)}}}function X(L,P){var I=P.method,$=L.iterator[I];if($===o)return P.delegate=null,I==="throw"&&L.iterator.return&&(P.method="return",P.arg=o,X(L,P),P.method==="throw")||I!=="return"&&(P.method="throw",P.arg=new TypeError("The iterator does not provide a '"+I+"' method")),A;var z=g($,L.iterator,P.arg);if(z.type==="throw")return P.method="throw",P.arg=z.arg,P.delegate=null,A;var q=z.arg;if(!q)return P.method="throw",P.arg=new TypeError("iterator result is not an object"),P.delegate=null,A;if(q.done)P[L.resultName]=q.value,P.next=L.nextLoc,P.method!=="return"&&(P.method="next",P.arg=o);else return q;return P.delegate=null,A}N(R),u(R,h,"Generator"),u(R,l,function(){return this}),u(R,"toString",function(){return"[object Generator]"});function Q(L){var P={tryLoc:L[0]};1 in L&&(P.catchLoc=L[1]),2 in L&&(P.finallyLoc=L[2],P.afterLoc=L[3]),this.tryEntries.push(P)}function U(L){var P=L.completion||{};P.type="normal",delete P.arg,L.completion=P}function Y(L){this.tryEntries=[{tryLoc:"root"}],L.forEach(Q,this),this.reset(!0)}e.keys=function(L){var P=Object(L),I=[];for(var $ in P)I.push($);return I.reverse(),function z(){for(;I.length;){var q=I.pop();if(q in P)return z.value=q,z.done=!1,z}return z.done=!0,z}};function D(L){if(L){var P=L[l];if(P)return P.call(L);if(typeof L.next=="function")return L;if(!isNaN(L.length)){var I=-1,$=function z(){for(;++I<L.length;)if(i.call(L,I))return z.value=L[I],z.done=!1,z;return z.value=o,z.done=!0,z};return $.next=$}}return{next:F}}e.values=D;function F(){return{value:o,done:!0}}return Y.prototype={constructor:Y,reset:function(L){if(this.prev=0,this.next=0,this.sent=this._sent=o,this.done=!1,this.delegate=null,this.method="next",this.arg=o,this.tryEntries.forEach(U),!L)for(var P in this)P.charAt(0)==="t"&&i.call(this,P)&&!isNaN(+P.slice(1))&&(this[P]=o)},stop:function(){this.done=!0;var L=this.tryEntries[0],P=L.completion;if(P.type==="throw")throw P.arg;return this.rval},dispatchException:function(L){if(this.done)throw L;var P=this;function I(ct,Et){return q.type="throw",q.arg=L,P.next=ct,Et&&(P.method="next",P.arg=o),!!Et}for(var $=this.tryEntries.length-1;$>=0;--$){var z=this.tryEntries[$],q=z.completion;if(z.tryLoc==="root")return I("end");if(z.tryLoc<=this.prev){var gt=i.call(z,"catchLoc"),dt=i.call(z,"finallyLoc");if(gt&&dt){if(this.prev<z.catchLoc)return I(z.catchLoc,!0);if(this.prev<z.finallyLoc)return I(z.finallyLoc)}else if(gt){if(this.prev<z.catchLoc)return I(z.catchLoc,!0)}else if(dt){if(this.prev<z.finallyLoc)return I(z.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(L,P){for(var I=this.tryEntries.length-1;I>=0;--I){var $=this.tryEntries[I];if($.tryLoc<=this.prev&&i.call($,"finallyLoc")&&this.prev<$.finallyLoc){var z=$;break}}z&&(L==="break"||L==="continue")&&z.tryLoc<=P&&P<=z.finallyLoc&&(z=null);var q=z?z.completion:{};return q.type=L,q.arg=P,z?(this.method="next",this.next=z.finallyLoc,A):this.complete(q)},complete:function(L,P){if(L.type==="throw")throw L.arg;return L.type==="break"||L.type==="continue"?this.next=L.arg:L.type==="return"?(this.rval=this.arg=L.arg,this.method="return",this.next="end"):L.type==="normal"&&P&&(this.next=P),A},finish:function(L){for(var P=this.tryEntries.length-1;P>=0;--P){var I=this.tryEntries[P];if(I.finallyLoc===L)return this.complete(I.completion,I.afterLoc),U(I),A}},catch:function(L){for(var P=this.tryEntries.length-1;P>=0;--P){var I=this.tryEntries[P];if(I.tryLoc===L){var $=I.completion;if($.type==="throw"){var z=$.arg;U(I)}return z}}throw new Error("illegal catch attempt")},delegateYield:function(L,P,I){return this.delegate={iterator:D(L),resultName:P,nextLoc:I},this.method==="next"&&(this.arg=o),A}},e}(n.exports);try{regeneratorRuntime=t}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}})(OA);var bg=(n,t)=>`${n}-${t}-${Math.random().toString(16).slice(3,8)}`;const FA=bg;let dp=0;var G0=({id:n,action:t,payload:e={}})=>{let s=n;return typeof s>"u"&&(s=FA("Job",dp),dp+=1),{id:s,action:t,payload:e}},wa={};let yg=!1;wa.logging=yg;wa.setLogging=n=>{yg=n};wa.log=(...n)=>yg?console.log.apply(void 0,n):null;const NA=G0,{log:Kc}=wa,HA=bg;let up=0;var BA=()=>{const n=HA("Scheduler",up),t={},e={};let s=[];up+=1;const i=()=>s.length,r=()=>Object.keys(t).length,o=()=>{if(s.length!==0){const u=Object.keys(t);for(let f=0;f<u.length;f+=1)if(typeof e[u[f]]>"u"){s[0](t[u[f]]);break}}},a=(u,f)=>new Promise((g,p)=>{const m=NA({action:u,payload:f});s.push(async b=>{s.shift(),e[b.id]=m;try{g(await b[u].apply(void 0,[...f,m.id]))}catch(y){p(y)}finally{delete e[b.id],o()}}),Kc(`[${n}]: Add ${m.id} to JobQueue`),Kc(`[${n}]: JobQueue length=${s.length}`),o()});return{addWorker:u=>(t[u.id]=u,Kc(`[${n}]: Add ${u.id}`),Kc(`[${n}]: Number of workers=${r()}`),o(),u.id),addJob:async(u,...f)=>{if(r()===0)throw Error(`[${n}]: You need to have at least one worker before adding jobs`);return a(u,f)},terminate:async()=>{Object.keys(t).forEach(async u=>{await t[u].terminate()}),s=[]},getQueueLen:i,getNumWorkers:r}};function zA(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var $A=n=>{const t={};return typeof WorkerGlobalScope<"u"?t.type="webworker":typeof document=="object"?t.type="browser":typeof process=="object"&&typeof zA=="function"&&(t.type="node"),typeof n>"u"?t:t[n]};const WA=$A("type")==="browser",jA=WA?n=>new URL(n,window.location.href).href:n=>n;var VA=n=>{const t={...n};return["corePath","workerPath","langPath"].forEach(e=>{n[e]&&(t[e]=jA(t[e]))}),t},X0={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3};const UA="7.0.0",GA={version:UA};var XA={workerBlobURL:!0,logger:()=>{}};const YA=GA.version,qA=XA;var KA={...qA,workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${YA}/dist/worker.min.js`},ZA=({workerPath:n,workerBlobURL:t})=>{let e;if(Blob&&URL&&t){const s=new Blob([`importScripts("${n}");`],{type:"application/javascript"});e=new Worker(URL.createObjectURL(s))}else e=new Worker(n);return e},JA=n=>{n.terminate()},QA=(n,t)=>{n.onmessage=({data:e})=>{t(e)}},tx=async(n,t)=>{n.postMessage(t)};const Jd=n=>new Promise((t,e)=>{const s=new FileReader;s.onload=()=>{t(s.result)},s.onerror=({target:{error:{code:i}}})=>{e(Error(`File could not be read! Code=${i}`))},s.readAsArrayBuffer(n)}),Hf=async n=>{let t=n;if(typeof n>"u")return"undefined";if(typeof n=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(n)?t=atob(n.split(",")[1]).split("").map(e=>e.charCodeAt(0)):t=await(await fetch(n)).arrayBuffer();else if(typeof HTMLElement<"u"&&n instanceof HTMLElement)n.tagName==="IMG"&&(t=await Hf(n.src)),n.tagName==="VIDEO"&&(t=await Hf(n.poster)),n.tagName==="CANVAS"&&await new Promise(e=>{n.toBlob(async s=>{t=await Jd(s),e()})});else if(typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas){const e=await n.convertToBlob();t=await Jd(e)}else(n instanceof File||n instanceof Blob)&&(t=await Jd(n));return new Uint8Array(t)};var ex=Hf;const sx=KA,ix=ZA,nx=JA,rx=QA,ox=tx,ax=ex;var lx={defaultOptions:sx,spawnWorker:ix,terminateWorker:nx,onMessage:rx,send:ox,loadImage:ax};const cx=VA,_s=G0,{log:fp}=wa,hx=bg,Dn=X0,{defaultOptions:dx,spawnWorker:ux,terminateWorker:fx,onMessage:gx,loadImage:gp,send:px}=lx;let pp=0;var Y0=async(n="eng",t=Dn.LSTM_ONLY,e={},s={})=>{const i=hx("Worker",pp),{logger:r,errorHandler:o,...a}=cx({...dx,...e}),l={},c=typeof n=="string"?n.split("+"):n;let h=t,u=s;const f=[Dn.DEFAULT,Dn.LSTM_ONLY].includes(t)&&!a.legacyCore;let g,p;const m=new Promise((D,F)=>{p=D,g=F}),b=D=>{g(D.message)};let y=ux(a);y.onerror=b,pp+=1;const A=({id:D,action:F,payload:L})=>new Promise((P,I)=>{fp(`[${i}]: Start ${D}, action=${F}`);const $=`${F}-${D}`;l[$]={resolve:P,reject:I},px(y,{workerId:i,jobId:D,action:F,payload:L})}),w=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),S=D=>A(_s({id:D,action:"load",payload:{options:{lstmOnly:f,corePath:a.corePath,logging:a.logging}}})),E=(D,F,L)=>A(_s({id:L,action:"FS",payload:{method:"writeFile",args:[D,F]}})),C=(D,F)=>A(_s({id:F,action:"FS",payload:{method:"readFile",args:[D,{encoding:"utf8"}]}})),k=(D,F)=>A(_s({id:F,action:"FS",payload:{method:"unlink",args:[D]}})),M=(D,F,L)=>A(_s({id:L,action:"FS",payload:{method:D,args:F}})),R=(D,F)=>A(_s({id:F,action:"loadLanguage",payload:{langs:D,options:{langPath:a.langPath,dataPath:a.dataPath,cachePath:a.cachePath,cacheMethod:a.cacheMethod,gzip:a.gzip,lstmOnly:[Dn.DEFAULT,Dn.LSTM_ONLY].includes(h)&&!a.legacyLang}}})),N=(D,F,L,P)=>A(_s({id:P,action:"initialize",payload:{langs:D,oem:F,config:L}})),O=(D="eng",F,L,P)=>{if(f&&[Dn.TESSERACT_ONLY,Dn.TESSERACT_LSTM_COMBINED].includes(F))throw Error("Legacy model requested but code missing.");const I=F||h;h=I;const $=L||u;u=$;const q=(typeof D=="string"?D.split("+"):D).filter(gt=>!c.includes(gt));return c.push(...q),q.length>0?R(q,P).then(()=>N(D,I,$,P)):N(D,I,$,P)},j=(D={},F)=>A(_s({id:F,action:"setParameters",payload:{params:D}})),X=async(D,F={},L={text:!0},P)=>A(_s({id:P,action:"recognize",payload:{image:await gp(D),options:F,output:L}})),Q=async(D,F)=>{if(f)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return A(_s({id:F,action:"detect",payload:{image:await gp(D)}}))},U=async()=>(y!==null&&(fx(y),y=null),Promise.resolve());gx(y,({workerId:D,jobId:F,status:L,action:P,data:I})=>{const $=`${P}-${F}`;if(L==="resolve")fp(`[${D}]: Complete ${F}`),l[$].resolve({jobId:F,data:I}),delete l[$];else if(L==="reject")if(l[$].reject(I),delete l[$],P==="load"&&g(I),o)o(I);else throw Error(I);else L==="progress"&&r({...I,userJobId:F})});const Y={id:i,worker:y,load:w,writeText:E,readText:C,removeFile:k,FS:M,reinitialize:O,setParameters:j,recognize:X,detect:Q,terminate:U};return S().then(()=>R(n)).then(()=>N(n,t,s)).then(()=>p(Y)).catch(()=>{}),m};const q0=Y0,mx=async(n,t,e)=>{const s=await q0(t,1,e);return s.recognize(n).finally(async()=>{await s.terminate()})},bx=async(n,t)=>{const e=await q0("osd",0,t);return e.detect(n).finally(async()=>{await e.terminate()})};var yx={recognize:mx,detect:bx},_x={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"},vx={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"};const Ax=BA,xx=Y0,wx=yx,Sx=_x,Ex=X0,Cx=vx,{setLogging:kx}=wa;var Mx={languages:Sx,OEM:Ex,PSM:Cx,createScheduler:Ax,createWorker:xx,setLogging:kx,...wx};const Qd=IA(Mx),Tx="/blood-analyzer/assets/worker.min-32WLk7pY.js",Lx="/blood-analyzer/assets/tesseract-core-lstm.wasm-DhgzXyTR.js";function K0(n){if(n.length===0)return 0;const t=[...n].sort((s,i)=>s-i),e=Math.floor(t.length/2);return t.length%2===1?t[e]:(t[e-1]+t[e])/2}function Bf(n,t){const e=[];for(const s of n){const i=e.find(r=>Math.abs(r.y-s.y)<t);i?(i.items.push({x:s.x,text:s.text}),i.y=(i.y+s.y)/2):e.push({y:s.y,items:[{x:s.x,text:s.text}]})}return e}function Z0(n){const t=[];let e=!1;for(const s of n.split(/\r?\n/)){const i=s.split("	");if(i.length<12)continue;const[r,o,a,l,c,,h,u,,f,,g]=i;if(r!=="5"||!g)continue;const p=Number(h),m=Number(u),b=Number(f);if(!Number.isFinite(p)||!Number.isFinite(m)||!Number.isFinite(b))continue;const y=[o,a,l,c].every(A=>/^\d+$/.test(A))?`${o}-${a}-${l}-${c}`:void 0;y&&(e=!0),t.push({x:p,y:m,height:b,text:g,lineId:y})}return{words:t,hasLineIds:e}}function zf(n){return n.sort((t,e)=>t.y-e.y).map(t=>t.items.sort((e,s)=>e.x-s.x).map(e=>e.text).join(" ").replace(/\s+/g," ").trim()).filter(t=>t!=="-"&&t!=="–"&&t!=="—").filter(Boolean)}function Px(n){const{words:t}=Z0(n),e=Math.max(3,Math.round(K0(t.map(i=>i.height))*.3)),s=Bf(t,e);return zf(s)}function Rx(n){const{words:t,hasLineIds:e}=Z0(n),s=Math.max(3,Math.round(K0(t.map(a=>a.height))*.3));if(!e)return zf(Bf(t,s));const i=new Map,r=[];for(const a of t){if(!a.lineId){r.push(a);continue}const l=i.get(a.lineId);l?(l.items.push({x:a.x,text:a.text}),l.y=(l.y+a.y)/2):i.set(a.lineId,{y:a.y,items:[{x:a.x,text:a.text}]})}const o=[...i.values()];return r.length&&o.push(...Bf(r,s)),zf(o)}let tu=null;const $f=new Set;async function Dx(){return tu??(tu=(async()=>{const e=await Qd.createWorker("eng+slv",Qd.OEM.LSTM_ONLY,{workerPath:Tx,corePath:Lx,langPath:"/blood-analyzer/tessdata",gzip:!0,logger:s=>{if(!(typeof(s==null?void 0:s.progress)!="number"||typeof(s==null?void 0:s.status)!="string"))for(const i of $f)i({status:s.status,progress:s.progress})}});return await e.setParameters({tessedit_pageseg_mode:Qd.PSM.SPARSE_TEXT,preserve_interword_spaces:"1"}),e})().catch(n=>{throw tu=null,n})),tu}async function Ix(n){const t=await createImageBitmap(n),e=2400,s=Math.min(1,Math.min(e/t.width,e/t.height)),i=document.createElement("canvas");i.width=Math.round(t.width*s),i.height=Math.round(t.height*s);const r=i.getContext("2d");if(!r)throw new Error("Canvas 2D context unavailable");return r.fillStyle="#fff",r.fillRect(0,0,i.width,i.height),r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.drawImage(t,0,0,i.width,i.height),t.close(),i}async function Ox(n,{onProgress:t}={}){t&&$f.add(t);try{const e=await Dx(),s=await Ix(n),r=(await e.recognize(s,{rotateAuto:!0},{tsv:!0})).data.tsv??"";return{lines:Px(r),tsv:r}}finally{t&&$f.delete(t)}}async function Fx(n,{onProgress:t}={}){const{lines:e,tsv:s}=await Ox(n,{onProgress:t}),i=Nf(e),r=s?Rx(s):[],o=r.length?Nf(r):[],a=o.length>=i.length+5?o:i,l=U0(n.name,r.length?[...e,...r]:e),c=a.map(h=>({...h,date:l,sourceFile:n.name}));return{id:`${n.name}-${Date.now()}`,date:l,sourceFile:n.name,markers:c}}/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function zc(n){return n+.5|0}const mn=(n,t,e)=>Math.max(Math.min(n,e),t);function qa(n){return mn(zc(n*2.55),0,255)}function An(n){return mn(zc(n*255),0,255)}function ni(n){return mn(zc(n/2.55)/100,0,1)}function mp(n){return mn(zc(n*100),0,100)}const Ue={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Wf=[..."0123456789ABCDEF"],Nx=n=>Wf[n&15],Hx=n=>Wf[(n&240)>>4]+Wf[n&15],Zc=n=>(n&240)>>4===(n&15),Bx=n=>Zc(n.r)&&Zc(n.g)&&Zc(n.b)&&Zc(n.a);function zx(n){var t=n.length,e;return n[0]==="#"&&(t===4||t===5?e={r:255&Ue[n[1]]*17,g:255&Ue[n[2]]*17,b:255&Ue[n[3]]*17,a:t===5?Ue[n[4]]*17:255}:(t===7||t===9)&&(e={r:Ue[n[1]]<<4|Ue[n[2]],g:Ue[n[3]]<<4|Ue[n[4]],b:Ue[n[5]]<<4|Ue[n[6]],a:t===9?Ue[n[7]]<<4|Ue[n[8]]:255})),e}const $x=(n,t)=>n<255?t(n):"";function Wx(n){var t=Bx(n)?Nx:Hx;return n?"#"+t(n.r)+t(n.g)+t(n.b)+$x(n.a,t):void 0}const jx=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function J0(n,t,e){const s=t*Math.min(e,1-e),i=(r,o=(r+n/30)%12)=>e-s*Math.max(Math.min(o-3,9-o,1),-1);return[i(0),i(8),i(4)]}function Vx(n,t,e){const s=(i,r=(i+n/60)%6)=>e-e*t*Math.max(Math.min(r,4-r,1),0);return[s(5),s(3),s(1)]}function Ux(n,t,e){const s=J0(n,1,.5);let i;for(t+e>1&&(i=1/(t+e),t*=i,e*=i),i=0;i<3;i++)s[i]*=1-t-e,s[i]+=t;return s}function Gx(n,t,e,s,i){return n===i?(t-e)/s+(t<e?6:0):t===i?(e-n)/s+2:(n-t)/s+4}function _g(n){const e=n.r/255,s=n.g/255,i=n.b/255,r=Math.max(e,s,i),o=Math.min(e,s,i),a=(r+o)/2;let l,c,h;return r!==o&&(h=r-o,c=a>.5?h/(2-r-o):h/(r+o),l=Gx(e,s,i,h,r),l=l*60+.5),[l|0,c||0,a]}function vg(n,t,e,s){return(Array.isArray(t)?n(t[0],t[1],t[2]):n(t,e,s)).map(An)}function Ag(n,t,e){return vg(J0,n,t,e)}function Xx(n,t,e){return vg(Ux,n,t,e)}function Yx(n,t,e){return vg(Vx,n,t,e)}function Q0(n){return(n%360+360)%360}function qx(n){const t=jx.exec(n);let e=255,s;if(!t)return;t[5]!==s&&(e=t[6]?qa(+t[5]):An(+t[5]));const i=Q0(+t[2]),r=+t[3]/100,o=+t[4]/100;return t[1]==="hwb"?s=Xx(i,r,o):t[1]==="hsv"?s=Yx(i,r,o):s=Ag(i,r,o),{r:s[0],g:s[1],b:s[2],a:e}}function Kx(n,t){var e=_g(n);e[0]=Q0(e[0]+t),e=Ag(e),n.r=e[0],n.g=e[1],n.b=e[2]}function Zx(n){if(!n)return;const t=_g(n),e=t[0],s=mp(t[1]),i=mp(t[2]);return n.a<255?`hsla(${e}, ${s}%, ${i}%, ${ni(n.a)})`:`hsl(${e}, ${s}%, ${i}%)`}const bp={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},yp={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function Jx(){const n={},t=Object.keys(yp),e=Object.keys(bp);let s,i,r,o,a;for(s=0;s<t.length;s++){for(o=a=t[s],i=0;i<e.length;i++)r=e[i],a=a.replace(r,bp[r]);r=parseInt(yp[o],16),n[a]=[r>>16&255,r>>8&255,r&255]}return n}let Jc;function Qx(n){Jc||(Jc=Jx(),Jc.transparent=[0,0,0,0]);const t=Jc[n.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const tw=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function ew(n){const t=tw.exec(n);let e=255,s,i,r;if(t){if(t[7]!==s){const o=+t[7];e=t[8]?qa(o):mn(o*255,0,255)}return s=+t[1],i=+t[3],r=+t[5],s=255&(t[2]?qa(s):mn(s,0,255)),i=255&(t[4]?qa(i):mn(i,0,255)),r=255&(t[6]?qa(r):mn(r,0,255)),{r:s,g:i,b:r,a:e}}}function sw(n){return n&&(n.a<255?`rgba(${n.r}, ${n.g}, ${n.b}, ${ni(n.a)})`:`rgb(${n.r}, ${n.g}, ${n.b})`)}const eu=n=>n<=.0031308?n*12.92:Math.pow(n,1/2.4)*1.055-.055,ho=n=>n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4);function iw(n,t,e){const s=ho(ni(n.r)),i=ho(ni(n.g)),r=ho(ni(n.b));return{r:An(eu(s+e*(ho(ni(t.r))-s))),g:An(eu(i+e*(ho(ni(t.g))-i))),b:An(eu(r+e*(ho(ni(t.b))-r))),a:n.a+e*(t.a-n.a)}}function Qc(n,t,e){if(n){let s=_g(n);s[t]=Math.max(0,Math.min(s[t]+s[t]*e,t===0?360:1)),s=Ag(s),n.r=s[0],n.g=s[1],n.b=s[2]}}function ty(n,t){return n&&Object.assign(t||{},n)}function _p(n){var t={r:0,g:0,b:0,a:255};return Array.isArray(n)?n.length>=3&&(t={r:n[0],g:n[1],b:n[2],a:255},n.length>3&&(t.a=An(n[3]))):(t=ty(n,{r:0,g:0,b:0,a:1}),t.a=An(t.a)),t}function nw(n){return n.charAt(0)==="r"?ew(n):qx(n)}class dl{constructor(t){if(t instanceof dl)return t;const e=typeof t;let s;e==="object"?s=_p(t):e==="string"&&(s=zx(t)||Qx(t)||nw(t)),this._rgb=s,this._valid=!!s}get valid(){return this._valid}get rgb(){var t=ty(this._rgb);return t&&(t.a=ni(t.a)),t}set rgb(t){this._rgb=_p(t)}rgbString(){return this._valid?sw(this._rgb):void 0}hexString(){return this._valid?Wx(this._rgb):void 0}hslString(){return this._valid?Zx(this._rgb):void 0}mix(t,e){if(t){const s=this.rgb,i=t.rgb;let r;const o=e===r?.5:e,a=2*o-1,l=s.a-i.a,c=((a*l===-1?a:(a+l)/(1+a*l))+1)/2;r=1-c,s.r=255&c*s.r+r*i.r+.5,s.g=255&c*s.g+r*i.g+.5,s.b=255&c*s.b+r*i.b+.5,s.a=o*s.a+(1-o)*i.a,this.rgb=s}return this}interpolate(t,e){return t&&(this._rgb=iw(this._rgb,t._rgb,e)),this}clone(){return new dl(this.rgb)}alpha(t){return this._rgb.a=An(t),this}clearer(t){const e=this._rgb;return e.a*=1-t,this}greyscale(){const t=this._rgb,e=zc(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=e,this}opaquer(t){const e=this._rgb;return e.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return Qc(this._rgb,2,t),this}darken(t){return Qc(this._rgb,2,-t),this}saturate(t){return Qc(this._rgb,1,t),this}desaturate(t){return Qc(this._rgb,1,-t),this}rotate(t){return Kx(this._rgb,t),this}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function Zs(){}const rw=(()=>{let n=0;return()=>n++})();function st(n){return n==null}function kt(n){if(Array.isArray&&Array.isArray(n))return!0;const t=Object.prototype.toString.call(n);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function nt(n){return n!==null&&Object.prototype.toString.call(n)==="[object Object]"}function Dt(n){return(typeof n=="number"||n instanceof Number)&&isFinite(+n)}function Re(n,t){return Dt(n)?n:t}function Z(n,t){return typeof n>"u"?t:n}const ow=(n,t)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100:+n/t,ey=(n,t)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100*t:+n;function wt(n,t,e){if(n&&typeof n.call=="function")return n.apply(e,t)}function bt(n,t,e,s){let i,r,o;if(kt(n))for(r=n.length,i=0;i<r;i++)t.call(e,n[i],i);else if(nt(n))for(o=Object.keys(n),r=o.length,i=0;i<r;i++)t.call(e,n[o[i]],o[i])}function td(n,t){let e,s,i,r;if(!n||!t||n.length!==t.length)return!1;for(e=0,s=n.length;e<s;++e)if(i=n[e],r=t[e],i.datasetIndex!==r.datasetIndex||i.index!==r.index)return!1;return!0}function ed(n){if(kt(n))return n.map(ed);if(nt(n)){const t=Object.create(null),e=Object.keys(n),s=e.length;let i=0;for(;i<s;++i)t[e[i]]=ed(n[e[i]]);return t}return n}function sy(n){return["__proto__","prototype","constructor"].indexOf(n)===-1}function aw(n,t,e,s){if(!sy(n))return;const i=t[n],r=e[n];nt(i)&&nt(r)?ul(i,r,s):t[n]=ed(r)}function ul(n,t,e){const s=kt(t)?t:[t],i=s.length;if(!nt(n))return n;e=e||{};const r=e.merger||aw;let o;for(let a=0;a<i;++a){if(o=s[a],!nt(o))continue;const l=Object.keys(o);for(let c=0,h=l.length;c<h;++c)r(l[c],n,o,e)}return n}function il(n,t){return ul(n,t,{merger:lw})}function lw(n,t,e){if(!sy(n))return;const s=t[n],i=e[n];nt(s)&&nt(i)?il(s,i):Object.prototype.hasOwnProperty.call(t,n)||(t[n]=ed(i))}const vp={"":n=>n,x:n=>n.x,y:n=>n.y};function cw(n){const t=n.split("."),e=[];let s="";for(const i of t)s+=i,s.endsWith("\\")?s=s.slice(0,-1)+".":(e.push(s),s="");return e}function hw(n){const t=cw(n);return e=>{for(const s of t){if(s==="")break;e=e&&e[s]}return e}}function Sn(n,t){return(vp[t]||(vp[t]=hw(t)))(n)}function xg(n){return n.charAt(0).toUpperCase()+n.slice(1)}const fl=n=>typeof n<"u",En=n=>typeof n=="function",Ap=(n,t)=>{if(n.size!==t.size)return!1;for(const e of n)if(!t.has(e))return!1;return!0};function dw(n){return n.type==="mouseup"||n.type==="click"||n.type==="contextmenu"}const ht=Math.PI,St=2*ht,uw=St+ht,sd=Number.POSITIVE_INFINITY,fw=ht/180,Nt=ht/2,In=ht/4,xp=ht*2/3,bn=Math.log10,Us=Math.sign;function nl(n,t,e){return Math.abs(n-t)<e}function wp(n){const t=Math.round(n);n=nl(n,t,n/1e3)?t:n;const e=Math.pow(10,Math.floor(bn(n))),s=n/e;return(s<=1?1:s<=2?2:s<=5?5:10)*e}function gw(n){const t=[],e=Math.sqrt(n);let s;for(s=1;s<e;s++)n%s===0&&(t.push(s),t.push(n/s));return e===(e|0)&&t.push(e),t.sort((i,r)=>i-r).pop(),t}function pw(n){return typeof n=="symbol"||typeof n=="object"&&n!==null&&!(Symbol.toPrimitive in n||"toString"in n||"valueOf"in n)}function va(n){return!pw(n)&&!isNaN(parseFloat(n))&&isFinite(n)}function mw(n,t){const e=Math.round(n);return e-t<=n&&e+t>=n}function iy(n,t,e){let s,i,r;for(s=0,i=n.length;s<i;s++)r=n[s][e],isNaN(r)||(t.min=Math.min(t.min,r),t.max=Math.max(t.max,r))}function ps(n){return n*(ht/180)}function wg(n){return n*(180/ht)}function Sp(n){if(!Dt(n))return;let t=1,e=0;for(;Math.round(n*t)/t!==n;)t*=10,e++;return e}function ny(n,t){const e=t.x-n.x,s=t.y-n.y,i=Math.sqrt(e*e+s*s);let r=Math.atan2(s,e);return r<-.5*ht&&(r+=St),{angle:r,distance:i}}function jf(n,t){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))}function bw(n,t){return(n-t+uw)%St-ht}function de(n){return(n%St+St)%St}function gl(n,t,e,s){const i=de(n),r=de(t),o=de(e),a=de(r-i),l=de(o-i),c=de(i-r),h=de(i-o);return i===r||i===o||s&&r===o||a>l&&c<h}function te(n,t,e){return Math.max(t,Math.min(e,n))}function yw(n){return te(n,-32768,32767)}function Ti(n,t,e,s=1e-6){return n>=Math.min(t,e)-s&&n<=Math.max(t,e)+s}function Sg(n,t,e){e=e||(o=>n[o]<t);let s=n.length-1,i=0,r;for(;s-i>1;)r=i+s>>1,e(r)?i=r:s=r;return{lo:i,hi:s}}const Li=(n,t,e,s)=>Sg(n,e,s?i=>{const r=n[i][t];return r<e||r===e&&n[i+1][t]===e}:i=>n[i][t]<e),_w=(n,t,e)=>Sg(n,e,s=>n[s][t]>=e);function vw(n,t,e){let s=0,i=n.length;for(;s<i&&n[s]<t;)s++;for(;i>s&&n[i-1]>e;)i--;return s>0||i<n.length?n.slice(s,i):n}const ry=["push","pop","shift","splice","unshift"];function Aw(n,t){if(n._chartjs){n._chartjs.listeners.push(t);return}Object.defineProperty(n,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),ry.forEach(e=>{const s="_onData"+xg(e),i=n[e];Object.defineProperty(n,e,{configurable:!0,enumerable:!1,value(...r){const o=i.apply(this,r);return n._chartjs.listeners.forEach(a=>{typeof a[s]=="function"&&a[s](...r)}),o}})})}function Ep(n,t){const e=n._chartjs;if(!e)return;const s=e.listeners,i=s.indexOf(t);i!==-1&&s.splice(i,1),!(s.length>0)&&(ry.forEach(r=>{delete n[r]}),delete n._chartjs)}function oy(n){const t=new Set(n);return t.size===n.length?n:Array.from(t)}const ay=function(){return typeof window>"u"?function(n){return n()}:window.requestAnimationFrame}();function ly(n,t){let e=[],s=!1;return function(...i){e=i,s||(s=!0,ay.call(window,()=>{s=!1,n.apply(t,e)}))}}function xw(n,t){let e;return function(...s){return t?(clearTimeout(e),e=setTimeout(n,t,s)):n.apply(this,s),t}}const Eg=n=>n==="start"?"left":n==="end"?"right":"center",he=(n,t,e)=>n==="start"?t:n==="end"?e:(t+e)/2,ww=(n,t,e,s)=>n===(s?"left":"right")?e:n==="center"?(t+e)/2:t;function cy(n,t,e){const s=t.length;let i=0,r=s;if(n._sorted){const{iScale:o,vScale:a,_parsed:l}=n,c=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null,h=o.axis,{min:u,max:f,minDefined:g,maxDefined:p}=o.getUserBounds();if(g){if(i=Math.min(Li(l,h,u).lo,e?s:Li(t,h,o.getPixelForValue(u)).lo),c){const m=l.slice(0,i+1).reverse().findIndex(b=>!st(b[a.axis]));i-=Math.max(0,m)}i=te(i,0,s-1)}if(p){let m=Math.max(Li(l,o.axis,f,!0).hi+1,e?0:Li(t,h,o.getPixelForValue(f),!0).hi+1);if(c){const b=l.slice(m-1).findIndex(y=>!st(y[a.axis]));m+=Math.max(0,b)}r=te(m,i,s)-i}else r=s-i}return{start:i,count:r}}function hy(n){const{xScale:t,yScale:e,_scaleRanges:s}=n,i={xmin:t.min,xmax:t.max,ymin:e.min,ymax:e.max};if(!s)return n._scaleRanges=i,!0;const r=s.xmin!==t.min||s.xmax!==t.max||s.ymin!==e.min||s.ymax!==e.max;return Object.assign(s,i),r}const th=n=>n===0||n===1,Cp=(n,t,e)=>-(Math.pow(2,10*(n-=1))*Math.sin((n-t)*St/e)),kp=(n,t,e)=>Math.pow(2,-10*n)*Math.sin((n-t)*St/e)+1,rl={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>-n*(n-2),easeInOutQuad:n=>(n/=.5)<1?.5*n*n:-.5*(--n*(n-2)-1),easeInCubic:n=>n*n*n,easeOutCubic:n=>(n-=1)*n*n+1,easeInOutCubic:n=>(n/=.5)<1?.5*n*n*n:.5*((n-=2)*n*n+2),easeInQuart:n=>n*n*n*n,easeOutQuart:n=>-((n-=1)*n*n*n-1),easeInOutQuart:n=>(n/=.5)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2),easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>(n-=1)*n*n*n*n+1,easeInOutQuint:n=>(n/=.5)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2),easeInSine:n=>-Math.cos(n*Nt)+1,easeOutSine:n=>Math.sin(n*Nt),easeInOutSine:n=>-.5*(Math.cos(ht*n)-1),easeInExpo:n=>n===0?0:Math.pow(2,10*(n-1)),easeOutExpo:n=>n===1?1:-Math.pow(2,-10*n)+1,easeInOutExpo:n=>th(n)?n:n<.5?.5*Math.pow(2,10*(n*2-1)):.5*(-Math.pow(2,-10*(n*2-1))+2),easeInCirc:n=>n>=1?n:-(Math.sqrt(1-n*n)-1),easeOutCirc:n=>Math.sqrt(1-(n-=1)*n),easeInOutCirc:n=>(n/=.5)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1),easeInElastic:n=>th(n)?n:Cp(n,.075,.3),easeOutElastic:n=>th(n)?n:kp(n,.075,.3),easeInOutElastic(n){return th(n)?n:n<.5?.5*Cp(n*2,.1125,.45):.5+.5*kp(n*2-1,.1125,.45)},easeInBack(n){return n*n*((1.70158+1)*n-1.70158)},easeOutBack(n){return(n-=1)*n*((1.70158+1)*n+1.70158)+1},easeInOutBack(n){let t=1.70158;return(n/=.5)<1?.5*(n*n*(((t*=1.525)+1)*n-t)):.5*((n-=2)*n*(((t*=1.525)+1)*n+t)+2)},easeInBounce:n=>1-rl.easeOutBounce(1-n),easeOutBounce(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},easeInOutBounce:n=>n<.5?rl.easeInBounce(n*2)*.5:rl.easeOutBounce(n*2-1)*.5+.5};function Cg(n){if(n&&typeof n=="object"){const t=n.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function Mp(n){return Cg(n)?n:new dl(n)}function su(n){return Cg(n)?n:new dl(n).saturate(.5).darken(.1).hexString()}const Sw=["x","y","borderWidth","radius","tension"],Ew=["color","borderColor","backgroundColor"];function Cw(n){n.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),n.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),n.set("animations",{colors:{type:"color",properties:Ew},numbers:{type:"number",properties:Sw}}),n.describe("animations",{_fallback:"animation"}),n.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function kw(n){n.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const Tp=new Map;function Mw(n,t){t=t||{};const e=n+JSON.stringify(t);let s=Tp.get(e);return s||(s=new Intl.NumberFormat(n,t),Tp.set(e,s)),s}function $c(n,t,e){return Mw(t,e).format(n)}const dy={values(n){return kt(n)?n:""+n},numeric(n,t,e){if(n===0)return"0";const s=this.chart.options.locale;let i,r=n;if(e.length>1){const c=Math.max(Math.abs(e[0].value),Math.abs(e[e.length-1].value));(c<1e-4||c>1e15)&&(i="scientific"),r=Tw(n,e)}const o=bn(Math.abs(r)),a=isNaN(o)?1:Math.max(Math.min(-1*Math.floor(o),20),0),l={notation:i,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),$c(n,s,l)},logarithmic(n,t,e){if(n===0)return"0";const s=e[t].significand||n/Math.pow(10,Math.floor(bn(n)));return[1,2,3,5,10,15].includes(s)||t>.8*e.length?dy.numeric.call(this,n,t,e):""}};function Tw(n,t){let e=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(e)>=1&&n!==Math.floor(n)&&(e=n-Math.floor(n)),e}var Id={formatters:dy};function Lw(n){n.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Id.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),n.route("scale.ticks","color","","color"),n.route("scale.grid","color","","borderColor"),n.route("scale.border","color","","borderColor"),n.route("scale.title","color","","color"),n.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),n.describe("scales",{_fallback:"scale"}),n.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const Qr=Object.create(null),Vf=Object.create(null);function ol(n,t){if(!t)return n;const e=t.split(".");for(let s=0,i=e.length;s<i;++s){const r=e[s];n=n[r]||(n[r]=Object.create(null))}return n}function iu(n,t,e){return typeof t=="string"?ul(ol(n,t),e):ul(ol(n,""),t)}class Pw{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=s=>s.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(s,i)=>su(i.backgroundColor),this.hoverBorderColor=(s,i)=>su(i.borderColor),this.hoverColor=(s,i)=>su(i.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return iu(this,t,e)}get(t){return ol(this,t)}describe(t,e){return iu(Vf,t,e)}override(t,e){return iu(Qr,t,e)}route(t,e,s,i){const r=ol(this,t),o=ol(this,s),a="_"+e;Object.defineProperties(r,{[a]:{value:r[e],writable:!0},[e]:{enumerable:!0,get(){const l=this[a],c=o[i];return nt(l)?Object.assign({},c,l):Z(l,c)},set(l){this[a]=l}}})}apply(t){t.forEach(e=>e(this))}}var Mt=new Pw({_scriptable:n=>!n.startsWith("on"),_indexable:n=>n!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[Cw,kw,Lw]);function Rw(n){return!n||st(n.size)||st(n.family)?null:(n.style?n.style+" ":"")+(n.weight?n.weight+" ":"")+n.size+"px "+n.family}function id(n,t,e,s,i){let r=t[i];return r||(r=t[i]=n.measureText(i).width,e.push(i)),r>s&&(s=r),s}function Dw(n,t,e,s){s=s||{};let i=s.data=s.data||{},r=s.garbageCollect=s.garbageCollect||[];s.font!==t&&(i=s.data={},r=s.garbageCollect=[],s.font=t),n.save(),n.font=t;let o=0;const a=e.length;let l,c,h,u,f;for(l=0;l<a;l++)if(u=e[l],u!=null&&!kt(u))o=id(n,i,r,o,u);else if(kt(u))for(c=0,h=u.length;c<h;c++)f=u[c],f!=null&&!kt(f)&&(o=id(n,i,r,o,f));n.restore();const g=r.length/2;if(g>e.length){for(l=0;l<g;l++)delete i[r[l]];r.splice(0,g)}return o}function On(n,t,e){const s=n.currentDevicePixelRatio,i=e!==0?Math.max(e/2,.5):0;return Math.round((t-i)*s)/s+i}function Lp(n,t){!t&&!n||(t=t||n.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,n.width,n.height),t.restore())}function Uf(n,t,e,s){uy(n,t,e,s,null)}function uy(n,t,e,s,i){let r,o,a,l,c,h,u,f;const g=t.pointStyle,p=t.rotation,m=t.radius;let b=(p||0)*fw;if(g&&typeof g=="object"&&(r=g.toString(),r==="[object HTMLImageElement]"||r==="[object HTMLCanvasElement]")){n.save(),n.translate(e,s),n.rotate(b),n.drawImage(g,-g.width/2,-g.height/2,g.width,g.height),n.restore();return}if(!(isNaN(m)||m<=0)){switch(n.beginPath(),g){default:i?n.ellipse(e,s,i/2,m,0,0,St):n.arc(e,s,m,0,St),n.closePath();break;case"triangle":h=i?i/2:m,n.moveTo(e+Math.sin(b)*h,s-Math.cos(b)*m),b+=xp,n.lineTo(e+Math.sin(b)*h,s-Math.cos(b)*m),b+=xp,n.lineTo(e+Math.sin(b)*h,s-Math.cos(b)*m),n.closePath();break;case"rectRounded":c=m*.516,l=m-c,o=Math.cos(b+In)*l,u=Math.cos(b+In)*(i?i/2-c:l),a=Math.sin(b+In)*l,f=Math.sin(b+In)*(i?i/2-c:l),n.arc(e-u,s-a,c,b-ht,b-Nt),n.arc(e+f,s-o,c,b-Nt,b),n.arc(e+u,s+a,c,b,b+Nt),n.arc(e-f,s+o,c,b+Nt,b+ht),n.closePath();break;case"rect":if(!p){l=Math.SQRT1_2*m,h=i?i/2:l,n.rect(e-h,s-l,2*h,2*l);break}b+=In;case"rectRot":u=Math.cos(b)*(i?i/2:m),o=Math.cos(b)*m,a=Math.sin(b)*m,f=Math.sin(b)*(i?i/2:m),n.moveTo(e-u,s-a),n.lineTo(e+f,s-o),n.lineTo(e+u,s+a),n.lineTo(e-f,s+o),n.closePath();break;case"crossRot":b+=In;case"cross":u=Math.cos(b)*(i?i/2:m),o=Math.cos(b)*m,a=Math.sin(b)*m,f=Math.sin(b)*(i?i/2:m),n.moveTo(e-u,s-a),n.lineTo(e+u,s+a),n.moveTo(e+f,s-o),n.lineTo(e-f,s+o);break;case"star":u=Math.cos(b)*(i?i/2:m),o=Math.cos(b)*m,a=Math.sin(b)*m,f=Math.sin(b)*(i?i/2:m),n.moveTo(e-u,s-a),n.lineTo(e+u,s+a),n.moveTo(e+f,s-o),n.lineTo(e-f,s+o),b+=In,u=Math.cos(b)*(i?i/2:m),o=Math.cos(b)*m,a=Math.sin(b)*m,f=Math.sin(b)*(i?i/2:m),n.moveTo(e-u,s-a),n.lineTo(e+u,s+a),n.moveTo(e+f,s-o),n.lineTo(e-f,s+o);break;case"line":o=i?i/2:Math.cos(b)*m,a=Math.sin(b)*m,n.moveTo(e-o,s-a),n.lineTo(e+o,s+a);break;case"dash":n.moveTo(e,s),n.lineTo(e+Math.cos(b)*(i?i/2:m),s+Math.sin(b)*m);break;case!1:n.closePath();break}n.fill(),t.borderWidth>0&&n.stroke()}}function Pi(n,t,e){return e=e||.5,!t||n&&n.x>t.left-e&&n.x<t.right+e&&n.y>t.top-e&&n.y<t.bottom+e}function Od(n,t){n.save(),n.beginPath(),n.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),n.clip()}function Fd(n){n.restore()}function Iw(n,t,e,s,i){if(!t)return n.lineTo(e.x,e.y);if(i==="middle"){const r=(t.x+e.x)/2;n.lineTo(r,t.y),n.lineTo(r,e.y)}else i==="after"!=!!s?n.lineTo(t.x,e.y):n.lineTo(e.x,t.y);n.lineTo(e.x,e.y)}function Ow(n,t,e,s){if(!t)return n.lineTo(e.x,e.y);n.bezierCurveTo(s?t.cp1x:t.cp2x,s?t.cp1y:t.cp2y,s?e.cp2x:e.cp1x,s?e.cp2y:e.cp1y,e.x,e.y)}function Fw(n,t){t.translation&&n.translate(t.translation[0],t.translation[1]),st(t.rotation)||n.rotate(t.rotation),t.color&&(n.fillStyle=t.color),t.textAlign&&(n.textAlign=t.textAlign),t.textBaseline&&(n.textBaseline=t.textBaseline)}function Nw(n,t,e,s,i){if(i.strikethrough||i.underline){const r=n.measureText(s),o=t-r.actualBoundingBoxLeft,a=t+r.actualBoundingBoxRight,l=e-r.actualBoundingBoxAscent,c=e+r.actualBoundingBoxDescent,h=i.strikethrough?(l+c)/2:c;n.strokeStyle=n.fillStyle,n.beginPath(),n.lineWidth=i.decorationWidth||2,n.moveTo(o,h),n.lineTo(a,h),n.stroke()}}function Hw(n,t){const e=n.fillStyle;n.fillStyle=t.color,n.fillRect(t.left,t.top,t.width,t.height),n.fillStyle=e}function to(n,t,e,s,i,r={}){const o=kt(t)?t:[t],a=r.strokeWidth>0&&r.strokeColor!=="";let l,c;for(n.save(),n.font=i.string,Fw(n,r),l=0;l<o.length;++l)c=o[l],r.backdrop&&Hw(n,r.backdrop),a&&(r.strokeColor&&(n.strokeStyle=r.strokeColor),st(r.strokeWidth)||(n.lineWidth=r.strokeWidth),n.strokeText(c,e,s,r.maxWidth)),n.fillText(c,e,s,r.maxWidth),Nw(n,e,s,c,r),s+=Number(i.lineHeight);n.restore()}function pl(n,t){const{x:e,y:s,w:i,h:r,radius:o}=t;n.arc(e+o.topLeft,s+o.topLeft,o.topLeft,1.5*ht,ht,!0),n.lineTo(e,s+r-o.bottomLeft),n.arc(e+o.bottomLeft,s+r-o.bottomLeft,o.bottomLeft,ht,Nt,!0),n.lineTo(e+i-o.bottomRight,s+r),n.arc(e+i-o.bottomRight,s+r-o.bottomRight,o.bottomRight,Nt,0,!0),n.lineTo(e+i,s+o.topRight),n.arc(e+i-o.topRight,s+o.topRight,o.topRight,0,-Nt,!0),n.lineTo(e+o.topLeft,s)}const Bw=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,zw=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function $w(n,t){const e=(""+n).match(Bw);if(!e||e[1]==="normal")return t*1.2;switch(n=+e[2],e[3]){case"px":return n;case"%":n/=100;break}return t*n}const Ww=n=>+n||0;function kg(n,t){const e={},s=nt(t),i=s?Object.keys(t):t,r=nt(n)?s?o=>Z(n[o],n[t[o]]):o=>n[o]:()=>n;for(const o of i)e[o]=Ww(r(o));return e}function fy(n){return kg(n,{top:"y",right:"x",bottom:"y",left:"x"})}function Xr(n){return kg(n,["topLeft","topRight","bottomLeft","bottomRight"])}function ge(n){const t=fy(n);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function Yt(n,t){n=n||{},t=t||Mt.font;let e=Z(n.size,t.size);typeof e=="string"&&(e=parseInt(e,10));let s=Z(n.style,t.style);s&&!(""+s).match(zw)&&(console.warn('Invalid font style specified: "'+s+'"'),s=void 0);const i={family:Z(n.family,t.family),lineHeight:$w(Z(n.lineHeight,t.lineHeight),e),size:e,style:s,weight:Z(n.weight,t.weight),string:""};return i.string=Rw(i),i}function Ka(n,t,e,s){let i,r,o;for(i=0,r=n.length;i<r;++i)if(o=n[i],o!==void 0&&o!==void 0)return o}function jw(n,t,e){const{min:s,max:i}=n,r=ey(t,(i-s)/2),o=(a,l)=>e&&a===0?0:a+l;return{min:o(s,-Math.abs(r)),max:o(i,r)}}function Tn(n,t){return Object.assign(Object.create(n),t)}function Mg(n,t=[""],e,s,i=()=>n[0]){const r=e||n;typeof s>"u"&&(s=by("_fallback",n));const o={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:n,_rootScopes:r,_fallback:s,_getTarget:i,override:a=>Mg([a,...n],t,r,s)};return new Proxy(o,{deleteProperty(a,l){return delete a[l],delete a._keys,delete n[0][l],!0},get(a,l){return py(a,l,()=>Zw(l,t,n,a))},getOwnPropertyDescriptor(a,l){return Reflect.getOwnPropertyDescriptor(a._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(n[0])},has(a,l){return Rp(a).includes(l)},ownKeys(a){return Rp(a)},set(a,l,c){const h=a._storage||(a._storage=i());return a[l]=h[l]=c,delete a._keys,!0}})}function Aa(n,t,e,s){const i={_cacheable:!1,_proxy:n,_context:t,_subProxy:e,_stack:new Set,_descriptors:gy(n,s),setContext:r=>Aa(n,r,e,s),override:r=>Aa(n.override(r),t,e,s)};return new Proxy(i,{deleteProperty(r,o){return delete r[o],delete n[o],!0},get(r,o,a){return py(r,o,()=>Uw(r,o,a))},getOwnPropertyDescriptor(r,o){return r._descriptors.allKeys?Reflect.has(n,o)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(n,o)},getPrototypeOf(){return Reflect.getPrototypeOf(n)},has(r,o){return Reflect.has(n,o)},ownKeys(){return Reflect.ownKeys(n)},set(r,o,a){return n[o]=a,delete r[o],!0}})}function gy(n,t={scriptable:!0,indexable:!0}){const{_scriptable:e=t.scriptable,_indexable:s=t.indexable,_allKeys:i=t.allKeys}=n;return{allKeys:i,scriptable:e,indexable:s,isScriptable:En(e)?e:()=>e,isIndexable:En(s)?s:()=>s}}const Vw=(n,t)=>n?n+xg(t):t,Tg=(n,t)=>nt(t)&&n!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function py(n,t,e){if(Object.prototype.hasOwnProperty.call(n,t)||t==="constructor")return n[t];const s=e();return n[t]=s,s}function Uw(n,t,e){const{_proxy:s,_context:i,_subProxy:r,_descriptors:o}=n;let a=s[t];return En(a)&&o.isScriptable(t)&&(a=Gw(t,a,n,e)),kt(a)&&a.length&&(a=Xw(t,a,n,o.isIndexable)),Tg(t,a)&&(a=Aa(a,i,r&&r[t],o)),a}function Gw(n,t,e,s){const{_proxy:i,_context:r,_subProxy:o,_stack:a}=e;if(a.has(n))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+n);a.add(n);let l=t(r,o||s);return a.delete(n),Tg(n,l)&&(l=Lg(i._scopes,i,n,l)),l}function Xw(n,t,e,s){const{_proxy:i,_context:r,_subProxy:o,_descriptors:a}=e;if(typeof r.index<"u"&&s(n))return t[r.index%t.length];if(nt(t[0])){const l=t,c=i._scopes.filter(h=>h!==l);t=[];for(const h of l){const u=Lg(c,i,n,h);t.push(Aa(u,r,o&&o[n],a))}}return t}function my(n,t,e){return En(n)?n(t,e):n}const Yw=(n,t)=>n===!0?t:typeof n=="string"?Sn(t,n):void 0;function qw(n,t,e,s,i){for(const r of t){const o=Yw(e,r);if(o){n.add(o);const a=my(o._fallback,e,i);if(typeof a<"u"&&a!==e&&a!==s)return a}else if(o===!1&&typeof s<"u"&&e!==s)return null}return!1}function Lg(n,t,e,s){const i=t._rootScopes,r=my(t._fallback,e,s),o=[...n,...i],a=new Set;a.add(s);let l=Pp(a,o,e,r||e,s);return l===null||typeof r<"u"&&r!==e&&(l=Pp(a,o,r,l,s),l===null)?!1:Mg(Array.from(a),[""],i,r,()=>Kw(t,e,s))}function Pp(n,t,e,s,i){for(;e;)e=qw(n,t,e,s,i);return e}function Kw(n,t,e){const s=n._getTarget();t in s||(s[t]={});const i=s[t];return kt(i)&&nt(e)?e:i||{}}function Zw(n,t,e,s){let i;for(const r of t)if(i=by(Vw(r,n),e),typeof i<"u")return Tg(n,i)?Lg(e,s,n,i):i}function by(n,t){for(const e of t){if(!e)continue;const s=e[n];if(typeof s<"u")return s}}function Rp(n){let t=n._keys;return t||(t=n._keys=Jw(n._scopes)),t}function Jw(n){const t=new Set;for(const e of n)for(const s of Object.keys(e).filter(i=>!i.startsWith("_")))t.add(s);return Array.from(t)}function yy(n,t,e,s){const{iScale:i}=n,{key:r="r"}=this._parsing,o=new Array(s);let a,l,c,h;for(a=0,l=s;a<l;++a)c=a+e,h=t[c],o[a]={r:i.parse(Sn(h,r),c)};return o}const Qw=Number.EPSILON||1e-14,xa=(n,t)=>t<n.length&&!n[t].skip&&n[t],_y=n=>n==="x"?"y":"x";function tS(n,t,e,s){const i=n.skip?t:n,r=t,o=e.skip?t:e,a=jf(r,i),l=jf(o,r);let c=a/(a+l),h=l/(a+l);c=isNaN(c)?0:c,h=isNaN(h)?0:h;const u=s*c,f=s*h;return{previous:{x:r.x-u*(o.x-i.x),y:r.y-u*(o.y-i.y)},next:{x:r.x+f*(o.x-i.x),y:r.y+f*(o.y-i.y)}}}function eS(n,t,e){const s=n.length;let i,r,o,a,l,c=xa(n,0);for(let h=0;h<s-1;++h)if(l=c,c=xa(n,h+1),!(!l||!c)){if(nl(t[h],0,Qw)){e[h]=e[h+1]=0;continue}i=e[h]/t[h],r=e[h+1]/t[h],a=Math.pow(i,2)+Math.pow(r,2),!(a<=9)&&(o=3/Math.sqrt(a),e[h]=i*o*t[h],e[h+1]=r*o*t[h])}}function sS(n,t,e="x"){const s=_y(e),i=n.length;let r,o,a,l=xa(n,0);for(let c=0;c<i;++c){if(o=a,a=l,l=xa(n,c+1),!a)continue;const h=a[e],u=a[s];o&&(r=(h-o[e])/3,a[`cp1${e}`]=h-r,a[`cp1${s}`]=u-r*t[c]),l&&(r=(l[e]-h)/3,a[`cp2${e}`]=h+r,a[`cp2${s}`]=u+r*t[c])}}function iS(n,t="x"){const e=_y(t),s=n.length,i=Array(s).fill(0),r=Array(s);let o,a,l,c=xa(n,0);for(o=0;o<s;++o)if(a=l,l=c,c=xa(n,o+1),!!l){if(c){const h=c[t]-l[t];i[o]=h!==0?(c[e]-l[e])/h:0}r[o]=a?c?Us(i[o-1])!==Us(i[o])?0:(i[o-1]+i[o])/2:i[o-1]:i[o]}eS(n,i,r),sS(n,r,t)}function eh(n,t,e){return Math.max(Math.min(n,e),t)}function nS(n,t){let e,s,i,r,o,a=Pi(n[0],t);for(e=0,s=n.length;e<s;++e)o=r,r=a,a=e<s-1&&Pi(n[e+1],t),r&&(i=n[e],o&&(i.cp1x=eh(i.cp1x,t.left,t.right),i.cp1y=eh(i.cp1y,t.top,t.bottom)),a&&(i.cp2x=eh(i.cp2x,t.left,t.right),i.cp2y=eh(i.cp2y,t.top,t.bottom)))}function rS(n,t,e,s,i){let r,o,a,l;if(t.spanGaps&&(n=n.filter(c=>!c.skip)),t.cubicInterpolationMode==="monotone")iS(n,i);else{let c=s?n[n.length-1]:n[0];for(r=0,o=n.length;r<o;++r)a=n[r],l=tS(c,a,n[Math.min(r+1,o-(s?0:1))%o],t.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,c=a}t.capBezierPoints&&nS(n,e)}function Pg(){return typeof window<"u"&&typeof document<"u"}function Rg(n){let t=n.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function nd(n,t,e){let s;return typeof n=="string"?(s=parseInt(n,10),n.indexOf("%")!==-1&&(s=s/100*t.parentNode[e])):s=n,s}const Nd=n=>n.ownerDocument.defaultView.getComputedStyle(n,null);function oS(n,t){return Nd(n).getPropertyValue(t)}const aS=["top","right","bottom","left"];function Yr(n,t,e){const s={};e=e?"-"+e:"";for(let i=0;i<4;i++){const r=aS[i];s[r]=parseFloat(n[t+"-"+r+e])||0}return s.width=s.left+s.right,s.height=s.top+s.bottom,s}const lS=(n,t,e)=>(n>0||t>0)&&(!e||!e.shadowRoot);function cS(n,t){const e=n.touches,s=e&&e.length?e[0]:n,{offsetX:i,offsetY:r}=s;let o=!1,a,l;if(lS(i,r,n.target))a=i,l=r;else{const c=t.getBoundingClientRect();a=s.clientX-c.left,l=s.clientY-c.top,o=!0}return{x:a,y:l,box:o}}function $n(n,t){if("native"in n)return n;const{canvas:e,currentDevicePixelRatio:s}=t,i=Nd(e),r=i.boxSizing==="border-box",o=Yr(i,"padding"),a=Yr(i,"border","width"),{x:l,y:c,box:h}=cS(n,e),u=o.left+(h&&a.left),f=o.top+(h&&a.top);let{width:g,height:p}=t;return r&&(g-=o.width+a.width,p-=o.height+a.height),{x:Math.round((l-u)/g*e.width/s),y:Math.round((c-f)/p*e.height/s)}}function hS(n,t,e){let s,i;if(t===void 0||e===void 0){const r=n&&Rg(n);if(!r)t=n.clientWidth,e=n.clientHeight;else{const o=r.getBoundingClientRect(),a=Nd(r),l=Yr(a,"border","width"),c=Yr(a,"padding");t=o.width-c.width-l.width,e=o.height-c.height-l.height,s=nd(a.maxWidth,r,"clientWidth"),i=nd(a.maxHeight,r,"clientHeight")}}return{width:t,height:e,maxWidth:s||sd,maxHeight:i||sd}}const yn=n=>Math.round(n*10)/10;function dS(n,t,e,s){const i=Nd(n),r=Yr(i,"margin"),o=nd(i.maxWidth,n,"clientWidth")||sd,a=nd(i.maxHeight,n,"clientHeight")||sd,l=hS(n,t,e);let{width:c,height:h}=l;if(i.boxSizing==="content-box"){const f=Yr(i,"border","width"),g=Yr(i,"padding");c-=g.width+f.width,h-=g.height+f.height}return c=Math.max(0,c-r.width),h=Math.max(0,s?c/s:h-r.height),c=yn(Math.min(c,o,l.maxWidth)),h=yn(Math.min(h,a,l.maxHeight)),c&&!h&&(h=yn(c/2)),(t!==void 0||e!==void 0)&&s&&l.height&&h>l.height&&(h=l.height,c=yn(Math.floor(h*s))),{width:c,height:h}}function Dp(n,t,e){const s=t||1,i=yn(n.height*s),r=yn(n.width*s);n.height=yn(n.height),n.width=yn(n.width);const o=n.canvas;return o.style&&(e||!o.style.height&&!o.style.width)&&(o.style.height=`${n.height}px`,o.style.width=`${n.width}px`),n.currentDevicePixelRatio!==s||o.height!==i||o.width!==r?(n.currentDevicePixelRatio=s,o.height=i,o.width=r,n.ctx.setTransform(s,0,0,s,0,0),!0):!1}const uS=function(){let n=!1;try{const t={get passive(){return n=!0,!1}};Pg()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch{}return n}();function Ip(n,t){const e=oS(n,t),s=e&&e.match(/^(\d+)(\.\d+)?px$/);return s?+s[1]:void 0}function Wn(n,t,e,s){return{x:n.x+e*(t.x-n.x),y:n.y+e*(t.y-n.y)}}function fS(n,t,e,s){return{x:n.x+e*(t.x-n.x),y:s==="middle"?e<.5?n.y:t.y:s==="after"?e<1?n.y:t.y:e>0?t.y:n.y}}function gS(n,t,e,s){const i={x:n.cp2x,y:n.cp2y},r={x:t.cp1x,y:t.cp1y},o=Wn(n,i,e),a=Wn(i,r,e),l=Wn(r,t,e),c=Wn(o,a,e),h=Wn(a,l,e);return Wn(c,h,e)}const pS=function(n,t){return{x(e){return n+n+t-e},setWidth(e){t=e},textAlign(e){return e==="center"?e:e==="right"?"left":"right"},xPlus(e,s){return e-s},leftForLtr(e,s){return e-s}}},mS=function(){return{x(n){return n},setWidth(n){},textAlign(n){return n},xPlus(n,t){return n+t},leftForLtr(n,t){return n}}};function So(n,t,e){return n?pS(t,e):mS()}function vy(n,t){let e,s;(t==="ltr"||t==="rtl")&&(e=n.canvas.style,s=[e.getPropertyValue("direction"),e.getPropertyPriority("direction")],e.setProperty("direction",t,"important"),n.prevTextDirection=s)}function Ay(n,t){t!==void 0&&(delete n.prevTextDirection,n.canvas.style.setProperty("direction",t[0],t[1]))}function xy(n){return n==="angle"?{between:gl,compare:bw,normalize:de}:{between:Ti,compare:(t,e)=>t-e,normalize:t=>t}}function Op({start:n,end:t,count:e,loop:s,style:i}){return{start:n%e,end:t%e,loop:s&&(t-n+1)%e===0,style:i}}function bS(n,t,e){const{property:s,start:i,end:r}=e,{between:o,normalize:a}=xy(s),l=t.length;let{start:c,end:h,loop:u}=n,f,g;if(u){for(c+=l,h+=l,f=0,g=l;f<g&&o(a(t[c%l][s]),i,r);++f)c--,h--;c%=l,h%=l}return h<c&&(h+=l),{start:c,end:h,loop:u,style:n.style}}function wy(n,t,e){if(!e)return[n];const{property:s,start:i,end:r}=e,o=t.length,{compare:a,between:l,normalize:c}=xy(s),{start:h,end:u,loop:f,style:g}=bS(n,t,e),p=[];let m=!1,b=null,y,A,w;const S=()=>l(i,w,y)&&a(i,w)!==0,E=()=>a(r,y)===0||l(r,w,y),C=()=>m||S(),k=()=>!m||E();for(let M=h,R=h;M<=u;++M)A=t[M%o],!A.skip&&(y=c(A[s]),y!==w&&(m=l(y,i,r),b===null&&C()&&(b=a(y,i)===0?M:R),b!==null&&k()&&(p.push(Op({start:b,end:M,loop:f,count:o,style:g})),b=null),R=M,w=y));return b!==null&&p.push(Op({start:b,end:u,loop:f,count:o,style:g})),p}function Sy(n,t){const e=[],s=n.segments;for(let i=0;i<s.length;i++){const r=wy(s[i],n.points,t);r.length&&e.push(...r)}return e}function yS(n,t,e,s){let i=0,r=t-1;if(e&&!s)for(;i<t&&!n[i].skip;)i++;for(;i<t&&n[i].skip;)i++;for(i%=t,e&&(r+=i);r>i&&n[r%t].skip;)r--;return r%=t,{start:i,end:r}}function _S(n,t,e,s){const i=n.length,r=[];let o=t,a=n[t],l;for(l=t+1;l<=e;++l){const c=n[l%i];c.skip||c.stop?a.skip||(s=!1,r.push({start:t%i,end:(l-1)%i,loop:s}),t=o=c.stop?l:null):(o=l,a.skip&&(t=l)),a=c}return o!==null&&r.push({start:t%i,end:o%i,loop:s}),r}function vS(n,t){const e=n.points,s=n.options.spanGaps,i=e.length;if(!i)return[];const r=!!n._loop,{start:o,end:a}=yS(e,i,r,s);if(s===!0)return Fp(n,[{start:o,end:a,loop:r}],e,t);const l=a<o?a+i:a,c=!!n._fullLoop&&o===0&&a===i-1;return Fp(n,_S(e,o,l,c),e,t)}function Fp(n,t,e,s){return!s||!s.setContext||!e?t:AS(n,t,e,s)}function AS(n,t,e,s){const i=n._chart.getContext(),r=Np(n.options),{_datasetIndex:o,options:{spanGaps:a}}=n,l=e.length,c=[];let h=r,u=t[0].start,f=u;function g(p,m,b,y){const A=a?-1:1;if(p!==m){for(p+=l;e[p%l].skip;)p-=A;for(;e[m%l].skip;)m+=A;p%l!==m%l&&(c.push({start:p%l,end:m%l,loop:b,style:y}),h=y,u=m%l)}}for(const p of t){u=a?u:p.start;let m=e[u%l],b;for(f=u+1;f<=p.end;f++){const y=e[f%l];b=Np(s.setContext(Tn(i,{type:"segment",p0:m,p1:y,p0DataIndex:(f-1)%l,p1DataIndex:f%l,datasetIndex:o}))),xS(b,h)&&g(u,f-1,p.loop,h),m=y,h=b}u<f-1&&g(u,f-1,p.loop,h)}return c}function Np(n){return{backgroundColor:n.backgroundColor,borderCapStyle:n.borderCapStyle,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderJoinStyle:n.borderJoinStyle,borderWidth:n.borderWidth,borderColor:n.borderColor}}function xS(n,t){if(!t)return!1;const e=[],s=function(i,r){return Cg(r)?(e.includes(r)||e.push(r),e.indexOf(r)):r};return JSON.stringify(n,s)!==JSON.stringify(t,s)}function sh(n,t,e){return n.options.clip?n[e]:t[e]}function wS(n,t){const{xScale:e,yScale:s}=n;return e&&s?{left:sh(e,t,"left"),right:sh(e,t,"right"),top:sh(s,t,"top"),bottom:sh(s,t,"bottom")}:t}function Ey(n,t){const e=t._clip;if(e.disabled)return!1;const s=wS(t,n.chartArea);return{left:e.left===!1?0:s.left-(e.left===!0?0:e.left),right:e.right===!1?n.width:s.right+(e.right===!0?0:e.right),top:e.top===!1?0:s.top-(e.top===!0?0:e.top),bottom:e.bottom===!1?n.height:s.bottom+(e.bottom===!0?0:e.bottom)}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class SS{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,s,i){const r=e.listeners[i],o=e.duration;r.forEach(a=>a({chart:t,initial:e.initial,numSteps:o,currentStep:Math.min(s-e.start,o)}))}_refresh(){this._request||(this._running=!0,this._request=ay.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let e=0;this._charts.forEach((s,i)=>{if(!s.running||!s.items.length)return;const r=s.items;let o=r.length-1,a=!1,l;for(;o>=0;--o)l=r[o],l._active?(l._total>s.duration&&(s.duration=l._total),l.tick(t),a=!0):(r[o]=r[r.length-1],r.pop());a&&(i.draw(),this._notify(i,s,t,"progress")),r.length||(s.running=!1,this._notify(i,s,t,"complete"),s.initial=!1),e+=r.length}),this._lastDate=t,e===0&&(this._running=!1)}_getAnims(t){const e=this._charts;let s=e.get(t);return s||(s={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,s)),s}listen(t,e,s){this._getAnims(t).listeners[e].push(s)}add(t,e){!e||!e.length||this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((s,i)=>Math.max(s,i._duration),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!(!e||!e.running||!e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const s=e.items;let i=s.length-1;for(;i>=0;--i)s[i].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var Qs=new SS;const Hp="transparent",ES={boolean(n,t,e){return e>.5?t:n},color(n,t,e){const s=Mp(n||Hp),i=s.valid&&Mp(t||Hp);return i&&i.valid?i.mix(s,e).hexString():t},number(n,t,e){return n+(t-n)*e}};class CS{constructor(t,e,s,i){const r=e[s];i=Ka([t.to,i,r,t.from]);const o=Ka([t.from,r,i]);this._active=!0,this._fn=t.fn||ES[t.type||typeof o],this._easing=rl[t.easing]||rl.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=s,this._from=o,this._to=i,this._promises=void 0}active(){return this._active}update(t,e,s){if(this._active){this._notify(!1);const i=this._target[this._prop],r=s-this._start,o=this._duration-r;this._start=s,this._duration=Math.floor(Math.max(o,t.duration)),this._total+=r,this._loop=!!t.loop,this._to=Ka([t.to,e,i,t.from]),this._from=Ka([t.from,i,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,s=this._duration,i=this._prop,r=this._from,o=this._loop,a=this._to;let l;if(this._active=r!==a&&(o||e<s),!this._active){this._target[i]=a,this._notify(!0);return}if(e<0){this._target[i]=r;return}l=e/s%2,l=o&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[i]=this._fn(r,a,l)}wait(){const t=this._promises||(this._promises=[]);return new Promise((e,s)=>{t.push({res:e,rej:s})})}_notify(t){const e=t?"res":"rej",s=this._promises||[];for(let i=0;i<s.length;i++)s[i][e]()}}class Cy{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!nt(t))return;const e=Object.keys(Mt.animation),s=this._properties;Object.getOwnPropertyNames(t).forEach(i=>{const r=t[i];if(!nt(r))return;const o={};for(const a of e)o[a]=r[a];(kt(r.properties)&&r.properties||[i]).forEach(a=>{(a===i||!s.has(a))&&s.set(a,o)})})}_animateOptions(t,e){const s=e.options,i=MS(t,s);if(!i)return[];const r=this._createAnimations(i,s);return s.$shared&&kS(t.options.$animations,s).then(()=>{t.options=s},()=>{}),r}_createAnimations(t,e){const s=this._properties,i=[],r=t.$animations||(t.$animations={}),o=Object.keys(e),a=Date.now();let l;for(l=o.length-1;l>=0;--l){const c=o[l];if(c.charAt(0)==="$")continue;if(c==="options"){i.push(...this._animateOptions(t,e));continue}const h=e[c];let u=r[c];const f=s.get(c);if(u)if(f&&u.active()){u.update(f,h,a);continue}else u.cancel();if(!f||!f.duration){t[c]=h;continue}r[c]=u=new CS(f,t,c,h),i.push(u)}return i}update(t,e){if(this._properties.size===0){Object.assign(t,e);return}const s=this._createAnimations(t,e);if(s.length)return Qs.add(this._chart,s),!0}}function kS(n,t){const e=[],s=Object.keys(t);for(let i=0;i<s.length;i++){const r=n[s[i]];r&&r.active()&&e.push(r.wait())}return Promise.all(e)}function MS(n,t){if(!t)return;let e=n.options;if(!e){n.options=t;return}return e.$shared&&(n.options=e=Object.assign({},e,{$shared:!1,$animations:{}})),e}function Bp(n,t){const e=n&&n.options||{},s=e.reverse,i=e.min===void 0?t:0,r=e.max===void 0?t:0;return{start:s?r:i,end:s?i:r}}function TS(n,t,e){if(e===!1)return!1;const s=Bp(n,e),i=Bp(t,e);return{top:i.end,right:s.end,bottom:i.start,left:s.start}}function LS(n){let t,e,s,i;return nt(n)?(t=n.top,e=n.right,s=n.bottom,i=n.left):t=e=s=i=n,{top:t,right:e,bottom:s,left:i,disabled:n===!1}}function ky(n,t){const e=[],s=n._getSortedDatasetMetas(t);let i,r;for(i=0,r=s.length;i<r;++i)e.push(s[i].index);return e}function zp(n,t,e,s={}){const i=n.keys,r=s.mode==="single";let o,a,l,c;if(t===null)return;let h=!1;for(o=0,a=i.length;o<a;++o){if(l=+i[o],l===e){if(h=!0,s.all)continue;break}c=n.values[l],Dt(c)&&(r||t===0||Us(t)===Us(c))&&(t+=c)}return!h&&!s.all?0:t}function PS(n,t){const{iScale:e,vScale:s}=t,i=e.axis==="x"?"x":"y",r=s.axis==="x"?"x":"y",o=Object.keys(n),a=new Array(o.length);let l,c,h;for(l=0,c=o.length;l<c;++l)h=o[l],a[l]={[i]:h,[r]:n[h]};return a}function nu(n,t){const e=n&&n.options.stacked;return e||e===void 0&&t.stack!==void 0}function RS(n,t,e){return`${n.id}.${t.id}.${e.stack||e.type}`}function DS(n){const{min:t,max:e,minDefined:s,maxDefined:i}=n.getUserBounds();return{min:s?t:Number.NEGATIVE_INFINITY,max:i?e:Number.POSITIVE_INFINITY}}function IS(n,t,e){const s=n[t]||(n[t]={});return s[e]||(s[e]={})}function $p(n,t,e,s){for(const i of t.getMatchingVisibleMetas(s).reverse()){const r=n[i.index];if(e&&r>0||!e&&r<0)return i.index}return null}function Wp(n,t){const{chart:e,_cachedMeta:s}=n,i=e._stacks||(e._stacks={}),{iScale:r,vScale:o,index:a}=s,l=r.axis,c=o.axis,h=RS(r,o,s),u=t.length;let f;for(let g=0;g<u;++g){const p=t[g],{[l]:m,[c]:b}=p,y=p._stacks||(p._stacks={});f=y[c]=IS(i,h,m),f[a]=b,f._top=$p(f,o,!0,s.type),f._bottom=$p(f,o,!1,s.type);const A=f._visualValues||(f._visualValues={});A[a]=b}}function ru(n,t){const e=n.scales;return Object.keys(e).filter(s=>e[s].axis===t).shift()}function OS(n,t){return Tn(n,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function FS(n,t,e){return Tn(n,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:e,index:t,mode:"default",type:"data"})}function Ta(n,t){const e=n.controller.index,s=n.vScale&&n.vScale.axis;if(s){t=t||n._parsed;for(const i of t){const r=i._stacks;if(!r||r[s]===void 0||r[s][e]===void 0)return;delete r[s][e],r[s]._visualValues!==void 0&&r[s]._visualValues[e]!==void 0&&delete r[s]._visualValues[e]}}}const ou=n=>n==="reset"||n==="none",jp=(n,t)=>t?n:Object.assign({},n),NS=(n,t,e)=>n&&!t.hidden&&t._stacked&&{keys:ky(e,!0),values:null};class ms{constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=nu(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&Ta(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,s=this.getDataset(),i=(u,f,g,p)=>u==="x"?f:u==="r"?p:g,r=e.xAxisID=Z(s.xAxisID,ru(t,"x")),o=e.yAxisID=Z(s.yAxisID,ru(t,"y")),a=e.rAxisID=Z(s.rAxisID,ru(t,"r")),l=e.indexAxis,c=e.iAxisID=i(l,r,o,a),h=e.vAxisID=i(l,o,r,a);e.xScale=this.getScaleForId(r),e.yScale=this.getScaleForId(o),e.rScale=this.getScaleForId(a),e.iScale=this.getScaleForId(c),e.vScale=this.getScaleForId(h)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&Ep(this._data,this),t._stacked&&Ta(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),s=this._data;if(nt(e)){const i=this._cachedMeta;this._data=PS(e,i)}else if(s!==e){if(s){Ep(s,this);const i=this._cachedMeta;Ta(i),i._parsed=[]}e&&Object.isExtensible(e)&&Aw(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,s=this.getDataset();let i=!1;this._dataCheck();const r=e._stacked;e._stacked=nu(e.vScale,e),e.stack!==s.stack&&(i=!0,Ta(e),e.stack=s.stack),this._resyncElements(t),(i||r!==e._stacked)&&(Wp(this,e._parsed),e._stacked=nu(e.vScale,e))}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),s=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(s,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:s,_data:i}=this,{iScale:r,_stacked:o}=s,a=r.axis;let l=t===0&&e===i.length?!0:s._sorted,c=t>0&&s._parsed[t-1],h,u,f;if(this._parsing===!1)s._parsed=i,s._sorted=!0,f=i;else{kt(i[t])?f=this.parseArrayData(s,i,t,e):nt(i[t])?f=this.parseObjectData(s,i,t,e):f=this.parsePrimitiveData(s,i,t,e);const g=()=>u[a]===null||c&&u[a]<c[a];for(h=0;h<e;++h)s._parsed[h+t]=u=f[h],l&&(g()&&(l=!1),c=u);s._sorted=l}o&&Wp(this,f)}parsePrimitiveData(t,e,s,i){const{iScale:r,vScale:o}=t,a=r.axis,l=o.axis,c=r.getLabels(),h=r===o,u=new Array(i);let f,g,p;for(f=0,g=i;f<g;++f)p=f+s,u[f]={[a]:h||r.parse(c[p],p),[l]:o.parse(e[p],p)};return u}parseArrayData(t,e,s,i){const{xScale:r,yScale:o}=t,a=new Array(i);let l,c,h,u;for(l=0,c=i;l<c;++l)h=l+s,u=e[h],a[l]={x:r.parse(u[0],h),y:o.parse(u[1],h)};return a}parseObjectData(t,e,s,i){const{xScale:r,yScale:o}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=new Array(i);let h,u,f,g;for(h=0,u=i;h<u;++h)f=h+s,g=e[f],c[h]={x:r.parse(Sn(g,a),f),y:o.parse(Sn(g,l),f)};return c}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,s){const i=this.chart,r=this._cachedMeta,o=e[t.axis],a={keys:ky(i,!0),values:e._stacks[t.axis]._visualValues};return zp(a,o,r.index,{mode:s})}updateRangeFromParsed(t,e,s,i){const r=s[e.axis];let o=r===null?NaN:r;const a=i&&s._stacks[e.axis];i&&a&&(i.values=a,o=zp(i,r,this._cachedMeta.index)),t.min=Math.min(t.min,o),t.max=Math.max(t.max,o)}getMinMax(t,e){const s=this._cachedMeta,i=s._parsed,r=s._sorted&&t===s.iScale,o=i.length,a=this._getOtherScale(t),l=NS(e,s,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:h,max:u}=DS(a);let f,g;function p(){g=i[f];const m=g[a.axis];return!Dt(g[t.axis])||h>m||u<m}for(f=0;f<o&&!(!p()&&(this.updateRangeFromParsed(c,t,g,l),r));++f);if(r){for(f=o-1;f>=0;--f)if(!p()){this.updateRangeFromParsed(c,t,g,l);break}}return c}getAllParsedValues(t){const e=this._cachedMeta._parsed,s=[];let i,r,o;for(i=0,r=e.length;i<r;++i)o=e[i][t.axis],Dt(o)&&s.push(o);return s}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,s=e.iScale,i=e.vScale,r=this.getParsed(t);return{label:s?""+s.getLabelForValue(r[s.axis]):"",value:i?""+i.getLabelForValue(r[i.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=LS(Z(this.options.clip,TS(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,s=this._cachedMeta,i=s.data||[],r=e.chartArea,o=[],a=this._drawStart||0,l=this._drawCount||i.length-a,c=this.options.drawActiveElementsOnTop;let h;for(s.dataset&&s.dataset.draw(t,r,a,l),h=a;h<a+l;++h){const u=i[h];u.hidden||(u.active&&c?o.push(u):u.draw(t,r))}for(h=0;h<o.length;++h)o[h].draw(t,r)}getStyle(t,e){const s=e?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(s):this.resolveDataElementOptions(t||0,s)}getContext(t,e,s){const i=this.getDataset();let r;if(t>=0&&t<this._cachedMeta.data.length){const o=this._cachedMeta.data[t];r=o.$context||(o.$context=FS(this.getContext(),t,o)),r.parsed=this.getParsed(t),r.raw=i.data[t],r.index=r.dataIndex=t}else r=this.$context||(this.$context=OS(this.chart.getContext(),this.index)),r.dataset=i,r.index=r.datasetIndex=this.index;return r.active=!!e,r.mode=s,r}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",s){const i=e==="active",r=this._cachedDataOpts,o=t+"-"+e,a=r[o],l=this.enableOptionSharing&&fl(s);if(a)return jp(a,l);const c=this.chart.config,h=c.datasetElementScopeKeys(this._type,t),u=i?[`${t}Hover`,"hover",t,""]:[t,""],f=c.getOptionScopes(this.getDataset(),h),g=Object.keys(Mt.elements[t]),p=()=>this.getContext(s,i,e),m=c.resolveNamedOptions(f,g,p,u);return m.$shared&&(m.$shared=l,r[o]=Object.freeze(jp(m,l))),m}_resolveAnimations(t,e,s){const i=this.chart,r=this._cachedDataOpts,o=`animation-${e}`,a=r[o];if(a)return a;let l;if(i.options.animation!==!1){const h=this.chart.config,u=h.datasetAnimationScopeKeys(this._type,e),f=h.getOptionScopes(this.getDataset(),u);l=h.createResolver(f,this.getContext(t,s,e))}const c=new Cy(i,l&&l.animations);return l&&l._cacheable&&(r[o]=Object.freeze(c)),c}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||ou(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const s=this.resolveDataElementOptions(t,e),i=this._sharedOptions,r=this.getSharedOptions(s),o=this.includeOptions(e,r)||r!==i;return this.updateSharedOptions(r,e,s),{sharedOptions:r,includeOptions:o}}updateElement(t,e,s,i){ou(i)?Object.assign(t,s):this._resolveAnimations(e,i).update(t,s)}updateSharedOptions(t,e,s){t&&!ou(e)&&this._resolveAnimations(void 0,e).update(t,s)}_setStyle(t,e,s,i){t.active=i;const r=this.getStyle(e,i);this._resolveAnimations(e,s,i).update(t,{options:!i&&this.getSharedOptions(r)||r})}removeHoverStyle(t,e,s){this._setStyle(t,s,"active",!1)}setHoverStyle(t,e,s){this._setStyle(t,s,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,s=this._cachedMeta.data;for(const[a,l,c]of this._syncList)this[a](l,c);this._syncList=[];const i=s.length,r=e.length,o=Math.min(r,i);o&&this.parse(0,o),r>i?this._insertElements(i,r-i,t):r<i&&this._removeElements(r,i-r)}_insertElements(t,e,s=!0){const i=this._cachedMeta,r=i.data,o=t+e;let a;const l=c=>{for(c.length+=e,a=c.length-1;a>=o;a--)c[a]=c[a-e]};for(l(r),a=t;a<o;++a)r[a]=new this.dataElementType;this._parsing&&l(i._parsed),this.parse(t,e),s&&this.updateElements(r,t,e,"reset")}updateElements(t,e,s,i){}_removeElements(t,e){const s=this._cachedMeta;if(this._parsing){const i=s._parsed.splice(t,e);s._stacked&&Ta(s,i)}s.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,s,i]=t;this[e](s,i)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const s=arguments.length-2;s&&this._sync(["_insertElements",t,s])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}T(ms,"defaults",{}),T(ms,"datasetElementType",null),T(ms,"dataElementType",null);function HS(n,t){if(!n._cache.$bar){const e=n.getMatchingVisibleMetas(t);let s=[];for(let i=0,r=e.length;i<r;i++)s=s.concat(e[i].controller.getAllParsedValues(n));n._cache.$bar=oy(s.sort((i,r)=>i-r))}return n._cache.$bar}function BS(n){const t=n.iScale,e=HS(t,n.type);let s=t._length,i,r,o,a;const l=()=>{o===32767||o===-32768||(fl(a)&&(s=Math.min(s,Math.abs(o-a)||s)),a=o)};for(i=0,r=e.length;i<r;++i)o=t.getPixelForValue(e[i]),l();for(a=void 0,i=0,r=t.ticks.length;i<r;++i)o=t.getPixelForTick(i),l();return s}function zS(n,t,e,s){const i=e.barThickness;let r,o;return st(i)?(r=t.min*e.categoryPercentage,o=e.barPercentage):(r=i*s,o=1),{chunk:r/s,ratio:o,start:t.pixels[n]-r/2}}function $S(n,t,e,s){const i=t.pixels,r=i[n];let o=n>0?i[n-1]:null,a=n<i.length-1?i[n+1]:null;const l=e.categoryPercentage;o===null&&(o=r-(a===null?t.end-t.start:a-r)),a===null&&(a=r+r-o);const c=r-(r-Math.min(o,a))/2*l;return{chunk:Math.abs(a-o)/2*l/s,ratio:e.barPercentage,start:c}}function WS(n,t,e,s){const i=e.parse(n[0],s),r=e.parse(n[1],s),o=Math.min(i,r),a=Math.max(i,r);let l=o,c=a;Math.abs(o)>Math.abs(a)&&(l=a,c=o),t[e.axis]=c,t._custom={barStart:l,barEnd:c,start:i,end:r,min:o,max:a}}function My(n,t,e,s){return kt(n)?WS(n,t,e,s):t[e.axis]=e.parse(n,s),t}function Vp(n,t,e,s){const i=n.iScale,r=n.vScale,o=i.getLabels(),a=i===r,l=[];let c,h,u,f;for(c=e,h=e+s;c<h;++c)f=t[c],u={},u[i.axis]=a||i.parse(o[c],c),l.push(My(f,u,r,c));return l}function au(n){return n&&n.barStart!==void 0&&n.barEnd!==void 0}function jS(n,t,e){return n!==0?Us(n):(t.isHorizontal()?1:-1)*(t.min>=e?1:-1)}function VS(n){let t,e,s,i,r;return n.horizontal?(t=n.base>n.x,e="left",s="right"):(t=n.base<n.y,e="bottom",s="top"),t?(i="end",r="start"):(i="start",r="end"),{start:e,end:s,reverse:t,top:i,bottom:r}}function US(n,t,e,s){let i=t.borderSkipped;const r={};if(!i){n.borderSkipped=r;return}if(i===!0){n.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:o,end:a,reverse:l,top:c,bottom:h}=VS(n);i==="middle"&&e&&(n.enableBorderRadius=!0,(e._top||0)===s?i=c:(e._bottom||0)===s?i=h:(r[Up(h,o,a,l)]=!0,i=c)),r[Up(i,o,a,l)]=!0,n.borderSkipped=r}function Up(n,t,e,s){return s?(n=GS(n,t,e),n=Gp(n,e,t)):n=Gp(n,t,e),n}function GS(n,t,e){return n===t?e:n===e?t:n}function Gp(n,t,e){return n==="start"?t:n==="end"?e:n}function XS(n,{inflateAmount:t},e){n.inflateAmount=t==="auto"?e===1?.33:0:t}class Hh extends ms{parsePrimitiveData(t,e,s,i){return Vp(t,e,s,i)}parseArrayData(t,e,s,i){return Vp(t,e,s,i)}parseObjectData(t,e,s,i){const{iScale:r,vScale:o}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=r.axis==="x"?a:l,h=o.axis==="x"?a:l,u=[];let f,g,p,m;for(f=s,g=s+i;f<g;++f)m=e[f],p={},p[r.axis]=r.parse(Sn(m,c),f),u.push(My(Sn(m,h),p,o,f));return u}updateRangeFromParsed(t,e,s,i){super.updateRangeFromParsed(t,e,s,i);const r=s._custom;r&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,r.min),t.max=Math.max(t.max,r.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:s,vScale:i}=e,r=this.getParsed(t),o=r._custom,a=au(o)?"["+o.start+", "+o.end+"]":""+i.getLabelForValue(r[i.axis]);return{label:""+s.getLabelForValue(r[s.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,s,i){const r=i==="reset",{index:o,_cachedMeta:{vScale:a}}=this,l=a.getBasePixel(),c=a.isHorizontal(),h=this._getRuler(),{sharedOptions:u,includeOptions:f}=this._getSharedOptions(e,i);for(let g=e;g<e+s;g++){const p=this.getParsed(g),m=r||st(p[a.axis])?{base:l,head:l}:this._calculateBarValuePixels(g),b=this._calculateBarIndexPixels(g,h),y=(p._stacks||{})[a.axis],A={horizontal:c,base:m.base,enableBorderRadius:!y||au(p._custom)||o===y._top||o===y._bottom,x:c?m.head:b.center,y:c?b.center:m.head,height:c?b.size:Math.abs(m.size),width:c?Math.abs(m.size):b.size};f&&(A.options=u||this.resolveDataElementOptions(g,t[g].active?"active":i));const w=A.options||t[g].options;US(A,w,y,o),XS(A,w,h.ratio),this.updateElement(t[g],g,A,i)}}_getStacks(t,e){const{iScale:s}=this._cachedMeta,i=s.getMatchingVisibleMetas(this._type).filter(h=>h.controller.options.grouped),r=s.options.stacked,o=[],a=this._cachedMeta.controller.getParsed(e),l=a&&a[s.axis],c=h=>{const u=h._parsed.find(g=>g[s.axis]===l),f=u&&u[h.vScale.axis];if(st(f)||isNaN(f))return!0};for(const h of i)if(!(e!==void 0&&c(h))&&((r===!1||o.indexOf(h.stack)===-1||r===void 0&&h.stack===void 0)&&o.push(h.stack),h.index===t))break;return o.length||o.push(void 0),o}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,e=this.chart.options.indexAxis;return Object.keys(t).filter(s=>t[s].axis===e).shift()}_getAxis(){const t={},e=this.getFirstScaleIdForIndexAxis();for(const s of this.chart.data.datasets)t[Z(this.chart.options.indexAxis==="x"?s.xAxisID:s.yAxisID,e)]=!0;return Object.keys(t)}_getStackIndex(t,e,s){const i=this._getStacks(t,s),r=e!==void 0?i.indexOf(e):-1;return r===-1?i.length-1:r}_getRuler(){const t=this.options,e=this._cachedMeta,s=e.iScale,i=[];let r,o;for(r=0,o=e.data.length;r<o;++r)i.push(s.getPixelForValue(this.getParsed(r)[s.axis],r));const a=t.barThickness;return{min:a||BS(e),pixels:i,start:s._startPixel,end:s._endPixel,stackCount:this._getStackCount(),scale:s,grouped:t.grouped,ratio:a?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:s,index:i},options:{base:r,minBarLength:o}}=this,a=r||0,l=this.getParsed(t),c=l._custom,h=au(c);let u=l[e.axis],f=0,g=s?this.applyStack(e,l,s):u,p,m;g!==u&&(f=g-u,g=u),h&&(u=c.barStart,g=c.barEnd-c.barStart,u!==0&&Us(u)!==Us(c.barEnd)&&(f=0),f+=u);const b=!st(r)&&!h?r:f;let y=e.getPixelForValue(b);if(this.chart.getDataVisibility(t)?p=e.getPixelForValue(f+g):p=y,m=p-y,Math.abs(m)<o){m=jS(m,e,a)*o,u===a&&(y-=m/2);const A=e.getPixelForDecimal(0),w=e.getPixelForDecimal(1),S=Math.min(A,w),E=Math.max(A,w);y=Math.max(Math.min(y,E),S),p=y+m,s&&!h&&(l._stacks[e.axis]._visualValues[i]=e.getValueForPixel(p)-e.getValueForPixel(y))}if(y===e.getPixelForValue(a)){const A=Us(m)*e.getLineWidthForValue(a)/2;y+=A,m-=A}return{size:m,base:y,head:p,center:p+m/2}}_calculateBarIndexPixels(t,e){const s=e.scale,i=this.options,r=i.skipNull,o=Z(i.maxBarThickness,1/0);let a,l;const c=this._getAxisCount();if(e.grouped){const h=r?this._getStackCount(t):e.stackCount,u=i.barThickness==="flex"?$S(t,e,i,h*c):zS(t,e,i,h*c),f=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,g=this._getAxis().indexOf(Z(f,this.getFirstScaleIdForIndexAxis())),p=this._getStackIndex(this.index,this._cachedMeta.stack,r?t:void 0)+g;a=u.start+u.chunk*p+u.chunk/2,l=Math.min(o,u.chunk*u.ratio)}else a=s.getPixelForValue(this.getParsed(t)[s.axis],t),l=Math.min(o,e.min*e.ratio);return{base:a-l/2,head:a+l/2,center:a,size:l}}draw(){const t=this._cachedMeta,e=t.vScale,s=t.data,i=s.length;let r=0;for(;r<i;++r)this.getParsed(r)[e.axis]!==null&&!s[r].hidden&&s[r].draw(this._ctx)}}T(Hh,"id","bar"),T(Hh,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),T(Hh,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class Bh extends ms{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,s,i){const r=super.parsePrimitiveData(t,e,s,i);for(let o=0;o<r.length;o++)r[o]._custom=this.resolveDataElementOptions(o+s).radius;return r}parseArrayData(t,e,s,i){const r=super.parseArrayData(t,e,s,i);for(let o=0;o<r.length;o++){const a=e[s+o];r[o]._custom=Z(a[2],this.resolveDataElementOptions(o+s).radius)}return r}parseObjectData(t,e,s,i){const r=super.parseObjectData(t,e,s,i);for(let o=0;o<r.length;o++){const a=e[s+o];r[o]._custom=Z(a&&a.r&&+a.r,this.resolveDataElementOptions(o+s).radius)}return r}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let s=t.length-1;s>=0;--s)e=Math.max(e,t[s].size(this.resolveDataElementOptions(s))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart.data.labels||[],{xScale:i,yScale:r}=e,o=this.getParsed(t),a=i.getLabelForValue(o.x),l=r.getLabelForValue(o.y),c=o._custom;return{label:s[t]||"",value:"("+a+", "+l+(c?", "+c:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,s,i){const r=i==="reset",{iScale:o,vScale:a}=this._cachedMeta,{sharedOptions:l,includeOptions:c}=this._getSharedOptions(e,i),h=o.axis,u=a.axis;for(let f=e;f<e+s;f++){const g=t[f],p=!r&&this.getParsed(f),m={},b=m[h]=r?o.getPixelForDecimal(.5):o.getPixelForValue(p[h]),y=m[u]=r?a.getBasePixel():a.getPixelForValue(p[u]);m.skip=isNaN(b)||isNaN(y),c&&(m.options=l||this.resolveDataElementOptions(f,g.active?"active":i),r&&(m.options.radius=0)),this.updateElement(g,f,m,i)}}resolveDataElementOptions(t,e){const s=this.getParsed(t);let i=super.resolveDataElementOptions(t,e);i.$shared&&(i=Object.assign({},i,{$shared:!1}));const r=i.radius;return e!=="active"&&(i.radius=0),i.radius+=Z(s&&s._custom,r),i}}T(Bh,"id","bubble"),T(Bh,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),T(Bh,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function YS(n,t,e){let s=1,i=1,r=0,o=0;if(t<St){const a=n,l=a+t,c=Math.cos(a),h=Math.sin(a),u=Math.cos(l),f=Math.sin(l),g=(w,S,E)=>gl(w,a,l,!0)?1:Math.max(S,S*e,E,E*e),p=(w,S,E)=>gl(w,a,l,!0)?-1:Math.min(S,S*e,E,E*e),m=g(0,c,u),b=g(Nt,h,f),y=p(ht,c,u),A=p(ht+Nt,h,f);s=(m-y)/2,i=(b-A)/2,r=-(m+y)/2,o=-(b+A)/2}return{ratioX:s,ratioY:i,offsetX:r,offsetY:o}}class Gn extends ms{constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const s=this.getDataset().data,i=this._cachedMeta;if(this._parsing===!1)i._parsed=s;else{let r=l=>+s[l];if(nt(s[t])){const{key:l="value"}=this._parsing;r=c=>+Sn(s[c],l)}let o,a;for(o=t,a=t+e;o<a;++o)i._parsed[o]=r(o)}}_getRotation(){return ps(this.options.rotation-90)}_getCircumference(){return ps(this.options.circumference)}_getRotationExtents(){let t=St,e=-St;for(let s=0;s<this.chart.data.datasets.length;++s)if(this.chart.isDatasetVisible(s)&&this.chart.getDatasetMeta(s).type===this._type){const i=this.chart.getDatasetMeta(s).controller,r=i._getRotation(),o=i._getCircumference();t=Math.min(t,r),e=Math.max(e,r+o)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:s}=e,i=this._cachedMeta,r=i.data,o=this.getMaxBorderWidth()+this.getMaxOffset(r)+this.options.spacing,a=Math.max((Math.min(s.width,s.height)-o)/2,0),l=Math.min(ow(this.options.cutout,a),1),c=this._getRingWeight(this.index),{circumference:h,rotation:u}=this._getRotationExtents(),{ratioX:f,ratioY:g,offsetX:p,offsetY:m}=YS(u,h,l),b=(s.width-o)/f,y=(s.height-o)/g,A=Math.max(Math.min(b,y)/2,0),w=ey(this.options.radius,A),S=Math.max(w*l,0),E=(w-S)/this._getVisibleDatasetWeightTotal();this.offsetX=p*w,this.offsetY=m*w,i.total=this.calculateTotal(),this.outerRadius=w-E*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-E*c,0),this.updateElements(r,0,r.length,t)}_circumference(t,e){const s=this.options,i=this._cachedMeta,r=this._getCircumference();return e&&s.animation.animateRotate||!this.chart.getDataVisibility(t)||i._parsed[t]===null||i.data[t].hidden?0:this.calculateCircumference(i._parsed[t]*r/St)}updateElements(t,e,s,i){const r=i==="reset",o=this.chart,a=o.chartArea,c=o.options.animation,h=(a.left+a.right)/2,u=(a.top+a.bottom)/2,f=r&&c.animateScale,g=f?0:this.innerRadius,p=f?0:this.outerRadius,{sharedOptions:m,includeOptions:b}=this._getSharedOptions(e,i);let y=this._getRotation(),A;for(A=0;A<e;++A)y+=this._circumference(A,r);for(A=e;A<e+s;++A){const w=this._circumference(A,r),S=t[A],E={x:h+this.offsetX,y:u+this.offsetY,startAngle:y,endAngle:y+w,circumference:w,outerRadius:p,innerRadius:g};b&&(E.options=m||this.resolveDataElementOptions(A,S.active?"active":i)),y+=w,this.updateElement(S,A,E,i)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let s=0,i;for(i=0;i<e.length;i++){const r=t._parsed[i];r!==null&&!isNaN(r)&&this.chart.getDataVisibility(i)&&!e[i].hidden&&(s+=Math.abs(r))}return s}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?St*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart,i=s.data.labels||[],r=$c(e._parsed[t],s.options.locale);return{label:i[t]||"",value:r}}getMaxBorderWidth(t){let e=0;const s=this.chart;let i,r,o,a,l;if(!t){for(i=0,r=s.data.datasets.length;i<r;++i)if(s.isDatasetVisible(i)){o=s.getDatasetMeta(i),t=o.data,a=o.controller;break}}if(!t)return 0;for(i=0,r=t.length;i<r;++i)l=a.resolveDataElementOptions(i),l.borderAlign!=="inner"&&(e=Math.max(e,l.borderWidth||0,l.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let s=0,i=t.length;s<i;++s){const r=this.resolveDataElementOptions(s);e=Math.max(e,r.offset||0,r.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let s=0;s<t;++s)this.chart.isDatasetVisible(s)&&(e+=this._getRingWeight(s));return e}_getRingWeight(t){return Math.max(Z(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}T(Gn,"id","doughnut"),T(Gn,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),T(Gn,"descriptors",{_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")}),T(Gn,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data,{labels:{pointStyle:s,textAlign:i,color:r,useBorderRadius:o,borderRadius:a}}=t.legend.options;return e.labels.length&&e.datasets.length?e.labels.map((l,c)=>{const u=t.getDatasetMeta(0).controller.getStyle(c);return{text:l,fillStyle:u.backgroundColor,fontColor:r,hidden:!t.getDataVisibility(c),lineDash:u.borderDash,lineDashOffset:u.borderDashOffset,lineJoin:u.borderJoinStyle,lineWidth:u.borderWidth,strokeStyle:u.borderColor,textAlign:i,pointStyle:s,borderRadius:o&&(a||u.borderRadius),index:c}}):[]}},onClick(t,e,s){s.chart.toggleDataVisibility(e.index),s.chart.update()}}}});class zh extends ms{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:s,data:i=[],_dataset:r}=e,o=this.chart._animationsDisabled;let{start:a,count:l}=cy(e,i,o);this._drawStart=a,this._drawCount=l,hy(e)&&(a=0,l=i.length),s._chart=this.chart,s._datasetIndex=this.index,s._decimated=!!r._decimated,s.points=i;const c=this.resolveDatasetElementOptions(t);this.options.showLine||(c.borderWidth=0),c.segment=this.options.segment,this.updateElement(s,void 0,{animated:!o,options:c},t),this.updateElements(i,a,l,t)}updateElements(t,e,s,i){const r=i==="reset",{iScale:o,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,{sharedOptions:h,includeOptions:u}=this._getSharedOptions(e,i),f=o.axis,g=a.axis,{spanGaps:p,segment:m}=this.options,b=va(p)?p:Number.POSITIVE_INFINITY,y=this.chart._animationsDisabled||r||i==="none",A=e+s,w=t.length;let S=e>0&&this.getParsed(e-1);for(let E=0;E<w;++E){const C=t[E],k=y?C:{};if(E<e||E>=A){k.skip=!0;continue}const M=this.getParsed(E),R=st(M[g]),N=k[f]=o.getPixelForValue(M[f],E),O=k[g]=r||R?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,M,l):M[g],E);k.skip=isNaN(N)||isNaN(O)||R,k.stop=E>0&&Math.abs(M[f]-S[f])>b,m&&(k.parsed=M,k.raw=c.data[E]),u&&(k.options=h||this.resolveDataElementOptions(E,C.active?"active":i)),y||this.updateElement(C,E,k,i),S=M}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,s=e.options&&e.options.borderWidth||0,i=t.data||[];if(!i.length)return s;const r=i[0].size(this.resolveDataElementOptions(0)),o=i[i.length-1].size(this.resolveDataElementOptions(i.length-1));return Math.max(s,r,o)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}T(zh,"id","line"),T(zh,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),T(zh,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class al extends ms{constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart,i=s.data.labels||[],r=$c(e._parsed[t].r,s.options.locale);return{label:i[t]||"",value:r}}parseObjectData(t,e,s,i){return yy.bind(this)(t,e,s,i)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((s,i)=>{const r=this.getParsed(i).r;!isNaN(r)&&this.chart.getDataVisibility(i)&&(r<e.min&&(e.min=r),r>e.max&&(e.max=r))}),e}_updateRadius(){const t=this.chart,e=t.chartArea,s=t.options,i=Math.min(e.right-e.left,e.bottom-e.top),r=Math.max(i/2,0),o=Math.max(s.cutoutPercentage?r/100*s.cutoutPercentage:1,0),a=(r-o)/t.getVisibleDatasetCount();this.outerRadius=r-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(t,e,s,i){const r=i==="reset",o=this.chart,l=o.options.animation,c=this._cachedMeta.rScale,h=c.xCenter,u=c.yCenter,f=c.getIndexAngle(0)-.5*ht;let g=f,p;const m=360/this.countVisibleElements();for(p=0;p<e;++p)g+=this._computeAngle(p,i,m);for(p=e;p<e+s;p++){const b=t[p];let y=g,A=g+this._computeAngle(p,i,m),w=o.getDataVisibility(p)?c.getDistanceFromCenterForValue(this.getParsed(p).r):0;g=A,r&&(l.animateScale&&(w=0),l.animateRotate&&(y=A=f));const S={x:h,y:u,innerRadius:0,outerRadius:w,startAngle:y,endAngle:A,options:this.resolveDataElementOptions(p,b.active?"active":i)};this.updateElement(b,p,S,i)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach((s,i)=>{!isNaN(this.getParsed(i).r)&&this.chart.getDataVisibility(i)&&e++}),e}_computeAngle(t,e,s){return this.chart.getDataVisibility(t)?ps(this.resolveDataElementOptions(t,e).angle||s):0}}T(al,"id","polarArea"),T(al,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),T(al,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:s,color:i}}=t.legend.options;return e.labels.map((r,o)=>{const l=t.getDatasetMeta(0).controller.getStyle(o);return{text:r,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:i,lineWidth:l.borderWidth,pointStyle:s,hidden:!t.getDataVisibility(o),index:o}})}return[]}},onClick(t,e,s){s.chart.toggleDataVisibility(e.index),s.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class Gf extends Gn{}T(Gf,"id","pie"),T(Gf,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class $h extends ms{getLabelAndValue(t){const e=this._cachedMeta.vScale,s=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(s[e.axis])}}parseObjectData(t,e,s,i){return yy.bind(this)(t,e,s,i)}update(t){const e=this._cachedMeta,s=e.dataset,i=e.data||[],r=e.iScale.getLabels();if(s.points=i,t!=="resize"){const o=this.resolveDatasetElementOptions(t);this.options.showLine||(o.borderWidth=0);const a={_loop:!0,_fullLoop:r.length===i.length,options:o};this.updateElement(s,void 0,a,t)}this.updateElements(i,0,i.length,t)}updateElements(t,e,s,i){const r=this._cachedMeta.rScale,o=i==="reset";for(let a=e;a<e+s;a++){const l=t[a],c=this.resolveDataElementOptions(a,l.active?"active":i),h=r.getPointPositionForValue(a,this.getParsed(a).r),u=o?r.xCenter:h.x,f=o?r.yCenter:h.y,g={x:u,y:f,angle:h.angle,skip:isNaN(u)||isNaN(f),options:c};this.updateElement(l,a,g,i)}}}T($h,"id","radar"),T($h,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),T($h,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class Wh extends ms{getLabelAndValue(t){const e=this._cachedMeta,s=this.chart.data.labels||[],{xScale:i,yScale:r}=e,o=this.getParsed(t),a=i.getLabelForValue(o.x),l=r.getLabelForValue(o.y);return{label:s[t]||"",value:"("+a+", "+l+")"}}update(t){const e=this._cachedMeta,{data:s=[]}=e,i=this.chart._animationsDisabled;let{start:r,count:o}=cy(e,s,i);if(this._drawStart=r,this._drawCount=o,hy(e)&&(r=0,o=s.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:a,_dataset:l}=e;a._chart=this.chart,a._datasetIndex=this.index,a._decimated=!!l._decimated,a.points=s;const c=this.resolveDatasetElementOptions(t);c.segment=this.options.segment,this.updateElement(a,void 0,{animated:!i,options:c},t)}else this.datasetElementType&&(delete e.dataset,this.datasetElementType=!1);this.updateElements(s,r,o,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,e,s,i){const r=i==="reset",{iScale:o,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,h=this.resolveDataElementOptions(e,i),u=this.getSharedOptions(h),f=this.includeOptions(i,u),g=o.axis,p=a.axis,{spanGaps:m,segment:b}=this.options,y=va(m)?m:Number.POSITIVE_INFINITY,A=this.chart._animationsDisabled||r||i==="none";let w=e>0&&this.getParsed(e-1);for(let S=e;S<e+s;++S){const E=t[S],C=this.getParsed(S),k=A?E:{},M=st(C[p]),R=k[g]=o.getPixelForValue(C[g],S),N=k[p]=r||M?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,C,l):C[p],S);k.skip=isNaN(R)||isNaN(N)||M,k.stop=S>0&&Math.abs(C[g]-w[g])>y,b&&(k.parsed=C,k.raw=c.data[S]),f&&(k.options=u||this.resolveDataElementOptions(S,E.active?"active":i)),A||this.updateElement(E,S,k,i),w=C}this.updateSharedOptions(u,i,h)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let a=0;for(let l=e.length-1;l>=0;--l)a=Math.max(a,e[l].size(this.resolveDataElementOptions(l))/2);return a>0&&a}const s=t.dataset,i=s.options&&s.options.borderWidth||0;if(!e.length)return i;const r=e[0].size(this.resolveDataElementOptions(0)),o=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(i,r,o)/2}}T(Wh,"id","scatter"),T(Wh,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),T(Wh,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var qS=Object.freeze({__proto__:null,BarController:Hh,BubbleController:Bh,DoughnutController:Gn,LineController:zh,PieController:Gf,PolarAreaController:al,RadarController:$h,ScatterController:Wh});function Fn(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class Dg{constructor(t){T(this,"options");this.options=t||{}}static override(t){Object.assign(Dg.prototype,t)}init(){}formats(){return Fn()}parse(){return Fn()}format(){return Fn()}add(){return Fn()}diff(){return Fn()}startOf(){return Fn()}endOf(){return Fn()}}var KS={_date:Dg};function ZS(n,t,e,s){const{controller:i,data:r,_sorted:o}=n,a=i._cachedMeta.iScale,l=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null;if(a&&t===a.axis&&t!=="r"&&o&&r.length){const c=a._reversePixels?_w:Li;if(s){if(i._sharedOptions){const h=r[0],u=typeof h.getRange=="function"&&h.getRange(t);if(u){const f=c(r,t,e-u),g=c(r,t,e+u);return{lo:f.lo,hi:g.hi}}}}else{const h=c(r,t,e);if(l){const{vScale:u}=i._cachedMeta,{_parsed:f}=n,g=f.slice(0,h.lo+1).reverse().findIndex(m=>!st(m[u.axis]));h.lo-=Math.max(0,g);const p=f.slice(h.hi).findIndex(m=>!st(m[u.axis]));h.hi+=Math.max(0,p)}return h}}return{lo:0,hi:r.length-1}}function Hd(n,t,e,s,i){const r=n.getSortedVisibleDatasetMetas(),o=e[t];for(let a=0,l=r.length;a<l;++a){const{index:c,data:h}=r[a],{lo:u,hi:f}=ZS(r[a],t,o,i);for(let g=u;g<=f;++g){const p=h[g];p.skip||s(p,c,g)}}}function JS(n){const t=n.indexOf("x")!==-1,e=n.indexOf("y")!==-1;return function(s,i){const r=t?Math.abs(s.x-i.x):0,o=e?Math.abs(s.y-i.y):0;return Math.sqrt(Math.pow(r,2)+Math.pow(o,2))}}function lu(n,t,e,s,i){const r=[];return!i&&!n.isPointInArea(t)||Hd(n,e,t,function(a,l,c){!i&&!Pi(a,n.chartArea,0)||a.inRange(t.x,t.y,s)&&r.push({element:a,datasetIndex:l,index:c})},!0),r}function QS(n,t,e,s){let i=[];function r(o,a,l){const{startAngle:c,endAngle:h}=o.getProps(["startAngle","endAngle"],s),{angle:u}=ny(o,{x:t.x,y:t.y});gl(u,c,h)&&i.push({element:o,datasetIndex:a,index:l})}return Hd(n,e,t,r),i}function tE(n,t,e,s,i,r){let o=[];const a=JS(e);let l=Number.POSITIVE_INFINITY;function c(h,u,f){const g=h.inRange(t.x,t.y,i);if(s&&!g)return;const p=h.getCenterPoint(i);if(!(!!r||n.isPointInArea(p))&&!g)return;const b=a(t,p);b<l?(o=[{element:h,datasetIndex:u,index:f}],l=b):b===l&&o.push({element:h,datasetIndex:u,index:f})}return Hd(n,e,t,c),o}function cu(n,t,e,s,i,r){return!r&&!n.isPointInArea(t)?[]:e==="r"&&!s?QS(n,t,e,i):tE(n,t,e,s,i,r)}function Xp(n,t,e,s,i){const r=[],o=e==="x"?"inXRange":"inYRange";let a=!1;return Hd(n,e,t,(l,c,h)=>{l[o]&&l[o](t[e],i)&&(r.push({element:l,datasetIndex:c,index:h}),a=a||l.inRange(t.x,t.y,i))}),s&&!a?[]:r}var eE={modes:{index(n,t,e,s){const i=$n(t,n),r=e.axis||"x",o=e.includeInvisible||!1,a=e.intersect?lu(n,i,r,s,o):cu(n,i,r,!1,s,o),l=[];return a.length?(n.getSortedVisibleDatasetMetas().forEach(c=>{const h=a[0].index,u=c.data[h];u&&!u.skip&&l.push({element:u,datasetIndex:c.index,index:h})}),l):[]},dataset(n,t,e,s){const i=$n(t,n),r=e.axis||"xy",o=e.includeInvisible||!1;let a=e.intersect?lu(n,i,r,s,o):cu(n,i,r,!1,s,o);if(a.length>0){const l=a[0].datasetIndex,c=n.getDatasetMeta(l).data;a=[];for(let h=0;h<c.length;++h)a.push({element:c[h],datasetIndex:l,index:h})}return a},point(n,t,e,s){const i=$n(t,n),r=e.axis||"xy",o=e.includeInvisible||!1;return lu(n,i,r,s,o)},nearest(n,t,e,s){const i=$n(t,n),r=e.axis||"xy",o=e.includeInvisible||!1;return cu(n,i,r,e.intersect,s,o)},x(n,t,e,s){const i=$n(t,n);return Xp(n,i,"x",e.intersect,s)},y(n,t,e,s){const i=$n(t,n);return Xp(n,i,"y",e.intersect,s)}}};const Ty=["left","top","right","bottom"];function La(n,t){return n.filter(e=>e.pos===t)}function Yp(n,t){return n.filter(e=>Ty.indexOf(e.pos)===-1&&e.box.axis===t)}function Pa(n,t){return n.sort((e,s)=>{const i=t?s:e,r=t?e:s;return i.weight===r.weight?i.index-r.index:i.weight-r.weight})}function sE(n){const t=[];let e,s,i,r,o,a;for(e=0,s=(n||[]).length;e<s;++e)i=n[e],{position:r,options:{stack:o,stackWeight:a=1}}=i,t.push({index:e,box:i,pos:r,horizontal:i.isHorizontal(),weight:i.weight,stack:o&&r+o,stackWeight:a});return t}function iE(n){const t={};for(const e of n){const{stack:s,pos:i,stackWeight:r}=e;if(!s||!Ty.includes(i))continue;const o=t[s]||(t[s]={count:0,placed:0,weight:0,size:0});o.count++,o.weight+=r}return t}function nE(n,t){const e=iE(n),{vBoxMaxWidth:s,hBoxMaxHeight:i}=t;let r,o,a;for(r=0,o=n.length;r<o;++r){a=n[r];const{fullSize:l}=a.box,c=e[a.stack],h=c&&a.stackWeight/c.weight;a.horizontal?(a.width=h?h*s:l&&t.availableWidth,a.height=i):(a.width=s,a.height=h?h*i:l&&t.availableHeight)}return e}function rE(n){const t=sE(n),e=Pa(t.filter(c=>c.box.fullSize),!0),s=Pa(La(t,"left"),!0),i=Pa(La(t,"right")),r=Pa(La(t,"top"),!0),o=Pa(La(t,"bottom")),a=Yp(t,"x"),l=Yp(t,"y");return{fullSize:e,leftAndTop:s.concat(r),rightAndBottom:i.concat(l).concat(o).concat(a),chartArea:La(t,"chartArea"),vertical:s.concat(i).concat(l),horizontal:r.concat(o).concat(a)}}function qp(n,t,e,s){return Math.max(n[e],t[e])+Math.max(n[s],t[s])}function Ly(n,t){n.top=Math.max(n.top,t.top),n.left=Math.max(n.left,t.left),n.bottom=Math.max(n.bottom,t.bottom),n.right=Math.max(n.right,t.right)}function oE(n,t,e,s){const{pos:i,box:r}=e,o=n.maxPadding;if(!nt(i)){e.size&&(n[i]-=e.size);const u=s[e.stack]||{size:0,count:1};u.size=Math.max(u.size,e.horizontal?r.height:r.width),e.size=u.size/u.count,n[i]+=e.size}r.getPadding&&Ly(o,r.getPadding());const a=Math.max(0,t.outerWidth-qp(o,n,"left","right")),l=Math.max(0,t.outerHeight-qp(o,n,"top","bottom")),c=a!==n.w,h=l!==n.h;return n.w=a,n.h=l,e.horizontal?{same:c,other:h}:{same:h,other:c}}function aE(n){const t=n.maxPadding;function e(s){const i=Math.max(t[s]-n[s],0);return n[s]+=i,i}n.y+=e("top"),n.x+=e("left"),e("right"),e("bottom")}function lE(n,t){const e=t.maxPadding;function s(i){const r={left:0,top:0,right:0,bottom:0};return i.forEach(o=>{r[o]=Math.max(t[o],e[o])}),r}return s(n?["left","right"]:["top","bottom"])}function Za(n,t,e,s){const i=[];let r,o,a,l,c,h;for(r=0,o=n.length,c=0;r<o;++r){a=n[r],l=a.box,l.update(a.width||t.w,a.height||t.h,lE(a.horizontal,t));const{same:u,other:f}=oE(t,e,a,s);c|=u&&i.length,h=h||f,l.fullSize||i.push(a)}return c&&Za(i,t,e,s)||h}function ih(n,t,e,s,i){n.top=e,n.left=t,n.right=t+s,n.bottom=e+i,n.width=s,n.height=i}function Kp(n,t,e,s){const i=e.padding;let{x:r,y:o}=t;for(const a of n){const l=a.box,c=s[a.stack]||{placed:0,weight:1},h=a.stackWeight/c.weight||1;if(a.horizontal){const u=t.w*h,f=c.size||l.height;fl(c.start)&&(o=c.start),l.fullSize?ih(l,i.left,o,e.outerWidth-i.right-i.left,f):ih(l,t.left+c.placed,o,u,f),c.start=o,c.placed+=u,o=l.bottom}else{const u=t.h*h,f=c.size||l.width;fl(c.start)&&(r=c.start),l.fullSize?ih(l,r,i.top,f,e.outerHeight-i.bottom-i.top):ih(l,r,t.top+c.placed,f,u),c.start=r,c.placed+=u,r=l.right}}t.x=r,t.y=o}var fe={addBox(n,t){n.boxes||(n.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},n.boxes.push(t)},removeBox(n,t){const e=n.boxes?n.boxes.indexOf(t):-1;e!==-1&&n.boxes.splice(e,1)},configure(n,t,e){t.fullSize=e.fullSize,t.position=e.position,t.weight=e.weight},update(n,t,e,s){if(!n)return;const i=ge(n.options.layout.padding),r=Math.max(t-i.width,0),o=Math.max(e-i.height,0),a=rE(n.boxes),l=a.vertical,c=a.horizontal;bt(n.boxes,m=>{typeof m.beforeLayout=="function"&&m.beforeLayout()});const h=l.reduce((m,b)=>b.box.options&&b.box.options.display===!1?m:m+1,0)||1,u=Object.freeze({outerWidth:t,outerHeight:e,padding:i,availableWidth:r,availableHeight:o,vBoxMaxWidth:r/2/h,hBoxMaxHeight:o/2}),f=Object.assign({},i);Ly(f,ge(s));const g=Object.assign({maxPadding:f,w:r,h:o,x:i.left,y:i.top},i),p=nE(l.concat(c),u);Za(a.fullSize,g,u,p),Za(l,g,u,p),Za(c,g,u,p)&&Za(l,g,u,p),aE(g),Kp(a.leftAndTop,g,u,p),g.x+=g.w,g.y+=g.h,Kp(a.rightAndBottom,g,u,p),n.chartArea={left:g.left,top:g.top,right:g.left+g.w,bottom:g.top+g.h,height:g.h,width:g.w},bt(a.chartArea,m=>{const b=m.box;Object.assign(b,n.chartArea),b.update(g.w,g.h,{left:0,top:0,right:0,bottom:0})})}};class Py{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,s){}removeEventListener(t,e,s){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,s,i){return e=Math.max(0,e||t.width),s=s||t.height,{width:e,height:Math.max(0,i?Math.floor(e/i):s)}}isAttached(t){return!0}updateConfig(t){}}class cE extends Py{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const jh="$chartjs",hE={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Zp=n=>n===null||n==="";function dE(n,t){const e=n.style,s=n.getAttribute("height"),i=n.getAttribute("width");if(n[jh]={initial:{height:s,width:i,style:{display:e.display,height:e.height,width:e.width}}},e.display=e.display||"block",e.boxSizing=e.boxSizing||"border-box",Zp(i)){const r=Ip(n,"width");r!==void 0&&(n.width=r)}if(Zp(s))if(n.style.height==="")n.height=n.width/(t||2);else{const r=Ip(n,"height");r!==void 0&&(n.height=r)}return n}const Ry=uS?{passive:!0}:!1;function uE(n,t,e){n&&n.addEventListener(t,e,Ry)}function fE(n,t,e){n&&n.canvas&&n.canvas.removeEventListener(t,e,Ry)}function gE(n,t){const e=hE[n.type]||n.type,{x:s,y:i}=$n(n,t);return{type:e,chart:t,native:n,x:s!==void 0?s:null,y:i!==void 0?i:null}}function rd(n,t){for(const e of n)if(e===t||e.contains(t))return!0}function pE(n,t,e){const s=n.canvas,i=new MutationObserver(r=>{let o=!1;for(const a of r)o=o||rd(a.addedNodes,s),o=o&&!rd(a.removedNodes,s);o&&e()});return i.observe(document,{childList:!0,subtree:!0}),i}function mE(n,t,e){const s=n.canvas,i=new MutationObserver(r=>{let o=!1;for(const a of r)o=o||rd(a.removedNodes,s),o=o&&!rd(a.addedNodes,s);o&&e()});return i.observe(document,{childList:!0,subtree:!0}),i}const ml=new Map;let Jp=0;function Dy(){const n=window.devicePixelRatio;n!==Jp&&(Jp=n,ml.forEach((t,e)=>{e.currentDevicePixelRatio!==n&&t()}))}function bE(n,t){ml.size||window.addEventListener("resize",Dy),ml.set(n,t)}function yE(n){ml.delete(n),ml.size||window.removeEventListener("resize",Dy)}function _E(n,t,e){const s=n.canvas,i=s&&Rg(s);if(!i)return;const r=ly((a,l)=>{const c=i.clientWidth;e(a,l),c<i.clientWidth&&e()},window),o=new ResizeObserver(a=>{const l=a[0],c=l.contentRect.width,h=l.contentRect.height;c===0&&h===0||r(c,h)});return o.observe(i),bE(n,r),o}function hu(n,t,e){e&&e.disconnect(),t==="resize"&&yE(n)}function vE(n,t,e){const s=n.canvas,i=ly(r=>{n.ctx!==null&&e(gE(r,n))},n);return uE(s,t,i),i}class AE extends Py{acquireContext(t,e){const s=t&&t.getContext&&t.getContext("2d");return s&&s.canvas===t?(dE(t,e),s):null}releaseContext(t){const e=t.canvas;if(!e[jh])return!1;const s=e[jh].initial;["height","width"].forEach(r=>{const o=s[r];st(o)?e.removeAttribute(r):e.setAttribute(r,o)});const i=s.style||{};return Object.keys(i).forEach(r=>{e.style[r]=i[r]}),e.width=e.width,delete e[jh],!0}addEventListener(t,e,s){this.removeEventListener(t,e);const i=t.$proxies||(t.$proxies={}),o={attach:pE,detach:mE,resize:_E}[e]||vE;i[e]=o(t,e,s)}removeEventListener(t,e){const s=t.$proxies||(t.$proxies={}),i=s[e];if(!i)return;({attach:hu,detach:hu,resize:hu}[e]||fE)(t,e,i),s[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,s,i){return dS(t,e,s,i)}isAttached(t){const e=t&&Rg(t);return!!(e&&e.isConnected)}}function xE(n){return!Pg()||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?cE:AE}class bs{constructor(){T(this,"x");T(this,"y");T(this,"active",!1);T(this,"options");T(this,"$animations")}tooltipPosition(t){const{x:e,y:s}=this.getProps(["x","y"],t);return{x:e,y:s}}hasValue(){return va(this.x)&&va(this.y)}getProps(t,e){const s=this.$animations;if(!e||!s)return this;const i={};return t.forEach(r=>{i[r]=s[r]&&s[r].active()?s[r]._to:this[r]}),i}}T(bs,"defaults",{}),T(bs,"defaultRoutes");function wE(n,t){const e=n.options.ticks,s=SE(n),i=Math.min(e.maxTicksLimit||s,s),r=e.major.enabled?CE(t):[],o=r.length,a=r[0],l=r[o-1],c=[];if(o>i)return kE(t,c,r,o/i),c;const h=EE(r,t,i);if(o>0){let u,f;const g=o>1?Math.round((l-a)/(o-1)):null;for(nh(t,c,h,st(g)?0:a-g,a),u=0,f=o-1;u<f;u++)nh(t,c,h,r[u],r[u+1]);return nh(t,c,h,l,st(g)?t.length:l+g),c}return nh(t,c,h),c}function SE(n){const t=n.options.offset,e=n._tickSize(),s=n._length/e+(t?0:1),i=n._maxLength/e;return Math.floor(Math.min(s,i))}function EE(n,t,e){const s=ME(n),i=t.length/e;if(!s)return Math.max(i,1);const r=gw(s);for(let o=0,a=r.length-1;o<a;o++){const l=r[o];if(l>i)return l}return Math.max(i,1)}function CE(n){const t=[];let e,s;for(e=0,s=n.length;e<s;e++)n[e].major&&t.push(e);return t}function kE(n,t,e,s){let i=0,r=e[0],o;for(s=Math.ceil(s),o=0;o<n.length;o++)o===r&&(t.push(n[o]),i++,r=e[i*s])}function nh(n,t,e,s,i){const r=Z(s,0),o=Math.min(Z(i,n.length),n.length);let a=0,l,c,h;for(e=Math.ceil(e),i&&(l=i-s,e=l/Math.floor(l/e)),h=r;h<0;)a++,h=Math.round(r+a*e);for(c=Math.max(r,0);c<o;c++)c===h&&(t.push(n[c]),a++,h=Math.round(r+a*e))}function ME(n){const t=n.length;let e,s;if(t<2)return!1;for(s=n[0],e=1;e<t;++e)if(n[e]-n[e-1]!==s)return!1;return s}const TE=n=>n==="left"?"right":n==="right"?"left":n,Qp=(n,t,e)=>t==="top"||t==="left"?n[t]+e:n[t]-e,tm=(n,t)=>Math.min(t||n,n);function em(n,t){const e=[],s=n.length/t,i=n.length;let r=0;for(;r<i;r+=s)e.push(n[Math.floor(r)]);return e}function LE(n,t,e){const s=n.ticks.length,i=Math.min(t,s-1),r=n._startPixel,o=n._endPixel,a=1e-6;let l=n.getPixelForTick(i),c;if(!(e&&(s===1?c=Math.max(l-r,o-l):t===0?c=(n.getPixelForTick(1)-l)/2:c=(l-n.getPixelForTick(i-1))/2,l+=i<t?c:-c,l<r-a||l>o+a)))return l}function PE(n,t){bt(n,e=>{const s=e.gc,i=s.length/2;let r;if(i>t){for(r=0;r<i;++r)delete e.data[s[r]];s.splice(0,i)}})}function Ra(n){return n.drawTicks?n.tickLength:0}function sm(n,t){if(!n.display)return 0;const e=Yt(n.font,t),s=ge(n.padding);return(kt(n.text)?n.text.length:1)*e.lineHeight+s.height}function RE(n,t){return Tn(n,{scale:t,type:"scale"})}function DE(n,t,e){return Tn(n,{tick:e,index:t,type:"tick"})}function IE(n,t,e){let s=Eg(n);return(e&&t!=="right"||!e&&t==="right")&&(s=TE(s)),s}function OE(n,t,e,s){const{top:i,left:r,bottom:o,right:a,chart:l}=n,{chartArea:c,scales:h}=l;let u=0,f,g,p;const m=o-i,b=a-r;if(n.isHorizontal()){if(g=he(s,r,a),nt(e)){const y=Object.keys(e)[0],A=e[y];p=h[y].getPixelForValue(A)+m-t}else e==="center"?p=(c.bottom+c.top)/2+m-t:p=Qp(n,e,t);f=a-r}else{if(nt(e)){const y=Object.keys(e)[0],A=e[y];g=h[y].getPixelForValue(A)-b+t}else e==="center"?g=(c.left+c.right)/2-b+t:g=Qp(n,e,t);p=he(s,o,i),u=e==="left"?-Nt:Nt}return{titleX:g,titleY:p,maxWidth:f,rotation:u}}class ao extends bs{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:s,_suggestedMax:i}=this;return t=Re(t,Number.POSITIVE_INFINITY),e=Re(e,Number.NEGATIVE_INFINITY),s=Re(s,Number.POSITIVE_INFINITY),i=Re(i,Number.NEGATIVE_INFINITY),{min:Re(t,s),max:Re(e,i),minDefined:Dt(t),maxDefined:Dt(e)}}getMinMax(t){let{min:e,max:s,minDefined:i,maxDefined:r}=this.getUserBounds(),o;if(i&&r)return{min:e,max:s};const a=this.getMatchingVisibleMetas();for(let l=0,c=a.length;l<c;++l)o=a[l].controller.getMinMax(this,t),i||(e=Math.min(e,o.min)),r||(s=Math.max(s,o.max));return e=r&&e>s?s:e,s=i&&e>s?e:s,{min:Re(e,Re(s,e)),max:Re(s,Re(e,s))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){wt(this.options.beforeUpdate,[this])}update(t,e,s){const{beginAtZero:i,grace:r,ticks:o}=this.options,a=o.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=s=Object.assign({left:0,right:0,top:0,bottom:0},s),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+s.left+s.right:this.height+s.top+s.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=jw(this,r,i),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=a<this.ticks.length;this._convertTicksToLabels(l?em(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||o.source==="auto")&&(this.ticks=wE(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,e,s;this.isHorizontal()?(e=this.left,s=this.right):(e=this.top,s=this.bottom,t=!t),this._startPixel=e,this._endPixel=s,this._reversePixels=t,this._length=s-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){wt(this.options.afterUpdate,[this])}beforeSetDimensions(){wt(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){wt(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),wt(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){wt(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let s,i,r;for(s=0,i=t.length;s<i;s++)r=t[s],r.label=wt(e.callback,[r.value,s,t],this)}afterTickToLabelConversion(){wt(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){wt(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,s=tm(this.ticks.length,t.ticks.maxTicksLimit),i=e.minRotation||0,r=e.maxRotation;let o=i,a,l,c;if(!this._isVisible()||!e.display||i>=r||s<=1||!this.isHorizontal()){this.labelRotation=i;return}const h=this._getLabelSizes(),u=h.widest.width,f=h.highest.height,g=te(this.chart.width-u,0,this.maxWidth);a=t.offset?this.maxWidth/s:g/(s-1),u+6>a&&(a=g/(s-(t.offset?.5:1)),l=this.maxHeight-Ra(t.grid)-e.padding-sm(t.title,this.chart.options.font),c=Math.sqrt(u*u+f*f),o=wg(Math.min(Math.asin(te((h.highest.height+6)/a,-1,1)),Math.asin(te(l/c,-1,1))-Math.asin(te(f/c,-1,1)))),o=Math.max(i,Math.min(r,o))),this.labelRotation=o}afterCalculateLabelRotation(){wt(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){wt(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:s,title:i,grid:r}}=this,o=this._isVisible(),a=this.isHorizontal();if(o){const l=sm(i,e.options.font);if(a?(t.width=this.maxWidth,t.height=Ra(r)+l):(t.height=this.maxHeight,t.width=Ra(r)+l),s.display&&this.ticks.length){const{first:c,last:h,widest:u,highest:f}=this._getLabelSizes(),g=s.padding*2,p=ps(this.labelRotation),m=Math.cos(p),b=Math.sin(p);if(a){const y=s.mirror?0:b*u.width+m*f.height;t.height=Math.min(this.maxHeight,t.height+y+g)}else{const y=s.mirror?0:m*u.width+b*f.height;t.width=Math.min(this.maxWidth,t.width+y+g)}this._calculatePadding(c,h,b,m)}}this._handleMargins(),a?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,s,i){const{ticks:{align:r,padding:o},position:a}=this.options,l=this.labelRotation!==0,c=a!=="top"&&this.axis==="x";if(this.isHorizontal()){const h=this.getPixelForTick(0)-this.left,u=this.right-this.getPixelForTick(this.ticks.length-1);let f=0,g=0;l?c?(f=i*t.width,g=s*e.height):(f=s*t.height,g=i*e.width):r==="start"?g=e.width:r==="end"?f=t.width:r!=="inner"&&(f=t.width/2,g=e.width/2),this.paddingLeft=Math.max((f-h+o)*this.width/(this.width-h),0),this.paddingRight=Math.max((g-u+o)*this.width/(this.width-u),0)}else{let h=e.height/2,u=t.height/2;r==="start"?(h=0,u=t.height):r==="end"&&(h=e.height,u=0),this.paddingTop=h+o,this.paddingBottom=u+o}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){wt(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return e==="top"||e==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let e,s;for(e=0,s=t.length;e<s;e++)st(t[e].label)&&(t.splice(e,1),s--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let s=this.ticks;e<s.length&&(s=em(s,e)),this._labelSizes=t=this._computeLabelSizes(s,s.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,s){const{ctx:i,_longestTextCache:r}=this,o=[],a=[],l=Math.floor(e/tm(e,s));let c=0,h=0,u,f,g,p,m,b,y,A,w,S,E;for(u=0;u<e;u+=l){if(p=t[u].label,m=this._resolveTickFontOptions(u),i.font=b=m.string,y=r[b]=r[b]||{data:{},gc:[]},A=m.lineHeight,w=S=0,!st(p)&&!kt(p))w=id(i,y.data,y.gc,w,p),S=A;else if(kt(p))for(f=0,g=p.length;f<g;++f)E=p[f],!st(E)&&!kt(E)&&(w=id(i,y.data,y.gc,w,E),S+=A);o.push(w),a.push(S),c=Math.max(w,c),h=Math.max(S,h)}PE(r,e);const C=o.indexOf(c),k=a.indexOf(h),M=R=>({width:o[R]||0,height:a[R]||0});return{first:M(0),last:M(e-1),widest:M(C),highest:M(k),widths:o,heights:a}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return yw(this._alignToPixels?On(this.chart,e,0):e)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const s=e[t];return s.$context||(s.$context=DE(this.getContext(),t,s))}return this.$context||(this.$context=RE(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=ps(this.labelRotation),s=Math.abs(Math.cos(e)),i=Math.abs(Math.sin(e)),r=this._getLabelSizes(),o=t.autoSkipPadding||0,a=r?r.widest.width+o:0,l=r?r.highest.height+o:0;return this.isHorizontal()?l*s>a*i?a/s:l/i:l*i<a*s?l/s:a/i}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,s=this.chart,i=this.options,{grid:r,position:o,border:a}=i,l=r.offset,c=this.isHorizontal(),u=this.ticks.length+(l?1:0),f=Ra(r),g=[],p=a.setContext(this.getContext()),m=p.display?p.width:0,b=m/2,y=function(Y){return On(s,Y,m)};let A,w,S,E,C,k,M,R,N,O,j,X;if(o==="top")A=y(this.bottom),k=this.bottom-f,R=A-b,O=y(t.top)+b,X=t.bottom;else if(o==="bottom")A=y(this.top),O=t.top,X=y(t.bottom)-b,k=A+b,R=this.top+f;else if(o==="left")A=y(this.right),C=this.right-f,M=A-b,N=y(t.left)+b,j=t.right;else if(o==="right")A=y(this.left),N=t.left,j=y(t.right)-b,C=A+b,M=this.left+f;else if(e==="x"){if(o==="center")A=y((t.top+t.bottom)/2+.5);else if(nt(o)){const Y=Object.keys(o)[0],D=o[Y];A=y(this.chart.scales[Y].getPixelForValue(D))}O=t.top,X=t.bottom,k=A+b,R=k+f}else if(e==="y"){if(o==="center")A=y((t.left+t.right)/2);else if(nt(o)){const Y=Object.keys(o)[0],D=o[Y];A=y(this.chart.scales[Y].getPixelForValue(D))}C=A-b,M=C-f,N=t.left,j=t.right}const Q=Z(i.ticks.maxTicksLimit,u),U=Math.max(1,Math.ceil(u/Q));for(w=0;w<u;w+=U){const Y=this.getContext(w),D=r.setContext(Y),F=a.setContext(Y),L=D.lineWidth,P=D.color,I=F.dash||[],$=F.dashOffset,z=D.tickWidth,q=D.tickColor,gt=D.tickBorderDash||[],dt=D.tickBorderDashOffset;S=LE(this,w,l),S!==void 0&&(E=On(s,S,L),c?C=M=N=j=E:k=R=O=X=E,g.push({tx1:C,ty1:k,tx2:M,ty2:R,x1:N,y1:O,x2:j,y2:X,width:L,color:P,borderDash:I,borderDashOffset:$,tickWidth:z,tickColor:q,tickBorderDash:gt,tickBorderDashOffset:dt}))}return this._ticksLength=u,this._borderValue=A,g}_computeLabelItems(t){const e=this.axis,s=this.options,{position:i,ticks:r}=s,o=this.isHorizontal(),a=this.ticks,{align:l,crossAlign:c,padding:h,mirror:u}=r,f=Ra(s.grid),g=f+h,p=u?-h:g,m=-ps(this.labelRotation),b=[];let y,A,w,S,E,C,k,M,R,N,O,j,X="middle";if(i==="top")C=this.bottom-p,k=this._getXAxisLabelAlignment();else if(i==="bottom")C=this.top+p,k=this._getXAxisLabelAlignment();else if(i==="left"){const U=this._getYAxisLabelAlignment(f);k=U.textAlign,E=U.x}else if(i==="right"){const U=this._getYAxisLabelAlignment(f);k=U.textAlign,E=U.x}else if(e==="x"){if(i==="center")C=(t.top+t.bottom)/2+g;else if(nt(i)){const U=Object.keys(i)[0],Y=i[U];C=this.chart.scales[U].getPixelForValue(Y)+g}k=this._getXAxisLabelAlignment()}else if(e==="y"){if(i==="center")E=(t.left+t.right)/2-g;else if(nt(i)){const U=Object.keys(i)[0],Y=i[U];E=this.chart.scales[U].getPixelForValue(Y)}k=this._getYAxisLabelAlignment(f).textAlign}e==="y"&&(l==="start"?X="top":l==="end"&&(X="bottom"));const Q=this._getLabelSizes();for(y=0,A=a.length;y<A;++y){w=a[y],S=w.label;const U=r.setContext(this.getContext(y));M=this.getPixelForTick(y)+r.labelOffset,R=this._resolveTickFontOptions(y),N=R.lineHeight,O=kt(S)?S.length:1;const Y=O/2,D=U.color,F=U.textStrokeColor,L=U.textStrokeWidth;let P=k;o?(E=M,k==="inner"&&(y===A-1?P=this.options.reverse?"left":"right":y===0?P=this.options.reverse?"right":"left":P="center"),i==="top"?c==="near"||m!==0?j=-O*N+N/2:c==="center"?j=-Q.highest.height/2-Y*N+N:j=-Q.highest.height+N/2:c==="near"||m!==0?j=N/2:c==="center"?j=Q.highest.height/2-Y*N:j=Q.highest.height-O*N,u&&(j*=-1),m!==0&&!U.showLabelBackdrop&&(E+=N/2*Math.sin(m))):(C=M,j=(1-O)*N/2);let I;if(U.showLabelBackdrop){const $=ge(U.backdropPadding),z=Q.heights[y],q=Q.widths[y];let gt=j-$.top,dt=0-$.left;switch(X){case"middle":gt-=z/2;break;case"bottom":gt-=z;break}switch(k){case"center":dt-=q/2;break;case"right":dt-=q;break;case"inner":y===A-1?dt-=q:y>0&&(dt-=q/2);break}I={left:dt,top:gt,width:q+$.width,height:z+$.height,color:U.backdropColor}}b.push({label:S,font:R,textOffset:j,options:{rotation:m,color:D,strokeColor:F,strokeWidth:L,textAlign:P,textBaseline:X,translation:[E,C],backdrop:I}})}return b}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-ps(this.labelRotation))return t==="top"?"left":"right";let i="center";return e.align==="start"?i="left":e.align==="end"?i="right":e.align==="inner"&&(i="inner"),i}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:s,mirror:i,padding:r}}=this.options,o=this._getLabelSizes(),a=t+r,l=o.widest.width;let c,h;return e==="left"?i?(h=this.right+r,s==="near"?c="left":s==="center"?(c="center",h+=l/2):(c="right",h+=l)):(h=this.right-a,s==="near"?c="right":s==="center"?(c="center",h-=l/2):(c="left",h=this.left)):e==="right"?i?(h=this.left+r,s==="near"?c="right":s==="center"?(c="center",h-=l/2):(c="left",h-=l)):(h=this.left+a,s==="near"?c="left":s==="center"?(c="center",h+=l/2):(c="right",h=this.right)):c="right",{textAlign:c,x:h}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;if(e==="left"||e==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(e==="top"||e==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:s,top:i,width:r,height:o}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(s,i,r,o),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const i=this.ticks.findIndex(r=>r.value===t);return i>=0?e.setContext(this.getContext(i)).lineWidth:0}drawGrid(t){const e=this.options.grid,s=this.ctx,i=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let r,o;const a=(l,c,h)=>{!h.width||!h.color||(s.save(),s.lineWidth=h.width,s.strokeStyle=h.color,s.setLineDash(h.borderDash||[]),s.lineDashOffset=h.borderDashOffset,s.beginPath(),s.moveTo(l.x,l.y),s.lineTo(c.x,c.y),s.stroke(),s.restore())};if(e.display)for(r=0,o=i.length;r<o;++r){const l=i[r];e.drawOnChartArea&&a({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),e.drawTicks&&a({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:s,grid:i}}=this,r=s.setContext(this.getContext()),o=s.display?r.width:0;if(!o)return;const a=i.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let c,h,u,f;this.isHorizontal()?(c=On(t,this.left,o)-o/2,h=On(t,this.right,a)+a/2,u=f=l):(u=On(t,this.top,o)-o/2,f=On(t,this.bottom,a)+a/2,c=h=l),e.save(),e.lineWidth=r.width,e.strokeStyle=r.color,e.beginPath(),e.moveTo(c,u),e.lineTo(h,f),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const s=this.ctx,i=this._computeLabelArea();i&&Od(s,i);const r=this.getLabelItems(t);for(const o of r){const a=o.options,l=o.font,c=o.label,h=o.textOffset;to(s,c,0,h,l,a)}i&&Fd(s)}drawTitle(){const{ctx:t,options:{position:e,title:s,reverse:i}}=this;if(!s.display)return;const r=Yt(s.font),o=ge(s.padding),a=s.align;let l=r.lineHeight/2;e==="bottom"||e==="center"||nt(e)?(l+=o.bottom,kt(s.text)&&(l+=r.lineHeight*(s.text.length-1))):l+=o.top;const{titleX:c,titleY:h,maxWidth:u,rotation:f}=OE(this,l,e,a);to(t,s.text,0,0,r,{color:s.color,maxWidth:u,rotation:f,textAlign:IE(a,e,i),textBaseline:"middle",translation:[c,h]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,s=Z(t.grid&&t.grid.z,-1),i=Z(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==ao.prototype.draw?[{z:e,draw:r=>{this.draw(r)}}]:[{z:s,draw:r=>{this.drawBackground(),this.drawGrid(r),this.drawTitle()}},{z:i,draw:()=>{this.drawBorder()}},{z:e,draw:r=>{this.drawLabels(r)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),s=this.axis+"AxisID",i=[];let r,o;for(r=0,o=e.length;r<o;++r){const a=e[r];a[s]===this.id&&(!t||a.type===t)&&i.push(a)}return i}_resolveTickFontOptions(t){const e=this.options.ticks.setContext(this.getContext(t));return Yt(e.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class rh{constructor(t,e,s){this.type=t,this.scope=e,this.override=s,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let s;HE(e)&&(s=this.register(e));const i=this.items,r=t.id,o=this.scope+"."+r;if(!r)throw new Error("class does not have id: "+t);return r in i||(i[r]=t,FE(t,o,s),this.override&&Mt.override(t.id,t.overrides)),o}get(t){return this.items[t]}unregister(t){const e=this.items,s=t.id,i=this.scope;s in e&&delete e[s],i&&s in Mt[i]&&(delete Mt[i][s],this.override&&delete Qr[s])}}function FE(n,t,e){const s=ul(Object.create(null),[e?Mt.get(e):{},Mt.get(t),n.defaults]);Mt.set(t,s),n.defaultRoutes&&NE(t,n.defaultRoutes),n.descriptors&&Mt.describe(t,n.descriptors)}function NE(n,t){Object.keys(t).forEach(e=>{const s=e.split("."),i=s.pop(),r=[n].concat(s).join("."),o=t[e].split("."),a=o.pop(),l=o.join(".");Mt.route(r,i,l,a)})}function HE(n){return"id"in n&&"defaults"in n}class BE{constructor(){this.controllers=new rh(ms,"datasets",!0),this.elements=new rh(bs,"elements"),this.plugins=new rh(Object,"plugins"),this.scales=new rh(ao,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,s){[...e].forEach(i=>{const r=s||this._getRegistryForType(i);s||r.isForType(i)||r===this.plugins&&i.id?this._exec(t,r,i):bt(i,o=>{const a=s||this._getRegistryForType(o);this._exec(t,a,o)})})}_exec(t,e,s){const i=xg(t);wt(s["before"+i],[],s),e[t](s),wt(s["after"+i],[],s)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const s=this._typedRegistries[e];if(s.isForType(t))return s}return this.plugins}_get(t,e,s){const i=e.get(t);if(i===void 0)throw new Error('"'+t+'" is not a registered '+s+".");return i}}var ws=new BE;class zE{constructor(){this._init=void 0}notify(t,e,s,i){if(e==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install")),this._init===void 0)return;const r=i?this._descriptors(t).filter(i):this._descriptors(t),o=this._notify(r,t,e,s);return e==="afterDestroy"&&(this._notify(r,t,"stop"),this._notify(this._init,t,"uninstall"),this._init=void 0),o}_notify(t,e,s,i){i=i||{};for(const r of t){const o=r.plugin,a=o[s],l=[e,i,r.options];if(wt(a,l,o)===!1&&i.cancelable)return!1}return!0}invalidate(){st(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const s=t&&t.config,i=Z(s.options&&s.options.plugins,{}),r=$E(s);return i===!1&&!e?[]:jE(t,r,i,e)}_notifyStateChanges(t){const e=this._oldCache||[],s=this._cache,i=(r,o)=>r.filter(a=>!o.some(l=>a.plugin.id===l.plugin.id));this._notify(i(e,s),t,"stop"),this._notify(i(s,e),t,"start")}}function $E(n){const t={},e=[],s=Object.keys(ws.plugins.items);for(let r=0;r<s.length;r++)e.push(ws.getPlugin(s[r]));const i=n.plugins||[];for(let r=0;r<i.length;r++){const o=i[r];e.indexOf(o)===-1&&(e.push(o),t[o.id]=!0)}return{plugins:e,localIds:t}}function WE(n,t){return!t&&n===!1?null:n===!0?{}:n}function jE(n,{plugins:t,localIds:e},s,i){const r=[],o=n.getContext();for(const a of t){const l=a.id,c=WE(s[l],i);c!==null&&r.push({plugin:a,options:VE(n.config,{plugin:a,local:e[l]},c,o)})}return r}function VE(n,{plugin:t,local:e},s,i){const r=n.pluginScopeKeys(t),o=n.getOptionScopes(s,r);return e&&t.defaults&&o.push(t.defaults),n.createResolver(o,i,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Xf(n,t){const e=Mt.datasets[n]||{};return((t.datasets||{})[n]||{}).indexAxis||t.indexAxis||e.indexAxis||"x"}function UE(n,t){let e=n;return n==="_index_"?e=t:n==="_value_"&&(e=t==="x"?"y":"x"),e}function GE(n,t){return n===t?"_index_":"_value_"}function im(n){if(n==="x"||n==="y"||n==="r")return n}function XE(n){if(n==="top"||n==="bottom")return"x";if(n==="left"||n==="right")return"y"}function Yf(n,...t){if(im(n))return n;for(const e of t){const s=e.axis||XE(e.position)||n.length>1&&im(n[0].toLowerCase());if(s)return s}throw new Error(`Cannot determine type of '${n}' axis. Please provide 'axis' or 'position' option.`)}function nm(n,t,e){if(e[t+"AxisID"]===n)return{axis:t}}function YE(n,t){if(t.data&&t.data.datasets){const e=t.data.datasets.filter(s=>s.xAxisID===n||s.yAxisID===n);if(e.length)return nm(n,"x",e[0])||nm(n,"y",e[0])}return{}}function qE(n,t){const e=Qr[n.type]||{scales:{}},s=t.scales||{},i=Xf(n.type,t),r=Object.create(null);return Object.keys(s).forEach(o=>{const a=s[o];if(!nt(a))return console.error(`Invalid scale configuration for scale: ${o}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${o}`);const l=Yf(o,a,YE(o,n),Mt.scales[a.type]),c=GE(l,i),h=e.scales||{};r[o]=il(Object.create(null),[{axis:l},a,h[l],h[c]])}),n.data.datasets.forEach(o=>{const a=o.type||n.type,l=o.indexAxis||Xf(a,t),h=(Qr[a]||{}).scales||{};Object.keys(h).forEach(u=>{const f=UE(u,l),g=o[f+"AxisID"]||f;r[g]=r[g]||Object.create(null),il(r[g],[{axis:f},s[g],h[u]])})}),Object.keys(r).forEach(o=>{const a=r[o];il(a,[Mt.scales[a.type],Mt.scale])}),r}function Iy(n){const t=n.options||(n.options={});t.plugins=Z(t.plugins,{}),t.scales=qE(n,t)}function Oy(n){return n=n||{},n.datasets=n.datasets||[],n.labels=n.labels||[],n}function KE(n){return n=n||{},n.data=Oy(n.data),Iy(n),n}const rm=new Map,Fy=new Set;function oh(n,t){let e=rm.get(n);return e||(e=t(),rm.set(n,e),Fy.add(e)),e}const Da=(n,t,e)=>{const s=Sn(t,e);s!==void 0&&n.add(s)};class ZE{constructor(t){this._config=KE(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=Oy(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),Iy(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return oh(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,e){return oh(`${t}.transition.${e}`,()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,e){return oh(`${t}-${e}`,()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]])}pluginScopeKeys(t){const e=t.id,s=this.type;return oh(`${s}-plugin-${e}`,()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,e){const s=this._scopeCache;let i=s.get(t);return(!i||e)&&(i=new Map,s.set(t,i)),i}getOptionScopes(t,e,s){const{options:i,type:r}=this,o=this._cachedScopes(t,s),a=o.get(e);if(a)return a;const l=new Set;e.forEach(h=>{t&&(l.add(t),h.forEach(u=>Da(l,t,u))),h.forEach(u=>Da(l,i,u)),h.forEach(u=>Da(l,Qr[r]||{},u)),h.forEach(u=>Da(l,Mt,u)),h.forEach(u=>Da(l,Vf,u))});const c=Array.from(l);return c.length===0&&c.push(Object.create(null)),Fy.has(e)&&o.set(e,c),c}chartOptionScopes(){const{options:t,type:e}=this;return[t,Qr[e]||{},Mt.datasets[e]||{},{type:e},Mt,Vf]}resolveNamedOptions(t,e,s,i=[""]){const r={$shared:!0},{resolver:o,subPrefixes:a}=om(this._resolverCache,t,i);let l=o;if(QE(o,e)){r.$shared=!1,s=En(s)?s():s;const c=this.createResolver(t,s,a);l=Aa(o,s,c)}for(const c of e)r[c]=l[c];return r}createResolver(t,e,s=[""],i){const{resolver:r}=om(this._resolverCache,t,s);return nt(e)?Aa(r,e,void 0,i):r}}function om(n,t,e){let s=n.get(t);s||(s=new Map,n.set(t,s));const i=e.join();let r=s.get(i);return r||(r={resolver:Mg(t,e),subPrefixes:e.filter(a=>!a.toLowerCase().includes("hover"))},s.set(i,r)),r}const JE=n=>nt(n)&&Object.getOwnPropertyNames(n).some(t=>En(n[t]));function QE(n,t){const{isScriptable:e,isIndexable:s}=gy(n);for(const i of t){const r=e(i),o=s(i),a=(o||r)&&n[i];if(r&&(En(a)||JE(a))||o&&kt(a))return!0}return!1}var tC="4.5.1";const eC=["top","bottom","left","right","chartArea"];function am(n,t){return n==="top"||n==="bottom"||eC.indexOf(n)===-1&&t==="x"}function lm(n,t){return function(e,s){return e[n]===s[n]?e[t]-s[t]:e[n]-s[n]}}function cm(n){const t=n.chart,e=t.options.animation;t.notifyPlugins("afterRender"),wt(e&&e.onComplete,[n],t)}function sC(n){const t=n.chart,e=t.options.animation;wt(e&&e.onProgress,[n],t)}function Ny(n){return Pg()&&typeof n=="string"?n=document.getElementById(n):n&&n.length&&(n=n[0]),n&&n.canvas&&(n=n.canvas),n}const Vh={},hm=n=>{const t=Ny(n);return Object.values(Vh).filter(e=>e.canvas===t).pop()};function iC(n,t,e){const s=Object.keys(n);for(const i of s){const r=+i;if(r>=t){const o=n[i];delete n[i],(e>0||r>t)&&(n[r+e]=o)}}}function nC(n,t,e,s){return!e||n.type==="mouseout"?null:s?t:n}class ri{static register(...t){ws.add(...t),dm()}static unregister(...t){ws.remove(...t),dm()}constructor(t,e){const s=this.config=new ZE(e),i=Ny(t),r=hm(i);if(r)throw new Error("Canvas is already in use. Chart with ID '"+r.id+"' must be destroyed before the canvas with ID '"+r.canvas.id+"' can be reused.");const o=s.createResolver(s.chartOptionScopes(),this.getContext());this.platform=new(s.platform||xE(i)),this.platform.updateConfig(s);const a=this.platform.acquireContext(i,o.aspectRatio),l=a&&a.canvas,c=l&&l.height,h=l&&l.width;if(this.id=rw(),this.ctx=a,this.canvas=l,this.width=h,this.height=c,this._options=o,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new zE,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=xw(u=>this.update(u),o.resizeDelay||0),this._dataChanges=[],Vh[this.id]=this,!a||!l){console.error("Failed to create chart: can't acquire context from the given item");return}Qs.listen(this,"complete",cm),Qs.listen(this,"progress",sC),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:s,height:i,_aspectRatio:r}=this;return st(t)?e&&r?r:i?s/i:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return ws}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():Dp(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Lp(this.canvas,this.ctx),this}stop(){return Qs.stop(this),this}resize(t,e){Qs.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const s=this.options,i=this.canvas,r=s.maintainAspectRatio&&this.aspectRatio,o=this.platform.getMaximumSize(i,t,e,r),a=s.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=o.width,this.height=o.height,this._aspectRatio=this.aspectRatio,Dp(this,a,!0)&&(this.notifyPlugins("resize",{size:o}),wt(s.onResize,[this,o],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const e=this.options.scales||{};bt(e,(s,i)=>{s.id=i})}buildOrUpdateScales(){const t=this.options,e=t.scales,s=this.scales,i=Object.keys(s).reduce((o,a)=>(o[a]=!1,o),{});let r=[];e&&(r=r.concat(Object.keys(e).map(o=>{const a=e[o],l=Yf(o,a),c=l==="r",h=l==="x";return{options:a,dposition:c?"chartArea":h?"bottom":"left",dtype:c?"radialLinear":h?"category":"linear"}}))),bt(r,o=>{const a=o.options,l=a.id,c=Yf(l,a),h=Z(a.type,o.dtype);(a.position===void 0||am(a.position,c)!==am(o.dposition))&&(a.position=o.dposition),i[l]=!0;let u=null;if(l in s&&s[l].type===h)u=s[l];else{const f=ws.getScale(h);u=new f({id:l,type:h,ctx:this.ctx,chart:this}),s[u.id]=u}u.init(a,t)}),bt(i,(o,a)=>{o||delete s[a]}),bt(s,o=>{fe.configure(this,o,o.options),fe.addBox(this,o)})}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,s=t.length;if(t.sort((i,r)=>i.index-r.index),s>e){for(let i=e;i<s;++i)this._destroyDatasetMeta(i);t.splice(e,s-e)}this._sortedMetasets=t.slice(0).sort(lm("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach((s,i)=>{e.filter(r=>r===s._dataset).length===0&&this._destroyDatasetMeta(i)})}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let s,i;for(this._removeUnreferencedMetasets(),s=0,i=e.length;s<i;s++){const r=e[s];let o=this.getDatasetMeta(s);const a=r.type||this.config.type;if(o.type&&o.type!==a&&(this._destroyDatasetMeta(s),o=this.getDatasetMeta(s)),o.type=a,o.indexAxis=r.indexAxis||Xf(a,this.options),o.order=r.order||0,o.index=s,o.label=""+r.label,o.visible=this.isDatasetVisible(s),o.controller)o.controller.updateIndex(s),o.controller.linkScales();else{const l=ws.getController(a),{datasetElementType:c,dataElementType:h}=Mt.datasets[a];Object.assign(l,{dataElementType:ws.getElement(h),datasetElementType:c&&ws.getElement(c)}),o.controller=new l(this,s),t.push(o.controller)}}return this._updateMetasets(),t}_resetElements(){bt(this.data.datasets,(t,e)=>{this.getDatasetMeta(e).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const s=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),i=this._animationsDisabled=!s.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const r=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let o=0;for(let c=0,h=this.data.datasets.length;c<h;c++){const{controller:u}=this.getDatasetMeta(c),f=!i&&r.indexOf(u)===-1;u.buildOrUpdateElements(f),o=Math.max(+u.getMaxOverflow(),o)}o=this._minPadding=s.layout.autoPadding?o:0,this._updateLayout(o),i||bt(r,c=>{c.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(lm("z","_idx"));const{_active:a,_lastEvent:l}=this;l?this._eventHandler(l,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){bt(this.scales,t=>{fe.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),s=new Set(t.events);(!Ap(e,s)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:s,start:i,count:r}of e){const o=s==="_removeElements"?-r:r;iC(t,i,o)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,s=r=>new Set(t.filter(o=>o[0]===r).map((o,a)=>a+","+o.splice(1).join(","))),i=s(0);for(let r=1;r<e;r++)if(!Ap(i,s(r)))return;return Array.from(i).map(r=>r.split(",")).map(r=>({method:r[1],start:+r[2],count:+r[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;fe.update(this,this.width,this.height,t);const e=this.chartArea,s=e.width<=0||e.height<=0;this._layers=[],bt(this.boxes,i=>{s&&i.position==="chartArea"||(i.configure&&i.configure(),this._layers.push(...i._layers()))},this),this._layers.forEach((i,r)=>{i._idx=r}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let e=0,s=this.data.datasets.length;e<s;++e)this.getDatasetMeta(e).controller.configure();for(let e=0,s=this.data.datasets.length;e<s;++e)this._updateDataset(e,En(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const s=this.getDatasetMeta(t),i={meta:s,index:t,mode:e,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",i)!==!1&&(s.controller._update(e),i.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",i))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Qs.has(this)?this.attached&&!Qs.running(this)&&Qs.start(this):(this.draw(),cm({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:s,height:i}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(s,i)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,s=[];let i,r;for(i=0,r=e.length;i<r;++i){const o=e[i];(!t||o.visible)&&s.push(o)}return s}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,s={meta:t,index:t.index,cancelable:!0},i=Ey(this,t);this.notifyPlugins("beforeDatasetDraw",s)!==!1&&(i&&Od(e,i),t.controller.draw(),i&&Fd(e),s.cancelable=!1,this.notifyPlugins("afterDatasetDraw",s))}isPointInArea(t){return Pi(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,s,i){const r=eE.modes[e];return typeof r=="function"?r(this,t,s,i):[]}getDatasetMeta(t){const e=this.data.datasets[t],s=this._metasets;let i=s.filter(r=>r&&r._dataset===e).pop();return i||(i={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},s.push(i)),i}getContext(){return this.$context||(this.$context=Tn(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const s=this.getDatasetMeta(t);return typeof s.hidden=="boolean"?!s.hidden:!e.hidden}setDatasetVisibility(t,e){const s=this.getDatasetMeta(t);s.hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,s){const i=s?"show":"hide",r=this.getDatasetMeta(t),o=r.controller._resolveAnimations(void 0,i);fl(e)?(r.data[e].hidden=!s,this.update()):(this.setDatasetVisibility(t,s),o.update(r,{visible:s}),this.update(a=>a.datasetIndex===t?i:void 0))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),Qs.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),Lp(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete Vh[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,s=(r,o)=>{e.addEventListener(this,r,o),t[r]=o},i=(r,o,a)=>{r.offsetX=o,r.offsetY=a,this._eventHandler(r)};bt(this.options.events,r=>s(r,i))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,s=(l,c)=>{e.addEventListener(this,l,c),t[l]=c},i=(l,c)=>{t[l]&&(e.removeEventListener(this,l,c),delete t[l])},r=(l,c)=>{this.canvas&&this.resize(l,c)};let o;const a=()=>{i("attach",a),this.attached=!0,this.resize(),s("resize",r),s("detach",o)};o=()=>{this.attached=!1,i("resize",r),this._stop(),this._resize(0,0),s("attach",a)},e.isAttached(this.canvas)?a():o()}unbindEvents(){bt(this._listeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._listeners={},bt(this._responsiveListeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,e,s){const i=s?"set":"remove";let r,o,a,l;for(e==="dataset"&&(r=this.getDatasetMeta(t[0].datasetIndex),r.controller["_"+i+"DatasetHoverStyle"]()),a=0,l=t.length;a<l;++a){o=t[a];const c=o&&this.getDatasetMeta(o.datasetIndex).controller;c&&c[i+"HoverStyle"](o.element,o.datasetIndex,o.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],s=t.map(({datasetIndex:r,index:o})=>{const a=this.getDatasetMeta(r);if(!a)throw new Error("No dataset found at index "+r);return{datasetIndex:r,element:a.data[o],index:o}});!td(s,e)&&(this._active=s,this._lastEvent=null,this._updateHoverStyles(s,e))}notifyPlugins(t,e,s){return this._plugins.notify(this,t,e,s)}isPluginEnabled(t){return this._plugins._cache.filter(e=>e.plugin.id===t).length===1}_updateHoverStyles(t,e,s){const i=this.options.hover,r=(l,c)=>l.filter(h=>!c.some(u=>h.datasetIndex===u.datasetIndex&&h.index===u.index)),o=r(e,t),a=s?t:r(t,e);o.length&&this.updateHoverStyle(o,i.mode,!1),a.length&&i.mode&&this.updateHoverStyle(a,i.mode,!0)}_eventHandler(t,e){const s={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},i=o=>(o.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",s,i)===!1)return;const r=this._handleEvent(t,e,s.inChartArea);return s.cancelable=!1,this.notifyPlugins("afterEvent",s,i),(r||s.changed)&&this.render(),this}_handleEvent(t,e,s){const{_active:i=[],options:r}=this,o=e,a=this._getActiveElements(t,i,s,o),l=dw(t),c=nC(t,this._lastEvent,s,l);s&&(this._lastEvent=null,wt(r.onHover,[t,a,this],this),l&&wt(r.onClick,[t,a,this],this));const h=!td(a,i);return(h||e)&&(this._active=a,this._updateHoverStyles(a,i,e)),this._lastEvent=c,h}_getActiveElements(t,e,s,i){if(t.type==="mouseout")return[];if(!s)return e;const r=this.options.hover;return this.getElementsAtEventForMode(t,r.mode,r,i)}}T(ri,"defaults",Mt),T(ri,"instances",Vh),T(ri,"overrides",Qr),T(ri,"registry",ws),T(ri,"version",tC),T(ri,"getChart",hm);function dm(){return bt(ri.instances,n=>n._plugins.invalidate())}function rC(n,t,e){const{startAngle:s,x:i,y:r,outerRadius:o,innerRadius:a,options:l}=t,{borderWidth:c,borderJoinStyle:h}=l,u=Math.min(c/o,de(s-e));if(n.beginPath(),n.arc(i,r,o-c/2,s+u/2,e-u/2),a>0){const f=Math.min(c/a,de(s-e));n.arc(i,r,a+c/2,e-f/2,s+f/2,!0)}else{const f=Math.min(c/2,o*de(s-e));if(h==="round")n.arc(i,r,f,e-ht/2,s+ht/2,!0);else if(h==="bevel"){const g=2*f*f,p=-g*Math.cos(e+ht/2)+i,m=-g*Math.sin(e+ht/2)+r,b=g*Math.cos(s+ht/2)+i,y=g*Math.sin(s+ht/2)+r;n.lineTo(p,m),n.lineTo(b,y)}}n.closePath(),n.moveTo(0,0),n.rect(0,0,n.canvas.width,n.canvas.height),n.clip("evenodd")}function oC(n,t,e){const{startAngle:s,pixelMargin:i,x:r,y:o,outerRadius:a,innerRadius:l}=t;let c=i/a;n.beginPath(),n.arc(r,o,a,s-c,e+c),l>i?(c=i/l,n.arc(r,o,l,e+c,s-c,!0)):n.arc(r,o,i,e+Nt,s-Nt),n.closePath(),n.clip()}function aC(n){return kg(n,["outerStart","outerEnd","innerStart","innerEnd"])}function lC(n,t,e,s){const i=aC(n.options.borderRadius),r=(e-t)/2,o=Math.min(r,s*t/2),a=l=>{const c=(e-Math.min(r,l))*s/2;return te(l,0,Math.min(r,c))};return{outerStart:a(i.outerStart),outerEnd:a(i.outerEnd),innerStart:te(i.innerStart,0,o),innerEnd:te(i.innerEnd,0,o)}}function uo(n,t,e,s){return{x:e+n*Math.cos(t),y:s+n*Math.sin(t)}}function od(n,t,e,s,i,r){const{x:o,y:a,startAngle:l,pixelMargin:c,innerRadius:h}=t,u=Math.max(t.outerRadius+s+e-c,0),f=h>0?h+s+e+c:0;let g=0;const p=i-l;if(s){const U=h>0?h-s:0,Y=u>0?u-s:0,D=(U+Y)/2,F=D!==0?p*D/(D+s):p;g=(p-F)/2}const m=Math.max(.001,p*u-e/ht)/u,b=(p-m)/2,y=l+b+g,A=i-b-g,{outerStart:w,outerEnd:S,innerStart:E,innerEnd:C}=lC(t,f,u,A-y),k=u-w,M=u-S,R=y+w/k,N=A-S/M,O=f+E,j=f+C,X=y+E/O,Q=A-C/j;if(n.beginPath(),r){const U=(R+N)/2;if(n.arc(o,a,u,R,U),n.arc(o,a,u,U,N),S>0){const L=uo(M,N,o,a);n.arc(L.x,L.y,S,N,A+Nt)}const Y=uo(j,A,o,a);if(n.lineTo(Y.x,Y.y),C>0){const L=uo(j,Q,o,a);n.arc(L.x,L.y,C,A+Nt,Q+Math.PI)}const D=(A-C/f+(y+E/f))/2;if(n.arc(o,a,f,A-C/f,D,!0),n.arc(o,a,f,D,y+E/f,!0),E>0){const L=uo(O,X,o,a);n.arc(L.x,L.y,E,X+Math.PI,y-Nt)}const F=uo(k,y,o,a);if(n.lineTo(F.x,F.y),w>0){const L=uo(k,R,o,a);n.arc(L.x,L.y,w,y-Nt,R)}}else{n.moveTo(o,a);const U=Math.cos(R)*u+o,Y=Math.sin(R)*u+a;n.lineTo(U,Y);const D=Math.cos(N)*u+o,F=Math.sin(N)*u+a;n.lineTo(D,F)}n.closePath()}function cC(n,t,e,s,i){const{fullCircles:r,startAngle:o,circumference:a}=t;let l=t.endAngle;if(r){od(n,t,e,s,l,i);for(let c=0;c<r;++c)n.fill();isNaN(a)||(l=o+(a%St||St))}return od(n,t,e,s,l,i),n.fill(),l}function hC(n,t,e,s,i){const{fullCircles:r,startAngle:o,circumference:a,options:l}=t,{borderWidth:c,borderJoinStyle:h,borderDash:u,borderDashOffset:f,borderRadius:g}=l,p=l.borderAlign==="inner";if(!c)return;n.setLineDash(u||[]),n.lineDashOffset=f,p?(n.lineWidth=c*2,n.lineJoin=h||"round"):(n.lineWidth=c,n.lineJoin=h||"bevel");let m=t.endAngle;if(r){od(n,t,e,s,m,i);for(let b=0;b<r;++b)n.stroke();isNaN(a)||(m=o+(a%St||St))}p&&oC(n,t,m),l.selfJoin&&m-o>=ht&&g===0&&h!=="miter"&&rC(n,t,m),r||(od(n,t,e,s,m,i),n.stroke())}class Ja extends bs{constructor(e){super();T(this,"circumference");T(this,"endAngle");T(this,"fullCircles");T(this,"innerRadius");T(this,"outerRadius");T(this,"pixelMargin");T(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,s,i){const r=this.getProps(["x","y"],i),{angle:o,distance:a}=ny(r,{x:e,y:s}),{startAngle:l,endAngle:c,innerRadius:h,outerRadius:u,circumference:f}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),g=(this.options.spacing+this.options.borderWidth)/2,p=Z(f,c-l),m=gl(o,l,c)&&l!==c,b=p>=St||m,y=Ti(a,h+g,u+g);return b&&y}getCenterPoint(e){const{x:s,y:i,startAngle:r,endAngle:o,innerRadius:a,outerRadius:l}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:c,spacing:h}=this.options,u=(r+o)/2,f=(a+l+h+c)/2;return{x:s+Math.cos(u)*f,y:i+Math.sin(u)*f}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:s,circumference:i}=this,r=(s.offset||0)/4,o=(s.spacing||0)/2,a=s.circular;if(this.pixelMargin=s.borderAlign==="inner"?.33:0,this.fullCircles=i>St?Math.floor(i/St):0,i===0||this.innerRadius<0||this.outerRadius<0)return;e.save();const l=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(l)*r,Math.sin(l)*r);const c=1-Math.sin(Math.min(ht,i||0)),h=r*c;e.fillStyle=s.backgroundColor,e.strokeStyle=s.borderColor,cC(e,this,h,o,a),hC(e,this,h,o,a),e.restore()}}T(Ja,"id","arc"),T(Ja,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1}),T(Ja,"defaultRoutes",{backgroundColor:"backgroundColor"}),T(Ja,"descriptors",{_scriptable:!0,_indexable:e=>e!=="borderDash"});function Hy(n,t,e=t){n.lineCap=Z(e.borderCapStyle,t.borderCapStyle),n.setLineDash(Z(e.borderDash,t.borderDash)),n.lineDashOffset=Z(e.borderDashOffset,t.borderDashOffset),n.lineJoin=Z(e.borderJoinStyle,t.borderJoinStyle),n.lineWidth=Z(e.borderWidth,t.borderWidth),n.strokeStyle=Z(e.borderColor,t.borderColor)}function dC(n,t,e){n.lineTo(e.x,e.y)}function uC(n){return n.stepped?Iw:n.tension||n.cubicInterpolationMode==="monotone"?Ow:dC}function By(n,t,e={}){const s=n.length,{start:i=0,end:r=s-1}=e,{start:o,end:a}=t,l=Math.max(i,o),c=Math.min(r,a),h=i<o&&r<o||i>a&&r>a;return{count:s,start:l,loop:t.loop,ilen:c<l&&!h?s+c-l:c-l}}function fC(n,t,e,s){const{points:i,options:r}=t,{count:o,start:a,loop:l,ilen:c}=By(i,e,s),h=uC(r);let{move:u=!0,reverse:f}=s||{},g,p,m;for(g=0;g<=c;++g)p=i[(a+(f?c-g:g))%o],!p.skip&&(u?(n.moveTo(p.x,p.y),u=!1):h(n,m,p,f,r.stepped),m=p);return l&&(p=i[(a+(f?c:0))%o],h(n,m,p,f,r.stepped)),!!l}function gC(n,t,e,s){const i=t.points,{count:r,start:o,ilen:a}=By(i,e,s),{move:l=!0,reverse:c}=s||{};let h=0,u=0,f,g,p,m,b,y;const A=S=>(o+(c?a-S:S))%r,w=()=>{m!==b&&(n.lineTo(h,b),n.lineTo(h,m),n.lineTo(h,y))};for(l&&(g=i[A(0)],n.moveTo(g.x,g.y)),f=0;f<=a;++f){if(g=i[A(f)],g.skip)continue;const S=g.x,E=g.y,C=S|0;C===p?(E<m?m=E:E>b&&(b=E),h=(u*h+S)/++u):(w(),n.lineTo(S,E),p=C,u=0,m=b=E),y=E}w()}function qf(n){const t=n.options,e=t.borderDash&&t.borderDash.length;return!n._decimated&&!n._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!e?gC:fC}function pC(n){return n.stepped?fS:n.tension||n.cubicInterpolationMode==="monotone"?gS:Wn}function mC(n,t,e,s){let i=t._path;i||(i=t._path=new Path2D,t.path(i,e,s)&&i.closePath()),Hy(n,t.options),n.stroke(i)}function bC(n,t,e,s){const{segments:i,options:r}=t,o=qf(t);for(const a of i)Hy(n,r,a.style),n.beginPath(),o(n,t,a,{start:e,end:e+s-1})&&n.closePath(),n.stroke()}const yC=typeof Path2D=="function";function _C(n,t,e,s){yC&&!t.options.segment?mC(n,t,e,s):bC(n,t,e,s)}class _n extends bs{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const s=this.options;if((s.tension||s.cubicInterpolationMode==="monotone")&&!s.stepped&&!this._pointsUpdated){const i=s.spanGaps?this._loop:this._fullLoop;rS(this._points,s,t,i,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=vS(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,s=t.length;return s&&e[t[s-1].end]}interpolate(t,e){const s=this.options,i=t[e],r=this.points,o=Sy(this,{property:e,start:i,end:i});if(!o.length)return;const a=[],l=pC(s);let c,h;for(c=0,h=o.length;c<h;++c){const{start:u,end:f}=o[c],g=r[u],p=r[f];if(g===p){a.push(g);continue}const m=Math.abs((i-g[e])/(p[e]-g[e])),b=l(g,p,m,s.stepped);b[e]=t[e],a.push(b)}return a.length===1?a[0]:a}pathSegment(t,e,s){return qf(this)(t,this,e,s)}path(t,e,s){const i=this.segments,r=qf(this);let o=this._loop;e=e||0,s=s||this.points.length-e;for(const a of i)o&=r(t,this,a,{start:e,end:e+s-1});return!!o}draw(t,e,s,i){const r=this.options||{};(this.points||[]).length&&r.borderWidth&&(t.save(),_C(t,this,s,i),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}T(_n,"id","line"),T(_n,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),T(_n,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),T(_n,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"});function um(n,t,e,s){const i=n.options,{[e]:r}=n.getProps([e],s);return Math.abs(t-r)<i.radius+i.hitRadius}class Uh extends bs{constructor(e){super();T(this,"parsed");T(this,"skip");T(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,s,i){const r=this.options,{x:o,y:a}=this.getProps(["x","y"],i);return Math.pow(e-o,2)+Math.pow(s-a,2)<Math.pow(r.hitRadius+r.radius,2)}inXRange(e,s){return um(this,e,"x",s)}inYRange(e,s){return um(this,e,"y",s)}getCenterPoint(e){const{x:s,y:i}=this.getProps(["x","y"],e);return{x:s,y:i}}size(e){e=e||this.options||{};let s=e.radius||0;s=Math.max(s,s&&e.hoverRadius||0);const i=s&&e.borderWidth||0;return(s+i)*2}draw(e,s){const i=this.options;this.skip||i.radius<.1||!Pi(this,s,this.size(i)/2)||(e.strokeStyle=i.borderColor,e.lineWidth=i.borderWidth,e.fillStyle=i.backgroundColor,Uf(e,i,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}T(Uh,"id","point"),T(Uh,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),T(Uh,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function zy(n,t){const{x:e,y:s,base:i,width:r,height:o}=n.getProps(["x","y","base","width","height"],t);let a,l,c,h,u;return n.horizontal?(u=o/2,a=Math.min(e,i),l=Math.max(e,i),c=s-u,h=s+u):(u=r/2,a=e-u,l=e+u,c=Math.min(s,i),h=Math.max(s,i)),{left:a,top:c,right:l,bottom:h}}function vn(n,t,e,s){return n?0:te(t,e,s)}function vC(n,t,e){const s=n.options.borderWidth,i=n.borderSkipped,r=fy(s);return{t:vn(i.top,r.top,0,e),r:vn(i.right,r.right,0,t),b:vn(i.bottom,r.bottom,0,e),l:vn(i.left,r.left,0,t)}}function AC(n,t,e){const{enableBorderRadius:s}=n.getProps(["enableBorderRadius"]),i=n.options.borderRadius,r=Xr(i),o=Math.min(t,e),a=n.borderSkipped,l=s||nt(i);return{topLeft:vn(!l||a.top||a.left,r.topLeft,0,o),topRight:vn(!l||a.top||a.right,r.topRight,0,o),bottomLeft:vn(!l||a.bottom||a.left,r.bottomLeft,0,o),bottomRight:vn(!l||a.bottom||a.right,r.bottomRight,0,o)}}function xC(n){const t=zy(n),e=t.right-t.left,s=t.bottom-t.top,i=vC(n,e/2,s/2),r=AC(n,e/2,s/2);return{outer:{x:t.left,y:t.top,w:e,h:s,radius:r},inner:{x:t.left+i.l,y:t.top+i.t,w:e-i.l-i.r,h:s-i.t-i.b,radius:{topLeft:Math.max(0,r.topLeft-Math.max(i.t,i.l)),topRight:Math.max(0,r.topRight-Math.max(i.t,i.r)),bottomLeft:Math.max(0,r.bottomLeft-Math.max(i.b,i.l)),bottomRight:Math.max(0,r.bottomRight-Math.max(i.b,i.r))}}}}function du(n,t,e,s){const i=t===null,r=e===null,a=n&&!(i&&r)&&zy(n,s);return a&&(i||Ti(t,a.left,a.right))&&(r||Ti(e,a.top,a.bottom))}function wC(n){return n.topLeft||n.topRight||n.bottomLeft||n.bottomRight}function SC(n,t){n.rect(t.x,t.y,t.w,t.h)}function uu(n,t,e={}){const s=n.x!==e.x?-t:0,i=n.y!==e.y?-t:0,r=(n.x+n.w!==e.x+e.w?t:0)-s,o=(n.y+n.h!==e.y+e.h?t:0)-i;return{x:n.x+s,y:n.y+i,w:n.w+r,h:n.h+o,radius:n.radius}}class Gh extends bs{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:s,backgroundColor:i}}=this,{inner:r,outer:o}=xC(this),a=wC(o.radius)?pl:SC;t.save(),(o.w!==r.w||o.h!==r.h)&&(t.beginPath(),a(t,uu(o,e,r)),t.clip(),a(t,uu(r,-e,o)),t.fillStyle=s,t.fill("evenodd")),t.beginPath(),a(t,uu(r,e)),t.fillStyle=i,t.fill(),t.restore()}inRange(t,e,s){return du(this,t,e,s)}inXRange(t,e){return du(this,t,null,e)}inYRange(t,e){return du(this,null,t,e)}getCenterPoint(t){const{x:e,y:s,base:i,horizontal:r}=this.getProps(["x","y","base","horizontal"],t);return{x:r?(e+i)/2:e,y:r?s:(s+i)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}T(Gh,"id","bar"),T(Gh,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),T(Gh,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var EC=Object.freeze({__proto__:null,ArcElement:Ja,BarElement:Gh,LineElement:_n,PointElement:Uh});const Kf=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],fm=Kf.map(n=>n.replace("rgb(","rgba(").replace(")",", 0.5)"));function $y(n){return Kf[n%Kf.length]}function Wy(n){return fm[n%fm.length]}function CC(n,t){return n.borderColor=$y(t),n.backgroundColor=Wy(t),++t}function kC(n,t){return n.backgroundColor=n.data.map(()=>$y(t++)),t}function MC(n,t){return n.backgroundColor=n.data.map(()=>Wy(t++)),t}function TC(n){let t=0;return(e,s)=>{const i=n.getDatasetMeta(s).controller;i instanceof Gn?t=kC(e,t):i instanceof al?t=MC(e,t):i&&(t=CC(e,t))}}function gm(n){let t;for(t in n)if(n[t].borderColor||n[t].backgroundColor)return!0;return!1}function LC(n){return n&&(n.borderColor||n.backgroundColor)}function PC(){return Mt.borderColor!=="rgba(0,0,0,0.1)"||Mt.backgroundColor!=="rgba(0,0,0,0.1)"}var RC={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(n,t,e){if(!e.enabled)return;const{data:{datasets:s},options:i}=n.config,{elements:r}=i,o=gm(s)||LC(i)||r&&gm(r)||PC();if(!e.forceOverride&&o)return;const a=TC(n);s.forEach(a)}};function DC(n,t,e,s,i){const r=i.samples||s;if(r>=e)return n.slice(t,t+e);const o=[],a=(e-2)/(r-2);let l=0;const c=t+e-1;let h=t,u,f,g,p,m;for(o[l++]=n[h],u=0;u<r-2;u++){let b=0,y=0,A;const w=Math.floor((u+1)*a)+1+t,S=Math.min(Math.floor((u+2)*a)+1,e)+t,E=S-w;for(A=w;A<S;A++)b+=n[A].x,y+=n[A].y;b/=E,y/=E;const C=Math.floor(u*a)+1+t,k=Math.min(Math.floor((u+1)*a)+1,e)+t,{x:M,y:R}=n[h];for(g=p=-1,A=C;A<k;A++)p=.5*Math.abs((M-b)*(n[A].y-R)-(M-n[A].x)*(y-R)),p>g&&(g=p,f=n[A],m=A);o[l++]=f,h=m}return o[l++]=n[c],o}function IC(n,t,e,s){let i=0,r=0,o,a,l,c,h,u,f,g,p,m;const b=[],y=t+e-1,A=n[t].x,S=n[y].x-A;for(o=t;o<t+e;++o){a=n[o],l=(a.x-A)/S*s,c=a.y;const E=l|0;if(E===h)c<p?(p=c,u=o):c>m&&(m=c,f=o),i=(r*i+a.x)/++r;else{const C=o-1;if(!st(u)&&!st(f)){const k=Math.min(u,f),M=Math.max(u,f);k!==g&&k!==C&&b.push({...n[k],x:i}),M!==g&&M!==C&&b.push({...n[M],x:i})}o>0&&C!==g&&b.push(n[C]),b.push(a),h=E,r=0,p=m=c,u=f=g=o}}return b}function jy(n){if(n._decimated){const t=n._data;delete n._decimated,delete n._data,Object.defineProperty(n,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function pm(n){n.data.datasets.forEach(t=>{jy(t)})}function OC(n,t){const e=t.length;let s=0,i;const{iScale:r}=n,{min:o,max:a,minDefined:l,maxDefined:c}=r.getUserBounds();return l&&(s=te(Li(t,r.axis,o).lo,0,e-1)),c?i=te(Li(t,r.axis,a).hi+1,s,e)-s:i=e-s,{start:s,count:i}}var FC={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(n,t,e)=>{if(!e.enabled){pm(n);return}const s=n.width;n.data.datasets.forEach((i,r)=>{const{_data:o,indexAxis:a}=i,l=n.getDatasetMeta(r),c=o||i.data;if(Ka([a,n.options.indexAxis])==="y"||!l.controller.supportsDecimation)return;const h=n.scales[l.xAxisID];if(h.type!=="linear"&&h.type!=="time"||n.options.parsing)return;let{start:u,count:f}=OC(l,c);const g=e.threshold||4*s;if(f<=g){jy(i);return}st(o)&&(i._data=c,delete i.data,Object.defineProperty(i,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(m){this._data=m}}));let p;switch(e.algorithm){case"lttb":p=DC(c,u,f,s,e);break;case"min-max":p=IC(c,u,f,s);break;default:throw new Error(`Unsupported decimation algorithm '${e.algorithm}'`)}i._decimated=p})},destroy(n){pm(n)}};function NC(n,t,e){const s=n.segments,i=n.points,r=t.points,o=[];for(const a of s){let{start:l,end:c}=a;c=Bd(l,c,i);const h=Zf(e,i[l],i[c],a.loop);if(!t.segments){o.push({source:a,target:h,start:i[l],end:i[c]});continue}const u=Sy(t,h);for(const f of u){const g=Zf(e,r[f.start],r[f.end],f.loop),p=wy(a,i,g);for(const m of p)o.push({source:m,target:f,start:{[e]:mm(h,g,"start",Math.max)},end:{[e]:mm(h,g,"end",Math.min)}})}}return o}function Zf(n,t,e,s){if(s)return;let i=t[n],r=e[n];return n==="angle"&&(i=de(i),r=de(r)),{property:n,start:i,end:r}}function HC(n,t){const{x:e=null,y:s=null}=n||{},i=t.points,r=[];return t.segments.forEach(({start:o,end:a})=>{a=Bd(o,a,i);const l=i[o],c=i[a];s!==null?(r.push({x:l.x,y:s}),r.push({x:c.x,y:s})):e!==null&&(r.push({x:e,y:l.y}),r.push({x:e,y:c.y}))}),r}function Bd(n,t,e){for(;t>n;t--){const s=e[t];if(!isNaN(s.x)&&!isNaN(s.y))break}return t}function mm(n,t,e,s){return n&&t?s(n[e],t[e]):n?n[e]:t?t[e]:0}function Vy(n,t){let e=[],s=!1;return kt(n)?(s=!0,e=n):e=HC(n,t),e.length?new _n({points:e,options:{tension:0},_loop:s,_fullLoop:s}):null}function bm(n){return n&&n.fill!==!1}function BC(n,t,e){let i=n[t].fill;const r=[t];let o;if(!e)return i;for(;i!==!1&&r.indexOf(i)===-1;){if(!Dt(i))return i;if(o=n[i],!o)return!1;if(o.visible)return i;r.push(i),i=o.fill}return!1}function zC(n,t,e){const s=VC(n);if(nt(s))return isNaN(s.value)?!1:s;let i=parseFloat(s);return Dt(i)&&Math.floor(i)===i?$C(s[0],t,i,e):["origin","start","end","stack","shape"].indexOf(s)>=0&&s}function $C(n,t,e,s){return(n==="-"||n==="+")&&(e=t+e),e===t||e<0||e>=s?!1:e}function WC(n,t){let e=null;return n==="start"?e=t.bottom:n==="end"?e=t.top:nt(n)?e=t.getPixelForValue(n.value):t.getBasePixel&&(e=t.getBasePixel()),e}function jC(n,t,e){let s;return n==="start"?s=e:n==="end"?s=t.options.reverse?t.min:t.max:nt(n)?s=n.value:s=t.getBaseValue(),s}function VC(n){const t=n.options,e=t.fill;let s=Z(e&&e.target,e);return s===void 0&&(s=!!t.backgroundColor),s===!1||s===null?!1:s===!0?"origin":s}function UC(n){const{scale:t,index:e,line:s}=n,i=[],r=s.segments,o=s.points,a=GC(t,e);a.push(Vy({x:null,y:t.bottom},s));for(let l=0;l<r.length;l++){const c=r[l];for(let h=c.start;h<=c.end;h++)XC(i,o[h],a)}return new _n({points:i,options:{}})}function GC(n,t){const e=[],s=n.getMatchingVisibleMetas("line");for(let i=0;i<s.length;i++){const r=s[i];if(r.index===t)break;r.hidden||e.unshift(r.dataset)}return e}function XC(n,t,e){const s=[];for(let i=0;i<e.length;i++){const r=e[i],{first:o,last:a,point:l}=YC(r,t,"x");if(!(!l||o&&a)){if(o)s.unshift(l);else if(n.push(l),!a)break}}n.push(...s)}function YC(n,t,e){const s=n.interpolate(t,e);if(!s)return{};const i=s[e],r=n.segments,o=n.points;let a=!1,l=!1;for(let c=0;c<r.length;c++){const h=r[c],u=o[h.start][e],f=o[h.end][e];if(Ti(i,u,f)){a=i===u,l=i===f;break}}return{first:a,last:l,point:s}}class Uy{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,s){const{x:i,y:r,radius:o}=this;return e=e||{start:0,end:St},t.arc(i,r,o,e.end,e.start,!0),!s.bounds}interpolate(t){const{x:e,y:s,radius:i}=this,r=t.angle;return{x:e+Math.cos(r)*i,y:s+Math.sin(r)*i,angle:r}}}function qC(n){const{chart:t,fill:e,line:s}=n;if(Dt(e))return KC(t,e);if(e==="stack")return UC(n);if(e==="shape")return!0;const i=ZC(n);return i instanceof Uy?i:Vy(i,s)}function KC(n,t){const e=n.getDatasetMeta(t);return e&&n.isDatasetVisible(t)?e.dataset:null}function ZC(n){return(n.scale||{}).getPointPositionForValue?QC(n):JC(n)}function JC(n){const{scale:t={},fill:e}=n,s=WC(e,t);if(Dt(s)){const i=t.isHorizontal();return{x:i?s:null,y:i?null:s}}return null}function QC(n){const{scale:t,fill:e}=n,s=t.options,i=t.getLabels().length,r=s.reverse?t.max:t.min,o=jC(e,t,r),a=[];if(s.grid.circular){const l=t.getPointPositionForValue(0,r);return new Uy({x:l.x,y:l.y,radius:t.getDistanceFromCenterForValue(o)})}for(let l=0;l<i;++l)a.push(t.getPointPositionForValue(l,o));return a}function fu(n,t,e){const s=qC(t),{chart:i,index:r,line:o,scale:a,axis:l}=t,c=o.options,h=c.fill,u=c.backgroundColor,{above:f=u,below:g=u}=h||{},p=i.getDatasetMeta(r),m=Ey(i,p);s&&o.points.length&&(Od(n,e),tk(n,{line:o,target:s,above:f,below:g,area:e,scale:a,axis:l,clip:m}),Fd(n))}function tk(n,t){const{line:e,target:s,above:i,below:r,area:o,scale:a,clip:l}=t,c=e._loop?"angle":t.axis;n.save();let h=r;r!==i&&(c==="x"?(ym(n,s,o.top),gu(n,{line:e,target:s,color:i,scale:a,property:c,clip:l}),n.restore(),n.save(),ym(n,s,o.bottom)):c==="y"&&(_m(n,s,o.left),gu(n,{line:e,target:s,color:r,scale:a,property:c,clip:l}),n.restore(),n.save(),_m(n,s,o.right),h=i)),gu(n,{line:e,target:s,color:h,scale:a,property:c,clip:l}),n.restore()}function ym(n,t,e){const{segments:s,points:i}=t;let r=!0,o=!1;n.beginPath();for(const a of s){const{start:l,end:c}=a,h=i[l],u=i[Bd(l,c,i)];r?(n.moveTo(h.x,h.y),r=!1):(n.lineTo(h.x,e),n.lineTo(h.x,h.y)),o=!!t.pathSegment(n,a,{move:o}),o?n.closePath():n.lineTo(u.x,e)}n.lineTo(t.first().x,e),n.closePath(),n.clip()}function _m(n,t,e){const{segments:s,points:i}=t;let r=!0,o=!1;n.beginPath();for(const a of s){const{start:l,end:c}=a,h=i[l],u=i[Bd(l,c,i)];r?(n.moveTo(h.x,h.y),r=!1):(n.lineTo(e,h.y),n.lineTo(h.x,h.y)),o=!!t.pathSegment(n,a,{move:o}),o?n.closePath():n.lineTo(e,u.y)}n.lineTo(e,t.first().y),n.closePath(),n.clip()}function gu(n,t){const{line:e,target:s,property:i,color:r,scale:o,clip:a}=t,l=NC(e,s,i);for(const{source:c,target:h,start:u,end:f}of l){const{style:{backgroundColor:g=r}={}}=c,p=s!==!0;n.save(),n.fillStyle=g,ek(n,o,a,p&&Zf(i,u,f)),n.beginPath();const m=!!e.pathSegment(n,c);let b;if(p){m?n.closePath():vm(n,s,f,i);const y=!!s.pathSegment(n,h,{move:m,reverse:!0});b=m&&y,b||vm(n,s,u,i)}n.closePath(),n.fill(b?"evenodd":"nonzero"),n.restore()}}function ek(n,t,e,s){const i=t.chart.chartArea,{property:r,start:o,end:a}=s||{};if(r==="x"||r==="y"){let l,c,h,u;r==="x"?(l=o,c=i.top,h=a,u=i.bottom):(l=i.left,c=o,h=i.right,u=a),n.beginPath(),e&&(l=Math.max(l,e.left),h=Math.min(h,e.right),c=Math.max(c,e.top),u=Math.min(u,e.bottom)),n.rect(l,c,h-l,u-c),n.clip()}}function vm(n,t,e,s){const i=t.interpolate(e,s);i&&n.lineTo(i.x,i.y)}var sk={id:"filler",afterDatasetsUpdate(n,t,e){const s=(n.data.datasets||[]).length,i=[];let r,o,a,l;for(o=0;o<s;++o)r=n.getDatasetMeta(o),a=r.dataset,l=null,a&&a.options&&a instanceof _n&&(l={visible:n.isDatasetVisible(o),index:o,fill:zC(a,o,s),chart:n,axis:r.controller.options.indexAxis,scale:r.vScale,line:a}),r.$filler=l,i.push(l);for(o=0;o<s;++o)l=i[o],!(!l||l.fill===!1)&&(l.fill=BC(i,o,e.propagate))},beforeDraw(n,t,e){const s=e.drawTime==="beforeDraw",i=n.getSortedVisibleDatasetMetas(),r=n.chartArea;for(let o=i.length-1;o>=0;--o){const a=i[o].$filler;a&&(a.line.updateControlPoints(r,a.axis),s&&a.fill&&fu(n.ctx,a,r))}},beforeDatasetsDraw(n,t,e){if(e.drawTime!=="beforeDatasetsDraw")return;const s=n.getSortedVisibleDatasetMetas();for(let i=s.length-1;i>=0;--i){const r=s[i].$filler;bm(r)&&fu(n.ctx,r,n.chartArea)}},beforeDatasetDraw(n,t,e){const s=t.meta.$filler;!bm(s)||e.drawTime!=="beforeDatasetDraw"||fu(n.ctx,s,n.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const Am=(n,t)=>{let{boxHeight:e=t,boxWidth:s=t}=n;return n.usePointStyle&&(e=Math.min(e,t),s=n.pointStyleWidth||Math.min(s,t)),{boxWidth:s,boxHeight:e,itemHeight:Math.max(t,e)}},ik=(n,t)=>n!==null&&t!==null&&n.datasetIndex===t.datasetIndex&&n.index===t.index;class xm extends bs{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,s){this.maxWidth=t,this.maxHeight=e,this._margins=s,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=wt(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter(s=>t.filter(s,this.chart.data))),t.sort&&(e=e.sort((s,i)=>t.sort(s,i,this.chart.data))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display){this.width=this.height=0;return}const s=t.labels,i=Yt(s.font),r=i.size,o=this._computeTitleHeight(),{boxWidth:a,itemHeight:l}=Am(s,r);let c,h;e.font=i.string,this.isHorizontal()?(c=this.maxWidth,h=this._fitRows(o,r,a,l)+10):(h=this.maxHeight,c=this._fitCols(o,i,a,l)+10),this.width=Math.min(c,t.maxWidth||this.maxWidth),this.height=Math.min(h,t.maxHeight||this.maxHeight)}_fitRows(t,e,s,i){const{ctx:r,maxWidth:o,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.lineWidths=[0],h=i+a;let u=t;r.textAlign="left",r.textBaseline="middle";let f=-1,g=-h;return this.legendItems.forEach((p,m)=>{const b=s+e/2+r.measureText(p.text).width;(m===0||c[c.length-1]+b+2*a>o)&&(u+=h,c[c.length-(m>0?0:1)]=0,g+=h,f++),l[m]={left:0,top:g,row:f,width:b,height:i},c[c.length-1]+=b+a}),u}_fitCols(t,e,s,i){const{ctx:r,maxHeight:o,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.columnSizes=[],h=o-t;let u=a,f=0,g=0,p=0,m=0;return this.legendItems.forEach((b,y)=>{const{itemWidth:A,itemHeight:w}=nk(s,e,r,b,i);y>0&&g+w+2*a>h&&(u+=f+a,c.push({width:f,height:g}),p+=f+a,m++,f=g=0),l[y]={left:p,top:g,col:m,width:A,height:w},f=Math.max(f,A),g+=w+a}),u+=f,c.push({width:f,height:g}),u}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:s,labels:{padding:i},rtl:r}}=this,o=So(r,this.left,this.width);if(this.isHorizontal()){let a=0,l=he(s,this.left+i,this.right-this.lineWidths[a]);for(const c of e)a!==c.row&&(a=c.row,l=he(s,this.left+i,this.right-this.lineWidths[a])),c.top+=this.top+t+i,c.left=o.leftForLtr(o.x(l),c.width),l+=c.width+i}else{let a=0,l=he(s,this.top+t+i,this.bottom-this.columnSizes[a].height);for(const c of e)c.col!==a&&(a=c.col,l=he(s,this.top+t+i,this.bottom-this.columnSizes[a].height)),c.top=l,c.left+=this.left+i,c.left=o.leftForLtr(o.x(c.left),c.width),l+=c.height+i}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;Od(t,this),this._draw(),Fd(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:s,ctx:i}=this,{align:r,labels:o}=t,a=Mt.color,l=So(t.rtl,this.left,this.width),c=Yt(o.font),{padding:h}=o,u=c.size,f=u/2;let g;this.drawTitle(),i.textAlign=l.textAlign("left"),i.textBaseline="middle",i.lineWidth=.5,i.font=c.string;const{boxWidth:p,boxHeight:m,itemHeight:b}=Am(o,u),y=function(C,k,M){if(isNaN(p)||p<=0||isNaN(m)||m<0)return;i.save();const R=Z(M.lineWidth,1);if(i.fillStyle=Z(M.fillStyle,a),i.lineCap=Z(M.lineCap,"butt"),i.lineDashOffset=Z(M.lineDashOffset,0),i.lineJoin=Z(M.lineJoin,"miter"),i.lineWidth=R,i.strokeStyle=Z(M.strokeStyle,a),i.setLineDash(Z(M.lineDash,[])),o.usePointStyle){const N={radius:m*Math.SQRT2/2,pointStyle:M.pointStyle,rotation:M.rotation,borderWidth:R},O=l.xPlus(C,p/2),j=k+f;uy(i,N,O,j,o.pointStyleWidth&&p)}else{const N=k+Math.max((u-m)/2,0),O=l.leftForLtr(C,p),j=Xr(M.borderRadius);i.beginPath(),Object.values(j).some(X=>X!==0)?pl(i,{x:O,y:N,w:p,h:m,radius:j}):i.rect(O,N,p,m),i.fill(),R!==0&&i.stroke()}i.restore()},A=function(C,k,M){to(i,M.text,C,k+b/2,c,{strikethrough:M.hidden,textAlign:l.textAlign(M.textAlign)})},w=this.isHorizontal(),S=this._computeTitleHeight();w?g={x:he(r,this.left+h,this.right-s[0]),y:this.top+h+S,line:0}:g={x:this.left+h,y:he(r,this.top+S+h,this.bottom-e[0].height),line:0},vy(this.ctx,t.textDirection);const E=b+h;this.legendItems.forEach((C,k)=>{i.strokeStyle=C.fontColor,i.fillStyle=C.fontColor;const M=i.measureText(C.text).width,R=l.textAlign(C.textAlign||(C.textAlign=o.textAlign)),N=p+f+M;let O=g.x,j=g.y;l.setWidth(this.width),w?k>0&&O+N+h>this.right&&(j=g.y+=E,g.line++,O=g.x=he(r,this.left+h,this.right-s[g.line])):k>0&&j+E>this.bottom&&(O=g.x=O+e[g.line].width+h,g.line++,j=g.y=he(r,this.top+S+h,this.bottom-e[g.line].height));const X=l.x(O);if(y(X,j,C),O=ww(R,O+p+f,w?O+N:this.right,t.rtl),A(l.x(O),j,C),w)g.x+=N+h;else if(typeof C.text!="string"){const Q=c.lineHeight;g.y+=Gy(C,Q)+h}else g.y+=E}),Ay(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,s=Yt(e.font),i=ge(e.padding);if(!e.display)return;const r=So(t.rtl,this.left,this.width),o=this.ctx,a=e.position,l=s.size/2,c=i.top+l;let h,u=this.left,f=this.width;if(this.isHorizontal())f=Math.max(...this.lineWidths),h=this.top+c,u=he(t.align,u,this.right-f);else{const p=this.columnSizes.reduce((m,b)=>Math.max(m,b.height),0);h=c+he(t.align,this.top,this.bottom-p-t.labels.padding-this._computeTitleHeight())}const g=he(a,u,u+f);o.textAlign=r.textAlign(Eg(a)),o.textBaseline="middle",o.strokeStyle=e.color,o.fillStyle=e.color,o.font=s.string,to(o,e.text,g,h,s)}_computeTitleHeight(){const t=this.options.title,e=Yt(t.font),s=ge(t.padding);return t.display?e.lineHeight+s.height:0}_getLegendItemAt(t,e){let s,i,r;if(Ti(t,this.left,this.right)&&Ti(e,this.top,this.bottom)){for(r=this.legendHitBoxes,s=0;s<r.length;++s)if(i=r[s],Ti(t,i.left,i.left+i.width)&&Ti(e,i.top,i.top+i.height))return this.legendItems[s]}return null}handleEvent(t){const e=this.options;if(!ak(t.type,e))return;const s=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const i=this._hoveredItem,r=ik(i,s);i&&!r&&wt(e.onLeave,[t,i,this],this),this._hoveredItem=s,s&&!r&&wt(e.onHover,[t,s,this],this)}else s&&wt(e.onClick,[t,s,this],this)}}function nk(n,t,e,s,i){const r=rk(s,n,t,e),o=ok(i,s,t.lineHeight);return{itemWidth:r,itemHeight:o}}function rk(n,t,e,s){let i=n.text;return i&&typeof i!="string"&&(i=i.reduce((r,o)=>r.length>o.length?r:o)),t+e.size/2+s.measureText(i).width}function ok(n,t,e){let s=n;return typeof t.text!="string"&&(s=Gy(t,e)),s}function Gy(n,t){const e=n.text?n.text.length:0;return t*e}function ak(n,t){return!!((n==="mousemove"||n==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(n==="click"||n==="mouseup"))}var lk={id:"legend",_element:xm,start(n,t,e){const s=n.legend=new xm({ctx:n.ctx,options:e,chart:n});fe.configure(n,s,e),fe.addBox(n,s)},stop(n){fe.removeBox(n,n.legend),delete n.legend},beforeUpdate(n,t,e){const s=n.legend;fe.configure(n,s,e),s.options=e},afterUpdate(n){const t=n.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(n,t){t.replay||n.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(n,t,e){const s=t.datasetIndex,i=e.chart;i.isDatasetVisible(s)?(i.hide(s),t.hidden=!0):(i.show(s),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:n=>n.chart.options.color,boxWidth:40,padding:10,generateLabels(n){const t=n.data.datasets,{labels:{usePointStyle:e,pointStyle:s,textAlign:i,color:r,useBorderRadius:o,borderRadius:a}}=n.legend.options;return n._getSortedDatasetMetas().map(l=>{const c=l.controller.getStyle(e?0:void 0),h=ge(c.borderWidth);return{text:t[l.index].label,fillStyle:c.backgroundColor,fontColor:r,hidden:!l.visible,lineCap:c.borderCapStyle,lineDash:c.borderDash,lineDashOffset:c.borderDashOffset,lineJoin:c.borderJoinStyle,lineWidth:(h.width+h.height)/4,strokeStyle:c.borderColor,pointStyle:s||c.pointStyle,rotation:c.rotation,textAlign:i||c.textAlign,borderRadius:o&&(a||c.borderRadius),datasetIndex:l.index}},this)}},title:{color:n=>n.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:n=>!n.startsWith("on"),labels:{_scriptable:n=>!["generateLabels","filter","sort"].includes(n)}}};class Ig extends bs{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const s=this.options;if(this.left=0,this.top=0,!s.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=e;const i=kt(s.text)?s.text.length:1;this._padding=ge(s.padding);const r=i*Yt(s.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=r:this.width=r}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:e,left:s,bottom:i,right:r,options:o}=this,a=o.align;let l=0,c,h,u;return this.isHorizontal()?(h=he(a,s,r),u=e+t,c=r-s):(o.position==="left"?(h=s+t,u=he(a,i,e),l=ht*-.5):(h=r-t,u=he(a,e,i),l=ht*.5),c=i-e),{titleX:h,titleY:u,maxWidth:c,rotation:l}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const s=Yt(e.font),r=s.lineHeight/2+this._padding.top,{titleX:o,titleY:a,maxWidth:l,rotation:c}=this._drawArgs(r);to(t,e.text,0,0,s,{color:e.color,maxWidth:l,rotation:c,textAlign:Eg(e.align),textBaseline:"middle",translation:[o,a]})}}function ck(n,t){const e=new Ig({ctx:n.ctx,options:t,chart:n});fe.configure(n,e,t),fe.addBox(n,e),n.titleBlock=e}var hk={id:"title",_element:Ig,start(n,t,e){ck(n,e)},stop(n){const t=n.titleBlock;fe.removeBox(n,t),delete n.titleBlock},beforeUpdate(n,t,e){const s=n.titleBlock;fe.configure(n,s,e),s.options=e},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const ah=new WeakMap;var dk={id:"subtitle",start(n,t,e){const s=new Ig({ctx:n.ctx,options:e,chart:n});fe.configure(n,s,e),fe.addBox(n,s),ah.set(n,s)},stop(n){fe.removeBox(n,ah.get(n)),ah.delete(n)},beforeUpdate(n,t,e){const s=ah.get(n);fe.configure(n,s,e),s.options=e},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Qa={average(n){if(!n.length)return!1;let t,e,s=new Set,i=0,r=0;for(t=0,e=n.length;t<e;++t){const a=n[t].element;if(a&&a.hasValue()){const l=a.tooltipPosition();s.add(l.x),i+=l.y,++r}}return r===0||s.size===0?!1:{x:[...s].reduce((a,l)=>a+l)/s.size,y:i/r}},nearest(n,t){if(!n.length)return!1;let e=t.x,s=t.y,i=Number.POSITIVE_INFINITY,r,o,a;for(r=0,o=n.length;r<o;++r){const l=n[r].element;if(l&&l.hasValue()){const c=l.getCenterPoint(),h=jf(t,c);h<i&&(i=h,a=l)}}if(a){const l=a.tooltipPosition();e=l.x,s=l.y}return{x:e,y:s}}};function vs(n,t){return t&&(kt(t)?Array.prototype.push.apply(n,t):n.push(t)),n}function ti(n){return(typeof n=="string"||n instanceof String)&&n.indexOf(`
`)>-1?n.split(`
`):n}function uk(n,t){const{element:e,datasetIndex:s,index:i}=t,r=n.getDatasetMeta(s).controller,{label:o,value:a}=r.getLabelAndValue(i);return{chart:n,label:o,parsed:r.getParsed(i),raw:n.data.datasets[s].data[i],formattedValue:a,dataset:r.getDataset(),dataIndex:i,datasetIndex:s,element:e}}function wm(n,t){const e=n.chart.ctx,{body:s,footer:i,title:r}=n,{boxWidth:o,boxHeight:a}=t,l=Yt(t.bodyFont),c=Yt(t.titleFont),h=Yt(t.footerFont),u=r.length,f=i.length,g=s.length,p=ge(t.padding);let m=p.height,b=0,y=s.reduce((S,E)=>S+E.before.length+E.lines.length+E.after.length,0);if(y+=n.beforeBody.length+n.afterBody.length,u&&(m+=u*c.lineHeight+(u-1)*t.titleSpacing+t.titleMarginBottom),y){const S=t.displayColors?Math.max(a,l.lineHeight):l.lineHeight;m+=g*S+(y-g)*l.lineHeight+(y-1)*t.bodySpacing}f&&(m+=t.footerMarginTop+f*h.lineHeight+(f-1)*t.footerSpacing);let A=0;const w=function(S){b=Math.max(b,e.measureText(S).width+A)};return e.save(),e.font=c.string,bt(n.title,w),e.font=l.string,bt(n.beforeBody.concat(n.afterBody),w),A=t.displayColors?o+2+t.boxPadding:0,bt(s,S=>{bt(S.before,w),bt(S.lines,w),bt(S.after,w)}),A=0,e.font=h.string,bt(n.footer,w),e.restore(),b+=p.width,{width:b,height:m}}function fk(n,t){const{y:e,height:s}=t;return e<s/2?"top":e>n.height-s/2?"bottom":"center"}function gk(n,t,e,s){const{x:i,width:r}=s,o=e.caretSize+e.caretPadding;if(n==="left"&&i+r+o>t.width||n==="right"&&i-r-o<0)return!0}function pk(n,t,e,s){const{x:i,width:r}=e,{width:o,chartArea:{left:a,right:l}}=n;let c="center";return s==="center"?c=i<=(a+l)/2?"left":"right":i<=r/2?c="left":i>=o-r/2&&(c="right"),gk(c,n,t,e)&&(c="center"),c}function Sm(n,t,e){const s=e.yAlign||t.yAlign||fk(n,e);return{xAlign:e.xAlign||t.xAlign||pk(n,t,e,s),yAlign:s}}function mk(n,t){let{x:e,width:s}=n;return t==="right"?e-=s:t==="center"&&(e-=s/2),e}function bk(n,t,e){let{y:s,height:i}=n;return t==="top"?s+=e:t==="bottom"?s-=i+e:s-=i/2,s}function Em(n,t,e,s){const{caretSize:i,caretPadding:r,cornerRadius:o}=n,{xAlign:a,yAlign:l}=e,c=i+r,{topLeft:h,topRight:u,bottomLeft:f,bottomRight:g}=Xr(o);let p=mk(t,a);const m=bk(t,l,c);return l==="center"?a==="left"?p+=c:a==="right"&&(p-=c):a==="left"?p-=Math.max(h,f)+i:a==="right"&&(p+=Math.max(u,g)+i),{x:te(p,0,s.width-t.width),y:te(m,0,s.height-t.height)}}function lh(n,t,e){const s=ge(e.padding);return t==="center"?n.x+n.width/2:t==="right"?n.x+n.width-s.right:n.x+s.left}function Cm(n){return vs([],ti(n))}function yk(n,t,e){return Tn(n,{tooltip:t,tooltipItems:e,type:"tooltip"})}function km(n,t){const e=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return e?n.override(e):n}const Xy={beforeTitle:Zs,title(n){if(n.length>0){const t=n[0],e=t.chart.data.labels,s=e?e.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(s>0&&t.dataIndex<s)return e[t.dataIndex]}return""},afterTitle:Zs,beforeBody:Zs,beforeLabel:Zs,label(n){if(this&&this.options&&this.options.mode==="dataset")return n.label+": "+n.formattedValue||n.formattedValue;let t=n.dataset.label||"";t&&(t+=": ");const e=n.formattedValue;return st(e)||(t+=e),t},labelColor(n){const e=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(n){const e=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:Zs,afterBody:Zs,beforeFooter:Zs,footer:Zs,afterFooter:Zs};function Se(n,t,e,s){const i=n[t].call(e,s);return typeof i>"u"?Xy[t].call(e,s):i}class Jf extends bs{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,s=this.options.setContext(this.getContext()),i=s.enabled&&e.options.animation&&s.animations,r=new Cy(this.chart,i);return i._cacheable&&(this._cachedAnimations=Object.freeze(r)),r}getContext(){return this.$context||(this.$context=yk(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,e){const{callbacks:s}=e,i=Se(s,"beforeTitle",this,t),r=Se(s,"title",this,t),o=Se(s,"afterTitle",this,t);let a=[];return a=vs(a,ti(i)),a=vs(a,ti(r)),a=vs(a,ti(o)),a}getBeforeBody(t,e){return Cm(Se(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:s}=e,i=[];return bt(t,r=>{const o={before:[],lines:[],after:[]},a=km(s,r);vs(o.before,ti(Se(a,"beforeLabel",this,r))),vs(o.lines,Se(a,"label",this,r)),vs(o.after,ti(Se(a,"afterLabel",this,r))),i.push(o)}),i}getAfterBody(t,e){return Cm(Se(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:s}=e,i=Se(s,"beforeFooter",this,t),r=Se(s,"footer",this,t),o=Se(s,"afterFooter",this,t);let a=[];return a=vs(a,ti(i)),a=vs(a,ti(r)),a=vs(a,ti(o)),a}_createItems(t){const e=this._active,s=this.chart.data,i=[],r=[],o=[];let a=[],l,c;for(l=0,c=e.length;l<c;++l)a.push(uk(this.chart,e[l]));return t.filter&&(a=a.filter((h,u,f)=>t.filter(h,u,f,s))),t.itemSort&&(a=a.sort((h,u)=>t.itemSort(h,u,s))),bt(a,h=>{const u=km(t.callbacks,h);i.push(Se(u,"labelColor",this,h)),r.push(Se(u,"labelPointStyle",this,h)),o.push(Se(u,"labelTextColor",this,h))}),this.labelColors=i,this.labelPointStyles=r,this.labelTextColors=o,this.dataPoints=a,a}update(t,e){const s=this.options.setContext(this.getContext()),i=this._active;let r,o=[];if(!i.length)this.opacity!==0&&(r={opacity:0});else{const a=Qa[s.position].call(this,i,this._eventPosition);o=this._createItems(s),this.title=this.getTitle(o,s),this.beforeBody=this.getBeforeBody(o,s),this.body=this.getBody(o,s),this.afterBody=this.getAfterBody(o,s),this.footer=this.getFooter(o,s);const l=this._size=wm(this,s),c=Object.assign({},a,l),h=Sm(this.chart,s,c),u=Em(s,c,h,this.chart);this.xAlign=h.xAlign,this.yAlign=h.yAlign,r={opacity:1,x:u.x,y:u.y,width:l.width,height:l.height,caretX:a.x,caretY:a.y}}this._tooltipItems=o,this.$context=void 0,r&&this._resolveAnimations().update(this,r),t&&s.external&&s.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,s,i){const r=this.getCaretPosition(t,s,i);e.lineTo(r.x1,r.y1),e.lineTo(r.x2,r.y2),e.lineTo(r.x3,r.y3)}getCaretPosition(t,e,s){const{xAlign:i,yAlign:r}=this,{caretSize:o,cornerRadius:a}=s,{topLeft:l,topRight:c,bottomLeft:h,bottomRight:u}=Xr(a),{x:f,y:g}=t,{width:p,height:m}=e;let b,y,A,w,S,E;return r==="center"?(S=g+m/2,i==="left"?(b=f,y=b-o,w=S+o,E=S-o):(b=f+p,y=b+o,w=S-o,E=S+o),A=b):(i==="left"?y=f+Math.max(l,h)+o:i==="right"?y=f+p-Math.max(c,u)-o:y=this.caretX,r==="top"?(w=g,S=w-o,b=y-o,A=y+o):(w=g+m,S=w+o,b=y+o,A=y-o),E=w),{x1:b,x2:y,x3:A,y1:w,y2:S,y3:E}}drawTitle(t,e,s){const i=this.title,r=i.length;let o,a,l;if(r){const c=So(s.rtl,this.x,this.width);for(t.x=lh(this,s.titleAlign,s),e.textAlign=c.textAlign(s.titleAlign),e.textBaseline="middle",o=Yt(s.titleFont),a=s.titleSpacing,e.fillStyle=s.titleColor,e.font=o.string,l=0;l<r;++l)e.fillText(i[l],c.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+a,l+1===r&&(t.y+=s.titleMarginBottom-a)}}_drawColorBox(t,e,s,i,r){const o=this.labelColors[s],a=this.labelPointStyles[s],{boxHeight:l,boxWidth:c}=r,h=Yt(r.bodyFont),u=lh(this,"left",r),f=i.x(u),g=l<h.lineHeight?(h.lineHeight-l)/2:0,p=e.y+g;if(r.usePointStyle){const m={radius:Math.min(c,l)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},b=i.leftForLtr(f,c)+c/2,y=p+l/2;t.strokeStyle=r.multiKeyBackground,t.fillStyle=r.multiKeyBackground,Uf(t,m,b,y),t.strokeStyle=o.borderColor,t.fillStyle=o.backgroundColor,Uf(t,m,b,y)}else{t.lineWidth=nt(o.borderWidth)?Math.max(...Object.values(o.borderWidth)):o.borderWidth||1,t.strokeStyle=o.borderColor,t.setLineDash(o.borderDash||[]),t.lineDashOffset=o.borderDashOffset||0;const m=i.leftForLtr(f,c),b=i.leftForLtr(i.xPlus(f,1),c-2),y=Xr(o.borderRadius);Object.values(y).some(A=>A!==0)?(t.beginPath(),t.fillStyle=r.multiKeyBackground,pl(t,{x:m,y:p,w:c,h:l,radius:y}),t.fill(),t.stroke(),t.fillStyle=o.backgroundColor,t.beginPath(),pl(t,{x:b,y:p+1,w:c-2,h:l-2,radius:y}),t.fill()):(t.fillStyle=r.multiKeyBackground,t.fillRect(m,p,c,l),t.strokeRect(m,p,c,l),t.fillStyle=o.backgroundColor,t.fillRect(b,p+1,c-2,l-2))}t.fillStyle=this.labelTextColors[s]}drawBody(t,e,s){const{body:i}=this,{bodySpacing:r,bodyAlign:o,displayColors:a,boxHeight:l,boxWidth:c,boxPadding:h}=s,u=Yt(s.bodyFont);let f=u.lineHeight,g=0;const p=So(s.rtl,this.x,this.width),m=function(M){e.fillText(M,p.x(t.x+g),t.y+f/2),t.y+=f+r},b=p.textAlign(o);let y,A,w,S,E,C,k;for(e.textAlign=o,e.textBaseline="middle",e.font=u.string,t.x=lh(this,b,s),e.fillStyle=s.bodyColor,bt(this.beforeBody,m),g=a&&b!=="right"?o==="center"?c/2+h:c+2+h:0,S=0,C=i.length;S<C;++S){for(y=i[S],A=this.labelTextColors[S],e.fillStyle=A,bt(y.before,m),w=y.lines,a&&w.length&&(this._drawColorBox(e,t,S,p,s),f=Math.max(u.lineHeight,l)),E=0,k=w.length;E<k;++E)m(w[E]),f=u.lineHeight;bt(y.after,m)}g=0,f=u.lineHeight,bt(this.afterBody,m),t.y-=r}drawFooter(t,e,s){const i=this.footer,r=i.length;let o,a;if(r){const l=So(s.rtl,this.x,this.width);for(t.x=lh(this,s.footerAlign,s),t.y+=s.footerMarginTop,e.textAlign=l.textAlign(s.footerAlign),e.textBaseline="middle",o=Yt(s.footerFont),e.fillStyle=s.footerColor,e.font=o.string,a=0;a<r;++a)e.fillText(i[a],l.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+s.footerSpacing}}drawBackground(t,e,s,i){const{xAlign:r,yAlign:o}=this,{x:a,y:l}=t,{width:c,height:h}=s,{topLeft:u,topRight:f,bottomLeft:g,bottomRight:p}=Xr(i.cornerRadius);e.fillStyle=i.backgroundColor,e.strokeStyle=i.borderColor,e.lineWidth=i.borderWidth,e.beginPath(),e.moveTo(a+u,l),o==="top"&&this.drawCaret(t,e,s,i),e.lineTo(a+c-f,l),e.quadraticCurveTo(a+c,l,a+c,l+f),o==="center"&&r==="right"&&this.drawCaret(t,e,s,i),e.lineTo(a+c,l+h-p),e.quadraticCurveTo(a+c,l+h,a+c-p,l+h),o==="bottom"&&this.drawCaret(t,e,s,i),e.lineTo(a+g,l+h),e.quadraticCurveTo(a,l+h,a,l+h-g),o==="center"&&r==="left"&&this.drawCaret(t,e,s,i),e.lineTo(a,l+u),e.quadraticCurveTo(a,l,a+u,l),e.closePath(),e.fill(),i.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,s=this.$animations,i=s&&s.x,r=s&&s.y;if(i||r){const o=Qa[t.position].call(this,this._active,this._eventPosition);if(!o)return;const a=this._size=wm(this,t),l=Object.assign({},o,this._size),c=Sm(e,t,l),h=Em(t,l,c,e);(i._to!==h.x||r._to!==h.y)&&(this.xAlign=c.xAlign,this.yAlign=c.yAlign,this.width=a.width,this.height=a.height,this.caretX=o.x,this.caretY=o.y,this._resolveAnimations().update(this,h))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let s=this.opacity;if(!s)return;this._updateAnimationTarget(e);const i={width:this.width,height:this.height},r={x:this.x,y:this.y};s=Math.abs(s)<.001?0:s;const o=ge(e.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&a&&(t.save(),t.globalAlpha=s,this.drawBackground(r,t,i,e),vy(t,e.textDirection),r.y+=o.top,this.drawTitle(r,t,e),this.drawBody(r,t,e),this.drawFooter(r,t,e),Ay(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const s=this._active,i=t.map(({datasetIndex:a,index:l})=>{const c=this.chart.getDatasetMeta(a);if(!c)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:c.data[l],index:l}}),r=!td(s,i),o=this._positionChanged(i,e);(r||o)&&(this._active=i,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,s=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const i=this.options,r=this._active||[],o=this._getActiveElements(t,r,e,s),a=this._positionChanged(o,t),l=e||!td(o,r)||a;return l&&(this._active=o,(i.enabled||i.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),l}_getActiveElements(t,e,s,i){const r=this.options;if(t.type==="mouseout")return[];if(!i)return e.filter(a=>this.chart.data.datasets[a.datasetIndex]&&this.chart.getDatasetMeta(a.datasetIndex).controller.getParsed(a.index)!==void 0);const o=this.chart.getElementsAtEventForMode(t,r.mode,r,s);return r.reverse&&o.reverse(),o}_positionChanged(t,e){const{caretX:s,caretY:i,options:r}=this,o=Qa[r.position].call(this,t,e);return o!==!1&&(s!==o.x||i!==o.y)}}T(Jf,"positioners",Qa);var _k={id:"tooltip",_element:Jf,positioners:Qa,afterInit(n,t,e){e&&(n.tooltip=new Jf({chart:n,options:e}))},beforeUpdate(n,t,e){n.tooltip&&n.tooltip.initialize(e)},reset(n,t,e){n.tooltip&&n.tooltip.initialize(e)},afterDraw(n){const t=n.tooltip;if(t&&t._willRender()){const e={tooltip:t};if(n.notifyPlugins("beforeTooltipDraw",{...e,cancelable:!0})===!1)return;t.draw(n.ctx),n.notifyPlugins("afterTooltipDraw",e)}},afterEvent(n,t){if(n.tooltip){const e=t.replay;n.tooltip.handleEvent(t.event,e,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(n,t)=>t.bodyFont.size,boxWidth:(n,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:Xy},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:n=>n!=="filter"&&n!=="itemSort"&&n!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},vk=Object.freeze({__proto__:null,Colors:RC,Decimation:FC,Filler:sk,Legend:lk,SubTitle:dk,Title:hk,Tooltip:_k});const Ak=(n,t,e,s)=>(typeof t=="string"?(e=n.push(t)-1,s.unshift({index:e,label:t})):isNaN(t)&&(e=null),e);function xk(n,t,e,s){const i=n.indexOf(t);if(i===-1)return Ak(n,t,e,s);const r=n.lastIndexOf(t);return i!==r?e:i}const wk=(n,t)=>n===null?null:te(Math.round(n),0,t);function Mm(n){const t=this.getLabels();return n>=0&&n<t.length?t[n]:n}class Qf extends ao{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const s=this.getLabels();for(const{index:i,label:r}of e)s[i]===r&&s.splice(i,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(st(t))return null;const s=this.getLabels();return e=isFinite(e)&&s[e]===t?e:xk(s,t,Z(e,t),this._addedLabels),wk(e,s.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:s,max:i}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(s=0),e||(i=this.getLabels().length-1)),this.min=s,this.max=i}buildTicks(){const t=this.min,e=this.max,s=this.options.offset,i=[];let r=this.getLabels();r=t===0&&e===r.length-1?r:r.slice(t,e+1),this._valueRange=Math.max(r.length-(s?0:1),1),this._startValue=this.min-(s?.5:0);for(let o=t;o<=e;o++)i.push({value:o});return i}getLabelForValue(t){return Mm.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}T(Qf,"id","category"),T(Qf,"defaults",{ticks:{callback:Mm}});function Sk(n,t){const e=[],{bounds:i,step:r,min:o,max:a,precision:l,count:c,maxTicks:h,maxDigits:u,includeBounds:f}=n,g=r||1,p=h-1,{min:m,max:b}=t,y=!st(o),A=!st(a),w=!st(c),S=(b-m)/(u+1);let E=wp((b-m)/p/g)*g,C,k,M,R;if(E<1e-14&&!y&&!A)return[{value:m},{value:b}];R=Math.ceil(b/E)-Math.floor(m/E),R>p&&(E=wp(R*E/p/g)*g),st(l)||(C=Math.pow(10,l),E=Math.ceil(E*C)/C),i==="ticks"?(k=Math.floor(m/E)*E,M=Math.ceil(b/E)*E):(k=m,M=b),y&&A&&r&&mw((a-o)/r,E/1e3)?(R=Math.round(Math.min((a-o)/E,h)),E=(a-o)/R,k=o,M=a):w?(k=y?o:k,M=A?a:M,R=c-1,E=(M-k)/R):(R=(M-k)/E,nl(R,Math.round(R),E/1e3)?R=Math.round(R):R=Math.ceil(R));const N=Math.max(Sp(E),Sp(k));C=Math.pow(10,st(l)?N:l),k=Math.round(k*C)/C,M=Math.round(M*C)/C;let O=0;for(y&&(f&&k!==o?(e.push({value:o}),k<o&&O++,nl(Math.round((k+O*E)*C)/C,o,Tm(o,S,n))&&O++):k<o&&O++);O<R;++O){const j=Math.round((k+O*E)*C)/C;if(A&&j>a)break;e.push({value:j})}return A&&f&&M!==a?e.length&&nl(e[e.length-1].value,a,Tm(a,S,n))?e[e.length-1].value=a:e.push({value:a}):(!A||M===a)&&e.push({value:M}),e}function Tm(n,t,{horizontal:e,minRotation:s}){const i=ps(s),r=(e?Math.sin(i):Math.cos(i))||.001,o=.75*t*(""+n).length;return Math.min(t/r,o)}class ad extends ao{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return st(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:s}=this.getUserBounds();let{min:i,max:r}=this;const o=l=>i=e?i:l,a=l=>r=s?r:l;if(t){const l=Us(i),c=Us(r);l<0&&c<0?a(0):l>0&&c>0&&o(0)}if(i===r){let l=r===0?1:Math.abs(r*.05);a(r+l),t||o(i-l)}this.min=i,this.max=r}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:e,stepSize:s}=t,i;return s?(i=Math.ceil(this.max/s)-Math.floor(this.min/s)+1,i>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${s} would result generating up to ${i} ticks. Limiting to 1000.`),i=1e3)):(i=this.computeTickLimit(),e=e||11),e&&(i=Math.min(e,i)),i}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let s=this.getTickLimit();s=Math.max(2,s);const i={maxTicks:s,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:e.includeBounds!==!1},r=this._range||this,o=Sk(i,r);return t.bounds==="ticks"&&iy(o,this,"value"),t.reverse?(o.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),o}configure(){const t=this.ticks;let e=this.min,s=this.max;if(super.configure(),this.options.offset&&t.length){const i=(s-e)/Math.max(t.length-1,1)/2;e-=i,s+=i}this._startValue=e,this._endValue=s,this._valueRange=s-e}getLabelForValue(t){return $c(t,this.chart.options.locale,this.options.ticks.format)}}class tg extends ad{determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=Dt(t)?t:0,this.max=Dt(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,s=ps(this.options.ticks.minRotation),i=(t?Math.sin(s):Math.cos(s))||.001,r=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,r.lineHeight/i))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}T(tg,"id","linear"),T(tg,"defaults",{ticks:{callback:Id.formatters.numeric}});const bl=n=>Math.floor(bn(n)),Nn=(n,t)=>Math.pow(10,bl(n)+t);function Lm(n){return n/Math.pow(10,bl(n))===1}function Pm(n,t,e){const s=Math.pow(10,e),i=Math.floor(n/s);return Math.ceil(t/s)-i}function Ek(n,t){const e=t-n;let s=bl(e);for(;Pm(n,t,s)>10;)s++;for(;Pm(n,t,s)<10;)s--;return Math.min(s,bl(n))}function Ck(n,{min:t,max:e}){t=Re(n.min,t);const s=[],i=bl(t);let r=Ek(t,e),o=r<0?Math.pow(10,Math.abs(r)):1;const a=Math.pow(10,r),l=i>r?Math.pow(10,i):0,c=Math.round((t-l)*o)/o,h=Math.floor((t-l)/a/10)*a*10;let u=Math.floor((c-h)/Math.pow(10,r)),f=Re(n.min,Math.round((l+h+u*Math.pow(10,r))*o)/o);for(;f<e;)s.push({value:f,major:Lm(f),significand:u}),u>=10?u=u<15?15:20:u++,u>=20&&(r++,u=2,o=r>=0?1:o),f=Math.round((l+h+u*Math.pow(10,r))*o)/o;const g=Re(n.max,f);return s.push({value:g,major:Lm(g),significand:u}),s}class eg extends ao{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const s=ad.prototype.parse.apply(this,[t,e]);if(s===0){this._zero=!0;return}return Dt(s)&&s>0?s:null}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=Dt(t)?Math.max(0,t):null,this.max=Dt(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Dt(this._userMin)&&(this.min=t===Nn(this.min,0)?Nn(this.min,-1):Nn(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let s=this.min,i=this.max;const r=a=>s=t?s:a,o=a=>i=e?i:a;s===i&&(s<=0?(r(1),o(10)):(r(Nn(s,-1)),o(Nn(i,1)))),s<=0&&r(Nn(i,-1)),i<=0&&o(Nn(s,1)),this.min=s,this.max=i}buildTicks(){const t=this.options,e={min:this._userMin,max:this._userMax},s=Ck(e,this);return t.bounds==="ticks"&&iy(s,this,"value"),t.reverse?(s.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),s}getLabelForValue(t){return t===void 0?"0":$c(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=bn(t),this._valueRange=bn(this.max)-bn(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(bn(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}T(eg,"id","logarithmic"),T(eg,"defaults",{ticks:{callback:Id.formatters.logarithmic,major:{enabled:!0}}});function sg(n){const t=n.ticks;if(t.display&&n.display){const e=ge(t.backdropPadding);return Z(t.font&&t.font.size,Mt.font.size)+e.height}return 0}function kk(n,t,e){return e=kt(e)?e:[e],{w:Dw(n,t.string,e),h:e.length*t.lineHeight}}function Rm(n,t,e,s,i){return n===s||n===i?{start:t-e/2,end:t+e/2}:n<s||n>i?{start:t-e,end:t}:{start:t,end:t+e}}function Mk(n){const t={l:n.left+n._padding.left,r:n.right-n._padding.right,t:n.top+n._padding.top,b:n.bottom-n._padding.bottom},e=Object.assign({},t),s=[],i=[],r=n._pointLabels.length,o=n.options.pointLabels,a=o.centerPointLabels?ht/r:0;for(let l=0;l<r;l++){const c=o.setContext(n.getPointLabelContext(l));i[l]=c.padding;const h=n.getPointPosition(l,n.drawingArea+i[l],a),u=Yt(c.font),f=kk(n.ctx,u,n._pointLabels[l]);s[l]=f;const g=de(n.getIndexAngle(l)+a),p=Math.round(wg(g)),m=Rm(p,h.x,f.w,0,180),b=Rm(p,h.y,f.h,90,270);Tk(e,t,g,m,b)}n.setCenterPoint(t.l-e.l,e.r-t.r,t.t-e.t,e.b-t.b),n._pointLabelItems=Rk(n,s,i)}function Tk(n,t,e,s,i){const r=Math.abs(Math.sin(e)),o=Math.abs(Math.cos(e));let a=0,l=0;s.start<t.l?(a=(t.l-s.start)/r,n.l=Math.min(n.l,t.l-a)):s.end>t.r&&(a=(s.end-t.r)/r,n.r=Math.max(n.r,t.r+a)),i.start<t.t?(l=(t.t-i.start)/o,n.t=Math.min(n.t,t.t-l)):i.end>t.b&&(l=(i.end-t.b)/o,n.b=Math.max(n.b,t.b+l))}function Lk(n,t,e){const s=n.drawingArea,{extra:i,additionalAngle:r,padding:o,size:a}=e,l=n.getPointPosition(t,s+i+o,r),c=Math.round(wg(de(l.angle+Nt))),h=Ok(l.y,a.h,c),u=Dk(c),f=Ik(l.x,a.w,u);return{visible:!0,x:l.x,y:h,textAlign:u,left:f,top:h,right:f+a.w,bottom:h+a.h}}function Pk(n,t){if(!t)return!0;const{left:e,top:s,right:i,bottom:r}=n;return!(Pi({x:e,y:s},t)||Pi({x:e,y:r},t)||Pi({x:i,y:s},t)||Pi({x:i,y:r},t))}function Rk(n,t,e){const s=[],i=n._pointLabels.length,r=n.options,{centerPointLabels:o,display:a}=r.pointLabels,l={extra:sg(r)/2,additionalAngle:o?ht/i:0};let c;for(let h=0;h<i;h++){l.padding=e[h],l.size=t[h];const u=Lk(n,h,l);s.push(u),a==="auto"&&(u.visible=Pk(u,c),u.visible&&(c=u))}return s}function Dk(n){return n===0||n===180?"center":n<180?"left":"right"}function Ik(n,t,e){return e==="right"?n-=t:e==="center"&&(n-=t/2),n}function Ok(n,t,e){return e===90||e===270?n-=t/2:(e>270||e<90)&&(n-=t),n}function Fk(n,t,e){const{left:s,top:i,right:r,bottom:o}=e,{backdropColor:a}=t;if(!st(a)){const l=Xr(t.borderRadius),c=ge(t.backdropPadding);n.fillStyle=a;const h=s-c.left,u=i-c.top,f=r-s+c.width,g=o-i+c.height;Object.values(l).some(p=>p!==0)?(n.beginPath(),pl(n,{x:h,y:u,w:f,h:g,radius:l}),n.fill()):n.fillRect(h,u,f,g)}}function Nk(n,t){const{ctx:e,options:{pointLabels:s}}=n;for(let i=t-1;i>=0;i--){const r=n._pointLabelItems[i];if(!r.visible)continue;const o=s.setContext(n.getPointLabelContext(i));Fk(e,o,r);const a=Yt(o.font),{x:l,y:c,textAlign:h}=r;to(e,n._pointLabels[i],l,c+a.lineHeight/2,a,{color:o.color,textAlign:h,textBaseline:"middle"})}}function Yy(n,t,e,s){const{ctx:i}=n;if(e)i.arc(n.xCenter,n.yCenter,t,0,St);else{let r=n.getPointPosition(0,t);i.moveTo(r.x,r.y);for(let o=1;o<s;o++)r=n.getPointPosition(o,t),i.lineTo(r.x,r.y)}}function Hk(n,t,e,s,i){const r=n.ctx,o=t.circular,{color:a,lineWidth:l}=t;!o&&!s||!a||!l||e<0||(r.save(),r.strokeStyle=a,r.lineWidth=l,r.setLineDash(i.dash||[]),r.lineDashOffset=i.dashOffset,r.beginPath(),Yy(n,e,o,s),r.closePath(),r.stroke(),r.restore())}function Bk(n,t,e){return Tn(n,{label:e,index:t,type:"pointLabel"})}class tl extends ad{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=ge(sg(this.options)/2),e=this.width=this.maxWidth-t.width,s=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+s/2+t.top),this.drawingArea=Math.floor(Math.min(e,s)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=Dt(t)&&!isNaN(t)?t:0,this.max=Dt(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/sg(this.options))}generateTickLabels(t){ad.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((e,s)=>{const i=wt(this.options.pointLabels.callback,[e,s],this);return i||i===0?i:""}).filter((e,s)=>this.chart.getDataVisibility(s))}fit(){const t=this.options;t.display&&t.pointLabels.display?Mk(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,s,i){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((s-i)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,s,i))}getIndexAngle(t){const e=St/(this._pointLabels.length||1),s=this.options.startAngle||0;return de(t*e+ps(s))}getDistanceFromCenterForValue(t){if(st(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(st(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const s=e[t];return Bk(this.getContext(),t,s)}}getPointPosition(t,e,s=0){const i=this.getIndexAngle(t)-Nt+s;return{x:Math.cos(i)*e+this.xCenter,y:Math.sin(i)*e+this.yCenter,angle:i}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:s,right:i,bottom:r}=this._pointLabelItems[t];return{left:e,top:s,right:i,bottom:r}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const s=this.ctx;s.save(),s.beginPath(),Yy(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),s.closePath(),s.fillStyle=t,s.fill(),s.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:s,grid:i,border:r}=e,o=this._pointLabels.length;let a,l,c;if(e.pointLabels.display&&Nk(this,o),i.display&&this.ticks.forEach((h,u)=>{if(u!==0||u===0&&this.min<0){l=this.getDistanceFromCenterForValue(h.value);const f=this.getContext(u),g=i.setContext(f),p=r.setContext(f);Hk(this,g,l,o,p)}}),s.display){for(t.save(),a=o-1;a>=0;a--){const h=s.setContext(this.getPointLabelContext(a)),{color:u,lineWidth:f}=h;!f||!u||(t.lineWidth=f,t.strokeStyle=u,t.setLineDash(h.borderDash),t.lineDashOffset=h.borderDashOffset,l=this.getDistanceFromCenterForValue(e.reverse?this.min:this.max),c=this.getPointPosition(a,l),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(c.x,c.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,s=e.ticks;if(!s.display)return;const i=this.getIndexAngle(0);let r,o;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(i),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((a,l)=>{if(l===0&&this.min>=0&&!e.reverse)return;const c=s.setContext(this.getContext(l)),h=Yt(c.font);if(r=this.getDistanceFromCenterForValue(this.ticks[l].value),c.showLabelBackdrop){t.font=h.string,o=t.measureText(a.label).width,t.fillStyle=c.backdropColor;const u=ge(c.backdropPadding);t.fillRect(-o/2-u.left,-r-h.size/2-u.top,o+u.width,h.size+u.height)}to(t,a.label,0,-r,h,{color:c.color,strokeColor:c.textStrokeColor,strokeWidth:c.textStrokeWidth})}),t.restore()}drawTitle(){}}T(tl,"id","radialLinear"),T(tl,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Id.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}}),T(tl,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),T(tl,"descriptors",{angleLines:{_fallback:"grid"}});const zd={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Me=Object.keys(zd);function Dm(n,t){return n-t}function Im(n,t){if(st(t))return null;const e=n._adapter,{parser:s,round:i,isoWeekday:r}=n._parseOpts;let o=t;return typeof s=="function"&&(o=s(o)),Dt(o)||(o=typeof s=="string"?e.parse(o,s):e.parse(o)),o===null?null:(i&&(o=i==="week"&&(va(r)||r===!0)?e.startOf(o,"isoWeek",r):e.startOf(o,i)),+o)}function Om(n,t,e,s){const i=Me.length;for(let r=Me.indexOf(n);r<i-1;++r){const o=zd[Me[r]],a=o.steps?o.steps:Number.MAX_SAFE_INTEGER;if(o.common&&Math.ceil((e-t)/(a*o.size))<=s)return Me[r]}return Me[i-1]}function zk(n,t,e,s,i){for(let r=Me.length-1;r>=Me.indexOf(e);r--){const o=Me[r];if(zd[o].common&&n._adapter.diff(i,s,o)>=t-1)return o}return Me[e?Me.indexOf(e):0]}function $k(n){for(let t=Me.indexOf(n)+1,e=Me.length;t<e;++t)if(zd[Me[t]].common)return Me[t]}function Fm(n,t,e){if(!e)n[t]=!0;else if(e.length){const{lo:s,hi:i}=Sg(e,t),r=e[s]>=t?e[s]:e[i];n[r]=!0}}function Wk(n,t,e,s){const i=n._adapter,r=+i.startOf(t[0].value,s),o=t[t.length-1].value;let a,l;for(a=r;a<=o;a=+i.add(a,1,s))l=e[a],l>=0&&(t[l].major=!0);return t}function Nm(n,t,e){const s=[],i={},r=t.length;let o,a;for(o=0;o<r;++o)a=t[o],i[a]=o,s.push({value:a,major:!1});return r===0||!e?s:Wk(n,s,i,e)}class yl extends ao{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e={}){const s=t.time||(t.time={}),i=this._adapter=new KS._date(t.adapters.date);i.init(e),il(s.displayFormats,i.formats()),this._parseOpts={parser:s.parser,round:s.round,isoWeekday:s.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return t===void 0?null:Im(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,s=t.time.unit||"day";let{min:i,max:r,minDefined:o,maxDefined:a}=this.getUserBounds();function l(c){!o&&!isNaN(c.min)&&(i=Math.min(i,c.min)),!a&&!isNaN(c.max)&&(r=Math.max(r,c.max))}(!o||!a)&&(l(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&l(this.getMinMax(!1))),i=Dt(i)&&!isNaN(i)?i:+e.startOf(Date.now(),s),r=Dt(r)&&!isNaN(r)?r:+e.endOf(Date.now(),s)+1,this.min=Math.min(i,r-1),this.max=Math.max(i+1,r)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],s=t[t.length-1]),{min:e,max:s}}buildTicks(){const t=this.options,e=t.time,s=t.ticks,i=s.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&i.length&&(this.min=this._userMin||i[0],this.max=this._userMax||i[i.length-1]);const r=this.min,o=this.max,a=vw(i,r,o);return this._unit=e.unit||(s.autoSkip?Om(e.minUnit,this.min,this.max,this._getLabelCapacity(r)):zk(this,a.length,e.minUnit,this.min,this.max)),this._majorUnit=!s.major.enabled||this._unit==="year"?void 0:$k(this._unit),this.initOffsets(i),t.reverse&&a.reverse(),Nm(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let e=0,s=0,i,r;this.options.offset&&t.length&&(i=this.getDecimalForValue(t[0]),t.length===1?e=1-i:e=(this.getDecimalForValue(t[1])-i)/2,r=this.getDecimalForValue(t[t.length-1]),t.length===1?s=r:s=(r-this.getDecimalForValue(t[t.length-2]))/2);const o=t.length<3?.5:.25;e=te(e,0,o),s=te(s,0,o),this._offsets={start:e,end:s,factor:1/(e+1+s)}}_generate(){const t=this._adapter,e=this.min,s=this.max,i=this.options,r=i.time,o=r.unit||Om(r.minUnit,e,s,this._getLabelCapacity(e)),a=Z(i.ticks.stepSize,1),l=o==="week"?r.isoWeekday:!1,c=va(l)||l===!0,h={};let u=e,f,g;if(c&&(u=+t.startOf(u,"isoWeek",l)),u=+t.startOf(u,c?"day":o),t.diff(s,e,o)>1e5*a)throw new Error(e+" and "+s+" are too far apart with stepSize of "+a+" "+o);const p=i.ticks.source==="data"&&this.getDataTimestamps();for(f=u,g=0;f<s;f=+t.add(f,a,o),g++)Fm(h,f,p);return(f===s||i.bounds==="ticks"||g===1)&&Fm(h,f,p),Object.keys(h).sort(Dm).map(m=>+m)}getLabelForValue(t){const e=this._adapter,s=this.options.time;return s.tooltipFormat?e.format(t,s.tooltipFormat):e.format(t,s.displayFormats.datetime)}format(t,e){const i=this.options.time.displayFormats,r=this._unit,o=e||i[r];return this._adapter.format(t,o)}_tickFormatFunction(t,e,s,i){const r=this.options,o=r.ticks.callback;if(o)return wt(o,[t,e,s],this);const a=r.time.displayFormats,l=this._unit,c=this._majorUnit,h=l&&a[l],u=c&&a[c],f=s[e],g=c&&u&&f&&f.major;return this._adapter.format(t,i||(g?u:h))}generateTickLabels(t){let e,s,i;for(e=0,s=t.length;e<s;++e)i=t[e],i.label=this._tickFormatFunction(i.value,e,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,s=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+s)*e.factor)}getValueForPixel(t){const e=this._offsets,s=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+s*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,s=this.ctx.measureText(t).width,i=ps(this.isHorizontal()?e.maxRotation:e.minRotation),r=Math.cos(i),o=Math.sin(i),a=this._resolveTickFontOptions(0).size;return{w:s*r+a*o,h:s*o+a*r}}_getLabelCapacity(t){const e=this.options.time,s=e.displayFormats,i=s[e.unit]||s.millisecond,r=this._tickFormatFunction(t,0,Nm(this,[t],this._majorUnit),i),o=this._getLabelSize(r),a=Math.floor(this.isHorizontal()?this.width/o.w:this.height/o.h)-1;return a>0?a:1}getDataTimestamps(){let t=this._cache.data||[],e,s;if(t.length)return t;const i=this.getMatchingVisibleMetas();if(this._normalized&&i.length)return this._cache.data=i[0].controller.getAllParsedValues(this);for(e=0,s=i.length;e<s;++e)t=t.concat(i[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let e,s;if(t.length)return t;const i=this.getLabels();for(e=0,s=i.length;e<s;++e)t.push(Im(this,i[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return oy(t.sort(Dm))}}T(yl,"id","time"),T(yl,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function ch(n,t,e){let s=0,i=n.length-1,r,o,a,l;e?(t>=n[s].pos&&t<=n[i].pos&&({lo:s,hi:i}=Li(n,"pos",t)),{pos:r,time:a}=n[s],{pos:o,time:l}=n[i]):(t>=n[s].time&&t<=n[i].time&&({lo:s,hi:i}=Li(n,"time",t)),{time:r,pos:a}=n[s],{time:o,pos:l}=n[i]);const c=o-r;return c?a+(l-a)*(t-r)/c:a}class ig extends yl{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=ch(e,this.min),this._tableRange=ch(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:s}=this,i=[],r=[];let o,a,l,c,h;for(o=0,a=t.length;o<a;++o)c=t[o],c>=e&&c<=s&&i.push(c);if(i.length<2)return[{time:e,pos:0},{time:s,pos:1}];for(o=0,a=i.length;o<a;++o)h=i[o+1],l=i[o-1],c=i[o],Math.round((h+l)/2)!==c&&r.push({time:c,pos:o/(a-1)});return r}_generate(){const t=this.min,e=this.max;let s=super.getDataTimestamps();return(!s.includes(t)||!s.length)&&s.splice(0,0,t),(!s.includes(e)||s.length===1)&&s.push(e),s.sort((i,r)=>i-r)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),s=this.getLabelTimestamps();return e.length&&s.length?t=this.normalize(e.concat(s)):t=e.length?e:s,t=this._cache.all=t,t}getDecimalForValue(t){return(ch(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,s=this.getDecimalForPixel(t)/e.factor-e.end;return ch(this._table,s*this._tableRange+this._minPos,!0)}}T(ig,"id","timeseries"),T(ig,"defaults",yl.defaults);var jk=Object.freeze({__proto__:null,CategoryScale:Qf,LinearScale:tg,LogarithmicScale:eg,RadialLinearScale:tl,TimeScale:yl,TimeSeriesScale:ig});const Vk=[qS,EC,vk,jk];ri.register(...Vk);function qy(n){return[...n].sort((t,e)=>t.date.localeCompare(e.date))}function Uk(n){var e;const t=qy(n);for(let s=t.length-1;s>=0;s-=1){const i=(e=t[s])==null?void 0:e.range;if(i&&(i.low!==void 0||i.high!==void 0))return i}return{}}function Gk(n){let t=null;function e(s,i){const r=qy(s),o=r.map(h=>h.date),a=r.map(h=>h.value),l=Uk(r),c=r.map(()=>l);t&&t.destroy(),t=new ri(n,{type:"line",data:{labels:o,datasets:[{label:i,data:a,borderColor:"#1f7a64",backgroundColor:"rgba(31, 122, 100, 0.15)",pointBackgroundColor:"#1f7a64",tension:.35,fill:!1},{label:"Low",data:c.map(h=>h.low??null),borderColor:"rgba(16, 32, 26, 0.2)",backgroundColor:"rgba(198, 230, 211, 0.4)",pointRadius:0,borderDash:[4,4],fill:"+1"},{label:"High",data:c.map(h=>h.high??null),borderColor:"rgba(16, 32, 26, 0.2)",backgroundColor:"rgba(198, 230, 211, 0.4)",pointRadius:0,borderDash:[4,4],fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,animation:!1,layout:{padding:{top:6,right:8,bottom:4,left:6}},plugins:{legend:{display:!1}},scales:{x:{grid:{display:!1},ticks:{maxRotation:0,maxTicksLimit:4}},y:{beginAtZero:!1,grid:{color:"rgba(16, 32, 26, 0.08)"},grace:"8%",ticks:{maxTicksLimit:5}}}},plugins:[{id:"range-background",beforeDraw(h){const{ctx:u,chartArea:f,scales:g}=h,p=l.low,m=l.high;if(p===void 0&&m===void 0)return;const b=p===void 0?void 0:g.y.getPixelForValue(p),y=m===void 0?void 0:g.y.getPixelForValue(m);u.save(),b!==void 0&&y!==void 0?(u.fillStyle="rgba(31, 122, 100, 0.08)",u.fillRect(f.left,y,f.right-f.left,b-y),u.fillStyle="rgba(200, 77, 77, 0.08)",u.fillRect(f.left,f.top,f.right-f.left,y-f.top),u.fillRect(f.left,b,f.right-f.left,f.bottom-b)):y!==void 0?(u.fillStyle="rgba(31, 122, 100, 0.08)",u.fillRect(f.left,y,f.right-f.left,f.bottom-y),u.fillStyle="rgba(200, 77, 77, 0.08)",u.fillRect(f.left,f.top,f.right-f.left,y-f.top)):b!==void 0&&(u.fillStyle="rgba(31, 122, 100, 0.08)",u.fillRect(f.left,f.top,f.right-f.left,b-f.top),u.fillStyle="rgba(200, 77, 77, 0.08)",u.fillRect(f.left,b,f.right-f.left,f.bottom-b)),u.restore()}}]})}return{render:e,destroy(){t&&(t.destroy(),t=null)},resize(s,i){t&&(t.resize(s,i),t.update("none"))}}}const Og="blood-results-reports";function Xk(n){let t=!1;const e=i=>Number.parseFloat(i.replace(",","."));return{reports:n.map(i=>{let r=!1;const o=i.markers.map(a=>{const l=Gr(a.marker),c=a.unit?Ft(l,a.unit):a.unit;if((l!==a.marker||c!==a.unit)&&(t=!0,r=!0,a={...a,marker:l,unit:c}),a.range||a.unit)return a;const h=a.marker.match(/^(.+?)\s+(\d+[\d.,]*)\s*[\-–]\s*(\d+[\d.,]*)\s+(.+)$/);if(h){const[,w,S,E,C]=h;if(!/^[A-Z]{1,3}\s*-/.test(w.trim()))return a;const k=e(S),M=e(E);return!Number.isFinite(k)||!Number.isFinite(M)?a:(t=!0,r=!0,{...a,marker:w.trim(),unit:C.trim(),range:{low:k,high:M}})}const u=a.marker.match(/^(.+?)\s+(<|>|≤|≥|nad|pod|do)\s*(\d+[\d.,]*)\s+(.+)$/i);if(!u)return a;const[,f,g,p,m]=u;if(!/^[A-Z]{1,3}\s*-/.test(f.trim()))return a;const b=e(p);if(!Number.isFinite(b))return a;const y=g.toLowerCase(),A=y===">"||y==="≥"||y==="nad"?{low:b}:y==="<"||y==="≤"||y==="pod"||y==="do"?{high:b}:void 0;return A?(t=!0,r=!0,{...a,marker:f.trim(),unit:m.trim(),range:A}):a});return r?{...i,markers:o}:i}),changed:t}}function Yk(){const n=localStorage.getItem(Og);if(!n)return[];try{const t=JSON.parse(n),e=Array.isArray(t)?t:[],s=Xk(e);return s.changed&&Ky(s.reports),s.reports}catch{return[]}}function Ky(n){localStorage.setItem(Og,JSON.stringify(n))}function qk(){localStorage.removeItem(Og)}const Hm={"S-Vitamin D":"25(OH) Vitamin D reflects vitamin D status. Deficiency/insufficiency thresholds vary by lab and guideline.","S-LDL holesterol":'LDL cholesterol ("bad" cholesterol). Targets depend on cardiovascular risk profile; labs may also flag with H/L based on their reference/decision limits.',"S-HDL holesterol":'HDL cholesterol ("good" cholesterol). Some labs treat this as a one-sided reference (e.g. nad/above a minimum).',"S-Kalcij":"Serum calcium. Reference intervals can vary with albumin correction, method and lab."},_l=document.getElementById("dropzone"),Bm=document.getElementById("file-input"),Zy=document.getElementById("upload-log"),Kk=document.getElementById("report-count"),Zk=document.getElementById("clear-storage"),eo=document.getElementById("marker-table"),zm=document.getElementById("chart-grid"),$m=document.getElementById("chart-empty"),vl=document.getElementById("marker-search"),Fg=document.getElementById("marker-search-toggle"),Di=document.getElementById("marker-search-input");let We=Yk();const Eo=new Set,qr=new Set,pu=new Map,ng="__";let $d="";const $e=document.createElement("div");$e.className="marker-popover";$e.hidden=!0;$e.addEventListener("pointerleave",Wc);document.body.appendChild($e);window.addEventListener("scroll",Wc,!0);window.addEventListener("resize",Wc);function rg(n){const t=Gr(n.marker),e=n.unit?Ft(t,n.unit):"";return`${t}${ng}${e}`}function Ng(n){const t=n.lastIndexOf(ng);if(t===-1)return{marker:n};const e=n.slice(0,t),s=n.slice(t+ng.length)||void 0;return{marker:e,unit:s}}function Mi(n){const{marker:t,unit:e}=Ng(n);return e?`${t} (${e})`:t}function Wm(n,t){if(!n||n.low===void 0&&n.high===void 0)return null;const e=t?` ${t}`:"";return n.low!==void 0&&n.high!==void 0?`${n.low} – ${n.high}${e}`:n.low!==void 0?`≥ ${n.low}${e}`:n.high!==void 0?`≤ ${n.high}${e}`:null}function Jy(n){return`${(n==null?void 0:n.low)??""}|${(n==null?void 0:n.high)??""}`}function Jk(n){const t=[...n].sort((i,r)=>i.date.localeCompare(r.date)),e=[];let s=null;for(const i of t){const r=i.range;if(!r||r.low===void 0&&r.high===void 0)continue;const o=Jy(r);o!==s&&(e.push({date:i.date,range:{low:r.low,high:r.high}}),s=o)}return e}function Qk(n){var e;const t=[...n].sort((s,i)=>s.date.localeCompare(i.date));for(let s=t.length-1;s>=0;s-=1){const i=(e=t[s])==null?void 0:e.range;if(i&&(i.low!==void 0||i.high!==void 0))return i}}function og(n,t="info"){const e=document.createElement("div");e.textContent=n,t==="error"&&(e.style.color="#c84d4d"),Zy.prepend(e)}function Wd(n){const t={};for(const e of n)for(const s of e.markers){const i=rg(s);t[i]||(t[i]=[]),t[i].push(s)}return t}function tM(){Kk.textContent=String(We.length)}function eM(n){var e;if(n.flag==="H")return!0;const t=(e=n.range)==null?void 0:e.high;return t===void 0?!1:n.value>t}function Qy(n){const t=new Set;for(const[e,s]of Object.entries(n))s.some(eM)&&t.add(e);return t}function sM(n,t){const e=new Set,s=new Set(Object.keys(n));for(const i of Eo)s.has(i)?e.add(i):Eo.delete(i);for(const i of qr)(!s.has(i)||!t.has(i))&&qr.delete(i);for(const i of t)qr.has(i)||e.add(i);return e}function iM(n){const t=$d.trim().toLowerCase();return t?n.filter(e=>Mi(e).toLowerCase().includes(t)):n}function nM(n,t,e){const s=Array.from(new Set(We.map(c=>c.date))).sort(),i=eo.querySelector("thead"),r=eo.querySelector("tbody");if(i.innerHTML="",r.innerHTML="",Object.keys(n).length===0){i.innerHTML="<tr><th>No markers yet</th></tr>";return}const a=document.createElement("tr"),l=document.createElement("th");if(l.textContent="Marker",a.appendChild(l),s.forEach(c=>{const h=document.createElement("th");h.textContent=c,a.appendChild(h)}),i.appendChild(a),t.length===0){const c=document.createElement("tr"),h=document.createElement("td");h.colSpan=s.length+1,h.textContent="No matches.",c.appendChild(h),r.appendChild(c);return}t.forEach(c=>{const h=document.createElement("tr"),u=document.createElement("td"),f=Ng(c),g=document.createElement("button");if(g.type="button",g.className=`marker-chip${e.has(c)?" is-active":""}`,g.dataset.markerKey=c,g.setAttribute("aria-pressed",e.has(c)?"true":"false"),g.append(document.createTextNode(f.marker)),f.unit){const p=document.createElement("span");p.className="marker-unit",p.textContent=f.unit,g.append(" ",p)}u.appendChild(g),h.appendChild(u),s.forEach(p=>{var y,A;const m=document.createElement("td"),b=n[c].find(w=>w.date===p);if(!b)m.textContent="—";else{const w=(y=b.range)==null?void 0:y.low,S=(A=b.range)==null?void 0:A.high;(w!==void 0&&b.value<w||S!==void 0&&b.value>S)&&m.classList.add("value-out");const C=f.unit??b.unit??"";m.textContent=C?`${b.value.toFixed(2)} ${C}`:b.value.toFixed(2)}h.appendChild(m)}),r.appendChild(h)})}function rM(n,t){for(const s of pu.values())s.destroy();if(pu.clear(),zm.innerHTML="",t.size===0){$m.hidden=!1;return}$m.hidden=!0,Array.from(t).sort((s,i)=>Mi(s).localeCompare(Mi(i))).forEach(s=>{const i=n[s];if(!i||i.length===0)return;const r=document.createElement("article");r.className="chart-card",r.setAttribute("role","listitem");const o=document.createElement("h3");o.textContent=Mi(s);const a=document.createElement("div");a.className="chart-canvas";const l=document.createElement("canvas");l.setAttribute("aria-label",`${Mi(s)} chart`),a.appendChild(l),r.append(o,a),zm.appendChild(r);const c=i.map(u=>({date:u.date,value:u.value,range:u.range})),h=Gk(l);h.render(c,Mi(s)),pu.set(s,h)})}function lo({charts:n}={charts:!0}){tM();const t=Wd(We),e=Object.keys(t).sort((r,o)=>Mi(r).localeCompare(Mi(o))),s=Qy(t),i=sM(t,s);nM(t,iM(e),i),n&&rM(t,i)}async function t_(n){if(!(!n||n.length===0))for(const t of Array.from(n)){const e=document.createElement("div");Zy.prepend(e);try{let s;if(t.type==="application/pdf")e.textContent=`Parsing ${t.name}...`,s=await DA(t);else if(t.type.startsWith("image/"))e.textContent=`OCR ${t.name}...`,s=await Fx(t,{onProgress:({status:r,progress:o})=>{const a=Number.isFinite(o)?Math.round(o*100):0;e.textContent=`OCR ${t.name}: ${r} (${a}%)`}});else{e.textContent=`${t.name}: unsupported file type (${t.type||"unknown"})`,e.style.color="#c84d4d";continue}s.markers.length===0&&og(`${t.name}: no markers detected`,"error");const i=We.findIndex(r=>r.date===s.date);if(i===-1)We=[s,...We];else{const r=We[i],o=[...r.markers];for(const a of s.markers){const l=rg(a),c=o.find(u=>rg(u)===l);if(!c){o.push(a);continue}if(!(c.value===a.value&&c.unit===a.unit)){og(`${s.date}: conflict for ${a.marker} (${c.value} ${c.unit??""} vs ${a.value} ${a.unit??""})`,"error");continue}!c.range&&a.range&&(c.range=a.range)}We[i]={...r,markers:o}}Ky(We),e.textContent=`${t.name}: imported ${s.markers.length} markers`,lo()}catch(s){const i=s instanceof Error?s.message:"Unknown error";e.textContent=`${t.name}: ${i}`,e.style.color="#c84d4d"}}}Bm.addEventListener("change",()=>t_(Bm.files));["dragenter","dragover"].forEach(n=>{_l.addEventListener(n,t=>{t.preventDefault(),_l.classList.add("dragover")})});["dragleave","drop"].forEach(n=>{_l.addEventListener(n,t=>{t.preventDefault(),_l.classList.remove("dragover")})});_l.addEventListener("drop",n=>{const t=n.dataTransfer;t&&t_(t.files)});eo.addEventListener("click",n=>{const e=n.target.closest(".marker-chip");if(!e)return;const s=e.dataset.markerKey;if(!s)return;const r=Qy(Wd(We)).has(s),o=Eo.has(s),a=qr.has(s);o||r&&!a?(Eo.delete(s),r&&qr.add(s)):(qr.delete(s),Eo.add(s)),lo()});function e_(n,t,e){const s=e[t]??[],{marker:i,unit:r}=Ng(t),o=Mi(t),a=Hm[i]??Hm[Gr(i)]??"",l=Jk(s),c=Qk(s),h=Wm(c,r)??"—",u=new Set(l.map(b=>Jy(b.range))).size>1;$e.innerHTML="";const f=document.createElement("div");if(f.className="marker-popover-title",f.textContent=o,$e.appendChild(f),a){const b=document.createElement("div");b.className="marker-popover-desc",b.textContent=a,$e.appendChild(b)}const g=document.createElement("div");if(g.className="marker-popover-note",g.textContent=`Chart uses latest reference: ${h}${u?" · Reference values changed over time":""}`,$e.appendChild(g),l.length>0){const b=document.createElement("ul");for(const y of l){const A=document.createElement("li");A.textContent=`${y.date}: ${Wm(y.range,r)??"—"}`,b.appendChild(A)}$e.appendChild(b)}const p=n.getBoundingClientRect(),m=10;$e.hidden=!1,$e.style.left=`${Math.min(window.innerWidth-m,Math.max(m,p.left))}px`,$e.style.top=`${Math.min(window.innerHeight-m,Math.max(m,p.bottom+8))}px`}function Wc(){$e.hidden=!0}eo.addEventListener("pointerover",n=>{const e=n.target.closest(".marker-chip");if(!e)return;const s=e.dataset.markerKey;if(!s)return;const i=Wd(We);e_(e,s,i)});eo.addEventListener("pointerout",n=>{if(!n.target.closest(".marker-chip"))return;const s=n.relatedTarget;s&&(s.closest(".marker-chip")||s.closest(".marker-popover"))||Wc()});eo.addEventListener("focusin",n=>{const e=n.target.closest(".marker-chip");if(!e)return;const s=e.dataset.markerKey;if(!s)return;const i=Wd(We);e_(e,s,i)});eo.addEventListener("focusout",n=>{const t=n.relatedTarget;t&&t.closest(".marker-popover")||Wc()});Zk.addEventListener("click",()=>{qk(),We=[],Eo.clear(),qr.clear(),lo(),og("Storage cleared.")});function oM(){vl.classList.add("is-open"),Fg.setAttribute("aria-expanded","true"),Di.focus()}function Hg(){vl.classList.remove("is-open"),Fg.setAttribute("aria-expanded","false")}Fg.addEventListener("click",()=>{if(!vl.classList.contains("is-open")){oM();return}if(Di.value){Di.value="",$d="",lo({charts:!1}),Di.focus();return}Hg()});Di.addEventListener("input",()=>{$d=Di.value,lo({charts:!1})});Di.addEventListener("keydown",n=>{n.key==="Escape"&&(Di.value="",$d="",Hg(),lo({charts:!1}))});document.addEventListener("pointerdown",n=>{if(!vl.classList.contains("is-open"))return;const t=n.target;t&&vl.contains(t)||Di.value.trim()||Hg()});lo();
